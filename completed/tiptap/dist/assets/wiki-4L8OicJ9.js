import{M as Oe,m as O,f as $e,g as Fe,h as Re,i as ie,k as S,l as Me,n as _e,o as T,F as R,p as N,q as ce,s as X,t as J,N as ae,v as Ke,w as Y,x as Te,y as Ne,z as Ve,D as qe,P as Ue,T as Ge,B as Xe,I as Je,S as Ye,C as Qe,U as Ze,H as et,a as tt,O as nt,L as ot,b as lt,c as rt,d as st,e as it,j as g,r as He,u as ct,E as at}from"./index-Jd2LHcLV.js";const dt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,ut=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,ft=Oe.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",O(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[$e({find:dt,type:this.type})]},addPasteRules(){return[Fe({find:ut,type:this.type})]}}),ht=Re.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:"left"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign||this.options.defaultAlignment;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign===this.options.defaultAlignment?{}:{style:`text-align: ${t.textAlign}`}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).every(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(e=>e)}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});var te,ne;if(typeof WeakMap<"u"){let t=new WeakMap;te=e=>t.get(e),ne=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;te=o=>{for(let l=0;l<t.length;l+=2)if(t[l]==o)return t[l+1]},ne=(o,l)=>(n==10&&(n=0),t[n++]=o,t[n++]=l)}var A=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,l=e/this.width|0;let r=o+1,s=l+1;for(let i=1;r<this.width&&this.map[e+i]==n;i++)r++;for(let i=1;s<this.height&&this.map[e+this.width*i]==n;i++)s++;return{left:o,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:l,top:r,bottom:s}=this.findCell(t);return e=="horiz"?(n<0?o==0:l==this.width)?null:this.map[r*this.width+(n<0?o-1:l)]:(n<0?r==0:s==this.height)?null:this.map[o+this.width*(n<0?r-1:s)]}rectBetween(t,e){const{left:n,right:o,top:l,bottom:r}=this.findCell(t),{left:s,right:i,top:c,bottom:a}=this.findCell(e);return{left:Math.min(n,s),top:Math.min(l,c),right:Math.max(o,i),bottom:Math.max(r,a)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let l=t.left;l<t.right;l++){const r=o*this.width+l,s=this.map[r];n[s]||(n[s]=!0,!(l==t.left&&l&&this.map[r-1]==s||o==t.top&&o&&this.map[r-this.width]==s)&&e.push(s))}return e}positionAt(t,e,n){for(let o=0,l=0;;o++){const r=l+n.child(o).nodeSize;if(o==t){let s=e+t*this.width;const i=(t+1)*this.width;for(;s<i&&this.map[s]<l;)s++;return s==i?r-1:this.map[s]}l=r}}static get(t){return te(t)||ne(t,pt(t))}};function pt(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=gt(t),n=t.childCount,o=[];let l=0,r=null;const s=[];for(let a=0,d=e*n;a<d;a++)o[a]=0;for(let a=0,d=0;a<n;a++){const u=t.child(a);d++;for(let p=0;;p++){for(;l<o.length&&o[l]!=0;)l++;if(p==u.childCount)break;const m=u.child(p),{colspan:b,rowspan:C,colwidth:k}=m.attrs;for(let L=0;L<C;L++){if(L+a>=n){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:C-L});break}const W=l+L*e;for(let E=0;E<b;E++){o[W+E]==0?o[W+E]=d:(r||(r=[])).push({type:"collision",row:a,pos:d,n:b-E});const $=k&&k[E];if($){const P=(W+E)%e*2,Z=s[P];Z==null||Z!=$&&s[P+1]==1?(s[P]=$,s[P+1]=1):Z==$&&s[P+1]++}}}l+=b,d+=m.nodeSize}const f=(a+1)*e;let h=0;for(;l<f;)o[l++]==0&&h++;h&&(r||(r=[])).push({type:"missing",row:a,n:h}),d++}const i=new A(e,n,o,r);let c=!1;for(let a=0;!c&&a<s.length;a+=2)s[a]!=null&&s[a+1]<n&&(c=!0);return c&&mt(i,s,t),i}function gt(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const l=t.child(o);let r=0;if(n)for(let s=0;s<o;s++){const i=t.child(s);for(let c=0;c<i.childCount;c++){const a=i.child(c);s+a.attrs.rowspan>o&&(r+=a.attrs.colspan)}}for(let s=0;s<l.childCount;s++){const i=l.child(s);r+=i.attrs.colspan,i.attrs.rowspan>1&&(n=!0)}e==-1?e=r:e!=r&&(e=Math.max(e,r))}return e}function mt(t,e,n){t.problems||(t.problems=[]);const o={};for(let l=0;l<t.map.length;l++){const r=t.map[l];if(o[r])continue;o[r]=!0;const s=n.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let i=null;const c=s.attrs;for(let a=0;a<c.colspan;a++){const d=(l+a)%t.width,u=e[d*2];u!=null&&(!c.colwidth||c.colwidth[a]!=u)&&((i||(i=bt(c)))[a]=u)}i&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:i})}}function bt(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function x(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],l=o.spec.tableRole;l&&(e[l]=o)}}return e}var j=new ie("selectingCells");function D(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function wt(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function M(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function Q(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=D(e.$head)||Ct(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Ct(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function oe(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function yt(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function de(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Le(t,e,n){const o=t.node(-1),l=A.get(o),r=t.start(-1),s=l.nextCell(t.pos-r,e,n);return s==null?null:t.node(0).resolve(r+s)}function B(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some(l=>l>0)||(o.colwidth=null)),o}function ze(t,e,n=1){const o={...t,colspan:t.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let l=0;l<n;l++)o.colwidth.splice(e,0,0)}return o}function At(t,e,n){const o=x(e.type.schema).header_cell;for(let l=0;l<t.height;l++)if(e.nodeAt(t.map[n+l*t.width]).type!=o)return!1;return!0}var w=class z extends S{constructor(e,n=e){const o=e.node(-1),l=A.get(o),r=e.start(-1),s=l.rectBetween(e.pos-r,n.pos-r),i=e.node(0),c=l.cellsInRect(s).filter(d=>d!=n.pos-r);c.unshift(n.pos-r);const a=c.map(d=>{const u=o.nodeAt(d);if(!u)throw RangeError(`No cell with offset ${d} found`);const f=r+d+1;return new _e(i.resolve(f),i.resolve(f+u.content.size))});super(a[0].$from,a[0].$to,a),this.$anchorCell=e,this.$headCell=n}map(e,n){const o=e.resolve(n.map(this.$anchorCell.pos)),l=e.resolve(n.map(this.$headCell.pos));if(oe(o)&&oe(l)&&de(o,l)){const r=this.$anchorCell.node(-1)!=o.node(-1);return r&&this.isRowSelection()?z.rowSelection(o,l):r&&this.isColSelection()?z.colSelection(o,l):new z(o,l)}return T.between(o,l)}content(){const e=this.$anchorCell.node(-1),n=A.get(e),o=this.$anchorCell.start(-1),l=n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),r={},s=[];for(let c=l.top;c<l.bottom;c++){const a=[];for(let d=c*n.width+l.left,u=l.left;u<l.right;u++,d++){const f=n.map[d];if(r[f])continue;r[f]=!0;const h=n.findCell(f);let p=e.nodeAt(f);if(!p)throw RangeError(`No cell with offset ${f} found`);const m=l.left-h.left,b=h.right-l.right;if(m>0||b>0){let C=p.attrs;if(m>0&&(C=B(C,0,m)),b>0&&(C=B(C,C.colspan-b,b)),h.left<l.left){if(p=p.type.createAndFill(C),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(C)}`)}else p=p.type.create(C,p.content)}if(h.top<l.top||h.bottom>l.bottom){const C={...p.attrs,rowspan:Math.min(h.bottom,l.bottom)-Math.max(h.top,l.top)};h.top<l.top?p=p.type.createAndFill(C):p=p.type.create(C,p.content)}a.push(p)}s.push(e.child(c).copy(R.from(a)))}const i=this.isColSelection()&&this.isRowSelection()?e:s;return new N(R.from(i),1,1)}replace(e,n=N.empty){const o=e.steps.length,l=this.ranges;for(let s=0;s<l.length;s++){const{$from:i,$to:c}=l[s],a=e.mapping.slice(o);e.replace(a.map(i.pos),a.map(c.pos),s?N.empty:n)}const r=S.findFrom(e.doc.resolve(e.mapping.slice(o).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,n){this.replace(e,new N(R.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),o=A.get(n),l=this.$anchorCell.start(-1),r=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l));for(let s=0;s<r.length;s++)e(n.nodeAt(r[s]),l+r[s])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const o=e+this.$anchorCell.nodeAfter.attrs.rowspan,l=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,l)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const o=e.node(-1),l=A.get(o),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(n.pos-r),c=e.node(0);return s.top<=i.top?(s.top>0&&(e=c.resolve(r+l.map[s.left])),i.bottom<l.height&&(n=c.resolve(r+l.map[l.width*(l.height-1)+i.right-1]))):(i.top>0&&(n=c.resolve(r+l.map[i.left])),s.bottom<l.height&&(e=c.resolve(r+l.map[l.width*(l.height-1)+s.right-1]))),new z(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=A.get(e),o=this.$anchorCell.start(-1),l=n.colCount(this.$anchorCell.pos-o),r=n.colCount(this.$headCell.pos-o);if(Math.min(l,r)>0)return!1;const s=l+this.$anchorCell.nodeAfter.attrs.colspan,i=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,i)==n.width}eq(e){return e instanceof z&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const o=e.node(-1),l=A.get(o),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(n.pos-r),c=e.node(0);return s.left<=i.left?(s.left>0&&(e=c.resolve(r+l.map[s.top*l.width])),i.right<l.width&&(n=c.resolve(r+l.map[l.width*(i.top+1)-1]))):(i.left>0&&(n=c.resolve(r+l.map[i.top*l.width])),s.right<l.width&&(e=c.resolve(r+l.map[l.width*(s.top+1)-1]))),new z(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new z(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){return new z(e.resolve(n),e.resolve(o))}getBookmark(){return new xt(this.$anchorCell.pos,this.$headCell.pos)}};w.prototype.visible=!1;S.jsonID("cell",w);var xt=class je{constructor(e,n){this.anchor=e,this.head=n}map(e){return new je(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),o=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&o.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&o.index()<o.parent.childCount&&de(n,o)?new w(n,o):S.near(o,1)}};function St(t){if(!(t.selection instanceof w))return null;const e=[];return t.selection.forEachCell((n,o)=>{e.push(J.node(o,o+n.nodeSize,{class:"selectedCell"}))}),X.create(t.doc,e)}function vt({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,o=e.pos,l=t.depth;for(;l>=0&&!(t.after(l+1)<t.end(l));l--,n++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,o--);return n==o&&/row|table/.test(t.node(l).type.spec.tableRole)}function kt({$from:t,$to:e}){let n,o;for(let l=t.depth;l>0;l--){const r=t.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){n=r;break}}for(let l=e.depth;l>0;l--){const r=e.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){o=r;break}}return n!==o&&e.parentOffset===0}function Rt(t,e,n){const o=(e||t).selection,l=(e||t).doc;let r,s;if(o instanceof ae&&(s=o.node.type.spec.tableRole)){if(s=="cell"||s=="header_cell")r=w.create(l,o.from);else if(s=="row"){const i=l.resolve(o.from+1);r=w.rowSelection(i,i)}else if(!n){const i=A.get(o.node),c=o.from+1,a=c+i.map[i.width*i.height-1];r=w.create(l,c+1,a)}}else o instanceof T&&vt(o)?r=T.create(l,o.from):o instanceof T&&kt(o)&&(r=T.create(l,o.$from.start(),o.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}var Mt=new ie("fix-tables");function Ee(t,e,n,o){const l=t.childCount,r=e.childCount;e:for(let s=0,i=0;s<r;s++){const c=e.child(s);for(let a=i,d=Math.min(l,s+3);a<d;a++)if(t.child(a)==c){i=a+1,n+=c.nodeSize;continue e}o(c,n),i<l&&t.child(i).sameMarkup(c)?Ee(t.child(i),c,n+1,o):c.nodesBetween(0,c.content.size,o,n+1),n+=c.nodeSize}}function Be(t,e){let n;const o=(l,r)=>{l.type.spec.tableRole=="table"&&(n=Tt(t,l,r,n))};return e?e.doc!=t.doc&&Ee(e.doc,t.doc,0,o):t.doc.descendants(o),n}function Tt(t,e,n,o){const l=A.get(e);if(!l.problems)return o;o||(o=t.tr);const r=[];for(let c=0;c<l.height;c++)r.push(0);for(let c=0;c<l.problems.length;c++){const a=l.problems[c];if(a.type=="collision"){const d=e.nodeAt(a.pos);if(!d)continue;const u=d.attrs;for(let f=0;f<u.rowspan;f++)r[a.row+f]+=a.n;o.setNodeMarkup(o.mapping.map(n+1+a.pos),null,B(u,u.colspan-a.n,a.n))}else if(a.type=="missing")r[a.row]+=a.n;else if(a.type=="overlong_rowspan"){const d=e.nodeAt(a.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+a.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-a.n})}else if(a.type=="colwidth mismatch"){const d=e.nodeAt(a.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+a.pos),null,{...d.attrs,colwidth:a.colwidth})}}let s,i;for(let c=0;c<r.length;c++)r[c]&&(s==null&&(s=c),i=c);for(let c=0,a=n+1;c<l.height;c++){const d=e.child(c),u=a+d.nodeSize,f=r[c];if(f>0){let h="cell";d.firstChild&&(h=d.firstChild.type.spec.tableRole);const p=[];for(let b=0;b<f;b++){const C=x(t.schema)[h].createAndFill();C&&p.push(C)}const m=(c==0||s==c-1)&&i==c?a+1:u-1;o.insert(o.mapping.map(m),p)}a=u}return o.setMeta(Mt,{fixTables:!0})}function H(t){const e=t.selection,n=Q(t),o=n.node(-1),l=n.start(-1),r=A.get(o);return{...e instanceof w?r.rectBetween(e.$anchorCell.pos-l,e.$headCell.pos-l):r.findCell(n.pos-l),tableStart:l,map:r,table:o}}function De(t,{map:e,tableStart:n,table:o},l){let r=l>0?-1:0;At(e,o,l+r)&&(r=l==0||l==e.width?null:0);for(let s=0;s<e.height;s++){const i=s*e.width+l;if(l>0&&l<e.width&&e.map[i-1]==e.map[i]){const c=e.map[i],a=o.nodeAt(c);t.setNodeMarkup(t.mapping.map(n+c),null,ze(a.attrs,l-e.colCount(c))),s+=a.attrs.rowspan-1}else{const c=r==null?x(o.type.schema).cell:o.nodeAt(e.map[i+r]).type,a=e.positionAt(s,l,o);t.insert(t.mapping.map(n+a),c.createAndFill())}}return t}function Nt(t,e){if(!M(t))return!1;if(e){const n=H(t);e(De(t.tr,n,n.left))}return!0}function Ht(t,e){if(!M(t))return!1;if(e){const n=H(t);e(De(t.tr,n,n.right))}return!0}function Lt(t,{map:e,table:n,tableStart:o},l){const r=t.mapping.maps.length;for(let s=0;s<e.height;){const i=s*e.width+l,c=e.map[i],a=n.nodeAt(c),d=a.attrs;if(l>0&&e.map[i-1]==c||l<e.width-1&&e.map[i+1]==c)t.setNodeMarkup(t.mapping.slice(r).map(o+c),null,B(d,l-e.colCount(c)));else{const u=t.mapping.slice(r).map(o+c);t.delete(u,u+a.nodeSize)}s+=d.rowspan}}function zt(t,e){if(!M(t))return!1;if(e){const n=H(t),o=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let l=n.right-1;Lt(o,n,l),l!=n.left;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=A.get(r)}e(o)}return!0}function jt(t,e,n){var o;const l=x(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if(((o=e.nodeAt(t.map[r+n*t.width]))==null?void 0:o.type)!=l)return!1;return!0}function We(t,{map:e,tableStart:n,table:o},l){var r;let s=n;for(let a=0;a<l;a++)s+=o.child(a).nodeSize;const i=[];let c=l>0?-1:0;jt(e,o,l+c)&&(c=l==0||l==e.height?null:0);for(let a=0,d=e.width*l;a<e.width;a++,d++)if(l>0&&l<e.height&&e.map[d]==e.map[d-e.width]){const u=e.map[d],f=o.nodeAt(u).attrs;t.setNodeMarkup(n+u,null,{...f,rowspan:f.rowspan+1}),a+=f.colspan-1}else{const u=c==null?x(o.type.schema).cell:(r=o.nodeAt(e.map[d+c*e.width]))==null?void 0:r.type,f=u==null?void 0:u.createAndFill();f&&i.push(f)}return t.insert(s,x(o.type.schema).row.create(null,i)),t}function Et(t,e){if(!M(t))return!1;if(e){const n=H(t);e(We(t.tr,n,n.top))}return!0}function Bt(t,e){if(!M(t))return!1;if(e){const n=H(t);e(We(t.tr,n,n.bottom))}return!0}function Dt(t,{map:e,table:n,tableStart:o},l){let r=0;for(let a=0;a<l;a++)r+=n.child(a).nodeSize;const s=r+n.child(l).nodeSize,i=t.mapping.maps.length;t.delete(r+o,s+o);const c=new Set;for(let a=0,d=l*e.width;a<e.width;a++,d++){const u=e.map[d];if(!c.has(u)){if(c.add(u),l>0&&u==e.map[d-e.width]){const f=n.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(i).map(u+o),null,{...f,rowspan:f.rowspan-1}),a+=f.colspan-1}else if(l<e.height&&u==e.map[d+e.width]){const f=n.nodeAt(u),h=f.attrs,p=f.type.create({...h,rowspan:f.attrs.rowspan-1},f.content),m=e.positionAt(l+1,a,n);t.insert(t.mapping.slice(i).map(o+m),p),a+=h.colspan-1}}}}function Wt(t,e){if(!M(t))return!1;if(e){const n=H(t),o=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let l=n.bottom-1;Dt(o,n,l),l!=n.top;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=A.get(n.table)}e(o)}return!0}function fe(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Pt({width:t,height:e,map:n},o){let l=o.top*t+o.left,r=l,s=(o.bottom-1)*t+o.left,i=l+(o.right-o.left-1);for(let c=o.top;c<o.bottom;c++){if(o.left>0&&n[r]==n[r-1]||o.right<t&&n[i]==n[i+1])return!0;r+=t,i+=t}for(let c=o.left;c<o.right;c++){if(o.top>0&&n[l]==n[l-t]||o.bottom<e&&n[s]==n[s+t])return!0;l++,s++}return!1}function he(t,e){const n=t.selection;if(!(n instanceof w)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=H(t),{map:l}=o;if(Pt(l,o))return!1;if(e){const r=t.tr,s={};let i=R.empty,c,a;for(let d=o.top;d<o.bottom;d++)for(let u=o.left;u<o.right;u++){const f=l.map[d*l.width+u],h=o.table.nodeAt(f);if(!(s[f]||!h))if(s[f]=!0,c==null)c=f,a=h;else{fe(h)||(i=i.append(h.content));const p=r.mapping.map(f+o.tableStart);r.delete(p,p+h.nodeSize)}}if(c==null||a==null)return!0;if(r.setNodeMarkup(c+o.tableStart,null,{...ze(a.attrs,a.attrs.colspan,o.right-o.left-a.attrs.colspan),rowspan:o.bottom-o.top}),i.size){const d=c+1+a.content.size,u=fe(a)?c+1:d;r.replaceWith(u+o.tableStart,d+o.tableStart,i)}r.setSelection(new w(r.doc.resolve(c+o.tableStart))),e(r)}return!0}function pe(t,e){const n=x(t.schema);return It(({node:o})=>n[o.type.spec.tableRole])(t,e)}function It(t){return(e,n)=>{var o;const l=e.selection;let r,s;if(l instanceof w){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=wt(l.$from),!r)return!1;s=(o=D(l.$from))==null?void 0:o.pos}if(r==null||s==null||r.attrs.colspan==1&&r.attrs.rowspan==1)return!1;if(n){let i=r.attrs;const c=[],a=i.colwidth;i.rowspan>1&&(i={...i,rowspan:1}),i.colspan>1&&(i={...i,colspan:1});const d=H(e),u=e.tr;for(let h=0;h<d.right-d.left;h++)c.push(a?{...i,colwidth:a&&a[h]?[a[h]]:null}:i);let f;for(let h=d.top;h<d.bottom;h++){let p=d.map.positionAt(h,d.left,d.table);h==d.top&&(p+=r.nodeSize);for(let m=d.left,b=0;m<d.right;m++,b++)m==d.left&&h==d.top||u.insert(f=u.mapping.map(p+d.tableStart,1),t({node:r,row:h,col:m}).createAndFill(c[b]))}u.setNodeMarkup(s,t({node:r,row:d.top,col:d.left}),c[0]),l instanceof w&&u.setSelection(new w(u.doc.resolve(l.$anchorCell.pos),f?u.doc.resolve(f):void 0)),n(u)}return!0}}function Ot(t,e){return function(n,o){if(!M(n))return!1;const l=Q(n);if(l.nodeAfter.attrs[t]===e)return!1;if(o){const r=n.tr;n.selection instanceof w?n.selection.forEachCell((s,i)=>{s.attrs[t]!==e&&r.setNodeMarkup(i,null,{...s.attrs,[t]:e})}):r.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[t]:e}),o(r)}return!0}}function $t(t){return function(e,n){if(!M(e))return!1;if(n){const o=x(e.schema),l=H(e),r=e.tr,s=l.map.cellsInRect(t=="column"?{left:l.left,top:0,right:l.right,bottom:l.map.height}:t=="row"?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),i=s.map(c=>l.table.nodeAt(c));for(let c=0;c<s.length;c++)i[c].type==o.header_cell&&r.setNodeMarkup(l.tableStart+s[c],o.cell,i[c].attrs);if(r.steps.length==0)for(let c=0;c<s.length;c++)r.setNodeMarkup(l.tableStart+s[c],o.header_cell,i[c].attrs);n(r)}return!0}}function ge(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let l=0;l<o.length;l++){const r=e.table.nodeAt(o[l]);if(r&&r.type!==n.header_cell)return!1}return!0}function I(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?$t(t):function(n,o){if(!M(n))return!1;if(o){const l=x(n.schema),r=H(n),s=n.tr,i=ge("row",r,l),c=ge("column",r,l),d=(t==="column"?i:t==="row"?c:!1)?1:0,u=t=="column"?{left:0,top:d,right:1,bottom:r.map.height}:t=="row"?{left:d,top:0,right:r.map.width,bottom:1}:r,f=t=="column"?c?l.cell:l.header_cell:t=="row"?i?l.cell:l.header_cell:l.cell;r.map.cellsInRect(u).forEach(h=>{const p=h+r.tableStart,m=s.doc.nodeAt(p);m&&s.setNodeMarkup(p,f,m.attrs)}),o(s)}return!0}}I("row",{useDeprecatedLogic:!0});I("column",{useDeprecatedLogic:!0});var Ft=I("cell",{useDeprecatedLogic:!0});function _t(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let o=t.index(-1)-1,l=t.before();o>=0;o--){const r=t.node(-1).child(o),s=r.lastChild;if(s)return l-1-s.nodeSize;l-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let o=t.indexAfter(-1),l=t.after();o<n.childCount;o++){const r=n.child(o);if(r.childCount)return l+1;l+=r.nodeSize}}return null}function me(t){return function(e,n){if(!M(e))return!1;const o=_t(Q(e),t);if(o==null)return!1;if(n){const l=e.doc.resolve(o);n(e.tr.setSelection(T.between(l,yt(l))).scrollIntoView())}return!0}}function Kt(t,e){const n=t.selection.$anchor;for(let o=n.depth;o>0;o--)if(n.node(o).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0;return!1}function F(t,e){const n=t.selection;if(!(n instanceof w))return!1;if(e){const o=t.tr,l=x(t.schema).cell.createAndFill().content;n.forEachCell((r,s)=>{r.content.eq(l)||o.replace(o.mapping.map(s+1),o.mapping.map(s+r.nodeSize-1),new N(l,0,0))}),o.docChanged&&e(o)}return!0}function Vt(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:o}=t;for(;e.childCount==1&&(n>0&&o>0||e.child(0).type.spec.tableRole=="table");)n--,o--,e=e.child(0).content;const l=e.child(0),r=l.type.spec.tableRole,s=l.type.schema,i=[];if(r=="row")for(let c=0;c<e.childCount;c++){let a=e.child(c).content;const d=c?0:Math.max(0,n-1),u=c<e.childCount-1?0:Math.max(0,o-1);(d||u)&&(a=le(x(s).row,new N(a,d,u)).content),i.push(a)}else if(r=="cell"||r=="header_cell")i.push(n||o?le(x(s).row,new N(e,n,o)).content:e);else return null;return qt(s,i)}function qt(t,e){const n=[];for(let l=0;l<e.length;l++){const r=e[l];for(let s=r.childCount-1;s>=0;s--){const{rowspan:i,colspan:c}=r.child(s).attrs;for(let a=l;a<l+i;a++)n[a]=(n[a]||0)+c}}let o=0;for(let l=0;l<n.length;l++)o=Math.max(o,n[l]);for(let l=0;l<n.length;l++)if(l>=e.length&&e.push(R.empty),n[l]<o){const r=x(t).cell.createAndFill(),s=[];for(let i=n[l];i<o;i++)s.push(r);e[l]=e[l].append(R.from(s))}return{height:e.length,width:o,rows:e}}function le(t,e){const n=t.createAndFill();return new Ke(n).replace(0,n.content.size,e).doc}function Ut({width:t,height:e,rows:n},o,l){if(t!=o){const r=[],s=[];for(let i=0;i<n.length;i++){const c=n[i],a=[];for(let d=r[i]||0,u=0;d<o;u++){let f=c.child(u%c.childCount);d+f.attrs.colspan>o&&(f=f.type.createChecked(B(f.attrs,f.attrs.colspan,d+f.attrs.colspan-o),f.content)),a.push(f),d+=f.attrs.colspan;for(let h=1;h<f.attrs.rowspan;h++)r[i+h]=(r[i+h]||0)+f.attrs.colspan}s.push(R.from(a))}n=s,t=o}if(e!=l){const r=[];for(let s=0,i=0;s<l;s++,i++){const c=[],a=n[i%e];for(let d=0;d<a.childCount;d++){let u=a.child(d);s+u.attrs.rowspan>l&&(u=u.type.create({...u.attrs,rowspan:Math.max(1,l-u.attrs.rowspan)},u.content)),c.push(u)}r.push(R.from(c))}n=r,e=l}return{width:t,height:e,rows:n}}function Gt(t,e,n,o,l,r,s){const i=t.doc.type.schema,c=x(i);let a,d;if(l>e.width)for(let u=0,f=0;u<e.height;u++){const h=n.child(u);f+=h.nodeSize;const p=[];let m;h.lastChild==null||h.lastChild.type==c.cell?m=a||(a=c.cell.createAndFill()):m=d||(d=c.header_cell.createAndFill());for(let b=e.width;b<l;b++)p.push(m);t.insert(t.mapping.slice(s).map(f-1+o),p)}if(r>e.height){const u=[];for(let p=0,m=(e.height-1)*e.width;p<Math.max(e.width,l);p++){const b=p>=e.width?!1:n.nodeAt(e.map[m+p]).type==c.header_cell;u.push(b?d||(d=c.header_cell.createAndFill()):a||(a=c.cell.createAndFill()))}const f=c.row.create(null,R.from(u)),h=[];for(let p=e.height;p<r;p++)h.push(f);t.insert(t.mapping.slice(s).map(o+n.nodeSize-2),h)}return!!(a||d)}function be(t,e,n,o,l,r,s,i){if(s==0||s==e.height)return!1;let c=!1;for(let a=l;a<r;a++){const d=s*e.width+a,u=e.map[d];if(e.map[d-e.width]==u){c=!0;const f=n.nodeAt(u),{top:h,left:p}=e.findCell(u);t.setNodeMarkup(t.mapping.slice(i).map(u+o),null,{...f.attrs,rowspan:s-h}),t.insert(t.mapping.slice(i).map(e.positionAt(s,p,n)),f.type.createAndFill({...f.attrs,rowspan:h+f.attrs.rowspan-s})),a+=f.attrs.colspan-1}}return c}function we(t,e,n,o,l,r,s,i){if(s==0||s==e.width)return!1;let c=!1;for(let a=l;a<r;a++){const d=a*e.width+s,u=e.map[d];if(e.map[d-1]==u){c=!0;const f=n.nodeAt(u),h=e.colCount(u),p=t.mapping.slice(i).map(u+o);t.setNodeMarkup(p,null,B(f.attrs,s-h,f.attrs.colspan-(s-h))),t.insert(p+f.nodeSize,f.type.createAndFill(B(f.attrs,0,s-h))),a+=f.attrs.rowspan-1}}return c}function Ce(t,e,n,o,l){let r=n?t.doc.nodeAt(n-1):t.doc;if(!r)throw new Error("No table found");let s=A.get(r);const{top:i,left:c}=o,a=c+l.width,d=i+l.height,u=t.tr;let f=0;function h(){if(r=n?u.doc.nodeAt(n-1):u.doc,!r)throw new Error("No table found");s=A.get(r),f=u.mapping.maps.length}Gt(u,s,r,n,a,d,f)&&h(),be(u,s,r,n,c,a,i,f)&&h(),be(u,s,r,n,c,a,d,f)&&h(),we(u,s,r,n,i,d,c,f)&&h(),we(u,s,r,n,i,d,a,f)&&h();for(let p=i;p<d;p++){const m=s.positionAt(p,c,r),b=s.positionAt(p,a,r);u.replace(u.mapping.slice(f).map(m+n),u.mapping.slice(f).map(b+n),new N(l.rows[p-i],0,0))}h(),u.setSelection(new w(u.doc.resolve(n+s.positionAt(i,c,r)),u.doc.resolve(n+s.positionAt(d-1,a-1,r)))),e(u)}var Xt=Me({ArrowLeft:_("horiz",-1),ArrowRight:_("horiz",1),ArrowUp:_("vert",-1),ArrowDown:_("vert",1),"Shift-ArrowLeft":K("horiz",-1),"Shift-ArrowRight":K("horiz",1),"Shift-ArrowUp":K("vert",-1),"Shift-ArrowDown":K("vert",1),Backspace:F,"Mod-Backspace":F,Delete:F,"Mod-Delete":F});function U(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function _(t,e){return(n,o,l)=>{if(!l)return!1;const r=n.selection;if(r instanceof w)return U(n,o,S.near(r.$headCell,e));if(t!="horiz"&&!r.empty)return!1;const s=Pe(l,t,e);if(s==null)return!1;if(t=="horiz")return U(n,o,S.near(n.doc.resolve(r.head+e),e));{const i=n.doc.resolve(s),c=Le(i,t,e);let a;return c?a=S.near(c,1):e<0?a=S.near(n.doc.resolve(i.before(-1)),-1):a=S.near(n.doc.resolve(i.after(-1)),1),U(n,o,a)}}}function K(t,e){return(n,o,l)=>{if(!l)return!1;const r=n.selection;let s;if(r instanceof w)s=r;else{const c=Pe(l,t,e);if(c==null)return!1;s=new w(n.doc.resolve(c))}const i=Le(s.$headCell,t,e);return i?U(n,o,new w(s.$anchorCell,i)):!1}}function Jt(t,e){const n=t.state.doc,o=D(n.resolve(e));return o?(t.dispatch(t.state.tr.setSelection(new w(o))),!0):!1}function Yt(t,e,n){if(!M(t.state))return!1;let o=Vt(n);const l=t.state.selection;if(l instanceof w){o||(o={width:1,height:1,rows:[R.from(le(x(t.state.schema).cell,n))]});const r=l.$anchorCell.node(-1),s=l.$anchorCell.start(-1),i=A.get(r).rectBetween(l.$anchorCell.pos-s,l.$headCell.pos-s);return o=Ut(o,i.right-i.left,i.bottom-i.top),Ce(t.state,t.dispatch,s,i,o),!0}else if(o){const r=Q(t.state),s=r.start(-1);return Ce(t.state,t.dispatch,s,A.get(r.node(-1)).findCell(r.pos-s),o),!0}else return!1}function Qt(t,e){var n;if(e.ctrlKey||e.metaKey)return;const o=ye(t,e.target);let l;if(e.shiftKey&&t.state.selection instanceof w)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&(l=D(t.state.selection.$anchor))!=null&&((n=ee(t,e))==null?void 0:n.pos)!=l.pos)r(l,e),e.preventDefault();else if(!o)return;function r(c,a){let d=ee(t,a);const u=j.getState(t.state)==null;if(!d||!de(c,d))if(u)d=c;else return;const f=new w(c,d);if(u||!t.state.selection.eq(f)){const h=t.state.tr.setSelection(f);u&&h.setMeta(j,c.pos),t.dispatch(h)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",i),j.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(j,-1))}function i(c){const a=c,d=j.getState(t.state);let u;if(d!=null)u=t.state.doc.resolve(d);else if(ye(t,a.target)!=o&&(u=ee(t,e),!u))return s();u&&r(u,a)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",i)}function Pe(t,e,n){if(!(t.state.selection instanceof T))return null;const{$head:o}=t.state.selection;for(let l=o.depth-1;l>=0;l--){const r=o.node(l);if((n<0?o.index(l):o.indexAfter(l))!=(n<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){const i=o.before(l),c=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(c)?i:null}}return null}function ye(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function ee(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?D(t.state.doc.resolve(n.pos)):null}var Zt=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),re(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,re(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function re(t,e,n,o,l,r){var s;let i=0,c=!0,a=e.firstChild;const d=t.firstChild;if(d){for(let u=0,f=0;u<d.childCount;u++){const{colspan:h,colwidth:p}=d.child(u).attrs;for(let m=0;m<h;m++,f++){const b=l==f?r:p&&p[m],C=b?b+"px":"";if(i+=b||o,b||(c=!1),a)a.style.width!=C&&(a.style.width=C),a=a.nextSibling;else{const k=document.createElement("col");k.style.width=C,e.appendChild(k)}}}for(;a;){const u=a.nextSibling;(s=a.parentNode)==null||s.removeChild(a),a=u}c?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}}var v=new ie("tableColumnResizing");function en({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:o=Zt,lastColumnResizable:l=!0}={}){const r=new ce({key:v,state:{init(s,i){var c,a;const d=(a=(c=r.spec)==null?void 0:c.props)==null?void 0:a.nodeViews,u=x(i.schema).table.name;return o&&d&&(d[u]=(f,h)=>new o(f,n,h)),new tn(-1,!1)},apply(s,i){return i.apply(s)}},props:{attributes:s=>{const i=v.getState(s);return i&&i.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(s,i)=>{nn(s,i,t,l)},mouseleave:s=>{on(s)},mousedown:(s,i)=>{ln(s,i,e,n)}},decorations:s=>{const i=v.getState(s);if(i&&i.activeHandle>-1)return dn(s,i.activeHandle)},nodeViews:{}}});return r}var tn=class G{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,o=e.getMeta(v);if(o&&o.setHandle!=null)return new G(o.setHandle,!1);if(o&&o.setDragging!==void 0)return new G(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&e.docChanged){let l=e.mapping.map(n.activeHandle,-1);return oe(e.doc.resolve(l))||(l=-1),new G(l,n.dragging)}return n}};function nn(t,e,n,o){const l=v.getState(t.state);if(l&&!l.dragging){const r=sn(e.target);let s=-1;if(r){const{left:i,right:c}=r.getBoundingClientRect();e.clientX-i<=n?s=Ae(t,e,"left",n):c-e.clientX<=n&&(s=Ae(t,e,"right",n))}if(s!=l.activeHandle){if(!o&&s!==-1){const i=t.state.doc.resolve(s),c=i.node(-1),a=A.get(c),d=i.start(-1);if(a.colCount(i.pos-d)+i.nodeAfter.attrs.colspan-1==a.width-1)return}Ie(t,s)}}}function on(t){const e=v.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&Ie(t,-1)}function ln(t,e,n,o){var l;const r=(l=t.dom.ownerDocument.defaultView)!=null?l:window,s=v.getState(t.state);if(!s||s.activeHandle==-1||s.dragging)return!1;const i=t.state.doc.nodeAt(s.activeHandle),c=rn(t,s.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(v,{setDragging:{startX:e.clientX,startWidth:c}}));function a(u){r.removeEventListener("mouseup",a),r.removeEventListener("mousemove",d);const f=v.getState(t.state);f!=null&&f.dragging&&(cn(t,f.activeHandle,xe(f.dragging,u,n)),t.dispatch(t.state.tr.setMeta(v,{setDragging:null})))}function d(u){if(!u.which)return a(u);const f=v.getState(t.state);if(f&&f.dragging){const h=xe(f.dragging,u,n);Se(t,f.activeHandle,h,o)}}return Se(t,s.activeHandle,c,o),r.addEventListener("mouseup",a),r.addEventListener("mousemove",d),e.preventDefault(),!0}function rn(t,e,{colspan:n,colwidth:o}){const l=o&&o[o.length-1];if(l)return l;const r=t.domAtPos(e);let i=r.node.childNodes[r.offset].offsetWidth,c=n;if(o)for(let a=0;a<n;a++)o[a]&&(i-=o[a],c--);return i/c}function sn(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function Ae(t,e,n,o){const l=n=="right"?-o:o,r=t.posAtCoords({left:e.clientX+l,top:e.clientY});if(!r)return-1;const{pos:s}=r,i=D(t.state.doc.resolve(s));if(!i)return-1;if(n=="right")return i.pos;const c=A.get(i.node(-1)),a=i.start(-1),d=c.map.indexOf(i.pos-a);return d%c.width==0?-1:a+c.map[d-1]}function xe(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function Ie(t,e){t.dispatch(t.state.tr.setMeta(v,{setHandle:e}))}function cn(t,e,n){const o=t.state.doc.resolve(e),l=o.node(-1),r=A.get(l),s=o.start(-1),i=r.colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,c=t.state.tr;for(let a=0;a<r.height;a++){const d=a*r.width+i;if(a&&r.map[d]==r.map[d-r.width])continue;const u=r.map[d],f=l.nodeAt(u).attrs,h=f.colspan==1?0:i-r.colCount(u);if(f.colwidth&&f.colwidth[h]==n)continue;const p=f.colwidth?f.colwidth.slice():an(f.colspan);p[h]=n,c.setNodeMarkup(s+u,null,{...f,colwidth:p})}c.docChanged&&t.dispatch(c)}function Se(t,e,n,o){const l=t.state.doc.resolve(e),r=l.node(-1),s=l.start(-1),i=A.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1;let c=t.domAtPos(l.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&re(r,c.firstChild,c,o,i,n)}function an(t){return Array(t).fill(0)}function dn(t,e){var n;const o=[],l=t.doc.resolve(e),r=l.node(-1);if(!r)return X.empty;const s=A.get(r),i=l.start(-1),c=s.colCount(l.pos-i)+l.nodeAfter.attrs.colspan-1;for(let a=0;a<s.height;a++){const d=c+a*s.width;if((c==s.width-1||s.map[d]!=s.map[d+1])&&(a==0||s.map[d]!=s.map[d-s.width])){const u=s.map[d],f=i+u+r.nodeAt(u).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",(n=v.getState(t))!=null&&n.dragging&&o.push(J.node(i+u,i+u+r.nodeAt(u).nodeSize,{class:"column-resize-dragging"})),o.push(J.widget(f,h))}}return X.create(t.doc,o)}function un({allowTableNodeSelection:t=!1}={}){return new ce({key:j,state:{init(){return null},apply(e,n){const o=e.getMeta(j);if(o!=null)return o==-1?null:o;if(n==null||!e.docChanged)return n;const{deleted:l,pos:r}=e.mapping.mapResult(n);return l?null:r}},props:{decorations:St,handleDOMEvents:{mousedown:Qt},createSelectionBetween(e){return j.getState(e.state)!=null?e.state.selection:null},handleTripleClick:Jt,handleKeyDown:Xt,handlePaste:Yt},appendTransaction(e,n,o){return Rt(o,Be(o,n),t)}})}function se(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function ve(t,e,n,o,l,r){var s;let i=0,c=!0,a=e.firstChild;const d=t.firstChild;if(d!==null)for(let u=0,f=0;u<d.childCount;u+=1){const{colspan:h,colwidth:p}=d.child(u).attrs;for(let m=0;m<h;m+=1,f+=1){const b=l===f?r:p&&p[m],C=b?`${b}px`:"";if(i+=b||o,b||(c=!1),a){if(a.style.width!==C){const[k,L]=se(o,b);a.style.setProperty(k,L)}a=a.nextSibling}else{const k=document.createElement("col"),[L,W]=se(o,b);k.style.setProperty(L,W),e.appendChild(k)}}}for(;a;){const u=a.nextSibling;(s=a.parentNode)===null||s===void 0||s.removeChild(a),a=u}c?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}class fn{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ve(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,ve(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function hn(t,e,n,o){let l=0,r=!0;const s=[],i=t.firstChild;if(!i)return{};for(let u=0,f=0;u<i.childCount;u+=1){const{colspan:h,colwidth:p}=i.child(u).attrs;for(let m=0;m<h;m+=1,f+=1){const b=n===f?o:p&&p[m];l+=b||e,b||(r=!1);const[C,k]=se(e,b);s.push(["col",{style:`${C}: ${k}`}])}}const c=r?`${l}px`:"",a=r?"":`${l}px`;return{colgroup:["colgroup",{},...s],tableWidth:c,tableMinWidth:a}}function ke(t,e){return t.createAndFill()}function pn(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const o=t.nodes[n];o.spec.tableRole&&(e[o.spec.tableRole]=o)}),t.cached.tableNodeTypes=e,e}function gn(t,e,n,o,l){const r=pn(t),s=[],i=[];for(let a=0;a<n;a+=1){const d=ke(r.cell);if(d&&i.push(d),o){const u=ke(r.header_cell);u&&s.push(u)}}const c=[];for(let a=0;a<e;a+=1)c.push(r.row.createChecked(null,o&&a===0?s:i));return r.table.createChecked(null,c)}function mn(t){return t instanceof w}const V=({editor:t})=>{const{selection:e}=t.state;if(!mn(e))return!1;let n=0;const o=Ve(e.ranges[0].$from,r=>r.type.name==="table");return o==null||o.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},bn=Y.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:fn,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:o,tableMinWidth:l}=hn(t,this.options.cellMinWidth);return["table",O(this.options.HTMLAttributes,e,{style:o?`width: ${o}`:`min-width: ${l}`}),n,["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:o,dispatch:l,editor:r})=>{const s=gn(r.schema,t,e,n);if(l){const i=o.selection.from+1;o.replaceSelectionWith(s).scrollIntoView().setSelection(T.near(o.doc.resolve(i)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Nt(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Ht(t,e),deleteColumn:()=>({state:t,dispatch:e})=>zt(t,e),addRowBefore:()=>({state:t,dispatch:e})=>Et(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Bt(t,e),deleteRow:()=>({state:t,dispatch:e})=>Wt(t,e),deleteTable:()=>({state:t,dispatch:e})=>Kt(t,e),mergeCells:()=>({state:t,dispatch:e})=>he(t,e),splitCell:()=>({state:t,dispatch:e})=>pe(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>I("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>I("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>Ft(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>he(t,e)?!0:pe(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:o})=>Ot(t,e)(n,o),goToNextCell:()=>({state:t,dispatch:e})=>me(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>me(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Be(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const o=w.create(e.doc,t.anchorCell,t.headCell);e.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:V,"Mod-Backspace":V,Delete:V,"Mod-Delete":V}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[en({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],un({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Te(Ne(t,"tableRole",e))}}}),wn=Y.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",O(this.options.HTMLAttributes,t),0]}}),Cn=Y.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",O(this.options.HTMLAttributes,t),0]}}),yn=Y.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",O(this.options.HTMLAttributes,t),0]}});class y extends S{constructor(e){super(e,e)}map(e,n){let o=e.resolve(n.map(this.head));return y.valid(o)?new y(o):S.near(o)}content(){return N.empty}eq(e){return e instanceof y&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new y(e.resolve(n.pos))}getBookmark(){return new ue(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!An(e)||!xn(e))return!1;let o=n.type.spec.allowGapCursor;if(o!=null)return o;let l=n.contentMatchAt(e.index()).defaultType;return l&&l.isTextblock}static findGapCursorFrom(e,n,o=!1){e:for(;;){if(!o&&y.valid(e))return e;let l=e.pos,r=null;for(let s=e.depth;;s--){let i=e.node(s);if(n>0?e.indexAfter(s)<i.childCount:e.index(s)>0){r=i.child(n>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;l+=n;let c=e.doc.resolve(l);if(y.valid(c))return c}for(;;){let s=n>0?r.firstChild:r.lastChild;if(!s){if(r.isAtom&&!r.isText&&!ae.isSelectable(r)){e=e.doc.resolve(l+r.nodeSize*n),o=!1;continue e}break}r=s,l+=n;let i=e.doc.resolve(l);if(y.valid(i))return i}return null}}}y.prototype.visible=!1;y.findFrom=y.findGapCursorFrom;S.jsonID("gapcursor",y);class ue{constructor(e){this.pos=e}map(e){return new ue(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return y.valid(n)?new y(n):S.near(n)}}function An(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),o=t.node(e);if(n==0){if(o.type.spec.isolating)return!0;continue}for(let l=o.child(n-1);;l=l.lastChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function xn(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),o=t.node(e);if(n==o.childCount){if(o.type.spec.isolating)return!0;continue}for(let l=o.child(n);;l=l.firstChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function Sn(){return new ce({props:{decorations:Mn,createSelectionBetween(t,e,n){return e.pos==n.pos&&y.valid(n)?new y(n):null},handleClick:kn,handleKeyDown:vn,handleDOMEvents:{beforeinput:Rn}}})}const vn=Me({ArrowLeft:q("horiz",-1),ArrowRight:q("horiz",1),ArrowUp:q("vert",-1),ArrowDown:q("vert",1)});function q(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,l,r){let s=o.selection,i=e>0?s.$to:s.$from,c=s.empty;if(s instanceof T){if(!r.endOfTextblock(n)||i.depth==0)return!1;c=!1,i=o.doc.resolve(e>0?i.after():i.before())}let a=y.findGapCursorFrom(i,e,c);return a?(l&&l(o.tr.setSelection(new y(a))),!0):!1}}function kn(t,e,n){if(!t||!t.editable)return!1;let o=t.state.doc.resolve(e);if(!y.valid(o))return!1;let l=t.posAtCoords({left:n.clientX,top:n.clientY});return l&&l.inside>-1&&ae.isSelectable(t.state.doc.nodeAt(l.inside))?!1:(t.dispatch(t.state.tr.setSelection(new y(o))),!0)}function Rn(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof y))return!1;let{$from:n}=t.state.selection,o=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!o)return!1;let l=R.empty;for(let s=o.length-1;s>=0;s--)l=R.from(o[s].createAndFill(null,l));let r=t.state.tr.replace(n.pos,n.pos,new N(l,0,0));return r.setSelection(T.near(r.doc.resolve(n.pos+1))),t.dispatch(r),!1}function Mn(t){if(!(t.selection instanceof y))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",X.create(t.doc,[J.widget(t.selection.head,e,{key:"gapcursor"})])}const Tn=Re.create({name:"gapCursor",addProseMirrorPlugins(){return[Sn()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Te(Ne(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Nn=[qe,Ue,Ge,Xe,Je,Ye,Qe,Ze,et.configure({levels:[1,2,3,4,5,6]}),tt,nt,ot,lt.configure({openOnClick:!0,autolink:!0,defaultProtocol:"https"}),rt,st,ft,ht.configure({types:["heading","paragraph"]}),Tn,bn.configure({resizable:!0}),yn,Cn,wn],Hn=`
  <h2>
    Hi there,
  </h2>
  <p>
    this is a <em>basic</em> example of <strong>Tiptap</strong>. Sure, there are all kind of basic text styles you‚Äôd probably expect from a text editor. But wait until you see the lists:
  </p>
  <ul>
    <li>
      That‚Äôs a bullet list with one ‚Ä¶
    </li>
    <li>
      ‚Ä¶ or two list items.
    </li>
  </ul>
  <p>
    Isn‚Äôt that great? And all of that is editable. But wait, there‚Äôs more. Let‚Äôs try a code block:
  </p>
  <pre><code class="language-css">body {
    display: none;
  }</code></pre>
  <p>
    I know, I know, this is impressive. It‚Äôs only the tip of the iceberg though. Give it a try and click a little bit around. Don‚Äôt forget to check the other examples too.
  </p>
  <blockquote>
    Wow, that‚Äôs amazing. Good work, boy! üëè
    <br />
    ‚Äî Mom
  </blockquote>
  <table>
    <tbody>
    <tr>
        <th>Name</th>
        <th colspan="3">Description</th>
    </tr>
    <tr>
        <td>Cyndi Lauper</td>
        <td>Singer</td>
        <td>Songwriter</td>
        <td>Actress</td>
    </tr>
    </tbody>
  </table>
  `,Ln=()=>{const t=ct({extensions:Nn,content:Hn});if(!t)return null;const e=He.useCallback(()=>{const n=t.getAttributes("link").href,o=window.prompt("URL",n);if(o!==null){if(o===""){t.chain().focus().extendMarkRange("link").unsetLink().run();return}t.chain().focus().extendMarkRange("link").setLink({href:o}).run()}},[t]);return g.jsxs("div",{className:"card",children:[g.jsx("h1",{children:"Tiptap Wiki - React"}),g.jsx("div",{className:"control-group",children:g.jsxs("div",{className:"button-group",children:[g.jsx("button",{onClick:()=>t.chain().focus().toggleBold().run(),disabled:!t.can().chain().focus().toggleBold().run(),className:t.isActive("bold")?"is-active":"",children:"Bold"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleItalic().run(),disabled:!t.can().chain().focus().toggleItalic().run(),className:t.isActive("italic")?"is-active":"",children:"Italic"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleStrike().run(),disabled:!t.can().chain().focus().toggleStrike().run(),className:t.isActive("strike")?"is-active":"",children:"Strike"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleUnderline().run(),disabled:!t.can().chain().focus().toggleUnderline().run(),className:t.isActive("underline")?"is-active":"",children:"Underline"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHighlight().run(),className:t.isActive("highlight")?"is-active":"",children:"Highlight"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleCode().run(),disabled:!t.can().chain().focus().toggleCode().run(),className:t.isActive("code")?"is-active":"",children:"Code"})," ",g.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:1}).run(),className:t.isActive("heading",{level:1})?"is-active":"",children:"H1"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:2}).run(),className:t.isActive("heading",{level:2})?"is-active":"",children:"H2"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:3}).run(),className:t.isActive("heading",{level:3})?"is-active":"",children:"H3"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeading({level:4}).run(),className:t.isActive("heading",{level:4})?"is-active":"",children:"H4"})," ",g.jsx("button",{onClick:()=>t.chain().focus().toggleBulletList().run(),className:t.isActive("bulletList")?"is-active":"",children:"Bullet list"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleOrderedList().run(),className:t.isActive("orderedList")?"is-active":"",children:"Ordered list"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleCodeBlock().run(),className:t.isActive("codeBlock")?"is-active":"",children:"Code block"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleBlockquote().run(),className:t.isActive("blockquote")?"is-active":"",children:"Blockquote"})," ",g.jsx("button",{onClick:()=>t.chain().focus().setTextAlign("left").run(),className:t.isActive({textAlign:"left"})?"is-active":"",children:"Left"}),g.jsx("button",{onClick:()=>t.chain().focus().setTextAlign("center").run(),className:t.isActive({textAlign:"center"})?"is-active":"",children:"Center"}),g.jsx("button",{onClick:()=>t.chain().focus().setTextAlign("right").run(),className:t.isActive({textAlign:"right"})?"is-active":"",children:"Right"})," ",g.jsx("button",{onClick:e,className:t.isActive("link")?"is-active":"",children:"Set link"}),g.jsx("button",{onClick:()=>t.chain().focus().unsetLink().run(),disabled:!t.isActive("link"),children:"Unset link"}),g.jsxs("div",{className:"button-group",children:[g.jsx("button",{onClick:()=>t.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),children:"Insert table"}),g.jsx("button",{onClick:()=>t.chain().focus().addColumnBefore().run(),children:"Add column before"}),g.jsx("button",{onClick:()=>t.chain().focus().addColumnAfter().run(),children:"Add column after"}),g.jsx("button",{onClick:()=>t.chain().focus().deleteColumn().run(),children:"Delete column"}),g.jsx("button",{onClick:()=>t.chain().focus().addRowBefore().run(),children:"Add row before"}),g.jsx("button",{onClick:()=>t.chain().focus().addRowAfter().run(),children:"Add row after"}),g.jsx("button",{onClick:()=>t.chain().focus().deleteRow().run(),children:"Delete row"}),g.jsx("button",{onClick:()=>t.chain().focus().deleteTable().run(),children:"Delete table"}),g.jsx("button",{onClick:()=>t.chain().focus().mergeCells().run(),children:"Merge cells"}),g.jsx("button",{onClick:()=>t.chain().focus().splitCell().run(),children:"Split cell"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeaderColumn().run(),children:"Toggle header column"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeaderRow().run(),children:"Toggle header row"}),g.jsx("button",{onClick:()=>t.chain().focus().toggleHeaderCell().run(),children:"Toggle header cell"}),g.jsx("button",{onClick:()=>t.chain().focus().mergeOrSplit().run(),children:"Merge or split"}),g.jsx("button",{onClick:()=>t.chain().focus().setCellAttribute("colspan",2).run(),children:"Set cell attribute"}),g.jsx("button",{onClick:()=>t.chain().focus().fixTables().run(),children:"Fix tables"}),g.jsx("button",{onClick:()=>t.chain().focus().goToNextCell().run(),children:"Go to next cell"}),g.jsx("button",{onClick:()=>t.chain().focus().goToPreviousCell().run(),children:"Go to previous cell"})]})]})}),g.jsx(at,{editor:t,className:"editor"})]})};it(document.getElementById("root")).render(g.jsx(He.StrictMode,{children:g.jsx(Ln,{})}));
