(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(l){if(l.ep)return;l.ep=!0;const h=n(l);fetch(l.href,h)}})();(function(){function o(a){this.content=a}function e(a,t,r){for(let s=0;;s++){if(s==a.childCount||s==t.childCount)return a.childCount==t.childCount?null:r;let c=a.child(s),d=t.child(s);if(c!=d){if(!c.sameMarkup(d))return r;if(c.isText&&c.text!=d.text){for(let u=0;c.text[u]==d.text[u];u++)r++;return r}if(c.content.size||d.content.size){let u=e(c.content,d.content,r+1);if(u!=null)return u}r+=c.nodeSize}else r+=c.nodeSize}}function n(a,t,r,s){for(let c=a.childCount,d=t.childCount;;){if(c==0||d==0)return c==d?null:{a:r,b:s};let u=a.child(--c),m=t.child(--d),g=u.nodeSize;if(u!=m){if(!u.sameMarkup(m))return{a:r,b:s};if(u.isText&&u.text!=m.text){let w=0,k=Math.min(u.text.length,m.text.length);for(;w<k&&u.text[u.text.length-w-1]==m.text[m.text.length-w-1];)w++,r--,s--;return{a:r,b:s}}if(u.content.size||m.content.size){let w=n(u.content,m.content,r-1,s-1);if(w)return w}r-=g,s-=g}else r-=g,s-=g}}o.prototype={constructor:o,find:function(a){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===a)return t;return-1},get:function(a){var t=this.find(a);return t==-1?void 0:this.content[t+1]},update:function(a,t,r){var s=r&&r!=a?this.remove(r):this,c=s.find(a),d=s.content.slice();return c==-1?d.push(r||a,t):(d[c+1]=t,r&&(d[c]=r)),new o(d)},remove:function(a){var t=this.find(a);if(t==-1)return this;var r=this.content.slice();return r.splice(t,2),new o(r)},addToStart:function(a,t){return new o([a,t].concat(this.remove(a).content))},addToEnd:function(a,t){var r=this.remove(a).content.slice();return r.push(a,t),new o(r)},addBefore:function(a,t,r){var s=this.remove(t),c=s.content.slice(),d=s.find(a);return c.splice(d==-1?c.length:d,0,t,r),new o(c)},forEach:function(a){for(var t=0;t<this.content.length;t+=2)a(this.content[t],this.content[t+1])},prepend:function(a){return(a=o.from(a)).size?new o(a.content.concat(this.subtract(a).content)):this},append:function(a){return(a=o.from(a)).size?new o(this.subtract(a).content.concat(a.content)):this},subtract:function(a){var t=this;a=o.from(a);for(var r=0;r<a.content.length;r+=2)t=t.remove(a.content[r]);return t},toObject:function(){var a={};return this.forEach(function(t,r){a[t]=r}),a},get size(){return this.content.length>>1}},o.from=function(a){if(a instanceof o)return a;var t=[];if(a)for(var r in a)t.push(r,a[r]);return new o(t)};class i{constructor(t,r){if(this.content=t,this.size=r||0,r==null)for(let s=0;s<t.length;s++)this.size+=t[s].nodeSize}nodesBetween(t,r,s,c=0,d){for(let u=0,m=0;m<r;u++){let g=this.content[u],w=m+g.nodeSize;if(w>t&&s(g,c+m,d||null,u)!==!1&&g.content.size){let k=m+1;g.nodesBetween(Math.max(0,t-k),Math.min(g.content.size,r-k),s,c+k)}m=w}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,r,s,c){let d="",u=!0;return this.nodesBetween(t,r,(m,g)=>{let w=m.isText?m.text.slice(Math.max(t,g)-g,r-g):m.isLeaf?c?typeof c=="function"?c(m):c:m.type.spec.leafText?m.type.spec.leafText(m):"":"";m.isBlock&&(m.isLeaf&&w||m.isTextblock)&&s&&(u?u=!1:d+=s),d+=w},0),d}append(t){if(!t.size)return this;if(!this.size)return t;let r=this.lastChild,s=t.firstChild,c=this.content.slice(),d=0;for(r.isText&&r.sameMarkup(s)&&(c[c.length-1]=r.withText(r.text+s.text),d=1);d<t.content.length;d++)c.push(t.content[d]);return new i(c,this.size+t.size)}cut(t,r=this.size){if(t==0&&r==this.size)return this;let s=[],c=0;if(r>t)for(let d=0,u=0;u<r;d++){let m=this.content[d],g=u+m.nodeSize;g>t&&((u<t||g>r)&&(m=m.isText?m.cut(Math.max(0,t-u),Math.min(m.text.length,r-u)):m.cut(Math.max(0,t-u-1),Math.min(m.content.size,r-u-1))),s.push(m),c+=m.nodeSize),u=g}return new i(s,c)}cutByIndex(t,r){return t==r?i.empty:t==0&&r==this.content.length?this:new i(this.content.slice(t,r))}replaceChild(t,r){let s=this.content[t];if(s==r)return this;let c=this.content.slice(),d=this.size+r.nodeSize-s.nodeSize;return c[t]=r,new i(c,d)}addToStart(t){return new i([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new i(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(t.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let r=this.content[t];if(!r)throw new RangeError("Index "+t+" out of range for "+this);return r}maybeChild(t){return this.content[t]||null}forEach(t){for(let r=0,s=0;r<this.content.length;r++){let c=this.content[r];t(c,s,r),s+=c.nodeSize}}findDiffStart(t,r=0){return e(this,t,r)}findDiffEnd(t,r=this.size,s=t.size){return n(this,t,r,s)}findIndex(t,r=-1){if(t==0)return h(0,t);if(t==this.size)return h(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let s=0,c=0;;s++){let d=c+this.child(s).nodeSize;if(d>=t)return d==t||r>0?h(s+1,d):h(s,c);c=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,r){if(!r)return i.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new i(r.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return i.empty;let r,s=0;for(let c=0;c<t.length;c++){let d=t[c];s+=d.nodeSize,c&&d.isText&&t[c-1].sameMarkup(d)?(r||(r=t.slice(0,c)),r[r.length-1]=d.withText(r[r.length-1].text+d.text)):r&&r.push(d)}return new i(r||t,s)}static from(t){if(!t)return i.empty;if(t instanceof i)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new i([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}i.empty=new i([],0);const l={index:0,offset:0};function h(a,t){return l.index=a,l.offset=t,l}function f(a,t){if(a===t)return!0;if(!a||typeof a!="object"||!t||typeof t!="object")return!1;let r=Array.isArray(a);if(Array.isArray(t)!=r)return!1;if(r){if(a.length!=t.length)return!1;for(let s=0;s<a.length;s++)if(!f(a[s],t[s]))return!1}else{for(let s in a)if(!(s in t)||!f(a[s],t[s]))return!1;for(let s in t)if(!(s in a))return!1}return!0}class p{constructor(t,r){this.type=t,this.attrs=r}addToSet(t){let r,s=!1;for(let c=0;c<t.length;c++){let d=t[c];if(this.eq(d))return t;if(this.type.excludes(d.type))r||(r=t.slice(0,c));else{if(d.type.excludes(this.type))return t;!s&&d.type.rank>this.type.rank&&(r||(r=t.slice(0,c)),r.push(this),s=!0),r&&r.push(d)}}return r||(r=t.slice()),s||r.push(this),r}removeFromSet(t){for(let r=0;r<t.length;r++)if(this.eq(t[r]))return t.slice(0,r).concat(t.slice(r+1));return t}isInSet(t){for(let r=0;r<t.length;r++)if(this.eq(t[r]))return!0;return!1}eq(t){return this==t||this.type==t.type&&f(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let r in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let s=t.marks[r.type];if(!s)throw new RangeError(`There is no mark type ${r.type} in this schema`);let c=s.create(r.attrs);return s.checkAttrs(c.attrs),c}static sameSet(t,r){if(t==r)return!0;if(t.length!=r.length)return!1;for(let s=0;s<t.length;s++)if(!t[s].eq(r[s]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return p.none;if(t instanceof p)return[t];let r=t.slice();return r.sort((s,c)=>s.type.rank-c.type.rank),r}}p.none=[];class y extends Error{}class b{constructor(t,r,s){this.content=t,this.openStart=r,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,r){let s=O(this.content,t+this.openStart,r);return s&&new b(s,this.openStart,this.openEnd)}removeBetween(t,r){return new b(S(this.content,t+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,r){if(!r)return b.empty;let s=r.openStart||0,c=r.openEnd||0;if(typeof s!="number"||typeof c!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new b(i.fromJSON(t,r.content),s,c)}static maxOpen(t,r=!0){let s=0,c=0;for(let d=t.firstChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.firstChild)s++;for(let d=t.lastChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.lastChild)c++;return new b(t,s,c)}}function S(a,t,r){let{index:s,offset:c}=a.findIndex(t),d=a.maybeChild(s),{index:u,offset:m}=a.findIndex(r);if(c==t||d.isText){if(m!=r&&!a.child(u).isText)throw new RangeError("Removing non-flat range");return a.cut(0,t).append(a.cut(r))}if(s!=u)throw new RangeError("Removing non-flat range");return a.replaceChild(s,d.copy(S(d.content,t-c-1,r-c-1)))}function O(a,t,r,s){let{index:c,offset:d}=a.findIndex(t),u=a.maybeChild(c);if(d==t||u.isText)return s&&!s.canReplace(c,c,r)?null:a.cut(0,t).append(r).append(a.cut(t));let m=O(u.content,t-d-1,r);return m&&a.replaceChild(c,u.copy(m))}function N(a,t,r){if(r.openStart>a.depth)throw new y("Inserted content deeper than insertion position");if(a.depth-r.openStart!=t.depth-r.openEnd)throw new y("Inconsistent open depths");return E(a,t,r,0)}function E(a,t,r,s){let c=a.index(s),d=a.node(s);if(c==t.index(s)&&s<a.depth-r.openStart){let u=E(a,t,r,s+1);return d.copy(d.content.replaceChild(c,u))}if(r.content.size){if(r.openStart||r.openEnd||a.depth!=s||t.depth!=s){let{start:u,end:m}=function(g,w){let k=w.depth-g.openStart,x=w.node(k).copy(g.content);for(let C=k-1;C>=0;C--)x=w.node(C).copy(i.from(x));return{start:x.resolveNoCache(g.openStart+k),end:x.resolveNoCache(x.content.size-g.openEnd-k)}}(r,a);return Q(d,we(a,u,m,t,s))}{let u=a.parent,m=u.content;return Q(u,m.cut(0,a.parentOffset).append(r.content).append(m.cut(t.parentOffset)))}}return Q(d,Ge(a,t,s))}function T(a,t){if(!t.type.compatibleContent(a.type))throw new y("Cannot join "+t.type.name+" onto "+a.type.name)}function z(a,t,r){let s=a.node(r);return T(s,t.node(r)),s}function P(a,t){let r=t.length-1;r>=0&&a.isText&&a.sameMarkup(t[r])?t[r]=a.withText(t[r].text+a.text):t.push(a)}function L(a,t,r,s){let c=(t||a).node(r),d=0,u=t?t.index(r):c.childCount;a&&(d=a.index(r),a.depth>r?d++:a.textOffset&&(P(a.nodeAfter,s),d++));for(let m=d;m<u;m++)P(c.child(m),s);t&&t.depth==r&&t.textOffset&&P(t.nodeBefore,s)}function Q(a,t){return a.type.checkContent(t),a.copy(t)}function we(a,t,r,s,c){let d=a.depth>c&&z(a,t,c+1),u=s.depth>c&&z(r,s,c+1),m=[];return L(null,a,c,m),d&&u&&t.index(c)==r.index(c)?(T(d,u),P(Q(d,we(a,t,r,s,c+1)),m)):(d&&P(Q(d,Ge(a,t,c+1)),m),L(t,r,c,m),u&&P(Q(u,Ge(r,s,c+1)),m)),L(s,null,c,m),new i(m)}function Ge(a,t,r){let s=[];return L(null,a,r,s),a.depth>r&&P(Q(z(a,t,r+1),Ge(a,t,r+1)),s),L(t,null,r,s),new i(s)}b.empty=new b(i.empty,0,0);class qe{constructor(t,r,s){this.pos=t,this.path=r,this.parentOffset=s,this.depth=r.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return(t=this.resolveDepth(t))==0?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,r=this.index(this.depth);if(r==t.childCount)return null;let s=this.pos-this.path[this.path.length-1],c=t.child(r);return s?t.child(r).cut(s):c}get nodeBefore(){let t=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(t).cut(0,r):t==0?null:this.parent.child(t-1)}posAtIndex(t,r){r=this.resolveDepth(r);let s=this.path[3*r],c=r==0?0:this.path[3*r-1]+1;for(let d=0;d<t;d++)c+=s.child(d).nodeSize;return c}marks(){let t=this.parent,r=this.index();if(t.content.size==0)return p.none;if(this.textOffset)return t.child(r).marks;let s=t.maybeChild(r-1),c=t.maybeChild(r);if(!s){let m=s;s=c,c=m}let d=s.marks;for(var u=0;u<d.length;u++)d[u].type.spec.inclusive!==!1||c&&d[u].isInSet(c.marks)||(d=d[u--].removeFromSet(d));return d}marksAcross(t){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let s=r.marks,c=t.parent.maybeChild(t.index());for(var d=0;d<s.length;d++)s[d].type.spec.inclusive!==!1||c&&s[d].isInSet(c.marks)||(s=s[d--].removeFromSet(s));return s}sharedDepth(t){for(let r=this.depth;r>0;r--)if(this.start(r)<=t&&this.end(r)>=t)return r;return 0}blockRange(t=this,r){if(t.pos<this.pos)return t.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);s>=0;s--)if(t.pos<=this.end(s)&&(!r||r(this.node(s))))return new G(this,t,s);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let r=1;r<=this.depth;r++)t+=(t?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return t+":"+this.parentOffset}static resolve(t,r){if(!(r>=0&&r<=t.content.size))throw new RangeError("Position "+r+" out of range");let s=[],c=0,d=r;for(let u=t;;){let{index:m,offset:g}=u.content.findIndex(d),w=d-g;if(s.push(u,m,c+g),!w||(u=u.child(m),u.isText))break;d=w-1,c+=g+1}return new qe(r,s,d)}static resolveCached(t,r){let s=un.get(t);if(s)for(let d=0;d<s.elts.length;d++){let u=s.elts[d];if(u.pos==r)return u}else un.set(t,s=new Re);let c=s.elts[s.i]=qe.resolve(t,r);return s.i=(s.i+1)%gr,c}}class Re{constructor(){this.elts=[],this.i=0}}const gr=12,un=new WeakMap;class G{constructor(t,r,s){this.$from=t,this.$to=r,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const wt=Object.create(null);class Oe{constructor(t,r,s,c=p.none){this.type=t,this.attrs=r,this.marks=c,this.content=s||i.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,r,s,c=0){this.content.nodesBetween(t,r,s,c,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,r,s,c){return this.content.textBetween(t,r,s,c)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,r,s){return this.type==t&&f(this.attrs,r||t.defaultAttrs||wt)&&p.sameSet(this.marks,s||p.none)}copy(t=null){return t==this.content?this:new Oe(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new Oe(this.type,this.attrs,this.content,t)}cut(t,r=this.content.size){return t==0&&r==this.content.size?this:this.copy(this.content.cut(t,r))}slice(t,r=this.content.size,s=!1){if(t==r)return b.empty;let c=this.resolve(t),d=this.resolve(r),u=s?0:c.sharedDepth(r),m=c.start(u),g=c.node(u).content.cut(c.pos-m,d.pos-m);return new b(g,c.depth-u,d.depth-u)}replace(t,r,s){return N(this.resolve(t),this.resolve(r),s)}nodeAt(t){for(let r=this;;){let{index:s,offset:c}=r.content.findIndex(t);if(r=r.maybeChild(s),!r)return null;if(c==t||r.isText)return r;t-=c+1}}childAfter(t){let{index:r,offset:s}=this.content.findIndex(t);return{node:this.content.maybeChild(r),index:r,offset:s}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:r,offset:s}=this.content.findIndex(t);if(s<t)return{node:this.content.child(r),index:r,offset:s};let c=this.content.child(r-1);return{node:c,index:r-1,offset:s-c.nodeSize}}resolve(t){return qe.resolveCached(this,t)}resolveNoCache(t){return qe.resolve(this,t)}rangeHasMark(t,r,s){let c=!1;return r>t&&this.nodesBetween(t,r,d=>(s.isInSet(d.marks)&&(c=!0),!c)),c}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Al(this.marks,t)}contentMatchAt(t){let r=this.type.contentMatch.matchFragment(this.content,0,t);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(t,r,s=i.empty,c=0,d=s.childCount){let u=this.contentMatchAt(t).matchFragment(s,c,d),m=u&&u.matchFragment(this.content,r);if(!m||!m.validEnd)return!1;for(let g=c;g<d;g++)if(!this.type.allowsMarks(s.child(g).marks))return!1;return!0}canReplaceWith(t,r,s,c){if(c&&!this.type.allowsMarks(c))return!1;let d=this.contentMatchAt(t).matchType(s),u=d&&d.matchFragment(this.content,r);return!!u&&u.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=p.none;for(let r=0;r<this.marks.length;r++){let s=this.marks[r];s.type.checkAttrs(s.attrs),t=s.addToSet(t)}if(!p.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let t={type:this.type.name};for(let r in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(r=>r.toJSON())),t}static fromJSON(t,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let s;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=r.marks.map(t.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(r.text,s)}let c=i.fromJSON(t,r.content),d=t.nodeType(r.type).create(r.attrs,c,s);return d.type.checkAttrs(d.attrs),d}}Oe.prototype.text=void 0;class Ln extends Oe{constructor(t,r,s,c){if(super(t,r,null,c),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Al(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,r){return this.text.slice(t,r)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new Ln(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new Ln(this.type,this.attrs,t,this.marks)}cut(t=0,r=this.text.length){return t==0&&r==this.text.length?this:this.withText(this.text.slice(t,r))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function Al(a,t){for(let r=a.length-1;r>=0;r--)t=a[r].type.name+"("+t+")";return t}class Ft{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,r){let s=new Ou(t,r);if(s.next==null)return Ft.empty;let c=Il(s);s.next&&s.err("Unexpected trailing text");let d=function(u){let m=Object.create(null);return g(Pl(u,0));function g(w){let k=[];w.forEach(C=>{u[C].forEach(({term:v,to:M})=>{if(!v)return;let D;for(let A=0;A<k.length;A++)k[A][0]==v&&(D=k[A][1]);Pl(u,M).forEach(A=>{D||k.push([v,D=[]]),D.indexOf(A)==-1&&D.push(A)})})});let x=m[w.join(",")]=new Ft(w.indexOf(u.length-1)>-1);for(let C=0;C<k.length;C++){let v=k[C][1].sort(zl);x.next.push({type:k[C][0],next:m[v.join(",")]||g(v)})}return x}}(function(u){let m=[[]];return k(x(u,0),g()),m;function g(){return m.push([])-1}function w(C,v,M){let D={term:M,to:v};return m[C].push(D),D}function k(C,v){C.forEach(M=>M.to=v)}function x(C,v){if(C.type=="choice")return C.exprs.reduce((M,D)=>M.concat(x(D,v)),[]);if(C.type!="seq"){if(C.type=="star"){let M=g();return w(v,M),k(x(C.expr,M),M),[w(M)]}if(C.type=="plus"){let M=g();return k(x(C.expr,v),M),k(x(C.expr,M),M),[w(M)]}if(C.type=="opt")return[w(v)].concat(x(C.expr,v));if(C.type=="range"){let M=v;for(let D=0;D<C.min;D++){let A=g();k(x(C.expr,M),A),M=A}if(C.max==-1)k(x(C.expr,M),M);else for(let D=C.min;D<C.max;D++){let A=g();w(M,A),k(x(C.expr,M),A),M=A}return[w(M)]}if(C.type=="name")return[w(v,void 0,C.value)];throw new Error("Unknown expr type")}for(let M=0;;M++){let D=x(C.exprs[M],v);if(M==C.exprs.length-1)return D;k(D,v=g())}}}(c));return function(u,m){for(let g=0,w=[u];g<w.length;g++){let k=w[g],x=!k.validEnd,C=[];for(let v=0;v<k.next.length;v++){let{type:M,next:D}=k.next[v];C.push(M.name),!x||M.isText||M.hasRequiredAttrs()||(x=!1),w.indexOf(D)==-1&&w.push(D)}x&&m.err("Only non-generatable nodes ("+C.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(d,s),d}matchType(t){for(let r=0;r<this.next.length;r++)if(this.next[r].type==t)return this.next[r].next;return null}matchFragment(t,r=0,s=t.childCount){let c=this;for(let d=r;c&&d<s;d++)c=c.matchType(t.child(d).type);return c}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:r}=this.next[t];if(!r.isText&&!r.hasRequiredAttrs())return r}return null}compatible(t){for(let r=0;r<this.next.length;r++)for(let s=0;s<t.next.length;s++)if(this.next[r].type==t.next[s].type)return!0;return!1}fillBefore(t,r=!1,s=0){let c=[this];return function d(u,m){let g=u.matchFragment(t,s);if(g&&(!r||g.validEnd))return i.from(m.map(w=>w.createAndFill()));for(let w=0;w<u.next.length;w++){let{type:k,next:x}=u.next[w];if(!k.isText&&!k.hasRequiredAttrs()&&c.indexOf(x)==-1){c.push(x);let C=d(x,m.concat(k));if(C)return C}}return null}(this,[])}findWrapping(t){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==t)return this.wrapCache[s+1];let r=this.computeWrapping(t);return this.wrapCache.push(t,r),r}computeWrapping(t){let r=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let c=s.shift(),d=c.match;if(d.matchType(t)){let u=[];for(let m=c;m.type;m=m.via)u.push(m.type);return u.reverse()}for(let u=0;u<d.next.length;u++){let{type:m,next:g}=d.next[u];m.isLeaf||m.hasRequiredAttrs()||m.name in r||c.type&&!g.validEnd||(s.push({match:m.contentMatch,type:m,via:c}),r[m.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];return function r(s){t.push(s);for(let c=0;c<s.next.length;c++)t.indexOf(s.next[c].next)==-1&&r(s.next[c].next)}(this),t.map((r,s)=>{let c=s+(r.validEnd?"*":" ")+" ";for(let d=0;d<r.next.length;d++)c+=(d?", ":"")+r.next[d].type.name+"->"+t.indexOf(r.next[d].next);return c}).join(`
`)}}Ft.empty=new Ft(!0);class Ou{constructor(t,r){this.string=t,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function Il(a){let t=[];do t.push(Nu(a));while(a.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function Nu(a){let t=[];do t.push(Du(a));while(a.next&&a.next!=")"&&a.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function Du(a){let t=function(r){if(r.eat("(")){let s=Il(r);return r.eat(")")||r.err("Missing closing paren"),s}if(!/\W/.test(r.next)){let s=function(c,d){let u=c.nodeTypes,m=u[d];if(m)return[m];let g=[];for(let w in u){let k=u[w];k.isInGroup(d)&&g.push(k)}return g.length==0&&c.err("No node type or group '"+d+"' found"),g}(r,r.next).map(c=>(r.inline==null?r.inline=c.isInline:r.inline!=c.isInline&&r.err("Mixing inline and block content"),{type:"name",value:c}));return r.pos++,s.length==1?s[0]:{type:"choice",exprs:s}}r.err("Unexpected token '"+r.next+"'")}(a);for(;;)if(a.eat("+"))t={type:"plus",expr:t};else if(a.eat("*"))t={type:"star",expr:t};else if(a.eat("?"))t={type:"opt",expr:t};else{if(!a.eat("{"))break;t=Tu(a,t)}return t}function Rl(a){/\D/.test(a.next)&&a.err("Expected number, got '"+a.next+"'");let t=Number(a.next);return a.pos++,t}function Tu(a,t){let r=Rl(a),s=r;return a.eat(",")&&(s=a.next!="}"?Rl(a):-1),a.eat("}")||a.err("Unclosed braced range"),{type:"range",min:r,max:s,expr:t}}function zl(a,t){return t-a}function Pl(a,t){let r=[];return function s(c){let d=a[c];if(d.length==1&&!d[0].term)return s(d[0].to);r.push(c);for(let u=0;u<d.length;u++){let{term:m,to:g}=d[u];m||r.indexOf(g)!=-1||s(g)}}(t),r.sort(zl)}function Bl(a){let t=Object.create(null);for(let r in a){let s=a[r];if(!s.hasDefault)return null;t[r]=s.default}return t}function Vl(a,t){let r=Object.create(null);for(let s in a){let c=t&&t[s];if(c===void 0){let d=a[s];if(!d.hasDefault)throw new RangeError("No value supplied for attribute "+s);c=d.default}r[s]=c}return r}function Fl(a,t,r,s){for(let c in t)if(!(c in a))throw new RangeError(`Unsupported attribute ${c} for ${r} of type ${c}`);for(let c in a){let d=a[c];d.validate&&d.validate(t[c])}}function Ll(a,t){let r=Object.create(null);if(t)for(let s in t)r[s]=new Eu(a,s,t[s]);return r}class yr{constructor(t,r,s){this.name=t,this.schema=r,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=Ll(t,s.attrs),this.defaultAttrs=Bl(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ft.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:Vl(this.attrs,t)}create(t=null,r,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Oe(this,this.computeAttrs(t),i.from(r),p.setFrom(s))}createChecked(t=null,r,s){return r=i.from(r),this.checkContent(r),new Oe(this,this.computeAttrs(t),r,p.setFrom(s))}createAndFill(t=null,r,s){if(t=this.computeAttrs(t),(r=i.from(r)).size){let u=this.contentMatch.fillBefore(r);if(!u)return null;r=u.append(r)}let c=this.contentMatch.matchFragment(r),d=c&&c.fillBefore(i.empty,!0);return d?new Oe(this,t,r.append(d),p.setFrom(s)):null}validContent(t){let r=this.contentMatch.matchFragment(t);if(!r||!r.validEnd)return!1;for(let s=0;s<t.childCount;s++)if(!this.allowsMarks(t.child(s).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){Fl(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let r=0;r<t.length;r++)if(!this.allowsMarkType(t[r].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let r;for(let s=0;s<t.length;s++)this.allowsMarkType(t[s].type)?r&&r.push(t[s]):r||(r=t.slice(0,s));return r?r.length?r:p.none:t}static compile(t,r){let s=Object.create(null);t.forEach((d,u)=>s[d]=new yr(d,r,u));let c=r.spec.topNode||"doc";if(!s[c])throw new RangeError("Schema is missing its top node type ('"+c+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let d in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}}class Eu{constructor(t,r,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?function(c,d,u){let m=u.split("|");return g=>{let w=g===null?"null":typeof g;if(m.indexOf(w)<0)throw new RangeError(`Expected value of type ${m} for attribute ${d} on type ${c}, got ${w}`)}}(t,r,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class wr{constructor(t,r,s,c){this.name=t,this.rank=r,this.schema=s,this.spec=c,this.attrs=Ll(t,c.attrs),this.excluded=null;let d=Bl(this.attrs);this.instance=d?new p(this,d):null}create(t=null){return!t&&this.instance?this.instance:new p(this,Vl(this.attrs,t))}static compile(t,r){let s=Object.create(null),c=0;return t.forEach((d,u)=>s[d]=new wr(d,c++,r,u)),s}removeFromSet(t){for(var r=0;r<t.length;r++)t[r].type==this&&(t=t.slice(0,r).concat(t.slice(r+1)),r--);return t}isInSet(t){for(let r=0;r<t.length;r++)if(t[r].type==this)return t[r]}checkAttrs(t){Fl(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class ql{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let c in t)r[c]=t[c];r.nodes=o.from(t.nodes),r.marks=o.from(t.marks||{}),this.nodes=yr.compile(this.spec.nodes,this),this.marks=wr.compile(this.spec.marks,this);let s=Object.create(null);for(let c in this.nodes){if(c in this.marks)throw new RangeError(c+" can not be both a node and a mark");let d=this.nodes[c],u=d.spec.content||"",m=d.spec.marks;if(d.contentMatch=s[u]||(s[u]=Ft.parse(u,this.nodes)),d.inlineContent=d.contentMatch.inlineContent,d.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!d.isInline||!d.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=d}d.markSet=m=="_"?null:m?$l(this,m.split(" ")):m!=""&&d.inlineContent?null:[]}for(let c in this.marks){let d=this.marks[c],u=d.spec.excludes;d.excluded=u==null?[d]:u==""?[]:$l(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,r=null,s,c){if(typeof t=="string")t=this.nodeType(t);else{if(!(t instanceof yr))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(r,s,c)}text(t,r){let s=this.nodes.text;return new Ln(s,s.defaultAttrs,t,p.setFrom(r))}mark(t,r){return typeof t=="string"&&(t=this.marks[t]),t.create(r)}nodeFromJSON(t){return Oe.fromJSON(this,t)}markFromJSON(t){return p.fromJSON(this,t)}nodeType(t){let r=this.nodes[t];if(!r)throw new RangeError("Unknown node type: "+t);return r}}function $l(a,t){let r=[];for(let s=0;s<t.length;s++){let c=t[s],d=a.marks[c],u=d;if(d)r.push(d);else for(let m in a.marks){let g=a.marks[m];(c=="_"||g.spec.group&&g.spec.group.split(" ").indexOf(c)>-1)&&r.push(u=g)}if(!u)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return r}class qn{constructor(t,r){this.schema=t,this.rules=r,this.tags=[],this.styles=[];let s=this.matchedStyles=[];r.forEach(c=>{if(function(d){return d.tag!=null}(c))this.tags.push(c);else if(function(d){return d.style!=null}(c)){let d=/[^=]*/.exec(c.style)[0];s.indexOf(d)<0&&s.push(d),this.styles.push(c)}}),this.normalizeLists=!this.tags.some(c=>{if(!/^(ul|ol)\b/.test(c.tag)||!c.node)return!1;let d=t.nodes[c.node];return d.contentMatch.matchType(d)})}parse(t,r={}){let s=new Kl(this,r,!1);return s.addAll(t,p.none,r.from,r.to),s.finish()}parseSlice(t,r={}){let s=new Kl(this,r,!0);return s.addAll(t,p.none,r.from,r.to),b.maxOpen(s.finish())}matchTag(t,r,s){for(let c=s?this.tags.indexOf(s)+1:0;c<this.tags.length;c++){let d=this.tags[c];if(Iu(t,d.tag)&&(d.namespace===void 0||t.namespaceURI==d.namespace)&&(!d.context||r.matchesContext(d.context))){if(d.getAttrs){let u=d.getAttrs(t);if(u===!1)continue;d.attrs=u||void 0}return d}}}matchStyle(t,r,s,c){for(let d=c?this.styles.indexOf(c)+1:0;d<this.styles.length;d++){let u=this.styles[d],m=u.style;if(!(m.indexOf(t)!=0||u.context&&!s.matchesContext(u.context)||m.length>t.length&&(m.charCodeAt(t.length)!=61||m.slice(t.length+1)!=r))){if(u.getAttrs){let g=u.getAttrs(r);if(g===!1)continue;u.attrs=g||void 0}return u}}}static schemaRules(t){let r=[];function s(c){let d=c.priority==null?50:c.priority,u=0;for(;u<r.length;u++){let m=r[u];if((m.priority==null?50:m.priority)<d)break}r.splice(u,0,c)}for(let c in t.marks){let d=t.marks[c].spec.parseDOM;d&&d.forEach(u=>{s(u=jl(u)),u.mark||u.ignore||u.clearMark||(u.mark=c)})}for(let c in t.nodes){let d=t.nodes[c].spec.parseDOM;d&&d.forEach(u=>{s(u=jl(u)),u.node||u.ignore||u.mark||(u.node=c)})}return r}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new qn(t,qn.schemaRules(t)))}}const Wl={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Au={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Jl={ol:!0,ul:!0};function Hl(a,t,r){return t!=null?(t?1:0)|(t==="full"?2:0):a&&a.whitespace=="pre"?3:-5&r}class mo{constructor(t,r,s,c,d,u){this.type=t,this.attrs=r,this.marks=s,this.solid=c,this.options=u,this.content=[],this.activeMarks=p.none,this.match=d||(4&u?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(i.from(t));if(!r){let s,c=this.type.contentMatch;return(s=c.findWrapping(t.type))?(this.match=c,s):null}this.match=this.type.contentMatch.matchFragment(r)}return this.match.findWrapping(t.type)}finish(t){if(!(1&this.options)){let s,c=this.content[this.content.length-1];if(c&&c.isText&&(s=/[ \t\r\n\u000c]+$/.exec(c.text))){let d=c;c.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=d.withText(d.text.slice(0,d.text.length-s[0].length))}}let r=i.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(i.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Wl.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class Kl{constructor(t,r,s){this.parser=t,this.options=r,this.isOpen=s,this.open=0;let c,d=r.topNode,u=Hl(null,r.preserveWhitespace,0)|(s?4:0);c=d?new mo(d.type,d.attrs,p.none,!0,r.topMatch||d.type.contentMatch,u):new mo(s?null:t.schema.topNodeType,null,p.none,!0,null,u),this.nodes=[c],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,r){t.nodeType==3?this.addTextNode(t,r):t.nodeType==1&&this.addElement(t,r)}addTextNode(t,r){let s=t.nodeValue,c=this.top;if(2&c.options||c.inlineContext(t)||/[^ \t\r\n\u000c]/.test(s)){if(1&c.options)s=2&c.options?s.replace(/\r\n?/g,`
`):s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let d=c.content[c.content.length-1],u=t.previousSibling;(!d||u&&u.nodeName=="BR"||d.isText&&/[ \t\r\n\u000c]$/.test(d.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s),r),this.findInText(t)}else this.findInside(t)}addElement(t,r,s){let c,d=t.nodeName.toLowerCase();Jl.hasOwnProperty(d)&&this.parser.normalizeLists&&function(m){for(let g=m.firstChild,w=null;g;g=g.nextSibling){let k=g.nodeType==1?g.nodeName.toLowerCase():null;k&&Jl.hasOwnProperty(k)&&w?(w.appendChild(g),g=w):k=="li"?w=g:k&&(w=null)}}(t);let u=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(c=this.parser.matchTag(t,this,s));if(u?u.ignore:Au.hasOwnProperty(d))this.findInside(t),this.ignoreFallback(t,r);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(t=u.skip);let m,g=this.top,w=this.needsBlock;if(Wl.hasOwnProperty(d))g.content.length&&g.content[0].isInline&&this.open&&(this.open--,g=this.top),m=!0,g.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t,r);let k=u&&u.skip?r:this.readStyles(t,r);k&&this.addAll(t,k),m&&this.sync(g),this.needsBlock=w}else{let m=this.readStyles(t,r);m&&this.addElementByRule(t,u,m,u.consuming===!1?c:void 0)}}leafFallback(t,r){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),r)}ignoreFallback(t,r){t.nodeName!="BR"||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),r)}readStyles(t,r){let s=t.style;if(s&&s.length)for(let c=0;c<this.parser.matchedStyles.length;c++){let d=this.parser.matchedStyles[c],u=s.getPropertyValue(d);if(u)for(let m;;){let g=this.parser.matchStyle(d,u,this,m);if(!g)break;if(g.ignore)return null;if(r=g.clearMark?r.filter(w=>!g.clearMark(w)):r.concat(this.parser.schema.marks[g.mark].create(g.attrs)),g.consuming!==!1)break;m=g}}return r}addElementByRule(t,r,s,c){let d,u;if(r.node)if(u=this.parser.schema.nodes[r.node],u.isLeaf)this.insertNode(u.create(r.attrs),s)||this.leafFallback(t,s);else{let g=this.enter(u,r.attrs||null,s,r.preserveWhitespace);g&&(d=!0,s=g)}else{let g=this.parser.schema.marks[r.mark];s=s.concat(g.create(r.attrs))}let m=this.top;if(u&&u.isLeaf)this.findInside(t);else if(c)this.addElement(t,s,c);else if(r.getContent)this.findInside(t),r.getContent(t,this.parser.schema).forEach(g=>this.insertNode(g,s));else{let g=t;typeof r.contentElement=="string"?g=t.querySelector(r.contentElement):typeof r.contentElement=="function"?g=r.contentElement(t):r.contentElement&&(g=r.contentElement),this.findAround(t,g,!0),this.addAll(g,s),this.findAround(t,g,!1)}d&&this.sync(m)&&this.open--}addAll(t,r,s,c){let d=s||0;for(let u=s?t.childNodes[s]:t.firstChild,m=c==null?null:t.childNodes[c];u!=m;u=u.nextSibling,++d)this.findAtPoint(t,d),this.addDOM(u,r);this.findAtPoint(t,d)}findPlace(t,r){let s,c;for(let d=this.open;d>=0;d--){let u=this.nodes[d],m=u.findWrapping(t);if(m&&(!s||s.length>m.length)&&(s=m,c=u,!m.length)||u.solid)break}if(!s)return null;this.sync(c);for(let d=0;d<s.length;d++)r=this.enterInner(s[d],null,r,!1);return r}insertNode(t,r){if(t.isInline&&this.needsBlock&&!this.top.type){let c=this.textblockFromContext();c&&(r=this.enterInner(c,null,r))}let s=this.findPlace(t,r);if(s){this.closeExtra();let c=this.top;c.match&&(c.match=c.match.matchType(t.type));let d=p.none;for(let u of s.concat(t.marks))(c.type?c.type.allowsMarkType(u.type):Ul(u.type,t.type))&&(d=u.addToSet(d));return c.content.push(t.mark(d)),!0}return!1}enter(t,r,s,c){let d=this.findPlace(t.create(r),s);return d&&(d=this.enterInner(t,r,s,!0,c)),d}enterInner(t,r,s,c=!1,d){this.closeExtra();let u=this.top;u.match=u.match&&u.match.matchType(t);let m=Hl(t,d,u.options);4&u.options&&u.content.length==0&&(m|=4);let g=p.none;return s=s.filter(w=>!(u.type?u.type.allowsMarkType(w.type):Ul(w.type,t))||(g=w.addToSet(g),!1)),this.nodes.push(new mo(t,r,g,c,null,m)),this.open++,s}closeExtra(t=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let r=this.open;r>=0;r--)if(this.nodes[r]==t)return this.open=r,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let r=this.open;r>=0;r--){let s=this.nodes[r].content;for(let c=s.length-1;c>=0;c--)t+=s[c].nodeSize;r&&t++}return t}findAtPoint(t,r){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==t&&this.find[s].offset==r&&(this.find[s].pos=this.currentPos)}findInside(t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(t,r,s){if(t!=r&&this.find)for(let c=0;c<this.find.length;c++)this.find[c].pos==null&&t.nodeType==1&&t.contains(this.find[c].node)&&r.compareDocumentPosition(this.find[c].node)&(s?2:4)&&(this.find[c].pos=this.currentPos)}findInText(t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==t&&(this.find[r].pos=this.currentPos-(t.nodeValue.length-this.find[r].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let r=t.split("/"),s=this.options.context,c=!(this.isOpen||s&&s.parent.type!=this.nodes[0].type),d=-(s?s.depth+1:0)+(c?0:1),u=(m,g)=>{for(;m>=0;m--){let w=r[m];if(w==""){if(m==r.length-1||m==0)continue;for(;g>=d;g--)if(u(m-1,g))return!0;return!1}{let k=g>0||g==0&&c?this.nodes[g].type:s&&g>=d?s.node(g-d).type:null;if(!k||k.name!=w&&!k.isInGroup(w))return!1;g--}}return!0};return u(r.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let r=t.depth;r>=0;r--){let s=t.node(r).contentMatchAt(t.indexAfter(r)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let r in this.parser.schema.nodes){let s=this.parser.schema.nodes[r];if(s.isTextblock&&s.defaultAttrs)return s}}}function Iu(a,t){return(a.matches||a.msMatchesSelector||a.webkitMatchesSelector||a.mozMatchesSelector).call(a,t)}function jl(a){let t={};for(let r in a)t[r]=a[r];return t}function Ul(a,t){let r=t.schema.nodes;for(let s in r){let c=r[s];if(!c.allowsMarkType(a))continue;let d=[],u=m=>{d.push(m);for(let g=0;g<m.edgeCount;g++){let{type:w,next:k}=m.edge(g);if(w==t||d.indexOf(k)<0&&u(k))return!0}};if(u(c.contentMatch))return!0}}class pn{constructor(t,r){this.nodes=t,this.marks=r}serializeFragment(t,r={},s){s||(s=go(r).createDocumentFragment());let c=s,d=[];return t.forEach(u=>{if(d.length||u.marks.length){let m=0,g=0;for(;m<d.length&&g<u.marks.length;){let w=u.marks[g];if(this.marks[w.type.name]){if(!w.eq(d[m][0])||w.type.spec.spanning===!1)break;m++,g++}else g++}for(;m<d.length;)c=d.pop()[1];for(;g<u.marks.length;){let w=u.marks[g++],k=this.serializeMark(w,u.isInline,r);k&&(d.push([w,c]),c.appendChild(k.dom),c=k.contentDOM||k.dom)}}c.appendChild(this.serializeNodeInner(u,r))}),s}serializeNodeInner(t,r){let{dom:s,contentDOM:c}=di(go(r),this.nodes[t.type.name](t),null,t.attrs);if(c){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,r,c)}return s}serializeNode(t,r={}){let s=this.serializeNodeInner(t,r);for(let c=t.marks.length-1;c>=0;c--){let d=this.serializeMark(t.marks[c],t.isInline,r);d&&((d.contentDOM||d.dom).appendChild(s),s=d.dom)}return s}serializeMark(t,r,s={}){let c=this.marks[t.type.name];return c&&di(go(s),c(t,r),null,t.attrs)}static renderSpec(t,r,s=null,c){return di(t,r,s,c)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new pn(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let r=Gl(t.nodes);return r.text||(r.text=s=>s.text),r}static marksFromSchema(t){return Gl(t.marks)}}function Gl(a){let t={};for(let r in a){let s=a[r].spec.toDOM;s&&(t[r]=s)}return t}function go(a){return a.document||window.document}const Yl=new WeakMap;function Ru(a){let t=Yl.get(a);return t===void 0&&Yl.set(a,t=function(r){let s=null;function c(d){if(d&&typeof d=="object")if(Array.isArray(d))if(typeof d[0]=="string")s||(s=[]),s.push(d);else for(let u=0;u<d.length;u++)c(d[u]);else for(let u in d)c(d[u])}return c(r),s}(a)),t}function di(a,t,r,s){if(typeof t=="string")return{dom:a.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let c,d=t[0];if(typeof d!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(c=Ru(s))&&c.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let u,m=d.indexOf(" ");m>0&&(r=d.slice(0,m),d=d.slice(m+1));let g=r?a.createElementNS(r,d):a.createElement(d),w=t[1],k=1;if(w&&typeof w=="object"&&w.nodeType==null&&!Array.isArray(w)){k=2;for(let x in w)if(w[x]!=null){let C=x.indexOf(" ");C>0?g.setAttributeNS(x.slice(0,C),x.slice(C+1),w[x]):g.setAttribute(x,w[x])}}for(let x=k;x<t.length;x++){let C=t[x];if(C===0){if(x<t.length-1||x>k)throw new RangeError("Content hole must be the only child of its parent node");return{dom:g,contentDOM:g}}{let{dom:v,contentDOM:M}=di(a,C,r,s);if(g.appendChild(v),M){if(u)throw new RangeError("Multiple content holes");u=M}}}return{dom:g,contentDOM:u}}var zu=Object.freeze({__proto__:null,ContentMatch:Ft,DOMParser:qn,DOMSerializer:pn,Fragment:i,Mark:p,MarkType:wr,Node:Oe,NodeRange:G,NodeType:yr,ReplaceError:y,ResolvedPos:qe,Schema:ql,Slice:b});const Xl=Math.pow(2,16);function _l(a){return 65535&a}class fi{constructor(t,r,s){this.pos=t,this.delInfo=r,this.recover=s}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class $e{constructor(t,r=!1){if(this.ranges=t,this.inverted=r,!t.length&&$e.empty)return $e.empty}recover(t){let r=0,s=_l(t);if(!this.inverted)for(let c=0;c<s;c++)r+=this.ranges[3*c+2]-this.ranges[3*c+1];return this.ranges[3*s]+r+function(c){return(c-(65535&c))/Xl}(t)}mapResult(t,r=1){return this._map(t,r,!1)}map(t,r=1){return this._map(t,r,!0)}_map(t,r,s){let c=0,d=this.inverted?2:1,u=this.inverted?1:2;for(let m=0;m<this.ranges.length;m+=3){let g=this.ranges[m]-(this.inverted?c:0);if(g>t)break;let w=this.ranges[m+d],k=this.ranges[m+u],x=g+w;if(t<=x){let C=g+c+((w?t==g?-1:t==x?1:r:r)<0?0:k);if(s)return C;let v=t==(r<0?g:x)?null:m/3+(t-g)*Xl,M=t==g?2:t==x?1:4;return(r<0?t!=g:t!=x)&&(M|=8),new fi(C,M,v)}c+=k-w}return s?t+c:new fi(t+c,0,null)}touches(t,r){let s=0,c=_l(r),d=this.inverted?2:1,u=this.inverted?1:2;for(let m=0;m<this.ranges.length;m+=3){let g=this.ranges[m]-(this.inverted?s:0);if(g>t)break;let w=this.ranges[m+d];if(t<=g+w&&m==3*c)return!0;s+=this.ranges[m+u]-w}return!1}forEach(t){let r=this.inverted?2:1,s=this.inverted?1:2;for(let c=0,d=0;c<this.ranges.length;c+=3){let u=this.ranges[c],m=u-(this.inverted?d:0),g=u+(this.inverted?0:d),w=this.ranges[c+r],k=this.ranges[c+s];t(m,m+w,g,g+k),d+=k-w}}invert(){return new $e(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?$e.empty:new $e(t<0?[0,-t,0]:[0,0,t])}}$e.empty=new $e([]);class mn{constructor(t=[],r,s=0,c=t.length){this.maps=t,this.mirror=r,this.from=s,this.to=c}slice(t=0,r=this.maps.length){return new mn(this.maps,this.mirror,t,r)}copy(){return new mn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,r){this.to=this.maps.push(t),r!=null&&this.setMirror(this.maps.length-1,r)}appendMapping(t){for(let r=0,s=this.maps.length;r<t.maps.length;r++){let c=t.getMirror(r);this.appendMap(t.maps[r],c!=null&&c<r?s+c:void 0)}}getMirror(t){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==t)return this.mirror[r+(r%2?-1:1)]}}setMirror(t,r){this.mirror||(this.mirror=[]),this.mirror.push(t,r)}appendMappingInverted(t){for(let r=t.maps.length-1,s=this.maps.length+t.maps.length;r>=0;r--){let c=t.getMirror(r);this.appendMap(t.maps[r].invert(),c!=null&&c>r?s-c-1:void 0)}}invert(){let t=new mn;return t.appendMappingInverted(this),t}map(t,r=1){if(this.mirror)return this._map(t,r,!0);for(let s=this.from;s<this.to;s++)t=this.maps[s].map(t,r);return t}mapResult(t,r=1){return this._map(t,r,!1)}_map(t,r,s){let c=0;for(let d=this.from;d<this.to;d++){let u=this.maps[d].mapResult(t,r);if(u.recover!=null){let m=this.getMirror(d);if(m!=null&&m>d&&m<this.to){d=m,t=this.maps[m].recover(u.recover);continue}}c|=u.delInfo,t=u.pos}return s?t:new fi(t,c,null)}}const yo=Object.create(null);class be{getMap(){return $e.empty}merge(t){return null}static fromJSON(t,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=yo[r.stepType];if(!s)throw new RangeError(`No step type ${r.stepType} defined`);return s.fromJSON(t,r)}static jsonID(t,r){if(t in yo)throw new RangeError("Duplicate use of step JSON ID "+t);return yo[t]=r,r.prototype.jsonID=t,r}}class he{constructor(t,r){this.doc=t,this.failed=r}static ok(t){return new he(t,null)}static fail(t){return new he(null,t)}static fromReplace(t,r,s,c){try{return he.ok(t.replace(r,s,c))}catch(d){if(d instanceof y)return he.fail(d.message);throw d}}}function wo(a,t,r){let s=[];for(let c=0;c<a.childCount;c++){let d=a.child(c);d.content.size&&(d=d.copy(wo(d.content,t,d))),d.isInline&&(d=t(d,r,c)),s.push(d)}return i.fromArray(s)}class Ot extends be{constructor(t,r,s){super(),this.from=t,this.to=r,this.mark=s}apply(t){let r=t.slice(this.from,this.to),s=t.resolve(this.from),c=s.node(s.sharedDepth(this.to)),d=new b(wo(r.content,(u,m)=>u.isAtom&&m.type.allowsMarkType(this.mark.type)?u.mark(this.mark.addToSet(u.marks)):u,c),r.openStart,r.openEnd);return he.fromReplace(t,this.from,this.to,d)}invert(){return new ht(this.from,this.to,this.mark)}map(t){let r=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return r.deleted&&s.deleted||r.pos>=s.pos?null:new Ot(r.pos,s.pos,this.mark)}merge(t){return t instanceof Ot&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Ot(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ot(r.from,r.to,t.markFromJSON(r.mark))}}be.jsonID("addMark",Ot);class ht extends be{constructor(t,r,s){super(),this.from=t,this.to=r,this.mark=s}apply(t){let r=t.slice(this.from,this.to),s=new b(wo(r.content,c=>c.mark(this.mark.removeFromSet(c.marks)),t),r.openStart,r.openEnd);return he.fromReplace(t,this.from,this.to,s)}invert(){return new Ot(this.from,this.to,this.mark)}map(t){let r=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return r.deleted&&s.deleted||r.pos>=s.pos?null:new ht(r.pos,s.pos,this.mark)}merge(t){return t instanceof ht&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new ht(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ht(r.from,r.to,t.markFromJSON(r.mark))}}be.jsonID("removeMark",ht);class Nt extends be{constructor(t,r){super(),this.pos=t,this.mark=r}apply(t){let r=t.nodeAt(this.pos);if(!r)return he.fail("No node at mark step's position");let s=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return he.fromReplace(t,this.pos,this.pos+1,new b(i.from(s),0,r.isLeaf?0:1))}invert(t){let r=t.nodeAt(this.pos);if(r){let s=this.mark.addToSet(r.marks);if(s.length==r.marks.length){for(let c=0;c<r.marks.length;c++)if(!r.marks[c].isInSet(s))return new Nt(this.pos,r.marks[c]);return new Nt(this.pos,this.mark)}}return new gn(this.pos,this.mark)}map(t){let r=t.mapResult(this.pos,1);return r.deletedAfter?null:new Nt(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Nt(r.pos,t.markFromJSON(r.mark))}}be.jsonID("addNodeMark",Nt);class gn extends be{constructor(t,r){super(),this.pos=t,this.mark=r}apply(t){let r=t.nodeAt(this.pos);if(!r)return he.fail("No node at mark step's position");let s=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return he.fromReplace(t,this.pos,this.pos+1,new b(i.from(s),0,r.isLeaf?0:1))}invert(t){let r=t.nodeAt(this.pos);return r&&this.mark.isInSet(r.marks)?new Nt(this.pos,this.mark):this}map(t){let r=t.mapResult(this.pos,1);return r.deletedAfter?null:new gn(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new gn(r.pos,t.markFromJSON(r.mark))}}be.jsonID("removeNodeMark",gn);class pe extends be{constructor(t,r,s,c=!1){super(),this.from=t,this.to=r,this.slice=s,this.structure=c}apply(t){return this.structure&&bo(t,this.from,this.to)?he.fail("Structure replace would overwrite content"):he.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new $e([this.from,this.to-this.from,this.slice.size])}invert(t){return new pe(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let r=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return r.deletedAcross&&s.deletedAcross?null:new pe(r.pos,Math.max(r.pos,s.pos),this.slice)}merge(t){if(!(t instanceof pe)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let r=this.slice.size+t.slice.size==0?b.empty:new b(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new pe(t.from,this.to,r,this.structure)}}{let r=this.slice.size+t.slice.size==0?b.empty:new b(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new pe(this.from,this.to+(t.to-t.from),r,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new pe(r.from,r.to,b.fromJSON(t,r.slice),!!r.structure)}}be.jsonID("replace",pe);class me extends be{constructor(t,r,s,c,d,u,m=!1){super(),this.from=t,this.to=r,this.gapFrom=s,this.gapTo=c,this.slice=d,this.insert=u,this.structure=m}apply(t){if(this.structure&&(bo(t,this.from,this.gapFrom)||bo(t,this.gapTo,this.to)))return he.fail("Structure gap-replace would overwrite content");let r=t.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return he.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,r.content);return s?he.fromReplace(t,this.from,this.to,s):he.fail("Content does not fit in gap")}getMap(){return new $e([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let r=this.gapTo-this.gapFrom;return new me(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let r=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),c=this.from==this.gapFrom?r.pos:t.map(this.gapFrom,-1),d=this.to==this.gapTo?s.pos:t.map(this.gapTo,1);return r.deletedAcross&&s.deletedAcross||c<r.pos||d>s.pos?null:new me(r.pos,s.pos,c,d,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new me(r.from,r.to,r.gapFrom,r.gapTo,b.fromJSON(t,r.slice),r.insert,!!r.structure)}}function bo(a,t,r){let s=a.resolve(t),c=r-t,d=s.depth;for(;c>0&&d>0&&s.indexAfter(d)==s.node(d).childCount;)d--,c--;if(c>0){let u=s.node(d).maybeChild(s.indexAfter(d));for(;c>0;){if(!u||u.isLeaf)return!0;u=u.firstChild,c--}}return!1}function ko(a,t,r,s=r.contentMatch,c=!0){let d=a.doc.nodeAt(t),u=[],m=t+1;for(let g=0;g<d.childCount;g++){let w=d.child(g),k=m+w.nodeSize,x=s.matchType(w.type);if(x){s=x;for(let C=0;C<w.marks.length;C++)r.allowsMarkType(w.marks[C].type)||a.step(new ht(m,k,w.marks[C]));if(c&&w.isText&&r.whitespace!="pre"){let C,v,M=/\r?\n|\r/g;for(;C=M.exec(w.text);)v||(v=new b(i.from(r.schema.text(" ",r.allowedMarks(w.marks))),0,0)),u.push(new pe(m+C.index,m+C.index+C[0].length,v))}}else u.push(new pe(m,k,b.empty));m=k}if(!s.validEnd){let g=s.fillBefore(i.empty,!0);a.replace(m,m,new b(g,0,0))}for(let g=u.length-1;g>=0;g--)a.step(u[g])}function Pu(a,t,r){return(t==0||a.canReplace(t,a.childCount))&&(r==a.childCount||a.canReplace(0,r))}function $n(a){let t=a.parent.content.cutByIndex(a.startIndex,a.endIndex);for(let r=a.depth;;--r){let s=a.$from.node(r),c=a.$from.index(r),d=a.$to.indexAfter(r);if(r<a.depth&&s.canReplace(c,d,t))return r;if(r==0||s.type.spec.isolating||!Pu(s,c,d))break}return null}function ui(a,t,r=null,s=a){let c=function(u,m){let{parent:g,startIndex:w,endIndex:k}=u,x=g.contentMatchAt(w).findWrapping(m);if(!x)return null;let C=x.length?x[0]:m;return g.canReplaceWith(w,k,C)?x:null}(a,t),d=c&&function(u,m){let{parent:g,startIndex:w,endIndex:k}=u,x=g.child(w),C=m.contentMatch.findWrapping(x.type);if(!C)return null;let v=(C.length?C[C.length-1]:m).contentMatch;for(let M=w;v&&M<k;M++)v=v.matchType(g.child(M).type);return v&&v.validEnd?C:null}(s,t);return d?c.map(Zl).concat({type:t,attrs:r}).concat(d.map(Zl)):null}function Zl(a){return{type:a,attrs:null}}function Ql(a,t,r,s){t.forEach((c,d)=>{if(c.isText){let u,m=/\r?\n|\r/g;for(;u=m.exec(c.text);){let g=a.mapping.slice(s).map(r+1+d+u.index);a.replaceWith(g,g+1,t.type.schema.linebreakReplacement.create())}}})}function ea(a,t,r,s){t.forEach((c,d)=>{if(c.type==c.type.schema.linebreakReplacement){let u=a.mapping.slice(s).map(r+1+d);a.replaceWith(u,u+1,t.type.schema.text(`
`))}})}function yn(a,t,r=1,s){let c=a.resolve(t),d=c.depth-r,u=s&&s[s.length-1]||c.parent;if(d<0||c.parent.type.spec.isolating||!c.parent.canReplace(c.index(),c.parent.childCount)||!u.type.validContent(c.parent.content.cutByIndex(c.index(),c.parent.childCount)))return!1;for(let w=c.depth-1,k=r-2;w>d;w--,k--){let x=c.node(w),C=c.index(w);if(x.type.spec.isolating)return!1;let v=x.content.cutByIndex(C,x.childCount),M=s&&s[k+1];M&&(v=v.replaceChild(0,M.type.create(M.attrs)));let D=s&&s[k]||x;if(!x.canReplace(C+1,x.childCount)||!D.type.validContent(v))return!1}let m=c.indexAfter(d),g=s&&s[0];return c.node(d).canReplaceWith(m,m,g?g.type:c.node(d+1).type)}function Lt(a,t){let r=a.resolve(t),s=r.index();return ta(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(s,s+1)}function ta(a,t){return!(!a||!t||a.isLeaf||!function(r,s){s.content.size||r.type.compatibleContent(s.type);let c=r.contentMatchAt(r.childCount),{linebreakReplacement:d}=r.type.schema;for(let u=0;u<s.childCount;u++){let m=s.child(u),g=m.type==d?r.type.schema.nodes.text:m.type;if(c=c.matchType(g),!c||!r.type.allowsMarks(m.marks))return!1}return c.validEnd}(a,t))}function xo(a,t,r=-1){let s=a.resolve(t);for(let c=s.depth;;c--){let d,u,m=s.index(c);if(c==s.depth?(d=s.nodeBefore,u=s.nodeAfter):r>0?(d=s.node(c+1),m++,u=s.node(c).maybeChild(m)):(d=s.node(c).maybeChild(m-1),u=s.node(c+1)),d&&!d.isTextblock&&ta(d,u)&&s.node(c).canReplace(m,m+1))return t;if(c==0)break;t=r<0?s.before(c):s.after(c)}}function na(a,t,r){let s=a.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),r))return t;if(s.parentOffset==0)for(let c=s.depth-1;c>=0;c--){let d=s.index(c);if(s.node(c).canReplaceWith(d,d,r))return s.before(c+1);if(d>0)return null}if(s.parentOffset==s.parent.content.size)for(let c=s.depth-1;c>=0;c--){let d=s.indexAfter(c);if(s.node(c).canReplaceWith(d,d,r))return s.after(c+1);if(d<s.node(c).childCount)return null}return null}function So(a,t,r){let s=a.resolve(t);if(!r.content.size)return t;let c=r.content;for(let d=0;d<r.openStart;d++)c=c.firstChild.content;for(let d=1;d<=(r.openStart==0&&r.size?2:1);d++)for(let u=s.depth;u>=0;u--){let m=u==s.depth?0:s.pos<=(s.start(u+1)+s.end(u+1))/2?-1:1,g=s.index(u)+(m>0?1:0),w=s.node(u),k=!1;if(d==1)k=w.canReplace(g,g,c);else{let x=w.contentMatchAt(g).findWrapping(c.firstChild.type);k=x&&w.canReplaceWith(g,g,x[0])}if(k)return m==0?s.pos:m<0?s.before(u+1):s.after(u+1)}return null}function br(a,t,r=t,s=b.empty){if(t==r&&!s.size)return null;let c=a.resolve(t),d=a.resolve(r);return ra(c,d,s)?new pe(t,r,s):new Bu(c,d,s).fit()}function ra(a,t,r){return!r.openStart&&!r.openEnd&&a.start()==t.start()&&a.parent.canReplace(a.index(),t.index(),r.content)}be.jsonID("replaceAround",me);class Bu{constructor(t,r,s){this.$from=t,this.$to=r,this.unplaced=s,this.frontier=[],this.placed=i.empty;for(let c=0;c<=t.depth;c++){let d=t.node(c);this.frontier.push({type:d.type,match:d.contentMatchAt(t.indexAfter(c))})}for(let c=t.depth;c>0;c--)this.placed=i.from(t.node(c).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let w=this.findFittable();w?this.placeNodes(w):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,s=this.$from,c=this.close(t<0?this.$to:s.doc.resolve(t));if(!c)return null;let d=this.placed,u=s.depth,m=c.depth;for(;u&&m&&d.childCount==1;)d=d.firstChild.content,u--,m--;let g=new b(d,u,m);return t>-1?new me(s.pos,t,this.$to.pos,this.$to.end(),g,r):g.size||s.pos!=this.$to.pos?new pe(s.pos,c.pos,g):null}findFittable(){let t=this.unplaced.openStart;for(let r=this.unplaced.content,s=0,c=this.unplaced.openEnd;s<t;s++){let d=r.firstChild;if(r.childCount>1&&(c=0),d.type.spec.isolating&&c<=s){t=s;break}r=d.content}for(let r=1;r<=2;r++)for(let s=r==1?t:this.unplaced.openStart;s>=0;s--){let c,d=null;s?(d=Co(this.unplaced.content,s-1).firstChild,c=d.content):c=this.unplaced.content;let u=c.firstChild;for(let m=this.depth;m>=0;m--){let g,{type:w,match:k}=this.frontier[m],x=null;if(r==1&&(u?k.matchType(u.type)||(x=k.fillBefore(i.from(u),!1)):d&&w.compatibleContent(d.type)))return{sliceDepth:s,frontierDepth:m,parent:d,inject:x};if(r==2&&u&&(g=k.findWrapping(u.type)))return{sliceDepth:s,frontierDepth:m,parent:d,wrap:g};if(d&&k.matchType(d.type))break}}}openMore(){let{content:t,openStart:r,openEnd:s}=this.unplaced,c=Co(t,r);return!(!c.childCount||c.firstChild.isLeaf)&&(this.unplaced=new b(t,r+1,Math.max(s,c.size+r>=t.size-s?r+1:0)),!0)}dropNode(){let{content:t,openStart:r,openEnd:s}=this.unplaced,c=Co(t,r);if(c.childCount<=1&&r>0){let d=t.size-r<=r+c.size;this.unplaced=new b(kr(t,r-1,1),r-1,d?r-1:s)}else this.unplaced=new b(kr(t,r,1),r,s)}placeNodes({sliceDepth:t,frontierDepth:r,parent:s,inject:c,wrap:d}){for(;this.depth>r;)this.closeFrontierNode();if(d)for(let D=0;D<d.length;D++)this.openFrontierNode(d[D]);let u=this.unplaced,m=s?s.content:u.content,g=u.openStart-t,w=0,k=[],{match:x,type:C}=this.frontier[r];if(c){for(let D=0;D<c.childCount;D++)k.push(c.child(D));x=x.matchFragment(c)}let v=m.size+t-(u.content.size-u.openEnd);for(;w<m.childCount;){let D=m.child(w),A=x.matchType(D.type);if(!A)break;w++,(w>1||g==0||D.content.size)&&(x=A,k.push(ia(D.mark(C.allowedMarks(D.marks)),w==1?g:0,w==m.childCount?v:-1)))}let M=w==m.childCount;M||(v=-1),this.placed=xr(this.placed,r,i.from(k)),this.frontier[r].match=x,M&&v<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let D=0,A=m;D<v;D++){let I=A.lastChild;this.frontier.push({type:I.type,match:I.contentMatchAt(I.childCount)}),A=I.content}this.unplaced=M?t==0?b.empty:new b(kr(u.content,t-1,1),t-1,v<0?u.openEnd:t-1):new b(kr(u.content,t,w),u.openStart,u.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,r=this.frontier[this.depth];if(!r.type.isTextblock||!Mo(this.$to,this.$to.depth,r.type,r.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:s}=this.$to,c=this.$to.after(s);for(;s>1&&c==this.$to.end(--s);)++c;return c}findCloseLevel(t){e:for(let r=Math.min(this.depth,t.depth);r>=0;r--){let{match:s,type:c}=this.frontier[r],d=r<t.depth&&t.end(r+1)==t.pos+(t.depth-(r+1)),u=Mo(t,r,c,s,d);if(u){for(let m=r-1;m>=0;m--){let{match:g,type:w}=this.frontier[m],k=Mo(t,m,w,g,!0);if(!k||k.childCount)continue e}return{depth:r,fit:u,move:d?t.doc.resolve(t.after(r+1)):t}}}}close(t){let r=this.findCloseLevel(t);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=xr(this.placed,r.depth,r.fit)),t=r.move;for(let s=r.depth+1;s<=t.depth;s++){let c=t.node(s),d=c.type.contentMatch.fillBefore(c.content,!0,t.index(s));this.openFrontierNode(c.type,c.attrs,d)}return t}openFrontierNode(t,r=null,s){let c=this.frontier[this.depth];c.match=c.match.matchType(t),this.placed=xr(this.placed,this.depth,i.from(t.create(r,s))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(i.empty,!0);t.childCount&&(this.placed=xr(this.placed,this.frontier.length,t))}}function kr(a,t,r){return t==0?a.cutByIndex(r,a.childCount):a.replaceChild(0,a.firstChild.copy(kr(a.firstChild.content,t-1,r)))}function xr(a,t,r){return t==0?a.append(r):a.replaceChild(a.childCount-1,a.lastChild.copy(xr(a.lastChild.content,t-1,r)))}function Co(a,t){for(let r=0;r<t;r++)a=a.firstChild.content;return a}function ia(a,t,r){if(t<=0)return a;let s=a.content;return t>1&&(s=s.replaceChild(0,ia(s.firstChild,t-1,s.childCount==1?r-1:0))),t>0&&(s=a.type.contentMatch.fillBefore(s).append(s),r<=0&&(s=s.append(a.type.contentMatch.matchFragment(s).fillBefore(i.empty,!0)))),a.copy(s)}function Mo(a,t,r,s,c){let d=a.node(t),u=c?a.indexAfter(t):a.index(t);if(u==d.childCount&&!r.compatibleContent(d.type))return null;let m=s.fillBefore(d.content,!0,u);return m&&!function(g,w,k){for(let x=k;x<w.childCount;x++)if(!g.allowsMarks(w.child(x).marks))return!0;return!1}(r,d.content,u)?m:null}function oa(a,t,r,s,c){if(t<r){let d=a.firstChild;a=a.replaceChild(0,d.copy(oa(d.content,t+1,r,s,d)))}if(t>s){let d=c.contentMatchAt(0),u=d.fillBefore(a).append(a);a=u.append(d.matchFragment(u).fillBefore(i.empty,!0))}return a}function sa(a,t){let r=[];for(let s=Math.min(a.depth,t.depth);s>=0;s--){let c=a.start(s);if(c<a.pos-(a.depth-s)||t.end(s)>t.pos+(t.depth-s)||a.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(c==t.start(s)||s==a.depth&&s==t.depth&&a.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==c-1)&&r.push(s)}return r}class wn extends be{constructor(t,r,s){super(),this.pos=t,this.attr=r,this.value=s}apply(t){let r=t.nodeAt(this.pos);if(!r)return he.fail("No node at attribute step's position");let s=Object.create(null);for(let d in r.attrs)s[d]=r.attrs[d];s[this.attr]=this.value;let c=r.type.create(s,null,r.marks);return he.fromReplace(t,this.pos,this.pos+1,new b(i.from(c),0,r.isLeaf?0:1))}getMap(){return $e.empty}invert(t){return new wn(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let r=t.mapResult(this.pos,1);return r.deletedAfter?null:new wn(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new wn(r.pos,r.attr,r.value)}}be.jsonID("attr",wn);class Wn extends be{constructor(t,r){super(),this.attr=t,this.value=r}apply(t){let r=Object.create(null);for(let c in t.attrs)r[c]=t.attrs[c];r[this.attr]=this.value;let s=t.type.create(r,t.content,t.marks);return he.ok(s)}getMap(){return $e.empty}invert(t){return new Wn(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Wn(r.attr,r.value)}}be.jsonID("docAttr",Wn);let Jn=class extends Error{};Jn=function a(t){let r=Error.call(this,t);return r.__proto__=a.prototype,r},(Jn.prototype=Object.create(Error.prototype)).constructor=Jn,Jn.prototype.name="TransformError";class la{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new mn}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let r=this.maybeStep(t);if(r.failed)throw new Jn(r.failed);return this}maybeStep(t){let r=t.apply(this.doc);return r.failed||this.addStep(t,r.doc),r}get docChanged(){return this.steps.length>0}addStep(t,r){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=r}replace(t,r=t,s=b.empty){let c=br(this.doc,t,r,s);return c&&this.step(c),this}replaceWith(t,r,s){return this.replace(t,r,new b(i.from(s),0,0))}delete(t,r){return this.replace(t,r,b.empty)}insert(t,r){return this.replaceWith(t,t,r)}replaceRange(t,r,s){return function(c,d,u,m){if(!m.size)return c.deleteRange(d,u);let g=c.doc.resolve(d),w=c.doc.resolve(u);if(ra(g,w,m))return c.step(new pe(d,u,m));let k=sa(g,c.doc.resolve(u));k[k.length-1]==0&&k.pop();let x=-(g.depth+1);k.unshift(x);for(let I=g.depth,R=g.pos-1;I>0;I--,R--){let V=g.node(I).type.spec;if(V.defining||V.definingAsContext||V.isolating)break;k.indexOf(I)>-1?x=I:g.before(I)==R&&k.splice(1,0,-I)}let C=k.indexOf(x),v=[],M=m.openStart;for(let I=m.content,R=0;;R++){let V=I.firstChild;if(v.push(V),R==m.openStart)break;I=V.content}for(let I=M-1;I>=0;I--){let R=v[I],V=(D=R.type).spec.defining||D.spec.definingForContent;if(V&&!R.sameMarkup(g.node(Math.abs(x)-1)))M=I;else if(V||!R.type.isTextblock)break}var D;for(let I=m.openStart;I>=0;I--){let R=(I+M+1)%(m.openStart+1),V=v[R];if(V)for(let q=0;q<k.length;q++){let Y=k[(q+C)%k.length],ie=!0;Y<0&&(ie=!1,Y=-Y);let ne=g.node(Y-1),H=g.index(Y-1);if(ne.canReplaceWith(H,H,V.type,V.marks))return c.replace(g.before(Y),ie?w.after(Y):u,new b(oa(m.content,0,m.openStart,R),R,m.openEnd))}}let A=c.steps.length;for(let I=k.length-1;I>=0&&(c.replace(d,u,m),!(c.steps.length>A));I--){let R=k[I];R<0||(d=g.before(R),u=w.after(R))}}(this,t,r,s),this}replaceRangeWith(t,r,s){return function(c,d,u,m){if(!m.isInline&&d==u&&c.doc.resolve(d).parent.content.size){let g=na(c.doc,d,m.type);g!=null&&(d=u=g)}c.replaceRange(d,u,new b(i.from(m),0,0))}(this,t,r,s),this}deleteRange(t,r){return function(s,c,d){let u=s.doc.resolve(c),m=s.doc.resolve(d),g=sa(u,m);for(let w=0;w<g.length;w++){let k=g[w],x=w==g.length-1;if(x&&k==0||u.node(k).type.contentMatch.validEnd)return s.delete(u.start(k),m.end(k));if(k>0&&(x||u.node(k-1).canReplace(u.index(k-1),m.indexAfter(k-1))))return s.delete(u.before(k),m.after(k))}for(let w=1;w<=u.depth&&w<=m.depth;w++)if(c-u.start(w)==u.depth-w&&d>u.end(w)&&m.end(w)-d!=m.depth-w&&u.start(w-1)==m.start(w-1)&&u.node(w-1).canReplace(u.index(w-1),m.index(w-1)))return s.delete(u.before(w),d);s.delete(c,d)}(this,t,r),this}lift(t,r){return function(s,c,d){let{$from:u,$to:m,depth:g}=c,w=u.before(g+1),k=m.after(g+1),x=w,C=k,v=i.empty,M=0;for(let I=g,R=!1;I>d;I--)R||u.index(I)>0?(R=!0,v=i.from(u.node(I).copy(v)),M++):x--;let D=i.empty,A=0;for(let I=g,R=!1;I>d;I--)R||m.after(I+1)<m.end(I)?(R=!0,D=i.from(m.node(I).copy(D)),A++):C++;s.step(new me(x,C,w,k,new b(v.append(D),M,A),v.size-M,!0))}(this,t,r),this}join(t,r=1){return function(s,c,d){let u=null,{linebreakReplacement:m}=s.doc.type.schema,g=s.doc.resolve(c-d),w=g.node().type;if(m&&w.inlineContent){let v=w.whitespace=="pre",M=!!w.contentMatch.matchType(m);v&&!M?u=!1:!v&&M&&(u=!0)}let k=s.steps.length;if(u===!1){let v=s.doc.resolve(c+d);ea(s,v.node(),v.before(),k)}w.inlineContent&&ko(s,c+d-1,w,g.node().contentMatchAt(g.index()),u==null);let x=s.mapping.slice(k),C=x.map(c-d);if(s.step(new pe(C,x.map(c+d,-1),b.empty,!0)),u===!0){let v=s.doc.resolve(C);Ql(s,v.node(),v.before(),s.steps.length)}}(this,t,r),this}wrap(t,r){return function(s,c,d){let u=i.empty;for(let w=d.length-1;w>=0;w--){if(u.size){let k=d[w].type.contentMatch.matchFragment(u);if(!k||!k.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}u=i.from(d[w].type.create(d[w].attrs,u))}let m=c.start,g=c.end;s.step(new me(m,g,m,g,new b(u,0,0),d.length,!0))}(this,t,r),this}setBlockType(t,r=t,s,c=null){return function(d,u,m,g,w){if(!g.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let k=d.steps.length;d.doc.nodesBetween(u,m,(x,C)=>{let v=typeof w=="function"?w(x):w;if(x.isTextblock&&!x.hasMarkup(g,v)&&function(M,D,A){let I=M.resolve(D),R=I.index();return I.parent.canReplaceWith(R,R+1,A)}(d.doc,d.mapping.slice(k).map(C),g)){let M=null;if(g.schema.linebreakReplacement){let R=g.whitespace=="pre",V=!!g.contentMatch.matchType(g.schema.linebreakReplacement);R&&!V?M=!1:!R&&V&&(M=!0)}M===!1&&ea(d,x,C,k),ko(d,d.mapping.slice(k).map(C,1),g,void 0,M===null);let D=d.mapping.slice(k),A=D.map(C,1),I=D.map(C+x.nodeSize,1);return d.step(new me(A,I,A+1,I-1,new b(i.from(g.create(v,null,x.marks)),0,0),1,!0)),M===!0&&Ql(d,x,C,k),!1}})}(this,t,r,s,c),this}setNodeMarkup(t,r,s=null,c){return function(d,u,m,g,w){let k=d.doc.nodeAt(u);if(!k)throw new RangeError("No node at given position");m||(m=k.type);let x=m.create(g,null,w||k.marks);if(k.isLeaf)return d.replaceWith(u,u+k.nodeSize,x);if(!m.validContent(k.content))throw new RangeError("Invalid content for node type "+m.name);d.step(new me(u,u+k.nodeSize,u+1,u+k.nodeSize-1,new b(i.from(x),0,0),1,!0))}(this,t,r,s,c),this}setNodeAttribute(t,r,s){return this.step(new wn(t,r,s)),this}setDocAttribute(t,r){return this.step(new Wn(t,r)),this}addNodeMark(t,r){return this.step(new Nt(t,r)),this}removeNodeMark(t,r){if(!(r instanceof p)){let s=this.doc.nodeAt(t);if(!s)throw new RangeError("No node at position "+t);if(!(r=r.isInSet(s.marks)))return this}return this.step(new gn(t,r)),this}split(t,r=1,s){return function(c,d,u=1,m){let g=c.doc.resolve(d),w=i.empty,k=i.empty;for(let x=g.depth,C=g.depth-u,v=u-1;x>C;x--,v--){w=i.from(g.node(x).copy(w));let M=m&&m[v];k=i.from(M?M.type.create(M.attrs,k):g.node(x).copy(k))}c.step(new pe(d,d,new b(w.append(k),u,u),!0))}(this,t,r,s),this}addMark(t,r,s){return function(c,d,u,m){let g,w,k=[],x=[];c.doc.nodesBetween(d,u,(C,v,M)=>{if(!C.isInline)return;let D=C.marks;if(!m.isInSet(D)&&M.type.allowsMarkType(m.type)){let A=Math.max(v,d),I=Math.min(v+C.nodeSize,u),R=m.addToSet(D);for(let V=0;V<D.length;V++)D[V].isInSet(R)||(g&&g.to==A&&g.mark.eq(D[V])?g.to=I:k.push(g=new ht(A,I,D[V])));w&&w.to==A?w.to=I:x.push(w=new Ot(A,I,m))}}),k.forEach(C=>c.step(C)),x.forEach(C=>c.step(C))}(this,t,r,s),this}removeMark(t,r,s){return function(c,d,u,m){let g=[],w=0;c.doc.nodesBetween(d,u,(k,x)=>{if(!k.isInline)return;w++;let C=null;if(m instanceof wr){let v,M=k.marks;for(;v=m.isInSet(M);)(C||(C=[])).push(v),M=v.removeFromSet(M)}else m?m.isInSet(k.marks)&&(C=[m]):C=k.marks;if(C&&C.length){let v=Math.min(x+k.nodeSize,u);for(let M=0;M<C.length;M++){let D,A=C[M];for(let I=0;I<g.length;I++){let R=g[I];R.step==w-1&&A.eq(g[I].style)&&(D=R)}D?(D.to=v,D.step=w):g.push({style:A,from:Math.max(x,d),to:v,step:w})}}}),g.forEach(k=>c.step(new ht(k.from,k.to,k.style)))}(this,t,r,s),this}clearIncompatible(t,r,s){return ko(this,t,r,s),this}}var Vu=Object.freeze({__proto__:null,AddMarkStep:Ot,AddNodeMarkStep:Nt,AttrStep:wn,DocAttrStep:Wn,MapResult:fi,Mapping:mn,RemoveMarkStep:ht,RemoveNodeMarkStep:gn,ReplaceAroundStep:me,ReplaceStep:pe,Step:be,StepMap:$e,StepResult:he,Transform:la,get TransformError(){return Jn},canJoin:Lt,canSplit:yn,dropPoint:So,findWrapping:ui,insertPoint:na,joinPoint:xo,liftTarget:$n,replaceStep:br});const vo=Object.create(null);class X{constructor(t,r,s){this.$anchor=t,this.$head=r,this.ranges=s||[new pi(t.min(r),t.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let r=0;r<t.length;r++)if(t[r].$from.pos!=t[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,r=b.empty){let s=r.content.lastChild,c=null;for(let m=0;m<r.openEnd;m++)c=s,s=s.lastChild;let d=t.steps.length,u=this.ranges;for(let m=0;m<u.length;m++){let{$from:g,$to:w}=u[m],k=t.mapping.slice(d);t.replaceRange(k.map(g.pos),k.map(w.pos),m?b.empty:r),m==0&&ha(t,d,(s?s.isInline:c&&c.isTextblock)?-1:1)}}replaceWith(t,r){let s=t.steps.length,c=this.ranges;for(let d=0;d<c.length;d++){let{$from:u,$to:m}=c[d],g=t.mapping.slice(s),w=g.map(u.pos),k=g.map(m.pos);d?t.deleteRange(w,k):(t.replaceRangeWith(w,k,r),ha(t,s,r.isInline?-1:1))}}static findFrom(t,r,s=!1){let c=t.parent.inlineContent?new Z(t):Hn(t.node(0),t.parent,t.pos,t.index(),r,s);if(c)return c;for(let d=t.depth-1;d>=0;d--){let u=r<0?Hn(t.node(0),t.node(d),t.before(d+1),t.index(d),r,s):Hn(t.node(0),t.node(d),t.after(d+1),t.index(d)+1,r,s);if(u)return u}return null}static near(t,r=1){return this.findFrom(t,r)||this.findFrom(t,-r)||new We(t.node(0))}static atStart(t){return Hn(t,t,0,0,1)||new We(t)}static atEnd(t){return Hn(t,t,t.content.size,t.childCount,-1)||new We(t)}static fromJSON(t,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=vo[r.type];if(!s)throw new RangeError(`No selection type ${r.type} defined`);return s.fromJSON(t,r)}static jsonID(t,r){if(t in vo)throw new RangeError("Duplicate use of selection JSON ID "+t);return vo[t]=r,r.prototype.jsonID=t,r}getBookmark(){return Z.between(this.$anchor,this.$head).getBookmark()}}X.prototype.visible=!0;class pi{constructor(t,r){this.$from=t,this.$to=r}}let aa=!1;function ca(a){aa||a.parent.inlineContent||(aa=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+a.parent.type.name+")"))}class Z extends X{constructor(t,r=t){ca(t),ca(r),super(t,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,r){let s=t.resolve(r.map(this.head));if(!s.parent.inlineContent)return X.near(s);let c=t.resolve(r.map(this.anchor));return new Z(c.parent.inlineContent?c:s,s)}replace(t,r=b.empty){if(super.replace(t,r),r==b.empty){let s=this.$from.marksAcross(this.$to);s&&t.ensureMarks(s)}}eq(t){return t instanceof Z&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new mi(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Z(t.resolve(r.anchor),t.resolve(r.head))}static create(t,r,s=r){let c=t.resolve(r);return new this(c,s==r?c:t.resolve(s))}static between(t,r,s){let c=t.pos-r.pos;if(s&&!c||(s=c>=0?1:-1),!r.parent.inlineContent){let d=X.findFrom(r,s,!0)||X.findFrom(r,-s,!0);if(!d)return X.near(r,s);r=d.$head}return t.parent.inlineContent||(c==0||(t=(X.findFrom(t,-s,!0)||X.findFrom(t,s,!0)).$anchor).pos<r.pos!=c<0)&&(t=r),new Z(t,r)}}X.jsonID("text",Z);class mi{constructor(t,r){this.anchor=t,this.head=r}map(t){return new mi(t.map(this.anchor),t.map(this.head))}resolve(t){return Z.between(t.resolve(this.anchor),t.resolve(this.head))}}class W extends X{constructor(t){let r=t.nodeAfter,s=t.node(0).resolve(t.pos+r.nodeSize);super(t,s),this.node=r}map(t,r){let{deleted:s,pos:c}=r.mapResult(this.anchor),d=t.resolve(c);return s?X.near(d):new W(d)}content(){return new b(i.from(this.node),0,0)}eq(t){return t instanceof W&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Oo(this.anchor)}static fromJSON(t,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new W(t.resolve(r.anchor))}static create(t,r){return new W(t.resolve(r))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}W.prototype.visible=!1,X.jsonID("node",W);class Oo{constructor(t){this.anchor=t}map(t){let{deleted:r,pos:s}=t.mapResult(this.anchor);return r?new mi(s,s):new Oo(s)}resolve(t){let r=t.resolve(this.anchor),s=r.nodeAfter;return s&&W.isSelectable(s)?new W(r):X.near(r)}}class We extends X{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,r=b.empty){if(r==b.empty){t.delete(0,t.doc.content.size);let s=X.atStart(t.doc);s.eq(t.selection)||t.setSelection(s)}else super.replace(t,r)}toJSON(){return{type:"all"}}static fromJSON(t){return new We(t)}map(t){return new We(t)}eq(t){return t instanceof We}getBookmark(){return Fu}}X.jsonID("all",We);const Fu={map(){return this},resolve:a=>new We(a)};function Hn(a,t,r,s,c,d=!1){if(t.inlineContent)return Z.create(a,r);for(let u=s-(c>0?0:1);c>0?u<t.childCount:u>=0;u+=c){let m=t.child(u);if(m.isAtom){if(!d&&W.isSelectable(m))return W.create(a,r-(c<0?m.nodeSize:0))}else{let g=Hn(a,m,r+c,c<0?m.childCount:0,c,d);if(g)return g}r+=m.nodeSize*c}return null}function ha(a,t,r){let s=a.steps.length-1;if(s<t)return;let c,d=a.steps[s];(d instanceof pe||d instanceof me)&&(a.mapping.maps[s].forEach((u,m,g,w)=>{c==null&&(c=w)}),a.setSelection(X.near(a.doc.resolve(c),r)))}class da extends la{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=2,this}ensureMarks(t){return p.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(t,r){super.addStep(t,r),this.updated=-3&this.updated,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,r=!0){let s=this.selection;return r&&(t=t.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||p.none))),s.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,r,s){let c=this.doc.type.schema;if(r==null)return t?this.replaceSelectionWith(c.text(t),!0):this.deleteSelection();{if(s==null&&(s=r),s=s??r,!t)return this.deleteRange(r,s);let d=this.storedMarks;if(!d){let u=this.doc.resolve(r);d=s==r?u.marks():u.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(r,s,c.text(t,d)),this.selection.empty||this.setSelection(X.near(this.selection.$to)),this}}setMeta(t,r){return this.meta[typeof t=="string"?t:t.key]=r,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function fa(a,t){return t&&a?a.bind(t):a}class Sr{constructor(t,r,s){this.name=t,this.init=fa(r.init,s),this.apply=fa(r.apply,s)}}const Lu=[new Sr("doc",{init:a=>a.doc||a.schema.topNodeType.createAndFill(),apply:a=>a.doc}),new Sr("selection",{init:(a,t)=>a.selection||X.atStart(t.doc),apply:a=>a.selection}),new Sr("storedMarks",{init:a=>a.storedMarks||null,apply:(a,t,r,s)=>s.selection.$cursor?a.storedMarks:null}),new Sr("scrollToSelection",{init:()=>0,apply:(a,t)=>a.scrolledIntoView?t+1:t})];class No{constructor(t,r){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Lu.slice(),r&&r.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new Sr(s.key,s.spec.state,s))})}}class Kn{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,r=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=r){let c=this.config.plugins[s];if(c.spec.filterTransaction&&!c.spec.filterTransaction.call(c,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let r=[t],s=this.applyInner(t),c=null;for(;;){let d=!1;for(let u=0;u<this.config.plugins.length;u++){let m=this.config.plugins[u];if(m.spec.appendTransaction){let g=c?c[u].n:0,w=c?c[u].state:this,k=g<r.length&&m.spec.appendTransaction.call(m,g?r.slice(g):r,w,s);if(k&&s.filterTransaction(k,u)){if(k.setMeta("appendedTransaction",t),!c){c=[];for(let x=0;x<this.config.plugins.length;x++)c.push(x<u?{state:s,n:r.length}:{state:this,n:0})}r.push(k),s=s.applyInner(k),d=!0}c&&(c[u]={state:s,n:r.length})}}if(!d)return{state:s,transactions:r}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let r=new Kn(this.config),s=this.config.fields;for(let c=0;c<s.length;c++){let d=s[c];r[d.name]=d.apply(t,this[d.name],this,r)}return r}get tr(){return new da(this)}static create(t){let r=new No(t.doc?t.doc.type.schema:t.schema,t.plugins),s=new Kn(r);for(let c=0;c<r.fields.length;c++)s[r.fields[c].name]=r.fields[c].init(t,s);return s}reconfigure(t){let r=new No(this.schema,t.plugins),s=r.fields,c=new Kn(r);for(let d=0;d<s.length;d++){let u=s[d].name;c[u]=this.hasOwnProperty(u)?this[u]:s[d].init(t,c)}return c}toJSON(t){let r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(s=>s.toJSON())),t&&typeof t=="object")for(let s in t){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let c=t[s],d=c.spec.state;d&&d.toJSON&&(r[s]=d.toJSON.call(c,this[c.key]))}return r}static fromJSON(t,r,s){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let c=new No(t.schema,t.plugins),d=new Kn(c);return c.fields.forEach(u=>{if(u.name=="doc")d.doc=Oe.fromJSON(t.schema,r.doc);else if(u.name=="selection")d.selection=X.fromJSON(d.doc,r.selection);else if(u.name=="storedMarks")r.storedMarks&&(d.storedMarks=r.storedMarks.map(t.schema.markFromJSON));else{if(s)for(let m in s){let g=s[m],w=g.spec.state;if(g.key==u.name&&w&&w.fromJSON&&Object.prototype.hasOwnProperty.call(r,m))return void(d[u.name]=w.fromJSON.call(g,t,r[m],d))}d[u.name]=u.init(t,d)}}),d}}function ua(a,t,r){for(let s in a){let c=a[s];c instanceof Function?c=c.bind(t):s=="handleDOMEvents"&&(c=ua(c,t,{})),r[s]=c}return r}class qt{constructor(t){this.spec=t,this.props={},t.props&&ua(t.props,this,this.props),this.key=t.key?t.key.key:pa("plugin")}getState(t){return t[this.key]}}const Do=Object.create(null);function pa(a){return a in Do?a+"$"+ ++Do[a]:(Do[a]=0,a+"$")}class To{constructor(t="key"){this.key=pa(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}var qu=Object.freeze({__proto__:null,AllSelection:We,EditorState:Kn,NodeSelection:W,Plugin:qt,PluginKey:To,Selection:X,SelectionRange:pi,TextSelection:Z,Transaction:da});const ke=function(a){for(var t=0;;t++)if(!(a=a.previousSibling))return t},Cr=function(a){let t=a.assignedSlot||a.parentNode;return t&&t.nodeType==11?t.host:t};let Eo=null;const Dt=function(a,t,r){let s=Eo||(Eo=document.createRange());return s.setEnd(a,r??a.nodeValue.length),s.setStart(a,t||0),s},bn=function(a,t,r,s){return r&&(ma(a,t,r,s,-1)||ma(a,t,r,s,1))},$u=/^(img|br|input|textarea|hr)$/i;function ma(a,t,r,s,c){for(;;){if(a==r&&t==s)return!0;if(t==(c<0?0:nt(a))){let d=a.parentNode;if(!d||d.nodeType!=1||Mr(a)||$u.test(a.nodeName)||a.contentEditable=="false")return!1;t=ke(a)+(c<0?0:1),a=d}else{if(a.nodeType!=1||(a=a.childNodes[t+(c<0?-1:0)]).contentEditable=="false")return!1;t=c<0?nt(a):0}}}function nt(a){return a.nodeType==3?a.nodeValue.length:a.childNodes.length}function Mr(a){let t;for(let r=a;r&&!(t=r.pmViewDesc);r=r.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==a||t.contentDOM==a)}const gi=function(a){return a.focusNode&&bn(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset)};function kn(a,t){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=a,r.key=r.code=t,r}const bt=typeof navigator<"u"?navigator:null,ga=typeof document<"u"?document:null,$t=bt&&bt.userAgent||"",Ao=/Edge\/(\d+)/.exec($t),ya=/MSIE \d/.exec($t),Io=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec($t),Je=!!(ya||Io||Ao),Wt=ya?document.documentMode:Io?+Io[1]:Ao?+Ao[1]:0,dt=!Je&&/gecko\/(\d+)/i.test($t);dt&&(/Firefox\/(\d+)/.exec($t)||[0,0])[1];const Ro=!Je&&/Chrome\/(\d+)/.exec($t),Ne=!!Ro,wa=Ro?+Ro[1]:0,ze=!Je&&!!bt&&/Apple Computer/.test(bt.vendor),jn=ze&&(/Mobile\/\w+/.test($t)||!!bt&&bt.maxTouchPoints>2),rt=jn||!!bt&&/Mac/.test(bt.platform),Wu=!!bt&&/Win/.test(bt.platform),ft=/Android \d/.test($t),vr=!!ga&&"webkitFontSmoothing"in ga.documentElement.style,Ju=vr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Hu(a){let t=a.defaultView&&a.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:a.documentElement.clientWidth,top:0,bottom:a.documentElement.clientHeight}}function Tt(a,t){return typeof a=="number"?a:a[t]}function Ku(a){let t=a.getBoundingClientRect(),r=t.width/a.offsetWidth||1,s=t.height/a.offsetHeight||1;return{left:t.left,right:t.left+a.clientWidth*r,top:t.top,bottom:t.top+a.clientHeight*s}}function ba(a,t,r){let s=a.someProp("scrollThreshold")||0,c=a.someProp("scrollMargin")||5,d=a.dom.ownerDocument;for(let u=r||a.dom;u;u=Cr(u)){if(u.nodeType!=1)continue;let m=u,g=m==d.body,w=g?Hu(d):Ku(m),k=0,x=0;if(t.top<w.top+Tt(s,"top")?x=-(w.top-t.top+Tt(c,"top")):t.bottom>w.bottom-Tt(s,"bottom")&&(x=t.bottom-t.top>w.bottom-w.top?t.top+Tt(c,"top")-w.top:t.bottom-w.bottom+Tt(c,"bottom")),t.left<w.left+Tt(s,"left")?k=-(w.left-t.left+Tt(c,"left")):t.right>w.right-Tt(s,"right")&&(k=t.right-w.right+Tt(c,"right")),k||x)if(g)d.defaultView.scrollBy(k,x);else{let C=m.scrollLeft,v=m.scrollTop;x&&(m.scrollTop+=x),k&&(m.scrollLeft+=k);let M=m.scrollLeft-C,D=m.scrollTop-v;t={left:t.left-M,top:t.top-D,right:t.right-M,bottom:t.bottom-D}}if(g||/^(fixed|sticky)$/.test(getComputedStyle(u).position))break}}function ka(a){let t=[],r=a.ownerDocument;for(let s=a;s&&(t.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),a!=r);s=Cr(s));return t}function xa(a,t){for(let r=0;r<a.length;r++){let{dom:s,top:c,left:d}=a[r];s.scrollTop!=c+t&&(s.scrollTop=c+t),s.scrollLeft!=d&&(s.scrollLeft=d)}}let Un=null;function Sa(a,t){let r,s,c,d,u=2e8,m=0,g=t.top,w=t.top;for(let k=a.firstChild,x=0;k;k=k.nextSibling,x++){let C;if(k.nodeType==1)C=k.getClientRects();else{if(k.nodeType!=3)continue;C=Dt(k).getClientRects()}for(let v=0;v<C.length;v++){let M=C[v];if(M.top<=g&&M.bottom>=w){g=Math.max(M.bottom,g),w=Math.min(M.top,w);let D=M.left>t.left?M.left-t.left:M.right<t.left?t.left-M.right:0;if(D<u){r=k,u=D,s=D&&r.nodeType==3?{left:M.right<t.left?M.right:M.left,top:t.top}:t,k.nodeType==1&&D&&(m=x+(t.left>=(M.left+M.right)/2?1:0));continue}}else M.top>t.top&&!c&&M.left<=t.left&&M.right>=t.left&&(c=k,d={left:Math.max(M.left,Math.min(M.right,t.left)),top:M.top});!r&&(t.left>=M.right&&t.top>=M.top||t.left>=M.left&&t.top>=M.bottom)&&(m=x+1)}}return!r&&c&&(r=c,s=d,u=0),r&&r.nodeType==3?function(k,x){let C=k.nodeValue.length,v=document.createRange();for(let M=0;M<C;M++){v.setEnd(k,M+1),v.setStart(k,M);let D=Jt(v,1);if(D.top!=D.bottom&&zo(x,D))return{node:k,offset:M+(x.left>=(D.left+D.right)/2?1:0)}}return{node:k,offset:0}}(r,s):!r||u&&r.nodeType==1?{node:a,offset:m}:Sa(r,s)}function zo(a,t){return a.left>=t.left-1&&a.left<=t.right+1&&a.top>=t.top-1&&a.top<=t.bottom+1}function Ca(a,t,r){let s=a.childNodes.length;if(s&&r.top<r.bottom)for(let c=Math.max(0,Math.min(s-1,Math.floor(s*(t.top-r.top)/(r.bottom-r.top))-2)),d=c;;){let u=a.childNodes[d];if(u.nodeType==1){let m=u.getClientRects();for(let g=0;g<m.length;g++){let w=m[g];if(zo(t,w))return Ca(u,t,w)}}if((d=(d+1)%s)==c)break}return a}function ju(a,t){let r,s=a.dom.ownerDocument,c=0,d=function(w,k,x){if(w.caretPositionFromPoint)try{let C=w.caretPositionFromPoint(k,x);if(C)return{node:C.offsetNode,offset:Math.min(nt(C.offsetNode),C.offset)}}catch{}if(w.caretRangeFromPoint){let C=w.caretRangeFromPoint(k,x);if(C)return{node:C.startContainer,offset:Math.min(nt(C.startContainer),C.startOffset)}}}(s,t.left,t.top);d&&({node:r,offset:c}=d);let u,m=(a.root.elementFromPoint?a.root:s).elementFromPoint(t.left,t.top);if(!m||!a.dom.contains(m.nodeType!=1?m.parentNode:m)){let w=a.dom.getBoundingClientRect();if(!zo(t,w)||(m=Ca(a.dom,t,w),!m))return null}if(ze)for(let w=m;r&&w;w=Cr(w))w.draggable&&(r=void 0);if(m=function(w,k){let x=w.parentNode;return x&&/^li$/i.test(x.nodeName)&&k.left<w.getBoundingClientRect().left?x:w}(m,t),r){if(dt&&r.nodeType==1&&(c=Math.min(c,r.childNodes.length),c<r.childNodes.length)){let k,x=r.childNodes[c];x.nodeName=="IMG"&&(k=x.getBoundingClientRect()).right<=t.left&&k.bottom>t.top&&c++}let w;vr&&c&&r.nodeType==1&&(w=r.childNodes[c-1]).nodeType==1&&w.contentEditable=="false"&&w.getBoundingClientRect().top>=t.top&&c--,r==a.dom&&c==r.childNodes.length-1&&r.lastChild.nodeType==1&&t.top>r.lastChild.getBoundingClientRect().bottom?u=a.state.doc.content.size:c!=0&&r.nodeType==1&&r.childNodes[c-1].nodeName=="BR"||(u=function(k,x,C,v){let M=-1;for(let D=x,A=!1;D!=k.dom;){let I=k.docView.nearestDesc(D,!0);if(!I)return null;if(I.dom.nodeType==1&&(I.node.isBlock&&I.parent||!I.contentDOM)){let R=I.dom.getBoundingClientRect();if(I.node.isBlock&&I.parent&&(!A&&R.left>v.left||R.top>v.top?M=I.posBefore:(!A&&R.right<v.left||R.bottom<v.top)&&(M=I.posAfter),A=!0),!I.contentDOM&&M<0&&!I.node.isText)return(I.node.isBlock?v.top<(R.top+R.bottom)/2:v.left<(R.left+R.right)/2)?I.posBefore:I.posAfter}D=I.dom.parentNode}return M>-1?M:k.docView.posFromDOM(x,C,-1)}(a,r,c,t))}u==null&&(u=function(w,k,x){let{node:C,offset:v}=Sa(k,x),M=-1;if(C.nodeType==1&&!C.firstChild){let D=C.getBoundingClientRect();M=D.left!=D.right&&x.left>(D.left+D.right)/2?1:-1}return w.docView.posFromDOM(C,v,M)}(a,m,t));let g=a.docView.nearestDesc(m,!0);return{pos:u,inside:g?g.posAtStart-g.border:-1}}function Ma(a){return a.top<a.bottom||a.left<a.right}function Jt(a,t){let r=a.getClientRects();if(r.length){let s=r[t<0?0:r.length-1];if(Ma(s))return s}return Array.prototype.find.call(r,Ma)||a.getBoundingClientRect()}const Uu=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function va(a,t,r){let{node:s,offset:c,atom:d}=a.docView.domFromPos(t,r<0?-1:1),u=vr||dt;if(s.nodeType==3){if(!u||!Uu.test(s.nodeValue)&&(r<0?c:c!=s.nodeValue.length)){let m=c,g=c,w=r<0?1:-1;return r<0&&!c?(g++,w=-1):r>=0&&c==s.nodeValue.length?(m--,w=1):r<0?m--:g++,Or(Jt(Dt(s,m,g),w),w<0)}{let m=Jt(Dt(s,c,c),r);if(dt&&c&&/\s/.test(s.nodeValue[c-1])&&c<s.nodeValue.length){let g=Jt(Dt(s,c-1,c-1),-1);if(g.top==m.top){let w=Jt(Dt(s,c,c+1),-1);if(w.top!=m.top)return Or(w,w.left<g.left)}}return m}}if(!a.state.doc.resolve(t-(d||0)).parent.inlineContent){if(d==null&&c&&(r<0||c==nt(s))){let m=s.childNodes[c-1];if(m.nodeType==1)return Po(m.getBoundingClientRect(),!1)}if(d==null&&c<nt(s)){let m=s.childNodes[c];if(m.nodeType==1)return Po(m.getBoundingClientRect(),!0)}return Po(s.getBoundingClientRect(),r>=0)}if(d==null&&c&&(r<0||c==nt(s))){let m=s.childNodes[c-1],g=m.nodeType==3?Dt(m,nt(m)-(u?0:1)):m.nodeType!=1||m.nodeName=="BR"&&m.nextSibling?null:m;if(g)return Or(Jt(g,1),!1)}if(d==null&&c<nt(s)){let m=s.childNodes[c];for(;m.pmViewDesc&&m.pmViewDesc.ignoreForCoords;)m=m.nextSibling;let g=m?m.nodeType==3?Dt(m,0,u?0:1):m.nodeType==1?m:null:null;if(g)return Or(Jt(g,-1),!0)}return Or(Jt(s.nodeType==3?Dt(s):s,-r),r>=0)}function Or(a,t){if(a.width==0)return a;let r=t?a.left:a.right;return{top:a.top,bottom:a.bottom,left:r,right:r}}function Po(a,t){if(a.height==0)return a;let r=t?a.top:a.bottom;return{top:r,bottom:r,left:a.left,right:a.right}}function Oa(a,t,r){let s=a.state,c=a.root.activeElement;s!=t&&a.updateState(t),c!=a.dom&&a.focus();try{return r()}finally{s!=t&&a.updateState(s),c!=a.dom&&c&&c.focus()}}const Gu=/[\u0590-\u08ac]/;let Na=null,Da=null,Ta=!1;function Yu(a,t,r){return Na==t&&Da==r?Ta:(Na=t,Da=r,Ta=r=="up"||r=="down"?function(s,c,d){let u=c.selection,m=d=="up"?u.$from:u.$to;return Oa(s,c,()=>{let{node:g}=s.docView.domFromPos(m.pos,d=="up"?-1:1);for(;;){let k=s.docView.nearestDesc(g,!0);if(!k)break;if(k.node.isBlock){g=k.contentDOM||k.dom;break}g=k.dom.parentNode}let w=va(s,m.pos,1);for(let k=g.firstChild;k;k=k.nextSibling){let x;if(k.nodeType==1)x=k.getClientRects();else{if(k.nodeType!=3)continue;x=Dt(k,0,k.nodeValue.length).getClientRects()}for(let C=0;C<x.length;C++){let v=x[C];if(v.bottom>v.top+1&&(d=="up"?w.top-v.top>2*(v.bottom-w.top):v.bottom-w.bottom>2*(w.bottom-v.top)))return!1}}return!0})}(a,t,r):function(s,c,d){let{$head:u}=c.selection;if(!u.parent.isTextblock)return!1;let m=u.parentOffset,g=!m,w=m==u.parent.content.size,k=s.domSelection();return k?Gu.test(u.parent.textContent)&&k.modify?Oa(s,c,()=>{let{focusNode:x,focusOffset:C,anchorNode:v,anchorOffset:M}=s.domSelectionRange(),D=k.caretBidiLevel;k.modify("move",d,"character");let A=u.depth?s.docView.domAfterPos(u.before()):s.dom,{focusNode:I,focusOffset:R}=s.domSelectionRange(),V=I&&!A.contains(I.nodeType==1?I:I.parentNode)||x==I&&C==R;try{k.collapse(v,M),x&&(x!=v||C!=M)&&k.extend&&k.extend(x,C)}catch{}return D!=null&&(k.caretBidiLevel=D),V}):d=="left"||d=="backward"?g:w:u.pos==u.start()||u.pos==u.end()}(a,t,r))}class Nr{constructor(t,r,s,c){this.parent=t,this.children=r,this.dom=s,this.contentDOM=c,this.dirty=0,s.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,r,s){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let r=0;r<this.children.length;r++)t+=this.children[r].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let r=0,s=this.posAtStart;;r++){let c=this.children[r];if(c==t)return s;s+=c.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,r,s){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode)){if(s<0){let d,u;if(t==this.contentDOM)d=t.childNodes[r-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;d=t.previousSibling}for(;d&&(!(u=d.pmViewDesc)||u.parent!=this);)d=d.previousSibling;return d?this.posBeforeChild(u)+u.size:this.posAtStart}{let d,u;if(t==this.contentDOM)d=t.childNodes[r];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;d=t.nextSibling}for(;d&&(!(u=d.pmViewDesc)||u.parent!=this);)d=d.nextSibling;return d?this.posBeforeChild(u):this.posAtEnd}}let c;if(t==this.dom&&this.contentDOM)c=r>ke(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))c=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(r==0)for(let d=t;;d=d.parentNode){if(d==this.dom){c=!1;break}if(d.previousSibling)break}if(c==null&&r==t.childNodes.length)for(let d=t;;d=d.parentNode){if(d==this.dom){c=!0;break}if(d.nextSibling)break}}return c??s>0?this.posAtEnd:this.posAtStart}nearestDesc(t,r=!1){for(let s=!0,c=t;c;c=c.parentNode){let d,u=this.getDesc(c);if(u&&(!r||u.node)){if(!s||!(d=u.nodeDOM)||(d.nodeType==1?d.contains(t.nodeType==1?t:t.parentNode):d==t))return u;s=!1}}}getDesc(t){let r=t.pmViewDesc;for(let s=r;s;s=s.parent)if(s==this)return r}posFromDOM(t,r,s){for(let c=t;c;c=c.parentNode){let d=this.getDesc(c);if(d)return d.localPosFromDOM(t,r,s)}return-1}descAt(t){for(let r=0,s=0;r<this.children.length;r++){let c=this.children[r],d=s+c.size;if(s==t&&d!=s){for(;!c.border&&c.children.length;)c=c.children[0];return c}if(t<d)return c.descAt(t-s-c.border);s=d}}domFromPos(t,r){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let s=0,c=0;for(let d=0;s<this.children.length;s++){let u=this.children[s],m=d+u.size;if(m>t||u instanceof Ia){c=t-d;break}d=m}if(c)return this.children[s].domFromPos(c-this.children[s].border,r);for(let d;s&&!(d=this.children[s-1]).size&&d instanceof Ea&&d.side>=0;s--);if(r<=0){let d,u=!0;for(;d=s?this.children[s-1]:null,d&&d.dom.parentNode!=this.contentDOM;s--,u=!1);return d&&r&&u&&!d.border&&!d.domAtom?d.domFromPos(d.size,r):{node:this.contentDOM,offset:d?ke(d.dom)+1:0}}{let d,u=!0;for(;d=s<this.children.length?this.children[s]:null,d&&d.dom.parentNode!=this.contentDOM;s++,u=!1);return d&&u&&!d.border&&!d.domAtom?d.domFromPos(0,r):{node:this.contentDOM,offset:d?ke(d.dom):this.contentDOM.childNodes.length}}}parseRange(t,r,s=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let c=-1,d=-1;for(let u=s,m=0;;m++){let g=this.children[m],w=u+g.size;if(c==-1&&t<=w){let k=u+g.border;if(t>=k&&r<=w-g.border&&g.node&&g.contentDOM&&this.contentDOM.contains(g.contentDOM))return g.parseRange(t,r,k);t=u;for(let x=m;x>0;x--){let C=this.children[x-1];if(C.size&&C.dom.parentNode==this.contentDOM&&!C.emptyChildAt(1)){c=ke(C.dom)+1;break}t-=C.size}c==-1&&(c=0)}if(c>-1&&(w>r||m==this.children.length-1)){r=w;for(let k=m+1;k<this.children.length;k++){let x=this.children[k];if(x.size&&x.dom.parentNode==this.contentDOM&&!x.emptyChildAt(-1)){d=ke(x.dom);break}r+=x.size}d==-1&&(d=this.contentDOM.childNodes.length);break}u=w}return{node:this.contentDOM,from:t,to:r,fromOffset:c,toOffset:d}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let r=this.children[t<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(t)}domAfterPos(t){let{node:r,offset:s}=this.domFromPos(t,0);if(r.nodeType!=1||s==r.childNodes.length)throw new RangeError("No node after pos "+t);return r.childNodes[s]}setSelection(t,r,s,c=!1){let d=Math.min(t,r),u=Math.max(t,r);for(let v=0,M=0;v<this.children.length;v++){let D=this.children[v],A=M+D.size;if(d>M&&u<A)return D.setSelection(t-M-D.border,r-M-D.border,s,c);M=A}let m=this.domFromPos(t,t?-1:1),g=r==t?m:this.domFromPos(r,r?-1:1),w=s.root.getSelection(),k=s.domSelectionRange(),x=!1;if((dt||ze)&&t==r){let{node:v,offset:M}=m;if(v.nodeType==3){if(x=!(!M||v.nodeValue[M-1]!=`
`),x&&M==v.nodeValue.length)for(let D,A=v;A;A=A.parentNode){if(D=A.nextSibling){D.nodeName=="BR"&&(m=g={node:D.parentNode,offset:ke(D)+1});break}let I=A.pmViewDesc;if(I&&I.node&&I.node.isBlock)break}}else{let D=v.childNodes[M-1];x=D&&(D.nodeName=="BR"||D.contentEditable=="false")}}if(dt&&k.focusNode&&k.focusNode!=g.node&&k.focusNode.nodeType==1){let v=k.focusNode.childNodes[k.focusOffset];v&&v.contentEditable=="false"&&(c=!0)}if(!(c||x&&ze)&&bn(m.node,m.offset,k.anchorNode,k.anchorOffset)&&bn(g.node,g.offset,k.focusNode,k.focusOffset))return;let C=!1;if((w.extend||t==r)&&!x){w.collapse(m.node,m.offset);try{t!=r&&w.extend(g.node,g.offset),C=!0}catch{}}if(!C){if(t>r){let M=m;m=g,g=M}let v=document.createRange();v.setEnd(g.node,g.offset),v.setStart(m.node,m.offset),w.removeAllRanges(),w.addRange(v)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,r){for(let s=0,c=0;c<this.children.length;c++){let d=this.children[c],u=s+d.size;if(s==u?t<=u&&r>=s:t<u&&r>s){let m=s+d.border,g=u-d.border;if(t>=m&&r<=g)return this.dirty=t==s||r==u?2:1,void(t!=m||r!=g||!d.contentLost&&d.dom.parentNode==this.contentDOM?d.markDirty(t-m,r-m):d.dirty=3);d.dirty=d.dom!=d.contentDOM||d.dom.parentNode!=this.contentDOM||d.children.length?3:2}s=u}this.dirty=2}markParentsDirty(){let t=1;for(let r=this.parent;r;r=r.parent,t++){let s=t==1?2:1;r.dirty<s&&(r.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(t){return!1}}class Ea extends Nr{constructor(t,r,s,c){let d,u=r.type.toDOM;if(typeof u=="function"&&(u=u(s,()=>d?d.parent?d.parent.posBeforeChild(d):void 0:c)),!r.type.spec.raw){if(u.nodeType!=1){let m=document.createElement("span");m.appendChild(u),u=m}u.contentEditable="false",u.classList.add("ProseMirror-widget")}super(t,[],u,null),this.widget=r,this.widget=r,d=this}matchesWidget(t){return this.dirty==0&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let r=this.widget.spec.stopEvent;return!!r&&r(t)}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Xu extends Nr{constructor(t,r,s,c){super(t,[],r,null),this.textDOM=s,this.text=c}get size(){return this.text.length}localPosFromDOM(t,r){return t!=this.textDOM?this.posAtStart+(r?this.size:0):this.posAtStart+r}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class xn extends Nr{constructor(t,r,s,c,d){super(t,[],s,c),this.mark=r,this.spec=d}static create(t,r,s,c){let d=c.nodeViews[r.type.name],u=d&&d(r,c,s);return u&&u.dom||(u=pn.renderSpec(document,r.type.spec.toDOM(r,s),null,r.attrs)),new xn(t,r,u.dom,u.contentDOM||u.dom,u)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=3&&this.mark.eq(t)}markDirty(t,r){if(super.markDirty(t,r),this.dirty!=0){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=0}}slice(t,r,s){let c=xn.create(this.parent,this.mark,!0,s),d=this.children,u=this.size;r<u&&(d=Vo(d,r,u,s)),t>0&&(d=Vo(d,0,t,s));for(let m=0;m<d.length;m++)d[m].parent=c;return c.children=d,c}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Ht extends Nr{constructor(t,r,s,c,d,u,m,g,w){super(t,[],d,u),this.node=r,this.outerDeco=s,this.innerDeco=c,this.nodeDOM=m}static create(t,r,s,c,d,u){let m,g=d.nodeViews[r.type.name],w=g&&g(r,d,()=>m?m.parent?m.parent.posBeforeChild(m):void 0:u,s,c),k=w&&w.dom,x=w&&w.contentDOM;if(r.isText)if(k){if(k.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else k=document.createTextNode(r.text);else k||({dom:k,contentDOM:x}=pn.renderSpec(document,r.type.spec.toDOM(r),null,r.attrs));x||r.isText||k.nodeName=="BR"||(k.hasAttribute("contenteditable")||(k.contentEditable="false"),r.type.spec.draggable&&(k.draggable=!0));let C=k;return k=Pa(k,s,r),w?m=new _u(t,r,s,c,k,x||null,C,w,d,u+1):r.isText?new yi(t,r,s,c,k,C,d):new Ht(t,r,s,c,k,x||null,C,d,u+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let r=this.children.length-1;r>=0;r--){let s=this.children[r];if(this.dom.contains(s.dom.parentNode)){t.contentElement=s.dom.parentNode;break}}t.contentElement||(t.getContent=()=>i.empty)}else t.contentElement=this.contentDOM;else t.getContent=()=>this.node.content;return t}matchesNode(t,r,s){return this.dirty==0&&t.eq(this.node)&&wi(r,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,r){let s=this.node.inlineContent,c=r,d=t.composing?this.localCompositionInfo(t,r):null,u=d&&d.pos>-1?d:null,m=d&&d.pos<0,g=new Qu(this,u&&u.node,t);(function(w,k,x,C){let v=k.locals(w),M=0;if(v.length==0){for(let R=0;R<w.childCount;R++){let V=w.child(R);C(V,v,k.forChild(M,V),R),M+=V.nodeSize}return}let D=0,A=[],I=null;for(let R=0;;){let V,q,Y,ie;for(;D<v.length&&v[D].to==M;){let H=v[D++];H.widget&&(V?(q||(q=[V])).push(H):V=H)}if(V)if(q){q.sort(ep);for(let H=0;H<q.length;H++)x(q[H],R,!!I)}else x(V,R,!!I);if(I)ie=-1,Y=I,I=null;else{if(!(R<w.childCount))break;ie=R,Y=w.child(R++)}for(let H=0;H<A.length;H++)A[H].to<=M&&A.splice(H--,1);for(;D<v.length&&v[D].from<=M&&v[D].to>M;)A.push(v[D++]);let ne=M+Y.nodeSize;if(Y.isText){let H=ne;D<v.length&&v[D].from<H&&(H=v[D].from);for(let $=0;$<A.length;$++)A[$].to<H&&(H=A[$].to);H<ne&&(I=Y.cut(H-M),Y=Y.cut(0,H-M),ne=H,ie=-1)}else for(;D<v.length&&v[D].to<ne;)D++;C(Y,Y.isInline&&!Y.isLeaf?A.filter(H=>!H.inline):A.slice(),k.forChild(M,Y),ie),M=ne}})(this.node,this.innerDeco,(w,k,x)=>{w.spec.marks?g.syncToMarks(w.spec.marks,s,t):w.type.side>=0&&!x&&g.syncToMarks(k==this.node.childCount?p.none:this.node.child(k).marks,s,t),g.placeWidget(w,t,c)},(w,k,x,C)=>{let v;g.syncToMarks(w.marks,s,t),g.findNodeMatch(w,k,x,C)||m&&t.state.selection.from>c&&t.state.selection.to<c+w.nodeSize&&(v=g.findIndexWithChild(d.node))>-1&&g.updateNodeAt(w,k,x,v,t)||g.updateNextNode(w,k,x,t,C,c)||g.addNode(w,k,x,t,c),c+=w.nodeSize}),g.syncToMarks([],s,t),this.node.isTextblock&&g.addTextblockHacks(),g.destroyRest(),(g.changed||this.dirty==2)&&(u&&this.protectLocalComposition(t,u),Ra(this.contentDOM,this.children,t),jn&&function(w){if(w.nodeName=="UL"||w.nodeName=="OL"){let k=w.style.cssText;w.style.cssText=k+"; list-style: square !important",window.getComputedStyle(w).listStyle,w.style.cssText=k}}(this.dom))}localCompositionInfo(t,r){let{from:s,to:c}=t.state.selection;if(!(t.state.selection instanceof Z)||s<r||c>r+this.node.content.size)return null;let d=t.input.compositionNode;if(!d||!this.dom.contains(d.parentNode))return null;if(this.node.inlineContent){let u=d.nodeValue,m=function(g,w,k,x){for(let C=0,v=0;C<g.childCount&&v<=x;){let M=g.child(C++),D=v;if(v+=M.nodeSize,!M.isText)continue;let A=M.text;for(;C<g.childCount;){let I=g.child(C++);if(v+=I.nodeSize,!I.isText)break;A+=I.text}if(v>=k){if(v>=x&&A.slice(x-w.length-D,x-D)==w)return x-w.length;let I=D<x?A.lastIndexOf(w,x-D-1):-1;if(I>=0&&I+w.length+D>=k)return D+I;if(k==x&&A.length>=x+w.length-D&&A.slice(x-D,x-D+w.length)==w)return x}}return-1}(this.node.content,u,s-r,c-r);return m<0?null:{node:d,pos:m,text:u}}return{node:d,pos:-1,text:""}}protectLocalComposition(t,{node:r,pos:s,text:c}){if(this.getDesc(r))return;let d=r;for(;d.parentNode!=this.contentDOM;d=d.parentNode){for(;d.previousSibling;)d.parentNode.removeChild(d.previousSibling);for(;d.nextSibling;)d.parentNode.removeChild(d.nextSibling);d.pmViewDesc&&(d.pmViewDesc=void 0)}let u=new Xu(this,d,r,c);t.input.compositionNodes.push(u),this.children=Vo(this.children,s,s+c.length,t,u)}update(t,r,s,c){return!(this.dirty==3||!t.sameMarkup(this.node))&&(this.updateInner(t,r,s,c),!0)}updateInner(t,r,s,c){this.updateOuterDeco(r),this.node=t,this.innerDeco=s,this.contentDOM&&this.updateChildren(c,this.posAtStart),this.dirty=0}updateOuterDeco(t){if(wi(t,this.outerDeco))return;let r=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=za(this.dom,this.nodeDOM,Bo(this.outerDeco,this.node,r),Bo(t,this.node,r)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Aa(a,t,r,s,c){Pa(s,t,a);let d=new Ht(void 0,a,t,r,s,s,s,c,0);return d.contentDOM&&d.updateChildren(c,0),d}class yi extends Ht{constructor(t,r,s,c,d,u,m){super(t,r,s,c,d,null,u,m,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,r,s,c){return!(this.dirty==3||this.dirty!=0&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(r),this.dirty==0&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,c.trackWrites==this.nodeDOM&&(c.trackWrites=null)),this.node=t,this.dirty=0,!0)}inParent(){let t=this.parent.contentDOM;for(let r=this.nodeDOM;r;r=r.parentNode)if(r==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,r,s){return t==this.nodeDOM?this.posAtStart+Math.min(r,this.node.text.length):super.localPosFromDOM(t,r,s)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,r,s){let c=this.node.cut(t,r),d=document.createTextNode(c.text);return new yi(this.parent,c,this.outerDeco,this.innerDeco,d,d,s)}markDirty(t,r){super.markDirty(t,r),this.dom==this.nodeDOM||t!=0&&r!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(t){return this.node.text==t}}class Ia extends Nr{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==0&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class _u extends Ht{constructor(t,r,s,c,d,u,m,g,w,k){super(t,r,s,c,d,u,m,w,k),this.spec=g}update(t,r,s,c){if(this.dirty==3)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let d=this.spec.update(t,r,s);return d&&this.updateInner(t,r,s,c),d}return!(!this.contentDOM&&!t.isLeaf)&&super.update(t,r,s,c)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,r,s,c){this.spec.setSelection?this.spec.setSelection(t,r,s.root):super.setSelection(t,r,s,c)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function Ra(a,t,r){let s=a.firstChild,c=!1;for(let d=0;d<t.length;d++){let u=t[d],m=u.dom;if(m.parentNode==a){for(;m!=s;)s=Ba(s),c=!0;s=s.nextSibling}else c=!0,a.insertBefore(m,s);if(u instanceof xn){let g=s?s.previousSibling:a.lastChild;Ra(u.contentDOM,u.children,r),s=g?g.nextSibling:a.firstChild}}for(;s;)s=Ba(s),c=!0;c&&r.trackWrites==a&&(r.trackWrites=null)}const Dr=function(a){a&&(this.nodeName=a)};Dr.prototype=Object.create(null);const Sn=[new Dr];function Bo(a,t,r){if(a.length==0)return Sn;let s=r?Sn[0]:new Dr,c=[s];for(let d=0;d<a.length;d++){let u=a[d].type.attrs;if(u){u.nodeName&&c.push(s=new Dr(u.nodeName));for(let m in u){let g=u[m];g!=null&&(r&&c.length==1&&c.push(s=new Dr(t.isInline?"span":"div")),m=="class"?s.class=(s.class?s.class+" ":"")+g:m=="style"?s.style=(s.style?s.style+";":"")+g:m!="nodeName"&&(s[m]=g))}}}return c}function za(a,t,r,s){if(r==Sn&&s==Sn)return t;let c=t;for(let d=0;d<s.length;d++){let u=s[d],m=r[d];if(d){let g;m&&m.nodeName==u.nodeName&&c!=a&&(g=c.parentNode)&&g.nodeName.toLowerCase()==u.nodeName||(g=document.createElement(u.nodeName),g.pmIsDeco=!0,g.appendChild(c),m=Sn[0]),c=g}Zu(c,m||Sn[0],u)}return c}function Zu(a,t,r){for(let s in t)s=="class"||s=="style"||s=="nodeName"||s in r||a.removeAttribute(s);for(let s in r)s!="class"&&s!="style"&&s!="nodeName"&&r[s]!=t[s]&&a.setAttribute(s,r[s]);if(t.class!=r.class){let s=t.class?t.class.split(" ").filter(Boolean):[],c=r.class?r.class.split(" ").filter(Boolean):[];for(let d=0;d<s.length;d++)c.indexOf(s[d])==-1&&a.classList.remove(s[d]);for(let d=0;d<c.length;d++)s.indexOf(c[d])==-1&&a.classList.add(c[d]);a.classList.length==0&&a.removeAttribute("class")}if(t.style!=r.style){if(t.style){let s,c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;s=c.exec(t.style);)a.style.removeProperty(s[1])}r.style&&(a.style.cssText+=r.style)}}function Pa(a,t,r){return za(a,a,Sn,Bo(t,r,a.nodeType!=1))}function wi(a,t){if(a.length!=t.length)return!1;for(let r=0;r<a.length;r++)if(!a[r].type.eq(t[r].type))return!1;return!0}function Ba(a){let t=a.nextSibling;return a.parentNode.removeChild(a),t}class Qu{constructor(t,r,s){this.lock=r,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=function(c,d){let u=d,m=u.children.length,g=c.childCount,w=new Map,k=[];e:for(;g>0;){let x;for(;;)if(m){let v=u.children[m-1];if(!(v instanceof xn)){x=v,m--;break}u=v,m=v.children.length}else{if(u==d)break e;m=u.parent.children.indexOf(u),u=u.parent}let C=x.node;if(C){if(C!=c.child(g-1))break;--g,w.set(x,g),k.push(x)}}return{index:g,matched:w,matches:k.reverse()}}(t.node.content,t)}destroyBetween(t,r){if(t!=r){for(let s=t;s<r;s++)this.top.children[s].destroy();this.top.children.splice(t,r-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,r,s){let c=0,d=this.stack.length>>1,u=Math.min(d,t.length);for(;c<u&&(c==d-1?this.top:this.stack[c+1<<1]).matchesMark(t[c])&&t[c].type.spec.spanning!==!1;)c++;for(;c<d;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),d--;for(;d<t.length;){this.stack.push(this.top,this.index+1);let m=-1;for(let g=this.index;g<Math.min(this.index+3,this.top.children.length);g++){let w=this.top.children[g];if(w.matchesMark(t[d])&&!this.isLocked(w.dom)){m=g;break}}if(m>-1)m>this.index&&(this.changed=!0,this.destroyBetween(this.index,m)),this.top=this.top.children[this.index];else{let g=xn.create(this.top,t[d],r,s);this.top.children.splice(this.index,0,g),this.top=g,this.changed=!0}this.index=0,d++}}findNodeMatch(t,r,s,c){let d,u=-1;if(c>=this.preMatch.index&&(d=this.preMatch.matches[c-this.preMatch.index]).parent==this.top&&d.matchesNode(t,r,s))u=this.top.children.indexOf(d,this.index);else for(let m=this.index,g=Math.min(this.top.children.length,m+5);m<g;m++){let w=this.top.children[m];if(w.matchesNode(t,r,s)&&!this.preMatch.matched.has(w)){u=m;break}}return!(u<0)&&(this.destroyBetween(this.index,u),this.index++,!0)}updateNodeAt(t,r,s,c,d){let u=this.top.children[c];return u.dirty==3&&u.dom==u.contentDOM&&(u.dirty=2),!!u.update(t,r,s,d)&&(this.destroyBetween(this.index,c),this.index++,!0)}findIndexWithChild(t){for(;;){let r=t.parentNode;if(!r)return-1;if(r==this.top.contentDOM){let s=t.pmViewDesc;if(s){for(let c=this.index;c<this.top.children.length;c++)if(this.top.children[c]==s)return c}return-1}t=r}}updateNextNode(t,r,s,c,d,u){for(let m=this.index;m<this.top.children.length;m++){let g=this.top.children[m];if(g instanceof Ht){let w=this.preMatch.matched.get(g);if(w!=null&&w!=d)return!1;let k,x=g.dom,C=this.isLocked(x)&&!(t.isText&&g.node&&g.node.isText&&g.nodeDOM.nodeValue==t.text&&g.dirty!=3&&wi(r,g.outerDeco));if(!C&&g.update(t,r,s,c))return this.destroyBetween(this.index,m),g.dom!=x&&(this.changed=!0),this.index++,!0;if(!C&&(k=this.recreateWrapper(g,t,r,s,c,u)))return this.destroyBetween(this.index,m),this.top.children[this.index]=k,k.contentDOM&&(k.dirty=2,k.updateChildren(c,u+1),k.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,r,s,c,d,u){if(t.dirty||r.isAtom||!t.children.length||!t.node.content.eq(r.content)||!wi(s,t.outerDeco)||!c.eq(t.innerDeco))return null;let m=Ht.create(this.top,r,s,c,d,u);if(m.contentDOM){m.children=t.children,t.children=[];for(let g of m.children)g.parent=m}return t.destroy(),m}addNode(t,r,s,c,d){let u=Ht.create(this.top,t,r,s,c,d);u.contentDOM&&u.updateChildren(c,d+1),this.top.children.splice(this.index++,0,u),this.changed=!0}placeWidget(t,r,s){let c=this.index<this.top.children.length?this.top.children[this.index]:null;if(!c||!c.matchesWidget(t)||t!=c.widget&&c.widget.type.toDOM.parentNode){let d=new Ea(this.top,t,r,s);this.top.children.splice(this.index++,0,d),this.changed=!0}else this.index++}addTextblockHacks(){let t=this.top.children[this.index-1],r=this.top;for(;t instanceof xn;)r=t,t=r.children[r.children.length-1];(!t||!(t instanceof yi)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((ze||Ne)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",r),this.addHackNode("BR",this.top))}addHackNode(t,r){if(r==this.top&&this.index<r.children.length&&r.children[this.index].matchesHack(t))this.index++;else{let s=document.createElement(t);t=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),t=="BR"&&(s.className="ProseMirror-trailingBreak");let c=new Ia(this.top,[],s,null);r!=this.top?r.children.push(c):r.children.splice(this.index++,0,c),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function ep(a,t){return a.type.side-t.type.side}function Vo(a,t,r,s,c){let d=[];for(let u=0,m=0;u<a.length;u++){let g=a[u],w=m,k=m+=g.size;w>=r||k<=t?d.push(g):(w<t&&d.push(g.slice(0,t-w,s)),c&&(d.push(c),c=void 0),k>r&&d.push(g.slice(r-w,g.size,s)))}return d}function Fo(a,t=null){let r=a.domSelectionRange(),s=a.state.doc;if(!r.focusNode)return null;let c=a.docView.nearestDesc(r.focusNode),d=c&&c.size==0,u=a.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(u<0)return null;let m,g,w=s.resolve(u);if(gi(r)){for(m=u;c&&!c.node;)c=c.parent;let x=c.node;if(c&&x.isAtom&&W.isSelectable(x)&&c.parent&&(!x.isInline||!function(C,v,M){for(let D=v==0,A=v==nt(C);D||A;){if(C==M)return!0;let I=ke(C);if(!(C=C.parentNode))return!1;D=D&&I==0,A=A&&I==nt(C)}}(r.focusNode,r.focusOffset,c.dom))){let C=c.posBefore;g=new W(u==C?w:s.resolve(C))}}else{if(r instanceof a.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let x=u,C=u;for(let v=0;v<r.rangeCount;v++){let M=r.getRangeAt(v);x=Math.min(x,a.docView.posFromDOM(M.startContainer,M.startOffset,1)),C=Math.max(C,a.docView.posFromDOM(M.endContainer,M.endOffset,-1))}if(x<0)return null;[m,u]=C==a.state.selection.anchor?[C,x]:[x,C],w=s.resolve(u)}else m=a.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(m<0)return null}let k=s.resolve(m);return g||(g=qo(a,k,w,t=="pointer"||a.state.selection.head<w.pos&&!d?1:-1)),g}function Va(a){return a.editable?a.hasFocus():Ha(a)&&document.activeElement&&document.activeElement.contains(a.dom)}function Et(a,t=!1){let r=a.state.selection;if($a(a,r),Va(a)){if(!t&&a.input.mouseDown&&a.input.mouseDown.allowDefault&&Ne){let s=a.domSelectionRange(),c=a.domObserver.currentSelection;if(s.anchorNode&&c.anchorNode&&bn(s.anchorNode,s.anchorOffset,c.anchorNode,c.anchorOffset))return a.input.mouseDown.delayedSelectionSync=!0,void a.domObserver.setCurSelection()}if(a.domObserver.disconnectSelection(),a.cursorWrapper)(function(s){let c=s.domSelection(),d=document.createRange();if(!c)return;let u=s.cursorWrapper.dom,m=u.nodeName=="IMG";m?d.setStart(u.parentNode,ke(u)+1):d.setStart(u,0),d.collapse(!0),c.removeAllRanges(),c.addRange(d),!m&&!s.state.selection.visible&&Je&&Wt<=11&&(u.disabled=!0,u.disabled=!1)})(a);else{let s,c,{anchor:d,head:u}=r;!Fa||r instanceof Z||(r.$from.parent.inlineContent||(s=La(a,r.from)),r.empty||r.$from.parent.inlineContent||(c=La(a,r.to))),a.docView.setSelection(d,u,a,t),Fa&&(s&&qa(s),c&&qa(c)),r.visible?a.dom.classList.remove("ProseMirror-hideselection"):(a.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(m){let g=m.dom.ownerDocument;g.removeEventListener("selectionchange",m.input.hideSelectionGuard);let w=m.domSelectionRange(),k=w.anchorNode,x=w.anchorOffset;g.addEventListener("selectionchange",m.input.hideSelectionGuard=()=>{w.anchorNode==k&&w.anchorOffset==x||(g.removeEventListener("selectionchange",m.input.hideSelectionGuard),setTimeout(()=>{Va(m)&&!m.state.selection.visible||m.dom.classList.remove("ProseMirror-hideselection")},20))})}(a))}a.domObserver.setCurSelection(),a.domObserver.connectSelection()}}const Fa=ze||Ne&&wa<63;function La(a,t){let{node:r,offset:s}=a.docView.domFromPos(t,0),c=s<r.childNodes.length?r.childNodes[s]:null,d=s?r.childNodes[s-1]:null;if(ze&&c&&c.contentEditable=="false")return Lo(c);if(!(c&&c.contentEditable!="false"||d&&d.contentEditable!="false")){if(c)return Lo(c);if(d)return Lo(d)}}function Lo(a){return a.contentEditable="true",ze&&a.draggable&&(a.draggable=!1,a.wasDraggable=!0),a}function qa(a){a.contentEditable="false",a.wasDraggable&&(a.draggable=!0,a.wasDraggable=null)}function $a(a,t){if(t instanceof W){let r=a.docView.descAt(t.from);r!=a.lastSelectedViewDesc&&(Wa(a),r&&r.selectNode(),a.lastSelectedViewDesc=r)}else Wa(a)}function Wa(a){a.lastSelectedViewDesc&&(a.lastSelectedViewDesc.parent&&a.lastSelectedViewDesc.deselectNode(),a.lastSelectedViewDesc=void 0)}function qo(a,t,r,s){return a.someProp("createSelectionBetween",c=>c(a,t,r))||Z.between(t,r,s)}function Ja(a){return!(a.editable&&!a.hasFocus())&&Ha(a)}function Ha(a){let t=a.domSelectionRange();if(!t.anchorNode)return!1;try{return a.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(a.editable||a.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function $o(a,t){let{$anchor:r,$head:s}=a.selection,c=t>0?r.max(s):r.min(s),d=c.parent.inlineContent?c.depth?a.doc.resolve(t>0?c.after():c.before()):null:c;return d&&X.findFrom(d,t)}function Kt(a,t){return a.dispatch(a.state.tr.setSelection(t).scrollIntoView()),!0}function Ka(a,t,r){let s=a.state.selection;if(!(s instanceof Z)){if(s instanceof W&&s.node.isInline)return Kt(a,new Z(t>0?s.$to:s.$from));{let c=$o(a.state,t);return!!c&&Kt(a,c)}}if(r.indexOf("s")>-1){let{$head:c}=s,d=c.textOffset?null:t<0?c.nodeBefore:c.nodeAfter;if(!d||d.isText||!d.isLeaf)return!1;let u=a.state.doc.resolve(c.pos+d.nodeSize*(t<0?-1:1));return Kt(a,new Z(s.$anchor,u))}if(!s.empty)return!1;if(a.endOfTextblock(t>0?"forward":"backward")){let c=$o(a.state,t);return!!(c&&c instanceof W)&&Kt(a,c)}if(!(rt&&r.indexOf("m")>-1)){let c,d=s.$head,u=d.textOffset?null:t<0?d.nodeBefore:d.nodeAfter;if(!u||u.isText)return!1;let m=t<0?d.pos-u.nodeSize:d.pos;return!!(u.isAtom||(c=a.docView.descAt(m))&&!c.contentDOM)&&(W.isSelectable(u)?Kt(a,new W(t<0?a.state.doc.resolve(d.pos-u.nodeSize):d)):!!vr&&Kt(a,new Z(a.state.doc.resolve(t<0?m:m+u.nodeSize))))}}function bi(a){return a.nodeType==3?a.nodeValue.length:a.childNodes.length}function Tr(a,t){let r=a.pmViewDesc;return r&&r.size==0&&(t<0||a.nextSibling||a.nodeName!="BR")}function Gn(a,t){return t<0?function(r){let s=r.domSelectionRange(),c=s.focusNode,d=s.focusOffset;if(!c)return;let u,m,g=!1;for(dt&&c.nodeType==1&&d<bi(c)&&Tr(c.childNodes[d],-1)&&(g=!0);;)if(d>0){if(c.nodeType!=1)break;{let w=c.childNodes[d-1];if(Tr(w,-1))u=c,m=--d;else{if(w.nodeType!=3)break;c=w,d=c.nodeValue.length}}}else{if(ja(c))break;{let w=c.previousSibling;for(;w&&Tr(w,-1);)u=c.parentNode,m=ke(w),w=w.previousSibling;if(w)c=w,d=bi(c);else{if(c=c.parentNode,c==r.dom)break;d=0}}}g?Wo(r,c,d):u&&Wo(r,u,m)}(a):function(r){let s=r.domSelectionRange(),c=s.focusNode,d=s.focusOffset;if(!c)return;let u,m,g=bi(c);for(;;)if(d<g){if(c.nodeType!=1||!Tr(c.childNodes[d],1))break;u=c,m=++d}else{if(ja(c))break;{let w=c.nextSibling;for(;w&&Tr(w,1);)u=w.parentNode,m=ke(w)+1,w=w.nextSibling;if(w)c=w,d=0,g=bi(c);else{if(c=c.parentNode,c==r.dom)break;d=g=0}}}u&&Wo(r,u,m)}(a)}function ja(a){let t=a.pmViewDesc;return t&&t.node&&t.node.isBlock}function Wo(a,t,r){if(t.nodeType!=3){let d,u;(u=function(m,g){for(;m&&g==m.childNodes.length&&!Mr(m);)g=ke(m)+1,m=m.parentNode;for(;m&&g<m.childNodes.length;){let w=m.childNodes[g];if(w.nodeType==3)return w;if(w.nodeType==1&&w.contentEditable=="false")break;m=w,g=0}}(t,r))?(t=u,r=0):(d=function(m,g){for(;m&&!g&&!Mr(m);)g=ke(m),m=m.parentNode;for(;m&&g;){let w=m.childNodes[g-1];if(w.nodeType==3)return w;if(w.nodeType==1&&w.contentEditable=="false")break;g=(m=w).childNodes.length}}(t,r))&&(t=d,r=d.nodeValue.length)}let s=a.domSelection();if(!s)return;if(gi(s)){let d=document.createRange();d.setEnd(t,r),d.setStart(t,r),s.removeAllRanges(),s.addRange(d)}else s.extend&&s.extend(t,r);a.domObserver.setCurSelection();let{state:c}=a;setTimeout(()=>{a.state==c&&Et(a)},50)}function Ua(a,t){let r=a.state.doc.resolve(t);if(!Ne&&!Wu&&r.parent.inlineContent){let s=a.coordsAtPos(t);if(t>r.start()){let c=a.coordsAtPos(t-1),d=(c.top+c.bottom)/2;if(d>s.top&&d<s.bottom&&Math.abs(c.left-s.left)>1)return c.left<s.left?"ltr":"rtl"}if(t<r.end()){let c=a.coordsAtPos(t+1),d=(c.top+c.bottom)/2;if(d>s.top&&d<s.bottom&&Math.abs(c.left-s.left)>1)return c.left>s.left?"ltr":"rtl"}}return getComputedStyle(a.dom).direction=="rtl"?"rtl":"ltr"}function Ga(a,t,r){let s=a.state.selection;if(s instanceof Z&&!s.empty||r.indexOf("s")>-1||rt&&r.indexOf("m")>-1)return!1;let{$from:c,$to:d}=s;if(!c.parent.inlineContent||a.endOfTextblock(t<0?"up":"down")){let u=$o(a.state,t);if(u&&u instanceof W)return Kt(a,u)}if(!c.parent.inlineContent){let u=t<0?c:d,m=s instanceof We?X.near(u,t):X.findFrom(u,t);return!!m&&Kt(a,m)}return!1}function Ya(a,t){if(!(a.state.selection instanceof Z))return!0;let{$head:r,$anchor:s,empty:c}=a.state.selection;if(!r.sameParent(s))return!0;if(!c)return!1;if(a.endOfTextblock(t>0?"forward":"backward"))return!0;let d=!r.textOffset&&(t<0?r.nodeBefore:r.nodeAfter);if(d&&!d.isText){let u=a.state.tr;return t<0?u.delete(r.pos-d.nodeSize,r.pos):u.delete(r.pos,r.pos+d.nodeSize),a.dispatch(u),!0}return!1}function Xa(a,t,r){a.domObserver.stop(),t.contentEditable=r,a.domObserver.start()}function tp(a,t){let r=t.keyCode,s=function(c){let d="";return c.ctrlKey&&(d+="c"),c.metaKey&&(d+="m"),c.altKey&&(d+="a"),c.shiftKey&&(d+="s"),d}(t);if(r==8||rt&&r==72&&s=="c")return Ya(a,-1)||Gn(a,-1);if(r==46&&!t.shiftKey||rt&&r==68&&s=="c")return Ya(a,1)||Gn(a,1);if(r==13||r==27)return!0;if(r==37||rt&&r==66&&s=="c"){let c=r==37?Ua(a,a.state.selection.from)=="ltr"?-1:1:-1;return Ka(a,c,s)||Gn(a,c)}if(r==39||rt&&r==70&&s=="c"){let c=r==39?Ua(a,a.state.selection.from)=="ltr"?1:-1:1;return Ka(a,c,s)||Gn(a,c)}return r==38||rt&&r==80&&s=="c"?Ga(a,-1,s)||Gn(a,-1):r==40||rt&&r==78&&s=="c"?function(c){if(!ze||c.state.selection.$head.parentOffset>0)return!1;let{focusNode:d,focusOffset:u}=c.domSelectionRange();if(d&&d.nodeType==1&&u==0&&d.firstChild&&d.firstChild.contentEditable=="false"){let m=d.firstChild;Xa(c,m,"true"),setTimeout(()=>Xa(c,m,"false"),20)}return!1}(a)||Ga(a,1,s)||Gn(a,1):s==(rt?"m":"c")&&(r==66||r==73||r==89||r==90)}function Jo(a,t){a.someProp("transformCopied",C=>{t=C(t,a)});let r=[],{content:s,openStart:c,openEnd:d}=t;for(;c>1&&d>1&&s.childCount==1&&s.firstChild.childCount==1;){c--,d--;let C=s.firstChild;r.push(C.type.name,C.attrs!=C.type.defaultAttrs?C.attrs:null),s=C.content}let u=a.someProp("clipboardSerializer")||pn.fromSchema(a.state.schema),m=rc(),g=m.createElement("div");g.appendChild(u.serializeFragment(s,{document:m}));let w,k=g.firstChild,x=0;for(;k&&k.nodeType==1&&(w=tc[k.nodeName.toLowerCase()]);){for(let C=w.length-1;C>=0;C--){let v=m.createElement(w[C]);for(;g.firstChild;)v.appendChild(g.firstChild);g.appendChild(v),x++}k=g.firstChild}return k&&k.nodeType==1&&k.setAttribute("data-pm-slice",`${c} ${d}${x?` -${x}`:""} ${JSON.stringify(r)}`),{dom:g,text:a.someProp("clipboardTextSerializer",C=>C(t,a))||t.content.textBetween(0,t.content.size,`

`),slice:t}}function Ho(a,t,r,s,c){let d,u,m=c.parent.type.spec.code;if(!r&&!t)return null;let g=t&&(s||m||!r);if(g){if(a.someProp("transformPastedText",C=>{t=C(t,m||s,a)}),m)return t?new b(i.from(a.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):b.empty;let x=a.someProp("clipboardTextParser",C=>C(t,c,s,a));if(x)u=x;else{let C=c.marks(),{schema:v}=a.state,M=pn.fromSchema(v);d=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(D=>{let A=d.appendChild(document.createElement("p"));D&&A.appendChild(M.serializeNode(v.text(D,C)))})}}else a.someProp("transformPastedHTML",x=>{r=x(r,a)}),d=function(x){let C=/^(\s*<meta [^>]*>)*/.exec(x);C&&(x=x.slice(C[0].length));let v,M=rc().createElement("div"),D=/<([a-z][^>\s]+)/i.exec(x);if((v=D&&tc[D[1].toLowerCase()])&&(x=v.map(A=>"<"+A+">").join("")+x+v.map(A=>"</"+A+">").reverse().join("")),M.innerHTML=function(A){let I=window.trustedTypes;return I?(jo||(jo=I.createPolicy("ProseMirrorClipboard",{createHTML:R=>R})),jo.createHTML(A)):A}(x),v)for(let A=0;A<v.length;A++)M=M.querySelector(v[A])||M;return M}(r),vr&&function(x){let C=x.querySelectorAll(Ne?"span:not([class]):not([style])":"span.Apple-converted-space");for(let v=0;v<C.length;v++){let M=C[v];M.childNodes.length==1&&M.textContent==" "&&M.parentNode&&M.parentNode.replaceChild(x.ownerDocument.createTextNode(" "),M)}}(d);let w=d&&d.querySelector("[data-pm-slice]"),k=w&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(w.getAttribute("data-pm-slice")||"");if(k&&k[3])for(let x=+k[3];x>0;x--){let C=d.firstChild;for(;C&&C.nodeType!=1;)C=C.nextSibling;if(!C)break;d=C}if(u||(u=(a.someProp("clipboardParser")||a.someProp("domParser")||qn.fromSchema(a.state.schema)).parseSlice(d,{preserveWhitespace:!(!g&&!k),context:c,ruleFromNode:C=>C.nodeName!="BR"||C.nextSibling||!C.parentNode||np.test(C.parentNode.nodeName)?null:{ignore:!0}})),k)u=function(x,C){if(!x.size)return x;let v,M=x.content.firstChild.type.schema;try{v=JSON.parse(C)}catch{return x}let{content:D,openStart:A,openEnd:I}=x;for(let R=v.length-2;R>=0;R-=2){let V=M.nodes[v[R]];if(!V||V.hasRequiredAttrs())break;D=i.from(V.create(v[R+1],D)),A++,I++}return new b(D,A,I)}(ec(u,+k[1],+k[2]),k[4]);else if(u=b.maxOpen(function(x,C){if(x.childCount<2)return x;for(let v=C.depth;v>=0;v--){let M,D=C.node(v).contentMatchAt(C.index(v)),A=[];if(x.forEach(I=>{if(!A)return;let R,V=D.findWrapping(I.type);if(!V)return A=null;if(R=A.length&&M.length&&Za(V,M,I,A[A.length-1],0))A[A.length-1]=R;else{A.length&&(A[A.length-1]=Qa(A[A.length-1],M.length));let q=_a(I,V);A.push(q),D=D.matchType(q.type),M=V}}),A)return i.from(A)}return x}(u.content,c),!0),u.openStart||u.openEnd){let x=0,C=0;for(let v=u.content.firstChild;x<u.openStart&&!v.type.spec.isolating;x++,v=v.firstChild);for(let v=u.content.lastChild;C<u.openEnd&&!v.type.spec.isolating;C++,v=v.lastChild);u=ec(u,x,C)}return a.someProp("transformPasted",x=>{u=x(u,a)}),u}const np=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function _a(a,t,r=0){for(let s=t.length-1;s>=r;s--)a=t[s].create(null,i.from(a));return a}function Za(a,t,r,s,c){if(c<a.length&&c<t.length&&a[c]==t[c]){let d=Za(a,t,r,s.lastChild,c+1);if(d)return s.copy(s.content.replaceChild(s.childCount-1,d));if(s.contentMatchAt(s.childCount).matchType(c==a.length-1?r.type:a[c+1]))return s.copy(s.content.append(i.from(_a(r,a,c+1))))}}function Qa(a,t){if(t==0)return a;let r=a.content.replaceChild(a.childCount-1,Qa(a.lastChild,t-1)),s=a.contentMatchAt(a.childCount).fillBefore(i.empty,!0);return a.copy(r.append(s))}function Ko(a,t,r,s,c,d){let u=t<0?a.firstChild:a.lastChild,m=u.content;return a.childCount>1&&(d=0),c<s-1&&(m=Ko(m,t,r,s,c+1,d)),c>=r&&(m=t<0?u.contentMatchAt(0).fillBefore(m,d<=c).append(m):m.append(u.contentMatchAt(u.childCount).fillBefore(i.empty,!0))),a.replaceChild(t<0?0:a.childCount-1,u.copy(m))}function ec(a,t,r){return t<a.openStart&&(a=new b(Ko(a.content,-1,t,a.openStart,0,a.openEnd),t,a.openEnd)),r<a.openEnd&&(a=new b(Ko(a.content,1,r,a.openEnd,0,0),a.openStart,r)),a}const tc={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let nc=null;function rc(){return nc||(nc=document.implementation.createHTMLDocument("title"))}let jo=null;const Pe={},Be={},rp={touchstart:!0,touchmove:!0};class ip{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function jt(a,t){a.input.lastSelectionOrigin=t,a.input.lastSelectionTime=Date.now()}function Uo(a){a.someProp("handleDOMEvents",t=>{for(let r in t)a.input.eventHandlers[r]||a.dom.addEventListener(r,a.input.eventHandlers[r]=s=>Go(a,s))})}function Go(a,t){return a.someProp("handleDOMEvents",r=>{let s=r[t.type];return!!s&&(s(a,t)||t.defaultPrevented)})}function op(a,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let r=t.target;r!=a.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(t))return!1;return!0}function ki(a){return{left:a.clientX,top:a.clientY}}function Yo(a,t,r,s,c){if(s==-1)return!1;let d=a.state.doc.resolve(s);for(let u=d.depth+1;u>0;u--)if(a.someProp(t,m=>u>d.depth?m(a,r,d.nodeAfter,d.before(u),c,!0):m(a,r,d.node(u),d.before(u),c,!1)))return!0;return!1}function Yn(a,t,r){if(a.focused||a.focus(),a.state.selection.eq(t))return;let s=a.state.tr.setSelection(t);s.setMeta("pointer",!0),a.dispatch(s)}function sp(a,t,r,s,c){return Yo(a,"handleClickOn",t,r,s)||a.someProp("handleClick",d=>d(a,t,s))||(c?function(d,u){if(u==-1)return!1;let m,g,w=d.state.selection;w instanceof W&&(m=w.node);let k=d.state.doc.resolve(u);for(let x=k.depth+1;x>0;x--){let C=x>k.depth?k.nodeAfter:k.node(x);if(W.isSelectable(C)){g=m&&w.$from.depth>0&&x>=w.$from.depth&&k.before(w.$from.depth+1)==w.$from.pos?k.before(w.$from.depth):k.before(x);break}}return g!=null&&(Yn(d,W.create(d.state.doc,g)),!0)}(a,r):function(d,u){if(u==-1)return!1;let m=d.state.doc.resolve(u),g=m.nodeAfter;return!!(g&&g.isAtom&&W.isSelectable(g))&&(Yn(d,new W(m)),!0)}(a,r))}function lp(a,t,r,s){return Yo(a,"handleDoubleClickOn",t,r,s)||a.someProp("handleDoubleClick",c=>c(a,t,s))}function ap(a,t,r,s){return Yo(a,"handleTripleClickOn",t,r,s)||a.someProp("handleTripleClick",c=>c(a,t,s))||function(c,d,u){if(u.button!=0)return!1;let m=c.state.doc;if(d==-1)return!!m.inlineContent&&(Yn(c,Z.create(m,0,m.content.size)),!0);let g=m.resolve(d);for(let w=g.depth+1;w>0;w--){let k=w>g.depth?g.nodeAfter:g.node(w),x=g.before(w);if(k.inlineContent)Yn(c,Z.create(m,x+1,x+1+k.content.size));else{if(!W.isSelectable(k))continue;Yn(c,W.create(m,x))}return!0}}(a,r,s)}function Xo(a){return Er(a)}Be.keydown=(a,t)=>{let r=t;if(a.input.shiftKey=r.keyCode==16||r.shiftKey,!oc(a,r)&&(a.input.lastKeyCode=r.keyCode,a.input.lastKeyCodeTime=Date.now(),!ft||!Ne||r.keyCode!=13))if(r.keyCode!=229&&a.domObserver.forceFlush(),!jn||r.keyCode!=13||r.ctrlKey||r.altKey||r.metaKey)a.someProp("handleKeyDown",s=>s(a,r))||tp(a,r)?r.preventDefault():jt(a,"key");else{let s=Date.now();a.input.lastIOSEnter=s,a.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{a.input.lastIOSEnter==s&&(a.someProp("handleKeyDown",c=>c(a,kn(13,"Enter"))),a.input.lastIOSEnter=0)},200)}},Be.keyup=(a,t)=>{t.keyCode==16&&(a.input.shiftKey=!1)},Be.keypress=(a,t)=>{let r=t;if(oc(a,r)||!r.charCode||r.ctrlKey&&!r.altKey||rt&&r.metaKey)return;if(a.someProp("handleKeyPress",c=>c(a,r)))return void r.preventDefault();let s=a.state.selection;if(!(s instanceof Z&&s.$from.sameParent(s.$to))){let c=String.fromCharCode(r.charCode);/[\r\n]/.test(c)||a.someProp("handleTextInput",d=>d(a,s.$from.pos,s.$to.pos,c))||a.dispatch(a.state.tr.insertText(c).scrollIntoView()),r.preventDefault()}};const ic=rt?"metaKey":"ctrlKey";Pe.mousedown=(a,t)=>{let r=t;a.input.shiftKey=r.shiftKey;let s=Xo(a),c=Date.now(),d="singleClick";c-a.input.lastClick.time<500&&function(m,g){let w=g.x-m.clientX,k=g.y-m.clientY;return w*w+k*k<100}(r,a.input.lastClick)&&!r[ic]&&(a.input.lastClick.type=="singleClick"?d="doubleClick":a.input.lastClick.type=="doubleClick"&&(d="tripleClick")),a.input.lastClick={time:c,x:r.clientX,y:r.clientY,type:d};let u=a.posAtCoords(ki(r));u&&(d=="singleClick"?(a.input.mouseDown&&a.input.mouseDown.done(),a.input.mouseDown=new cp(a,u,r,!!s)):(d=="doubleClick"?lp:ap)(a,u.pos,u.inside,r)?r.preventDefault():jt(a,"pointer"))};class cp{constructor(t,r,s,c){let d,u;if(this.view=t,this.pos=r,this.event=s,this.flushed=c,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!s[ic],this.allowDefault=s.shiftKey,r.inside>-1)d=t.state.doc.nodeAt(r.inside),u=r.inside;else{let k=t.state.doc.resolve(r.pos);d=k.parent,u=k.depth?k.before():0}const m=c?null:s.target,g=m?t.docView.nearestDesc(m,!0):null;this.target=g&&g.dom.nodeType==1?g.dom:null;let{selection:w}=t.state;(s.button==0&&d.type.spec.draggable&&d.type.spec.selectable!==!1||w instanceof W&&w.from<=u&&w.to>u)&&(this.mightDrag={node:d,pos:u,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!dt||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),jt(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Et(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(ki(t))),this.updateAllowDefault(t),this.allowDefault||!r?jt(this.view,"pointer"):sp(this.view,r.pos,r.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||ze&&this.mightDrag&&!this.mightDrag.node.isAtom||Ne&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Yn(this.view,X.near(this.view.state.doc.resolve(r.pos))),t.preventDefault()):jt(this.view,"pointer")}move(t){this.updateAllowDefault(t),jt(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}function oc(a,t){return!!a.composing||!!(ze&&Math.abs(t.timeStamp-a.input.compositionEndedAt)<500)&&(a.input.compositionEndedAt=-2e8,!0)}Pe.touchstart=a=>{a.input.lastTouch=Date.now(),Xo(a),jt(a,"pointer")},Pe.touchmove=a=>{a.input.lastTouch=Date.now(),jt(a,"pointer")},Pe.contextmenu=a=>Xo(a);const hp=ft?5e3:-1;function sc(a,t){clearTimeout(a.input.composingTimeout),t>-1&&(a.input.composingTimeout=setTimeout(()=>Er(a),t))}function lc(a){for(a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=function(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());a.input.compositionNodes.length>0;)a.input.compositionNodes.pop().markParentsDirty()}function dp(a){let t=a.domSelectionRange();if(!t.focusNode)return null;let r=function(c,d){for(;;){if(c.nodeType==3&&d)return c;if(c.nodeType==1&&d>0){if(c.contentEditable=="false")return null;d=nt(c=c.childNodes[d-1])}else{if(!c.parentNode||Mr(c))return null;d=ke(c),c=c.parentNode}}}(t.focusNode,t.focusOffset),s=function(c,d){for(;;){if(c.nodeType==3&&d<c.nodeValue.length)return c;if(c.nodeType==1&&d<c.childNodes.length){if(c.contentEditable=="false")return null;c=c.childNodes[d],d=0}else{if(!c.parentNode||Mr(c))return null;d=ke(c)+1,c=c.parentNode}}}(t.focusNode,t.focusOffset);if(r&&s&&r!=s){let c=s.pmViewDesc,d=a.domObserver.lastChangedTextNode;if(r==d||s==d)return d;if(!c||!c.isText(s.nodeValue))return s;if(a.input.compositionNode==s){let u=r.pmViewDesc;if(u&&u.isText(r.nodeValue))return s}}return r||s}function Er(a,t=!1){if(!(ft&&a.domObserver.flushingSoon>=0)){if(a.domObserver.forceFlush(),lc(a),t||a.docView&&a.docView.dirty){let r=Fo(a);return r&&!r.eq(a.state.selection)?a.dispatch(a.state.tr.setSelection(r)):!a.markCursor&&!t||a.state.selection.empty?a.updateState(a.state):a.dispatch(a.state.tr.deleteSelection()),!0}return!1}}Be.compositionstart=Be.compositionupdate=a=>{if(!a.composing){a.domObserver.flush();let{state:t}=a,r=t.selection.$to;if(t.selection instanceof Z&&(t.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))a.markCursor=a.state.storedMarks||r.marks(),Er(a,!0),a.markCursor=null;else if(Er(a,!t.selection.empty),dt&&t.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let s=a.domSelectionRange();for(let c=s.focusNode,d=s.focusOffset;c&&c.nodeType==1&&d!=0;){let u=d<0?c.lastChild:c.childNodes[d-1];if(!u)break;if(u.nodeType==3){let m=a.domSelection();m&&m.collapse(u,u.nodeValue.length);break}c=u,d=-1}}a.input.composing=!0}sc(a,hp)},Be.compositionend=(a,t)=>{a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=t.timeStamp,a.input.compositionPendingChanges=a.domObserver.pendingRecords().length?a.input.compositionID:0,a.input.compositionNode=null,a.input.compositionPendingChanges&&Promise.resolve().then(()=>a.domObserver.flush()),a.input.compositionID++,sc(a,20))};const Ar=Je&&Wt<15||jn&&Ju<604;function Ir(a,t,r,s,c){let d=Ho(a,t,r,s,a.state.selection.$from);if(a.someProp("handlePaste",g=>g(a,c,d||b.empty)))return!0;if(!d)return!1;let u=function(g){return g.openStart==0&&g.openEnd==0&&g.content.childCount==1?g.content.firstChild:null}(d),m=u?a.state.tr.replaceSelectionWith(u,s):a.state.tr.replaceSelection(d);return a.dispatch(m.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function ac(a){let t=a.getData("text/plain")||a.getData("Text");if(t)return t;let r=a.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}Pe.copy=Be.cut=(a,t)=>{let r=t,s=a.state.selection,c=r.type=="cut";if(s.empty)return;let d=Ar?null:r.clipboardData,u=s.content(),{dom:m,text:g}=Jo(a,u);d?(r.preventDefault(),d.clearData(),d.setData("text/html",m.innerHTML),d.setData("text/plain",g)):function(w,k){if(!w.dom.parentNode)return;let x=w.dom.parentNode.appendChild(document.createElement("div"));x.appendChild(k),x.style.cssText="position: fixed; left: -10000px; top: 10px";let C=getSelection(),v=document.createRange();v.selectNodeContents(k),w.dom.blur(),C.removeAllRanges(),C.addRange(v),setTimeout(()=>{x.parentNode&&x.parentNode.removeChild(x),w.focus()},50)}(a,m),c&&a.dispatch(a.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Be.paste=(a,t)=>{let r=t;if(a.composing&&!ft)return;let s=Ar?null:r.clipboardData,c=a.input.shiftKey&&a.input.lastKeyCode!=45;s&&Ir(a,ac(s),s.getData("text/html"),c,r)?r.preventDefault():function(d,u){if(!d.dom.parentNode)return;let m=d.input.shiftKey||d.state.selection.$from.parent.type.spec.code,g=d.dom.parentNode.appendChild(document.createElement(m?"textarea":"div"));m||(g.contentEditable="true"),g.style.cssText="position: fixed; left: -10000px; top: 10px",g.focus();let w=d.input.shiftKey&&d.input.lastKeyCode!=45;setTimeout(()=>{d.focus(),g.parentNode&&g.parentNode.removeChild(g),m?Ir(d,g.value,null,w,u):Ir(d,g.textContent,g.innerHTML,w,u)},50)}(a,r)};class cc{constructor(t,r,s){this.slice=t,this.move=r,this.node=s}}const hc=rt?"altKey":"ctrlKey";Pe.dragstart=(a,t)=>{let r=t,s=a.input.mouseDown;if(s&&s.done(),!r.dataTransfer)return;let c,d=a.state.selection,u=d.empty?null:a.posAtCoords(ki(r));if(!(u&&u.pos>=d.from&&u.pos<=(d instanceof W?d.to-1:d.to))){if(s&&s.mightDrag)c=W.create(a.state.doc,s.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let x=a.docView.nearestDesc(r.target,!0);x&&x.node.type.spec.draggable&&x!=a.docView&&(c=W.create(a.state.doc,x.posBefore))}}let m=(c||a.state.selection).content(),{dom:g,text:w,slice:k}=Jo(a,m);(!r.dataTransfer.files.length||!Ne||wa>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Ar?"Text":"text/html",g.innerHTML),r.dataTransfer.effectAllowed="copyMove",Ar||r.dataTransfer.setData("text/plain",w),a.dragging=new cc(k,!r[hc],c)},Pe.dragend=a=>{let t=a.dragging;window.setTimeout(()=>{a.dragging==t&&(a.dragging=null)},50)},Be.dragover=Be.dragenter=(a,t)=>t.preventDefault(),Be.drop=(a,t)=>{let r=t,s=a.dragging;if(a.dragging=null,!r.dataTransfer)return;let c=a.posAtCoords(ki(r));if(!c)return;let d=a.state.doc.resolve(c.pos),u=s&&s.slice;u?a.someProp("transformPasted",M=>{u=M(u,a)}):u=Ho(a,ac(r.dataTransfer),Ar?null:r.dataTransfer.getData("text/html"),!1,d);let m=!(!s||r[hc]);if(a.someProp("handleDrop",M=>M(a,r,u||b.empty,m)))return void r.preventDefault();if(!u)return;r.preventDefault();let g=u?So(a.state.doc,d.pos,u):d.pos;g==null&&(g=d.pos);let w=a.state.tr;if(m){let{node:M}=s;M?M.replace(w):w.deleteSelection()}let k=w.mapping.map(g),x=u.openStart==0&&u.openEnd==0&&u.content.childCount==1,C=w.doc;if(x?w.replaceRangeWith(k,k,u.content.firstChild):w.replaceRange(k,k,u),w.doc.eq(C))return;let v=w.doc.resolve(k);if(x&&W.isSelectable(u.content.firstChild)&&v.nodeAfter&&v.nodeAfter.sameMarkup(u.content.firstChild))w.setSelection(new W(v));else{let M=w.mapping.map(g);w.mapping.maps[w.mapping.maps.length-1].forEach((D,A,I,R)=>M=R),w.setSelection(qo(a,v,w.doc.resolve(M)))}a.focus(),a.dispatch(w.setMeta("uiEvent","drop"))},Pe.focus=a=>{a.input.lastFocus=Date.now(),a.focused||(a.domObserver.stop(),a.dom.classList.add("ProseMirror-focused"),a.domObserver.start(),a.focused=!0,setTimeout(()=>{a.docView&&a.hasFocus()&&!a.domObserver.currentSelection.eq(a.domSelectionRange())&&Et(a)},20))},Pe.blur=(a,t)=>{let r=t;a.focused&&(a.domObserver.stop(),a.dom.classList.remove("ProseMirror-focused"),a.domObserver.start(),r.relatedTarget&&a.dom.contains(r.relatedTarget)&&a.domObserver.currentSelection.clear(),a.focused=!1)},Pe.beforeinput=(a,t)=>{if(Ne&&ft&&t.inputType=="deleteContentBackward"){a.domObserver.flushSoon();let{domChangeCount:r}=a.input;setTimeout(()=>{if(a.input.domChangeCount!=r||(a.dom.blur(),a.focus(),a.someProp("handleKeyDown",c=>c(a,kn(8,"Backspace")))))return;let{$cursor:s}=a.state.selection;s&&s.pos>0&&a.dispatch(a.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let a in Be)Pe[a]=Be[a];function Rr(a,t){if(a==t)return!0;for(let r in a)if(a[r]!==t[r])return!1;for(let r in t)if(!(r in a))return!1;return!0}class xi{constructor(t,r){this.toDOM=t,this.spec=r||Cn,this.side=this.spec.side||0}map(t,r,s,c){let{pos:d,deleted:u}=t.mapResult(r.from+c,this.side<0?-1:1);return u?null:new Ye(d-s,d-s,this)}valid(){return!0}eq(t){return this==t||t instanceof xi&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Rr(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Ut{constructor(t,r){this.attrs=t,this.spec=r||Cn}map(t,r,s,c){let d=t.map(r.from+c,this.spec.inclusiveStart?-1:1)-s,u=t.map(r.to+c,this.spec.inclusiveEnd?1:-1)-s;return d>=u?null:new Ye(d,u,this)}valid(t,r){return r.from<r.to}eq(t){return this==t||t instanceof Ut&&Rr(this.attrs,t.attrs)&&Rr(this.spec,t.spec)}static is(t){return t.type instanceof Ut}destroy(){}}class _o{constructor(t,r){this.attrs=t,this.spec=r||Cn}map(t,r,s,c){let d=t.mapResult(r.from+c,1);if(d.deleted)return null;let u=t.mapResult(r.to+c,-1);return u.deleted||u.pos<=d.pos?null:new Ye(d.pos-s,u.pos-s,this)}valid(t,r){let s,{index:c,offset:d}=t.content.findIndex(r.from);return d==r.from&&!(s=t.child(c)).isText&&d+s.nodeSize==r.to}eq(t){return this==t||t instanceof _o&&Rr(this.attrs,t.attrs)&&Rr(this.spec,t.spec)}destroy(){}}class Ye{constructor(t,r,s){this.from=t,this.to=r,this.type=s}copy(t,r){return new Ye(t,r,this.type)}eq(t,r=0){return this.type.eq(t.type)&&this.from+r==t.from&&this.to+r==t.to}map(t,r,s){return this.type.map(t,this,r,s)}static widget(t,r,s){return new Ye(t,t,new xi(r,s))}static inline(t,r,s,c){return new Ye(t,r,new Ut(s,c))}static node(t,r,s,c){return new Ye(t,r,new _o(s,c))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ut}get widget(){return this.type instanceof xi}}const Xn=[],Cn={};class de{constructor(t,r){this.local=t.length?t:Xn,this.children=r.length?r:Xn}static create(t,r){return r.length?Si(r,t,0,Cn):De}find(t,r,s){let c=[];return this.findInner(t??0,r??1e9,c,0,s),c}findInner(t,r,s,c,d){for(let u=0;u<this.local.length;u++){let m=this.local[u];m.from<=r&&m.to>=t&&(!d||d(m.spec))&&s.push(m.copy(m.from+c,m.to+c))}for(let u=0;u<this.children.length;u+=3)if(this.children[u]<r&&this.children[u+1]>t){let m=this.children[u]+1;this.children[u+2].findInner(t-m,r-m,s,c+m,d)}}map(t,r,s){return this==De||t.maps.length==0?this:this.mapInner(t,r,0,0,s||Cn)}mapInner(t,r,s,c,d){let u;for(let m=0;m<this.local.length;m++){let g=this.local[m].map(t,s,c);g&&g.type.valid(r,g)?(u||(u=[])).push(g):d.onRemove&&d.onRemove(this.local[m].spec)}return this.children.length?function(m,g,w,k,x,C,v){let M=m.slice();for(let A=0,I=C;A<w.maps.length;A++){let R=0;w.maps[A].forEach((V,q,Y,ie)=>{let ne=ie-Y-(q-V);for(let H=0;H<M.length;H+=3){let $=M[H+1];if($<0||V>$+I-R)continue;let K=M[H]+I-R;q>=K?M[H+1]=V<=K?-2:-1:V>=I&&ne&&(M[H]+=ne,M[H+1]+=ne)}R+=ne}),I=w.maps[A].map(I,-1)}let D=!1;for(let A=0;A<M.length;A+=3)if(M[A+1]<0){if(M[A+1]==-2){D=!0,M[A+1]=-1;continue}let I=w.map(m[A]+C),R=I-x;if(R<0||R>=k.content.size){D=!0;continue}let V=w.map(m[A+1]+C,-1)-x,{index:q,offset:Y}=k.content.findIndex(R),ie=k.maybeChild(q);if(ie&&Y==R&&Y+ie.nodeSize==V){let ne=M[A+2].mapInner(w,ie,I+1,m[A]+C+1,v);ne!=De?(M[A]=R,M[A+1]=V,M[A+2]=ne):(M[A+1]=-2,D=!0)}else D=!0}if(D){let A=function(R,V,q,Y,ie,ne,H){function $(K,se){for(let j=0;j<K.local.length;j++){let Ke=K.local[j].map(Y,ie,se);Ke?q.push(Ke):H.onRemove&&H.onRemove(K.local[j].spec)}for(let j=0;j<K.children.length;j+=3)$(K.children[j+2],K.children[j]+se+1)}for(let K=0;K<R.length;K+=3)R[K+1]==-1&&$(R[K+2],V[K]+ne+1);return q}(M,m,g,w,x,C,v),I=Si(A,k,0,v);g=I.local;for(let R=0;R<M.length;R+=3)M[R+1]<0&&(M.splice(R,3),R-=3);for(let R=0,V=0;R<I.children.length;R+=3){let q=I.children[R];for(;V<M.length&&M[V]<q;)V+=3;M.splice(V,0,I.children[R],I.children[R+1],I.children[R+2])}}return new de(g.sort(Mn),M)}(this.children,u||[],t,r,s,c,d):u?new de(u.sort(Mn),Xn):De}add(t,r){return r.length?this==De?de.create(t,r):this.addInner(t,r,0):this}addInner(t,r,s){let c,d=0;t.forEach((m,g)=>{let w,k=g+s;if(w=fc(r,m,k)){for(c||(c=this.children.slice());d<c.length&&c[d]<g;)d+=3;c[d]==g?c[d+2]=c[d+2].addInner(m,w,k+1):c.splice(d,0,g,g+m.nodeSize,Si(w,m,k+1,Cn)),d+=3}});let u=dc(d?uc(r):r,-s);for(let m=0;m<u.length;m++)u[m].type.valid(t,u[m])||u.splice(m--,1);return new de(u.length?this.local.concat(u).sort(Mn):this.local,c||this.children)}remove(t){return t.length==0||this==De?this:this.removeInner(t,0)}removeInner(t,r){let s=this.children,c=this.local;for(let d=0;d<s.length;d+=3){let u,m=s[d]+r,g=s[d+1]+r;for(let k,x=0;x<t.length;x++)(k=t[x])&&k.from>m&&k.to<g&&(t[x]=null,(u||(u=[])).push(k));if(!u)continue;s==this.children&&(s=this.children.slice());let w=s[d+2].removeInner(u,m+1);w!=De?s[d+2]=w:(s.splice(d,3),d-=3)}if(c.length){for(let d,u=0;u<t.length;u++)if(d=t[u])for(let m=0;m<c.length;m++)c[m].eq(d,r)&&(c==this.local&&(c=this.local.slice()),c.splice(m--,1))}return s==this.children&&c==this.local?this:c.length||s.length?new de(c,s):De}forChild(t,r){if(this==De)return this;if(r.isLeaf)return de.empty;let s,c;for(let m=0;m<this.children.length;m+=3)if(this.children[m]>=t){this.children[m]==t&&(s=this.children[m+2]);break}let d=t+1,u=d+r.content.size;for(let m=0;m<this.local.length;m++){let g=this.local[m];if(g.from<u&&g.to>d&&g.type instanceof Ut){let w=Math.max(d,g.from)-d,k=Math.min(u,g.to)-d;w<k&&(c||(c=[])).push(g.copy(w,k))}}if(c){let m=new de(c.sort(Mn),Xn);return s?new Gt([m,s]):m}return s||De}eq(t){if(this==t)return!0;if(!(t instanceof de)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(t.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=t.children[r]||this.children[r+1]!=t.children[r+1]||!this.children[r+2].eq(t.children[r+2]))return!1;return!0}locals(t){return Zo(this.localsInner(t))}localsInner(t){if(this==De)return Xn;if(t.inlineContent||!this.local.some(Ut.is))return this.local;let r=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Ut||r.push(this.local[s]);return r}forEachSet(t){t(this)}}de.empty=new de([],[]),de.removeOverlap=Zo;const De=de.empty;class Gt{constructor(t){this.members=t}map(t,r){const s=this.members.map(c=>c.map(t,r,Cn));return Gt.from(s)}forChild(t,r){if(r.isLeaf)return de.empty;let s=[];for(let c=0;c<this.members.length;c++){let d=this.members[c].forChild(t,r);d!=De&&(d instanceof Gt?s=s.concat(d.members):s.push(d))}return Gt.from(s)}eq(t){if(!(t instanceof Gt)||t.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(t.members[r]))return!1;return!0}locals(t){let r,s=!0;for(let c=0;c<this.members.length;c++){let d=this.members[c].localsInner(t);if(d.length)if(r){s&&(r=r.slice(),s=!1);for(let u=0;u<d.length;u++)r.push(d[u])}else r=d}return r?Zo(s?r:r.sort(Mn)):Xn}static from(t){switch(t.length){case 0:return De;case 1:return t[0];default:return new Gt(t.every(r=>r instanceof de)?t:t.reduce((r,s)=>r.concat(s instanceof de?s:s.members),[]))}}forEachSet(t){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(t)}}function dc(a,t){if(!t||!a.length)return a;let r=[];for(let s=0;s<a.length;s++){let c=a[s];r.push(new Ye(c.from+t,c.to+t,c.type))}return r}function fc(a,t,r){if(t.isLeaf)return null;let s=r+t.nodeSize,c=null;for(let d,u=0;u<a.length;u++)(d=a[u])&&d.from>r&&d.to<s&&((c||(c=[])).push(d),a[u]=null);return c}function uc(a){let t=[];for(let r=0;r<a.length;r++)a[r]!=null&&t.push(a[r]);return t}function Si(a,t,r,s){let c=[],d=!1;t.forEach((m,g)=>{let w=fc(a,m,g+r);if(w){d=!0;let k=Si(w,m,r+g+1,s);k!=De&&c.push(g,g+m.nodeSize,k)}});let u=dc(d?uc(a):a,-r).sort(Mn);for(let m=0;m<u.length;m++)u[m].type.valid(t,u[m])||(s.onRemove&&s.onRemove(u[m].spec),u.splice(m--,1));return u.length||c.length?new de(u,c):De}function Mn(a,t){return a.from-t.from||a.to-t.to}function Zo(a){let t=a;for(let r=0;r<t.length-1;r++){let s=t[r];if(s.from!=s.to)for(let c=r+1;c<t.length;c++){let d=t[c];if(d.from!=s.from){d.from<s.to&&(t==a&&(t=a.slice()),t[r]=s.copy(s.from,d.from),pc(t,c,s.copy(d.from,s.to)));break}d.to!=s.to&&(t==a&&(t=a.slice()),t[c]=d.copy(d.from,s.to),pc(t,c+1,d.copy(s.to,d.to)))}}return t}function pc(a,t,r){for(;t<a.length&&Mn(r,a[t])>0;)t++;a.splice(t,0,r)}function Qo(a){let t=[];return a.someProp("decorations",r=>{let s=r(a.state);s&&s!=De&&t.push(s)}),a.cursorWrapper&&t.push(de.create(a.state.doc,[a.cursorWrapper.deco])),Gt.from(t)}const fp={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},up=Je&&Wt<=11;class pp{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class mp{constructor(t,r){this.view=t,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new pp,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let c=0;c<s.length;c++)this.queue.push(s[c]);Je&&Wt<=11&&s.some(c=>c.type=="childList"&&c.removedNodes.length||c.type=="characterData"&&c.oldValue.length>c.target.nodeValue.length)?this.flushSoon():this.flush()}),up&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,fp)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let r=0;r<t.length;r++)this.queue.push(t[r]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Ja(this.view)){if(this.suppressingSelectionUpdates)return Et(this.view);if(Je&&Wt<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&bn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let r,s=new Set;for(let d=t.focusNode;d;d=Cr(d))s.add(d);for(let d=t.anchorNode;d;d=Cr(d))if(s.has(d)){r=d;break}let c=r&&this.view.docView.nearestDesc(r);return c&&c.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let r=this.pendingRecords();r.length&&(this.queue=[]);let s=t.domSelectionRange(),c=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Ja(t)&&!this.ignoreSelectionChange(s),d=-1,u=-1,m=!1,g=[];if(t.editable)for(let k=0;k<r.length;k++){let x=this.registerMutation(r[k],g);x&&(d=d<0?x.from:Math.min(x.from,d),u=u<0?x.to:Math.max(x.to,u),x.typeOver&&(m=!0))}if(dt&&g.length){let k=g.filter(x=>x.nodeName=="BR");if(k.length==2){let[x,C]=k;x.parentNode&&x.parentNode.parentNode==C.parentNode?C.remove():x.remove()}else{let{focusNode:x}=this.currentSelection;for(let C of k){let v=C.parentNode;!v||v.nodeName!="LI"||x&&gp(t,x)==v||C.remove()}}}let w=null;d<0&&c&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&gi(s)&&(w=Fo(t))&&w.eq(X.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Et(t),this.currentSelection.set(s),t.scrollToSelection()):(d>-1||c)&&(d>-1&&(t.docView.markDirty(d,u),function(k){if(!mc.has(k)&&(mc.set(k,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(k.dom).whiteSpace)!==-1)){if(k.requiresGeckoHackNode=dt,gc)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),gc=!0}}(t)),this.handleDOMChange(d,u,m,g),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(s)||Et(t),this.currentSelection.set(s))}registerMutation(t,r){if(r.indexOf(t.target)>-1)return null;let s=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(s==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!s||s.ignoreMutation(t))return null;if(t.type=="childList"){for(let w=0;w<t.addedNodes.length;w++){let k=t.addedNodes[w];r.push(k),k.nodeType==3&&(this.lastChangedTextNode=k)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(t.target))return{from:s.posBefore,to:s.posAfter};let c=t.previousSibling,d=t.nextSibling;if(Je&&Wt<=11&&t.addedNodes.length)for(let w=0;w<t.addedNodes.length;w++){let{previousSibling:k,nextSibling:x}=t.addedNodes[w];(!k||Array.prototype.indexOf.call(t.addedNodes,k)<0)&&(c=k),(!x||Array.prototype.indexOf.call(t.addedNodes,x)<0)&&(d=x)}let u=c&&c.parentNode==t.target?ke(c)+1:0,m=s.localPosFromDOM(t.target,u,-1),g=d&&d.parentNode==t.target?ke(d):t.target.childNodes.length;return{from:m,to:s.localPosFromDOM(t.target,g,1)}}return t.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=t.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let mc=new WeakMap,gc=!1;function yc(a,t){let r=t.startContainer,s=t.startOffset,c=t.endContainer,d=t.endOffset,u=a.domAtPos(a.state.selection.anchor);return bn(u.node,u.offset,c,d)&&([r,s,c,d]=[c,d,r,s]),{anchorNode:r,anchorOffset:s,focusNode:c,focusOffset:d}}function gp(a,t){for(let r=t.parentNode;r&&r!=a.dom;r=r.parentNode){let s=a.docView.nearestDesc(r,!0);if(s&&s.node.isBlock)return r}return null}function yp(a){let t=a.pmViewDesc;if(t)return t.parseRule();if(a.nodeName=="BR"&&a.parentNode){if(ze&&/^(ul|ol)$/i.test(a.parentNode.nodeName)){let r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}if(a.parentNode.lastChild==a||ze&&/^(tr|table)$/i.test(a.parentNode.nodeName))return{ignore:!0}}else if(a.nodeName=="IMG"&&a.getAttribute("mark-placeholder"))return{ignore:!0};return null}const wp=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function bp(a,t,r,s,c){let d=a.input.compositionPendingChanges||(a.composing?a.input.compositionID:0);if(a.input.compositionPendingChanges=0,t<0){let $=a.input.lastSelectionTime>Date.now()-50?a.input.lastSelectionOrigin:null,K=Fo(a,$);if(K&&!a.state.selection.eq(K)){if(Ne&&ft&&a.input.lastKeyCode===13&&Date.now()-100<a.input.lastKeyCodeTime&&a.someProp("handleKeyDown",j=>j(a,kn(13,"Enter"))))return;let se=a.state.tr.setSelection(K);$=="pointer"?se.setMeta("pointer",!0):$=="key"&&se.scrollIntoView(),d&&se.setMeta("composition",d),a.dispatch(se)}return}let u=a.state.doc.resolve(t),m=u.sharedDepth(r);t=u.before(m+1),r=a.state.doc.resolve(r).after(m+1);let g,w,k=a.state.selection,x=function($,K,se){let j,{node:Ke,fromOffset:U,toOffset:le,from:ae,to:Ze}=$.docView.parseRange(K,se),_t=$.domSelectionRange(),oe=_t.anchorNode;if(oe&&$.dom.contains(oe.nodeType==1?oe:oe.parentNode)&&(j=[{node:oe,offset:_t.anchorOffset}],gi(_t)||j.push({node:_t.focusNode,offset:_t.focusOffset})),Ne&&$.input.lastKeyCode===8)for(let vn=le;vn>U;vn--){let Qn=Ke.childNodes[vn-1],vs=Qn.pmViewDesc;if(Qn.nodeName=="BR"&&!vs){le=vn;break}if(!vs||vs.size)break}let hm=$.state.doc,dm=$.someProp("domParser")||qn.fromSchema($.state.schema),$r=hm.resolve(ae),Bh=null,fm=dm.parse(Ke,{topNode:$r.parent,topMatch:$r.parent.contentMatchAt($r.index()),topOpen:!0,from:U,to:le,preserveWhitespace:$r.parent.type.whitespace!="pre"||"full",findPositions:j,ruleFromNode:yp,context:$r});if(j&&j[0].pos!=null){let vn=j[0].pos,Qn=j[1]&&j[1].pos;Qn==null&&(Qn=vn),Bh={anchor:vn+ae,head:Qn+ae}}return{doc:fm,sel:Bh,from:ae,to:Ze}}(a,t,r),C=a.state.doc,v=C.slice(x.from,x.to);a.input.lastKeyCode===8&&Date.now()-100<a.input.lastKeyCodeTime?(g=a.state.selection.to,w="end"):(g=a.state.selection.from,w="start"),a.input.lastKeyCode=null;let M=function($,K,se,j,Ke){let U=$.findDiffStart(K,se);if(U==null)return null;let{a:le,b:ae}=$.findDiffEnd(K,se+$.size,se+K.size);if(Ke=="end"&&(j-=le+Math.max(0,U-Math.min(le,ae))-U),le<U&&$.size<K.size){let Ze=j<=U&&j>=le?U-j:0;U-=Ze,U&&U<K.size&&bc(K.textBetween(U-1,U+1))&&(U+=Ze?1:-1),ae=U+(ae-le),le=U}else if(ae<U){let Ze=j<=U&&j>=ae?U-j:0;U-=Ze,U&&U<$.size&&bc($.textBetween(U-1,U+1))&&(U+=Ze?1:-1),le=U+(le-ae),ae=U}return{start:U,endA:le,endB:ae}}(v.content,x.doc.content,x.from,g,w);if(M&&a.input.domChangeCount++,(jn&&a.input.lastIOSEnter>Date.now()-225||ft)&&c.some($=>$.nodeType==1&&!wp.test($.nodeName))&&(!M||M.endA>=M.endB)&&a.someProp("handleKeyDown",$=>$(a,kn(13,"Enter"))))return void(a.input.lastIOSEnter=0);if(!M){if(!(s&&k instanceof Z&&!k.empty&&k.$head.sameParent(k.$anchor))||a.composing||x.sel&&x.sel.anchor!=x.sel.head){if(x.sel){let $=wc(a,a.state.doc,x.sel);if($&&!$.eq(a.state.selection)){let K=a.state.tr.setSelection($);d&&K.setMeta("composition",d),a.dispatch(K)}}return}M={start:k.from,endA:k.to,endB:k.to}}a.state.selection.from<a.state.selection.to&&M.start==M.endB&&a.state.selection instanceof Z&&(M.start>a.state.selection.from&&M.start<=a.state.selection.from+2&&a.state.selection.from>=x.from?M.start=a.state.selection.from:M.endA<a.state.selection.to&&M.endA>=a.state.selection.to-2&&a.state.selection.to<=x.to&&(M.endB+=a.state.selection.to-M.endA,M.endA=a.state.selection.to)),Je&&Wt<=11&&M.endB==M.start+1&&M.endA==M.start&&M.start>x.from&&x.doc.textBetween(M.start-x.from-1,M.start-x.from+1)=="  "&&(M.start--,M.endA--,M.endB--);let D,A=x.doc.resolveNoCache(M.start-x.from),I=x.doc.resolveNoCache(M.endB-x.from),R=C.resolve(M.start),V=A.sameParent(I)&&A.parent.inlineContent&&R.end()>=M.endA;if((jn&&a.input.lastIOSEnter>Date.now()-225&&(!V||c.some($=>$.nodeName=="DIV"||$.nodeName=="P"))||!V&&A.pos<x.doc.content.size&&!A.sameParent(I)&&(D=X.findFrom(x.doc.resolve(A.pos+1),1,!0))&&D.head==I.pos)&&a.someProp("handleKeyDown",$=>$(a,kn(13,"Enter"))))return void(a.input.lastIOSEnter=0);if(a.state.selection.anchor>M.start&&function($,K,se,j,Ke){if(se-K<=Ke.pos-j.pos||es(j,!0,!1)<Ke.pos)return!1;let U=$.resolve(K);if(!j.parent.isTextblock){let ae=U.nodeAfter;return ae!=null&&se==K+ae.nodeSize}if(U.parentOffset<U.parent.content.size||!U.parent.isTextblock)return!1;let le=$.resolve(es(U,!0,!0));return!(!le.parent.isTextblock||le.pos>se||es(le,!0,!1)<se)&&j.parent.content.cut(j.parentOffset).eq(le.parent.content)}(C,M.start,M.endA,A,I)&&a.someProp("handleKeyDown",$=>$(a,kn(8,"Backspace"))))return void(ft&&Ne&&a.domObserver.suppressSelectionUpdates());Ne&&ft&&M.endB==M.start&&(a.input.lastAndroidDelete=Date.now()),ft&&!V&&A.start()!=I.start()&&I.parentOffset==0&&A.depth==I.depth&&x.sel&&x.sel.anchor==x.sel.head&&x.sel.head==M.endA&&(M.endB-=2,I=x.doc.resolveNoCache(M.endB-x.from),setTimeout(()=>{a.someProp("handleKeyDown",function($){return $(a,kn(13,"Enter"))})},20));let q,Y,ie,ne=M.start,H=M.endA;if(V){if(A.pos==I.pos)Je&&Wt<=11&&A.parentOffset==0&&(a.domObserver.suppressSelectionUpdates(),setTimeout(()=>Et(a),20)),q=a.state.tr.delete(ne,H),Y=C.resolve(M.start).marksAcross(C.resolve(M.endA));else if(M.endA==M.endB&&(ie=function($,K){let se,j,Ke,U=$.firstChild.marks,le=K.firstChild.marks,ae=U,Ze=le;for(let oe=0;oe<le.length;oe++)ae=le[oe].removeFromSet(ae);for(let oe=0;oe<U.length;oe++)Ze=U[oe].removeFromSet(Ze);if(ae.length==1&&Ze.length==0)j=ae[0],se="add",Ke=oe=>oe.mark(j.addToSet(oe.marks));else{if(ae.length!=0||Ze.length!=1)return null;j=Ze[0],se="remove",Ke=oe=>oe.mark(j.removeFromSet(oe.marks))}let _t=[];for(let oe=0;oe<K.childCount;oe++)_t.push(Ke(K.child(oe)));if(i.from(_t).eq($))return{mark:j,type:se}}(A.parent.content.cut(A.parentOffset,I.parentOffset),R.parent.content.cut(R.parentOffset,M.endA-R.start()))))q=a.state.tr,ie.type=="add"?q.addMark(ne,H,ie.mark):q.removeMark(ne,H,ie.mark);else if(A.parent.child(A.index()).isText&&A.index()==I.index()-(I.textOffset?0:1)){let $=A.parent.textBetween(A.parentOffset,I.parentOffset);if(a.someProp("handleTextInput",K=>K(a,ne,H,$)))return;q=a.state.tr.insertText($,ne,H)}}if(q||(q=a.state.tr.replace(ne,H,x.doc.slice(M.start-x.from,M.endB-x.from))),x.sel){let $=wc(a,q.doc,x.sel);$&&!(Ne&&ft&&a.composing&&$.empty&&(M.start!=M.endB||a.input.lastAndroidDelete<Date.now()-100)&&($.head==ne||$.head==q.mapping.map(H)-1)||Je&&$.empty&&$.head==ne)&&q.setSelection($)}Y&&q.ensureMarks(Y),d&&q.setMeta("composition",d),a.dispatch(q.scrollIntoView())}function wc(a,t,r){return Math.max(r.anchor,r.head)>t.content.size?null:qo(a,t.resolve(r.anchor),t.resolve(r.head))}function es(a,t,r){let s=a.depth,c=t?a.end():a.pos;for(;s>0&&(t||a.indexAfter(s)==a.node(s).childCount);)s--,c++,t=!1;if(r){let d=a.node(s).maybeChild(a.indexAfter(s));for(;d&&!d.isLeaf;)d=d.firstChild,c++}return c}function bc(a){if(a.length!=2)return!1;let t=a.charCodeAt(0),r=a.charCodeAt(1);return t>=56320&&t<=57343&&r>=55296&&r<=56319}const kp=Jo,xp=Ho,Sp=Er;function kc(a){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(a.editable),a.someProp("attributes",r=>{if(typeof r=="function"&&(r=r(a.state)),r)for(let s in r)s=="class"?t.class+=" "+r[s]:s=="style"?t.style=(t.style?t.style+";":"")+r[s]:t[s]||s=="contenteditable"||s=="nodeName"||(t[s]=String(r[s]))}),t.translate||(t.translate="no"),[Ye.node(0,a.state.doc.content.size,t)]}function xc(a){if(a.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),a.cursorWrapper={dom:t,deco:Ye.widget(a.state.selection.from,t,{raw:!0,marks:a.markCursor})}}else a.cursorWrapper=null}function Sc(a){return!a.someProp("editable",t=>t(a.state)===!1)}function Cc(a){let t=Object.create(null);function r(s){for(let c in s)Object.prototype.hasOwnProperty.call(t,c)||(t[c]=s[c])}return a.someProp("nodeViews",r),a.someProp("markViews",r),t}function Mc(a){if(a.spec.state||a.spec.filterTransaction||a.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var Cp=Object.freeze({__proto__:null,Decoration:Ye,DecorationSet:de,EditorView:class{constructor(a,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new ip,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Mc),this.dispatch=this.dispatch.bind(this),this.dom=a&&a.mount||document.createElement("div"),a&&(a.appendChild?a.appendChild(this.dom):typeof a=="function"?a(this.dom):a.mount&&(this.mounted=!0)),this.editable=Sc(this),xc(this),this.nodeViews=Cc(this),this.docView=Aa(this.state.doc,kc(this),Qo(this),this.dom,this),this.domObserver=new mp(this,(r,s,c,d)=>bp(this,r,s,c,d)),this.domObserver.start(),function(r){for(let s in Pe){let c=Pe[s];r.dom.addEventListener(s,r.input.eventHandlers[s]=d=>{!op(r,d)||Go(r,d)||!r.editable&&d.type in Be||c(r,d)},rp[s]?{passive:!0}:void 0)}ze&&r.dom.addEventListener("input",()=>null),Uo(r)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let a=this._props;this._props={};for(let t in a)this._props[t]=a[t];this._props.state=this.state}return this._props}update(a){a.handleDOMEvents!=this._props.handleDOMEvents&&Uo(this);let t=this._props;this._props=a,a.plugins&&(a.plugins.forEach(Mc),this.directPlugins=a.plugins),this.updateStateInner(a.state,t)}setProps(a){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in a)t[r]=a[r];this.update(t)}updateState(a){this.updateStateInner(a,this._props)}updateStateInner(a,t){var r;let s=this.state,c=!1,d=!1;a.storedMarks&&this.composing&&(lc(this),d=!0),this.state=a;let u=s.plugins!=a.plugins||this._props.plugins!=t.plugins;if(u||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let C=Cc(this);(function(v,M){let D=0,A=0;for(let I in v){if(v[I]!=M[I])return!0;D++}for(let I in M)A++;return D!=A})(C,this.nodeViews)&&(this.nodeViews=C,c=!0)}(u||t.handleDOMEvents!=this._props.handleDOMEvents)&&Uo(this),this.editable=Sc(this),xc(this);let m=Qo(this),g=kc(this),w=s.plugins==a.plugins||s.doc.eq(a.doc)?a.scrollToSelection>s.scrollToSelection?"to selection":"preserve":"reset",k=c||!this.docView.matchesNode(a.doc,g,m);!k&&a.selection.eq(s.selection)||(d=!0);let x=w=="preserve"&&d&&this.dom.style.overflowAnchor==null&&function(C){let v,M,D=C.dom.getBoundingClientRect(),A=Math.max(0,D.top);for(let I=(D.left+D.right)/2,R=A+1;R<Math.min(innerHeight,D.bottom);R+=5){let V=C.root.elementFromPoint(I,R);if(!V||V==C.dom||!C.dom.contains(V))continue;let q=V.getBoundingClientRect();if(q.top>=A-20){v=V,M=q.top;break}}return{refDOM:v,refTop:M,stack:ka(C.dom)}}(this);if(d){this.domObserver.stop();let C=k&&(Je||Ne)&&!this.composing&&!s.selection.empty&&!a.selection.empty&&function(v,M){let D=Math.min(v.$anchor.sharedDepth(v.head),M.$anchor.sharedDepth(M.head));return v.$anchor.start(D)!=M.$anchor.start(D)}(s.selection,a.selection);if(k){let v=Ne?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=dp(this)),!c&&this.docView.update(a.doc,g,m,this)||(this.docView.updateOuterDeco(g),this.docView.destroy(),this.docView=Aa(a.doc,g,m,this.dom,this)),v&&!this.trackWrites&&(C=!0)}C||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(v){let M=v.docView.domFromPos(v.state.selection.anchor,0),D=v.domSelectionRange();return bn(M.node,M.offset,D.anchorNode,D.anchorOffset)}(this))?Et(this,C):($a(this,a.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(a.doc)&&this.updateDraggedNode(this.dragging,s),w=="reset"?this.dom.scrollTop=0:w=="to selection"?this.scrollToSelection():x&&function({refDOM:C,refTop:v,stack:M}){let D=C?C.getBoundingClientRect().top:0;xa(M,D==0?0:D-v)}(x)}scrollToSelection(){let a=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof W){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&ba(this,t.getBoundingClientRect(),a)}else ba(this,this.coordsAtPos(this.state.selection.head,1),a)}destroyPluginViews(){let a;for(;a=this.pluginViews.pop();)a.destroy&&a.destroy()}updatePluginViews(a){if(a&&a.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,a)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}}updateDraggedNode(a,t){let r=a.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let c=r.from+(this.state.doc.content.size-t.doc.content.size);(c>0&&this.state.doc.nodeAt(c))==r.node&&(s=c)}this.dragging=new cc(a.slice,a.move,s<0?void 0:W.create(this.state.doc,s))}someProp(a,t){let r,s=this._props&&this._props[a];if(s!=null&&(r=t?t(s):s))return r;for(let d=0;d<this.directPlugins.length;d++){let u=this.directPlugins[d].props[a];if(u!=null&&(r=t?t(u):u))return r}let c=this.state.plugins;if(c)for(let d=0;d<c.length;d++){let u=c[d].props[a];if(u!=null&&(r=t?t(u):u))return r}}hasFocus(){if(Je){let a=this.root.activeElement;if(a==this.dom)return!0;if(!a||!this.dom.contains(a))return!1;for(;a&&this.dom!=a&&this.dom.contains(a);){if(a.contentEditable=="false")return!1;a=a.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(a){if(a.setActive)return a.setActive();if(Un)return a.focus(Un);let t=ka(a);a.focus(Un==null?{get preventScroll(){return Un={preventScroll:!0},!0}}:void 0),Un||(Un=!1,xa(t,0))}(this.dom),Et(this),this.domObserver.start()}get root(){let a=this._root;if(a==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return a||document}updateRoot(){this._root=null}posAtCoords(a){return ju(this,a)}coordsAtPos(a,t=1){return va(this,a,t)}domAtPos(a,t=0){return this.docView.domFromPos(a,t)}nodeDOM(a){let t=this.docView.descAt(a);return t?t.nodeDOM:null}posAtDOM(a,t,r=-1){let s=this.docView.posFromDOM(a,t,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(a,t){return Yu(this,t||this.state,a)}pasteHTML(a,t){return Ir(this,"",a,!1,t||new ClipboardEvent("paste"))}pasteText(a,t){return Ir(this,a,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(function(a){a.domObserver.stop();for(let t in a.input.eventHandlers)a.dom.removeEventListener(t,a.input.eventHandlers[t]);clearTimeout(a.input.composingTimeout),clearTimeout(a.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Qo(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Eo=null)}get isDestroyed(){return this.docView==null}dispatchEvent(a){return function(t,r){Go(t,r)||!Pe[r.type]||!t.editable&&r.type in Be||Pe[r.type](t,r)}(this,a)}dispatch(a){let t=this._props.dispatchTransaction;t?t.call(this,a):this.updateState(this.state.apply(a))}domSelectionRange(){let a=this.domSelection();return a?ze&&this.root.nodeType===11&&function(t){let r=t.activeElement;for(;r&&r.shadowRoot;)r=r.shadowRoot.activeElement;return r}(this.dom.ownerDocument)==this.dom&&function(t,r){if(r.getComposedRanges){let d=r.getComposedRanges(t.root)[0];if(d)return yc(t,d)}let s;function c(d){d.preventDefault(),d.stopImmediatePropagation(),s=d.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",c,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",c,!0),s?yc(t,s):null}(this,a)||a:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}},__endComposition:Sp,__parseFromClipboard:xp,__serializeForClipboard:kp}),Yt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ci={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Mp=typeof navigator<"u"&&/Mac/.test(navigator.platform),vp=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),xe=0;xe<10;xe++)Yt[48+xe]=Yt[96+xe]=String(xe);for(xe=1;xe<=24;xe++)Yt[xe+111]="F"+xe;for(xe=65;xe<=90;xe++)Yt[xe]=String.fromCharCode(xe+32),Ci[xe]=String.fromCharCode(xe);for(var ts in Yt)Ci.hasOwnProperty(ts)||(Ci[ts]=Yt[ts]);const Op=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function Np(a){let t,r,s,c,d=a.split(/-(?!$)/),u=d[d.length-1];u=="Space"&&(u=" ");for(let m=0;m<d.length-1;m++){let g=d[m];if(/^(cmd|meta|m)$/i.test(g))c=!0;else if(/^a(lt)?$/i.test(g))t=!0;else if(/^(c|ctrl|control)$/i.test(g))r=!0;else if(/^s(hift)?$/i.test(g))s=!0;else{if(!/^mod$/i.test(g))throw new Error("Unrecognized modifier name: "+g);Op?c=!0:r=!0}}return t&&(u="Alt-"+u),r&&(u="Ctrl-"+u),c&&(u="Meta-"+u),s&&(u="Shift-"+u),u}function ns(a,t,r=!0){return t.altKey&&(a="Alt-"+a),t.ctrlKey&&(a="Ctrl-"+a),t.metaKey&&(a="Meta-"+a),r&&t.shiftKey&&(a="Shift-"+a),a}function rs(a){return new qt({props:{handleKeyDown:is(a)}})}function is(a){let t=function(r){let s=Object.create(null);for(let c in r)s[Np(c)]=r[c];return s}(a);return function(r,s){let c,d=function(m){var g=!(Mp&&m.metaKey&&m.shiftKey&&!m.ctrlKey&&!m.altKey||vp&&m.shiftKey&&m.key&&m.key.length==1||m.key=="Unidentified")&&m.key||(m.shiftKey?Ci:Yt)[m.keyCode]||m.key||"Unidentified";return g=="Esc"&&(g="Escape"),g=="Del"&&(g="Delete"),g=="Left"&&(g="ArrowLeft"),g=="Up"&&(g="ArrowUp"),g=="Right"&&(g="ArrowRight"),g=="Down"&&(g="ArrowDown"),g}(s),u=t[ns(d,s)];if(u&&u(r.state,r.dispatch,r))return!0;if(d.length==1&&d!=" "){if(s.shiftKey){let m=t[ns(d,s,!1)];if(m&&m(r.state,r.dispatch,r))return!0}if((s.shiftKey||s.altKey||s.metaKey||d.charCodeAt(0)>127)&&(c=Yt[s.keyCode])&&c!=d){let m=t[ns(c,s)];if(m&&m(r.state,r.dispatch,r))return!0}}return!1}}var Dp=Object.freeze({__proto__:null,keydownHandler:is,keymap:rs});class At{constructor(t,r,s={}){var c;this.match=t,this.match=t,this.handler=typeof r=="string"?(c=r,function(d,u,m,g){let w=c;if(u[1]){let k=u[0].lastIndexOf(u[1]);w+=u[0].slice(k+u[1].length);let x=(m+=k)-g;x>0&&(w=u[0].slice(k-x,k)+w,m=g)}return d.tr.insertText(w,m,g)}):r,this.undoable=s.undoable!==!1,this.inCode=s.inCode||!1}}function vc({rules:a}){let t=new qt({state:{init:()=>null,apply(r,s){return r.getMeta(this)||(r.selectionSet||r.docChanged?null:s)}},props:{handleTextInput:(r,s,c,d)=>Oc(r,s,c,d,a,t),handleDOMEvents:{compositionend:r=>{setTimeout(()=>{let{$cursor:s}=r.state.selection;s&&Oc(r,s.pos,s.pos,"",a,t)})}}},isInputRules:!0});return t}function Oc(a,t,r,s,c,d){if(a.composing)return!1;let u=a.state,m=u.doc.resolve(t),g=m.parent.textBetween(Math.max(0,m.parentOffset-500),m.parentOffset,null,"￼")+s;for(let w=0;w<c.length;w++){let k=c[w];if(m.parent.type.spec.code){if(!k.inCode)continue}else if(k.inCode==="only")continue;let x=k.match.exec(g),C=x&&k.handler(u,x,t-(x[0].length-s.length),r);if(C)return k.undoable&&C.setMeta(d,{transform:C,from:t,to:r,text:s}),a.dispatch(C),!0}return!1}const Nc=(a,t)=>{let r=a.plugins;for(let s=0;s<r.length;s++){let c,d=r[s];if(d.spec.isInputRules&&(c=d.getState(a))){if(t){let u=a.tr,m=c.transform;for(let g=m.steps.length-1;g>=0;g--)u.step(m.steps[g].invert(m.docs[g]));if(c.text){let g=u.doc.resolve(c.from).marks();u.replaceWith(c.from,c.to,a.schema.text(c.text,g))}else u.delete(c.from,c.to);t(u)}return!0}}return!1},Dc=new At(/--$/,"—"),Tc=new At(/\.\.\.$/,"…"),Ec=new At(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“"),Ac=new At(/"$/,"”"),Ic=new At(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘"),Rc=new At(/'$/,"’"),zc=[Ec,Ac,Ic,Rc];function Mi(a,t,r=null,s){return new At(a,(c,d,u,m)=>{let g=r instanceof Function?r(d):r,w=c.tr.delete(u,m),k=w.doc.resolve(u).blockRange(),x=k&&ui(k,t,g);if(!x)return null;w.wrap(k,x);let C=w.doc.resolve(u-1).nodeBefore;return C&&C.type==t&&Lt(w.doc,u-1)&&(!s||s(d,C))&&w.join(u-1),w})}function ss(a,t,r=null){return new At(a,(s,c,d,u)=>{let m=s.doc.resolve(d),g=r instanceof Function?r(c):r;return m.node(-1).canReplaceWith(m.index(-1),m.indexAfter(-1),t)?s.tr.delete(d,u).setBlockType(d,d,t,g):null})}var Tp=Object.freeze({__proto__:null,InputRule:At,closeDoubleQuote:Ac,closeSingleQuote:Rc,ellipsis:Tc,emDash:Dc,inputRules:vc,openDoubleQuote:Ec,openSingleQuote:Ic,smartQuotes:zc,textblockTypeInputRule:ss,undoInputRule:Nc,wrappingInputRule:Mi}),vi=200,ge=function(){};ge.prototype.append=function(a){return a.length?(a=ge.from(a),!this.length&&a||a.length<vi&&this.leafAppend(a)||this.length<vi&&a.leafPrepend(this)||this.appendInner(a)):this},ge.prototype.prepend=function(a){return a.length?ge.from(a).append(this):this},ge.prototype.appendInner=function(a){return new Ep(this,a)},ge.prototype.slice=function(a,t){return a===void 0&&(a=0),t===void 0&&(t=this.length),a>=t?ge.empty:this.sliceInner(Math.max(0,a),Math.min(this.length,t))},ge.prototype.get=function(a){if(!(a<0||a>=this.length))return this.getInner(a)},ge.prototype.forEach=function(a,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(a,t,r,0):this.forEachInvertedInner(a,t,r,0)},ge.prototype.map=function(a,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(c,d){return s.push(a(c,d))},t,r),s},ge.from=function(a){return a instanceof ge?a:a&&a.length?new Pc(a):ge.empty};var Pc=function(a){function t(s){a.call(this),this.values=s}a&&(t.__proto__=a),t.prototype=Object.create(a&&a.prototype),t.prototype.constructor=t;var r={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(s,c){return s==0&&c==this.length?this:new t(this.values.slice(s,c))},t.prototype.getInner=function(s){return this.values[s]},t.prototype.forEachInner=function(s,c,d,u){for(var m=c;m<d;m++)if(s(this.values[m],u+m)===!1)return!1},t.prototype.forEachInvertedInner=function(s,c,d,u){for(var m=c-1;m>=d;m--)if(s(this.values[m],u+m)===!1)return!1},t.prototype.leafAppend=function(s){if(this.length+s.length<=vi)return new t(this.values.concat(s.flatten()))},t.prototype.leafPrepend=function(s){if(this.length+s.length<=vi)return new t(s.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(t.prototype,r),t}(ge);ge.empty=new Pc([]);var Ep=function(a){function t(r,s){a.call(this),this.left=r,this.right=s,this.length=r.length+s.length,this.depth=Math.max(r.depth,s.depth)+1}return a&&(t.__proto__=a),t.prototype=Object.create(a&&a.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,s,c,d){var u=this.left.length;return!(s<u&&this.left.forEachInner(r,s,Math.min(c,u),d)===!1)&&!(c>u&&this.right.forEachInner(r,Math.max(s-u,0),Math.min(this.length,c)-u,d+u)===!1)&&void 0},t.prototype.forEachInvertedInner=function(r,s,c,d){var u=this.left.length;return!(s>u&&this.right.forEachInvertedInner(r,s-u,Math.max(c,u)-u,d+u)===!1)&&!(c<u&&this.left.forEachInvertedInner(r,Math.min(s,u),c,d)===!1)&&void 0},t.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var c=this.left.length;return s<=c?this.left.slice(r,s):r>=c?this.right.slice(r-c,s-c):this.left.slice(r,c).append(this.right.slice(0,s-c))},t.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new t(this.left,s)},t.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new t(s,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(ge);class ut{constructor(t,r){this.items=t,this.eventCount=r}popEvent(t,r){if(this.eventCount==0)return null;let s,c,d=this.items.length;for(;;d--)if(this.items.get(d-1).selection){--d;break}r&&(s=this.remapping(d,this.items.length),c=s.maps.length);let u,m,g=t.tr,w=[],k=[];return this.items.forEach((x,C)=>{if(!x.step)return s||(s=this.remapping(d,C+1),c=s.maps.length),c--,void k.push(x);if(s){k.push(new kt(x.map));let v,M=x.step.map(s.slice(c));M&&g.maybeStep(M).doc&&(v=g.mapping.maps[g.mapping.maps.length-1],w.push(new kt(v,void 0,void 0,w.length+k.length))),c--,v&&s.appendMap(v,c)}else g.maybeStep(x.step);return x.selection?(u=s?x.selection.map(s.slice(c)):x.selection,m=new ut(this.items.slice(0,d).append(k.reverse().concat(w)),this.eventCount-1),!1):void 0},this.items.length,0),{remaining:m,transform:g,selection:u}}addTransform(t,r,s,c){let d=[],u=this.eventCount,m=this.items,g=!c&&m.length?m.get(m.length-1):null;for(let k=0;k<t.steps.length;k++){let x,C=t.steps[k].invert(t.docs[k]),v=new kt(t.mapping.maps[k],C,r);(x=g&&g.merge(v))&&(v=x,k?d.pop():m=m.slice(0,m.length-1)),d.push(v),r&&(u++,r=void 0),c||(g=v)}let w=u-s.depth;return w>Ap&&(m=function(k,x){let C;return k.forEach((v,M)=>{if(v.selection&&x--==0)return C=M,!1}),k.slice(C)}(m,w),u-=w),new ut(m.append(d),u)}remapping(t,r){let s=new mn;return this.items.forEach((c,d)=>{let u=c.mirrorOffset!=null&&d-c.mirrorOffset>=t?s.maps.length-c.mirrorOffset:void 0;s.appendMap(c.map,u)},t,r),s}addMaps(t){return this.eventCount==0?this:new ut(this.items.append(t.map(r=>new kt(r))),this.eventCount)}rebased(t,r){if(!this.eventCount)return this;let s=[],c=Math.max(0,this.items.length-r),d=t.mapping,u=t.steps.length,m=this.eventCount;this.items.forEach(C=>{C.selection&&m--},c);let g=r;this.items.forEach(C=>{let v=d.getMirror(--g);if(v==null)return;u=Math.min(u,v);let M=d.maps[v];if(C.step){let D=t.steps[v].invert(t.docs[v]),A=C.selection&&C.selection.map(d.slice(g+1,v));A&&m++,s.push(new kt(M,D,A))}else s.push(new kt(M))},c);let w=[];for(let C=r;C<u;C++)w.push(new kt(d.maps[C]));let k=this.items.slice(0,c).append(w).append(s),x=new ut(k,m);return x.emptyItemCount()>500&&(x=x.compress(this.items.length-s.length)),x}emptyItemCount(){let t=0;return this.items.forEach(r=>{r.step||t++}),t}compress(t=this.items.length){let r=this.remapping(0,t),s=r.maps.length,c=[],d=0;return this.items.forEach((u,m)=>{if(m>=t)c.push(u),u.selection&&d++;else if(u.step){let g=u.step.map(r.slice(s)),w=g&&g.getMap();if(s--,w&&r.appendMap(w,s),g){let k=u.selection&&u.selection.map(r.slice(s));k&&d++;let x,C=new kt(w.invert(),g,k),v=c.length-1;(x=c.length&&c[v].merge(C))?c[v]=x:c.push(C)}}else u.map&&s--},this.items.length,0),new ut(ge.from(c.reverse()),d)}}ut.empty=new ut(ge.empty,0);class kt{constructor(t,r,s,c){this.map=t,this.step=r,this.selection=s,this.mirrorOffset=c}merge(t){if(this.step&&t.step&&!t.selection){let r=t.step.merge(this.step);if(r)return new kt(r.getMap().invert(),r,this.selection)}}}class Xt{constructor(t,r,s,c,d){this.done=t,this.undone=r,this.prevRanges=s,this.prevTime=c,this.prevComposition=d}}const Ap=20;function Bc(a){let t=[];for(let r=a.length-1;r>=0&&t.length==0;r--)a[r].forEach((s,c,d,u)=>t.push(d,u));return t}function ls(a,t){if(!a)return null;let r=[];for(let s=0;s<a.length;s+=2){let c=t.map(a[s],1),d=t.map(a[s+1],-1);c<=d&&r.push(c,d)}return r}let as=!1,Vc=null;function Oi(a){let t=a.plugins;if(Vc!=t){as=!1,Vc=t;for(let r=0;r<t.length;r++)if(t[r].spec.historyPreserveItems){as=!0;break}}return as}const It=new To("history"),Fc=new To("closeHistory");function Lc(a={}){return a={depth:a.depth||100,newGroupDelay:a.newGroupDelay||500},new qt({key:It,state:{init:()=>new Xt(ut.empty,ut.empty,null,0,-1),apply:(t,r,s)=>function(c,d,u,m){let g,w=u.getMeta(It);if(w)return w.historyState;u.getMeta(Fc)&&(c=new Xt(c.done,c.undone,null,0,-1));let k=u.getMeta("appendedTransaction");if(u.steps.length==0)return c;if(k&&k.getMeta(It))return k.getMeta(It).redo?new Xt(c.done.addTransform(u,void 0,m,Oi(d)),c.undone,Bc(u.mapping.maps),c.prevTime,c.prevComposition):new Xt(c.done,c.undone.addTransform(u,void 0,m,Oi(d)),null,c.prevTime,c.prevComposition);if(u.getMeta("addToHistory")===!1||k&&k.getMeta("addToHistory")===!1)return(g=u.getMeta("rebased"))?new Xt(c.done.rebased(u,g),c.undone.rebased(u,g),ls(c.prevRanges,u.mapping),c.prevTime,c.prevComposition):new Xt(c.done.addMaps(u.mapping.maps),c.undone.addMaps(u.mapping.maps),ls(c.prevRanges,u.mapping),c.prevTime,c.prevComposition);{let x=u.getMeta("composition"),C=c.prevTime==0||!k&&c.prevComposition!=x&&(c.prevTime<(u.time||0)-m.newGroupDelay||!function(M,D){if(!D)return!1;if(!M.docChanged)return!0;let A=!1;return M.mapping.maps[0].forEach((I,R)=>{for(let V=0;V<D.length;V+=2)I<=D[V+1]&&R>=D[V]&&(A=!0)}),A}(u,c.prevRanges)),v=k?ls(c.prevRanges,u.mapping):Bc(u.mapping.maps);return new Xt(c.done.addTransform(u,C?d.selection.getBookmark():void 0,m,Oi(d)),ut.empty,v,u.time,x??c.prevComposition)}}(r,s,t,a)},config:a,props:{handleDOMEvents:{beforeinput(t,r){let s=r.inputType,c=s=="historyUndo"?zr:s=="historyRedo"?_n:null;return!!c&&(r.preventDefault(),c(t.state,t.dispatch))}}}})}function Ni(a,t){return(r,s)=>{let c=It.getState(r);if(!c||(a?c.undone:c.done).eventCount==0)return!1;if(s){let d=function(u,m,g){let w=Oi(m),k=It.get(m).spec.config,x=(g?u.undone:u.done).popEvent(m,w);if(!x)return null;let C=x.selection.resolve(x.transform.doc),v=(g?u.done:u.undone).addTransform(x.transform,m.selection.getBookmark(),k,w),M=new Xt(g?v:x.remaining,g?x.remaining:v,null,0,-1);return x.transform.setSelection(C).setMeta(It,{redo:g,historyState:M})}(c,r,a);d&&s(t?d.scrollIntoView():d)}return!0}}const zr=Ni(!1,!0),_n=Ni(!0,!0),Ip=Ni(!1,!1),Rp=Ni(!0,!1);var zp=Object.freeze({__proto__:null,closeHistory:function(a){return a.setMeta(Fc,!0)},history:Lc,redo:_n,redoDepth:function(a){let t=It.getState(a);return t?t.undone.eventCount:0},redoNoScroll:Rp,undo:zr,undoDepth:function(a){let t=It.getState(a);return t?t.done.eventCount:0},undoNoScroll:Ip});const cs=(a,t)=>!a.selection.empty&&(t&&t(a.tr.deleteSelection().scrollIntoView()),!0);function qc(a,t){let{$cursor:r}=a.selection;return!r||(t?!t.endOfTextblock("backward",a):r.parentOffset>0)?null:r}const $c=(a,t,r)=>{let s=qc(a,r);if(!s)return!1;let c=hs(s);if(!c){let u=s.blockRange(),m=u&&$n(u);return m!=null&&(t&&t(a.tr.lift(u,m).scrollIntoView()),!0)}let d=c.nodeBefore;if(Qc(a,c,t,-1))return!0;if(s.parent.content.size==0&&(Zn(d,"end")||W.isSelectable(d)))for(let u=s.depth;;u--){let m=br(a.doc,s.before(u),s.after(u),b.empty);if(m&&m.slice.size<m.to-m.from){if(t){let g=a.tr.step(m);g.setSelection(Zn(d,"end")?X.findFrom(g.doc.resolve(g.mapping.map(c.pos,-1)),-1):W.create(g.doc,c.pos-d.nodeSize)),t(g.scrollIntoView())}return!0}if(u==1||s.node(u-1).childCount>1)break}return!(!d.isAtom||c.depth!=s.depth-1)&&(t&&t(a.tr.delete(c.pos-d.nodeSize,c.pos).scrollIntoView()),!0)};function Wc(a,t,r){let s=t.nodeBefore,c=t.pos-1;for(;!s.isTextblock;c--){if(s.type.spec.isolating)return!1;let g=s.lastChild;if(!g)return!1;s=g}let d=t.nodeAfter,u=t.pos+1;for(;!d.isTextblock;u++){if(d.type.spec.isolating)return!1;let g=d.firstChild;if(!g)return!1;d=g}let m=br(a.doc,c,u,b.empty);if(!m||m.from!=c||m instanceof pe&&m.slice.size>=u-c)return!1;if(r){let g=a.tr.step(m);g.setSelection(Z.create(g.doc,c)),r(g.scrollIntoView())}return!0}function Zn(a,t,r=!1){for(let s=a;s;s=t=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(r&&s.childCount!=1)return!1}return!1}const Jc=(a,t,r)=>{let{$head:s,empty:c}=a.selection,d=s;if(!c)return!1;if(s.parent.isTextblock){if(r?!r.endOfTextblock("backward",a):s.parentOffset>0)return!1;d=hs(s)}let u=d&&d.nodeBefore;return!(!u||!W.isSelectable(u))&&(t&&t(a.tr.setSelection(W.create(a.doc,d.pos-u.nodeSize)).scrollIntoView()),!0)};function hs(a){if(!a.parent.type.spec.isolating)for(let t=a.depth-1;t>=0;t--){if(a.index(t)>0)return a.doc.resolve(a.before(t+1));if(a.node(t).type.spec.isolating)break}return null}function Hc(a,t){let{$cursor:r}=a.selection;return!r||(t?!t.endOfTextblock("forward",a):r.parentOffset<r.parent.content.size)?null:r}const Kc=(a,t,r)=>{let s=Hc(a,r);if(!s)return!1;let c=ds(s);if(!c)return!1;let d=c.nodeAfter;if(Qc(a,c,t,1))return!0;if(s.parent.content.size==0&&(Zn(d,"start")||W.isSelectable(d))){let u=br(a.doc,s.before(),s.after(),b.empty);if(u&&u.slice.size<u.to-u.from){if(t){let m=a.tr.step(u);m.setSelection(Zn(d,"start")?X.findFrom(m.doc.resolve(m.mapping.map(c.pos)),1):W.create(m.doc,m.mapping.map(c.pos))),t(m.scrollIntoView())}return!0}}return!(!d.isAtom||c.depth!=s.depth-1)&&(t&&t(a.tr.delete(c.pos,c.pos+d.nodeSize).scrollIntoView()),!0)},jc=(a,t,r)=>{let{$head:s,empty:c}=a.selection,d=s;if(!c)return!1;if(s.parent.isTextblock){if(r?!r.endOfTextblock("forward",a):s.parentOffset<s.parent.content.size)return!1;d=ds(s)}let u=d&&d.nodeAfter;return!(!u||!W.isSelectable(u))&&(t&&t(a.tr.setSelection(W.create(a.doc,d.pos)).scrollIntoView()),!0)};function ds(a){if(!a.parent.type.spec.isolating)for(let t=a.depth-1;t>=0;t--){let r=a.node(t);if(a.index(t)+1<r.childCount)return a.doc.resolve(a.after(t+1));if(r.type.spec.isolating)break}return null}const Di=(a,t)=>{let r,s=a.selection,c=s instanceof W;if(c){if(s.node.isTextblock||!Lt(a.doc,s.from))return!1;r=s.from}else if(r=xo(a.doc,s.from,-1),r==null)return!1;if(t){let d=a.tr.join(r);c&&d.setSelection(W.create(d.doc,r-a.doc.resolve(r).nodeBefore.nodeSize)),t(d.scrollIntoView())}return!0},Uc=(a,t)=>{let r,s=a.selection;if(s instanceof W){if(s.node.isTextblock||!Lt(a.doc,s.to))return!1;r=s.to}else if(r=xo(a.doc,s.to,1),r==null)return!1;return t&&t(a.tr.join(r).scrollIntoView()),!0},Ti=(a,t)=>{let{$from:r,$to:s}=a.selection,c=r.blockRange(s),d=c&&$n(c);return d!=null&&(t&&t(a.tr.lift(c,d).scrollIntoView()),!0)},Gc=(a,t)=>{let{$head:r,$anchor:s}=a.selection;return!(!r.parent.type.spec.code||!r.sameParent(s))&&(t&&t(a.tr.insertText(`
`).scrollIntoView()),!0)};function fs(a){for(let t=0;t<a.edgeCount;t++){let{type:r}=a.edge(t);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const us=(a,t)=>{let{$head:r,$anchor:s}=a.selection;if(!r.parent.type.spec.code||!r.sameParent(s))return!1;let c=r.node(-1),d=r.indexAfter(-1),u=fs(c.contentMatchAt(d));if(!u||!c.canReplaceWith(d,d,u))return!1;if(t){let m=r.after(),g=a.tr.replaceWith(m,m,u.createAndFill());g.setSelection(X.near(g.doc.resolve(m),1)),t(g.scrollIntoView())}return!0},Yc=(a,t)=>{let r=a.selection,{$from:s,$to:c}=r;if(r instanceof We||s.parent.inlineContent||c.parent.inlineContent)return!1;let d=fs(c.parent.contentMatchAt(c.indexAfter()));if(!d||!d.isTextblock)return!1;if(t){let u=(!s.parentOffset&&c.index()<c.parent.childCount?s:c).pos,m=a.tr.insert(u,d.createAndFill());m.setSelection(Z.create(m.doc,u+1)),t(m.scrollIntoView())}return!0},Xc=(a,t)=>{let{$cursor:r}=a.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let d=r.before();if(yn(a.doc,d))return t&&t(a.tr.split(d).scrollIntoView()),!0}let s=r.blockRange(),c=s&&$n(s);return c!=null&&(t&&t(a.tr.lift(s,c).scrollIntoView()),!0)};function _c(a){return(t,r)=>{let{$from:s,$to:c}=t.selection;if(t.selection instanceof W&&t.selection.node.isBlock)return!(!s.parentOffset||!yn(t.doc,s.pos))&&(r&&r(t.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let d,u,m=[],g=!1,w=!1;for(let v=s.depth;;v--){if(s.node(v).isBlock){g=s.end(v)==s.pos+(s.depth-v),w=s.start(v)==s.pos-(s.depth-v),u=fs(s.node(v-1).contentMatchAt(s.indexAfter(v-1)));let M=a&&a(c.parent,g,s);m.unshift(M||(g&&u?{type:u}:null)),d=v;break}if(v==1)return!1;m.unshift(null)}let k=t.tr;(t.selection instanceof Z||t.selection instanceof We)&&k.deleteSelection();let x=k.mapping.map(s.pos),C=yn(k.doc,x,m.length,m);if(C||(m[0]=u?{type:u}:null,C=yn(k.doc,x,m.length,m)),k.split(x,m.length,m),!g&&w&&s.node(d).type!=u){let v=k.mapping.map(s.before(d)),M=k.doc.resolve(v);u&&s.node(d-1).canReplaceWith(M.index(),M.index()+1,u)&&k.setNodeMarkup(k.mapping.map(s.before(d)),u)}return r&&r(k.scrollIntoView()),!0}}const ps=_c(),Ei=(a,t)=>{let r,{$from:s,to:c}=a.selection,d=s.sharedDepth(c);return d!=0&&(r=s.before(d),t&&t(a.tr.setSelection(W.create(a.doc,r))),!0)},Zc=(a,t)=>(t&&t(a.tr.setSelection(new We(a.doc))),!0);function Qc(a,t,r,s){let c,d,u=t.nodeBefore,m=t.nodeAfter,g=u.type.spec.isolating||m.type.spec.isolating;if(!g&&function(v,M,D){let A=M.nodeBefore,I=M.nodeAfter,R=M.index();return!(!(A&&I&&A.type.compatibleContent(I.type))||(!A.content.size&&M.parent.canReplace(R-1,R)?(D&&D(v.tr.delete(M.pos-A.nodeSize,M.pos).scrollIntoView()),0):!M.parent.canReplace(R,R+1)||!I.isTextblock&&!Lt(v.doc,M.pos)||(D&&D(v.tr.join(M.pos).scrollIntoView()),0)))}(a,t,r))return!0;let w=!g&&t.parent.canReplace(t.index(),t.index()+1);if(w&&(c=(d=u.contentMatchAt(u.childCount)).findWrapping(m.type))&&d.matchType(c[0]||m.type).validEnd){if(r){let v=t.pos+m.nodeSize,M=i.empty;for(let I=c.length-1;I>=0;I--)M=i.from(c[I].create(null,M));M=i.from(u.copy(M));let D=a.tr.step(new me(t.pos-1,v,t.pos,v,new b(M,1,0),c.length,!0)),A=D.doc.resolve(v+2*c.length);A.nodeAfter&&A.nodeAfter.type==u.type&&Lt(D.doc,A.pos)&&D.join(A.pos),r(D.scrollIntoView())}return!0}let k=m.type.spec.isolating||s>0&&g?null:X.findFrom(t,1),x=k&&k.$from.blockRange(k.$to),C=x&&$n(x);if(C!=null&&C>=t.depth)return r&&r(a.tr.lift(x,C).scrollIntoView()),!0;if(w&&Zn(m,"start",!0)&&Zn(u,"end")){let v=u,M=[];for(;M.push(v),!v.isTextblock;)v=v.lastChild;let D=m,A=1;for(;!D.isTextblock;D=D.firstChild)A++;if(v.canReplace(v.childCount,v.childCount,D.content)){if(r){let I=i.empty;for(let R=M.length-1;R>=0;R--)I=i.from(M[R].copy(I));r(a.tr.step(new me(t.pos-M.length,t.pos+m.nodeSize,t.pos+A,t.pos+m.nodeSize-A,new b(I,M.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function eh(a){return function(t,r){let s=t.selection,c=a<0?s.$from:s.$to,d=c.depth;for(;c.node(d).isInline;){if(!d)return!1;d--}return!!c.node(d).isTextblock&&(r&&r(t.tr.setSelection(Z.create(t.doc,a<0?c.start(d):c.end(d)))),!0)}}const th=eh(-1),nh=eh(1);function Ai(a,t=null){return function(r,s){let{$from:c,$to:d}=r.selection,u=c.blockRange(d),m=u&&ui(u,a,t);return!!m&&(s&&s(r.tr.wrap(u,m).scrollIntoView()),!0)}}function Pr(a,t=null){return function(r,s){let c=!1;for(let d=0;d<r.selection.ranges.length&&!c;d++){let{$from:{pos:u},$to:{pos:m}}=r.selection.ranges[d];r.doc.nodesBetween(u,m,(g,w)=>{if(c)return!1;if(g.isTextblock&&!g.hasMarkup(a,t))if(g.type==a)c=!0;else{let k=r.doc.resolve(w),x=k.index();c=k.parent.canReplaceWith(x,x+1,a)}})}if(!c)return!1;if(s){let d=r.tr;for(let u=0;u<r.selection.ranges.length;u++){let{$from:{pos:m},$to:{pos:g}}=r.selection.ranges[u];d.setBlockType(m,g,a,t)}s(d.scrollIntoView())}return!0}}function Rt(a,t=null,r){let s=(r&&r.removeWhenPresent)!==!1,c=(r&&r.enterInlineAtoms)!==!1;return function(d,u){let{empty:m,$cursor:g,ranges:w}=d.selection;if(m&&!g||!function(k,x,C,v){for(let M=0;M<x.length;M++){let{$from:D,$to:A}=x[M],I=D.depth==0&&k.inlineContent&&k.type.allowsMarkType(C);if(k.nodesBetween(D.pos,A.pos,(R,V)=>{if(I||!v&&R.isAtom&&R.isInline&&V>=D.pos&&V+R.nodeSize<=A.pos)return!1;I=R.inlineContent&&R.type.allowsMarkType(C)}),I)return!0}return!1}(d.doc,w,a,c))return!1;if(u)if(g)a.isInSet(d.storedMarks||g.marks())?u(d.tr.removeStoredMark(a)):u(d.tr.addStoredMark(a.create(t)));else{let k,x=d.tr;c||(w=function(C){let v=[];for(let M=0;M<C.length;M++){let{$from:D,$to:A}=C[M];D.doc.nodesBetween(D.pos,A.pos,(I,R)=>{if(I.isAtom&&I.content.size&&I.isInline&&R>=D.pos&&R+I.nodeSize<=A.pos)return R+1>D.pos&&v.push(new pi(D,D.doc.resolve(R+1))),D=D.doc.resolve(R+1+I.content.size),!1}),D.pos<A.pos&&v.push(new pi(D,A))}return v}(w)),k=s?!w.some(C=>d.doc.rangeHasMark(C.$from.pos,C.$to.pos,a)):!w.every(C=>{let v=!1;return x.doc.nodesBetween(C.$from.pos,C.$to.pos,(M,D,A)=>{if(v)return!1;v=!a.isInSet(M.marks)&&!!A&&A.type.allowsMarkType(a)&&!(M.isText&&/^\s*$/.test(M.textBetween(Math.max(0,C.$from.pos-D),Math.min(M.nodeSize,C.$to.pos-D))))}),!v});for(let C=0;C<w.length;C++){let{$from:v,$to:M}=w[C];if(k){let D=v.pos,A=M.pos,I=v.nodeAfter,R=M.nodeBefore,V=I&&I.isText?/^\s*/.exec(I.text)[0].length:0,q=R&&R.isText?/\s*$/.exec(R.text)[0].length:0;D+V<A&&(D+=V,A-=q),x.addMark(D,A,a.create(t))}else x.removeMark(v.pos,M.pos,a)}u(x.scrollIntoView())}return!0}}function Pp(a,t){return r=>{if(!r.isGeneric)return a(r);let s=[];for(let d=0;d<r.mapping.maps.length;d++){let u=r.mapping.maps[d];for(let m=0;m<s.length;m++)s[m]=u.map(s[m]);u.forEach((m,g,w,k)=>s.push(w,k))}let c=[];for(let d=0;d<s.length;d+=2){let u=s[d],m=s[d+1],g=r.doc.resolve(u),w=g.sharedDepth(m),k=g.node(w);for(let x=g.indexAfter(w),C=g.after(w+1);C<=m;++x){let v=k.maybeChild(x);if(!v)break;if(x&&c.indexOf(C)==-1){let M=k.child(x-1);M.type==v.type&&t(M,v)&&c.push(C)}C+=v.nodeSize}}c.sort((d,u)=>d-u);for(let d=c.length-1;d>=0;d--)Lt(r.doc,c[d])&&r.join(c[d]);a(r)}}function Br(...a){return function(t,r,s){for(let c=0;c<a.length;c++)if(a[c](t,r,s))return!0;return!1}}let ms=Br(cs,$c,Jc),rh=Br(cs,Kc,jc);const xt={Enter:Br(Gc,Yc,Xc,ps),"Mod-Enter":us,Backspace:ms,"Mod-Backspace":ms,"Shift-Backspace":ms,Delete:rh,"Mod-Delete":rh,"Mod-a":Zc},gs={"Ctrl-h":xt.Backspace,"Alt-Backspace":xt["Mod-Backspace"],"Ctrl-d":xt.Delete,"Ctrl-Alt-Backspace":xt["Mod-Delete"],"Alt-Delete":xt["Mod-Delete"],"Alt-d":xt["Mod-Delete"],"Ctrl-a":th,"Ctrl-e":nh};for(let a in xt)gs[a]=xt[a];const ih=(typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!(typeof os>"u"||!os.platform)&&os.platform()=="darwin")?gs:xt;var Bp=Object.freeze({__proto__:null,autoJoin:function(a,t){let r=Array.isArray(t)?s=>t.indexOf(s.type.name)>-1:t;return(s,c,d)=>a(s,c&&Pp(c,r),d)},baseKeymap:ih,chainCommands:Br,createParagraphNear:Yc,deleteSelection:cs,exitCode:us,joinBackward:$c,joinDown:Uc,joinForward:Kc,joinTextblockBackward:(a,t,r)=>{let s=qc(a,r);if(!s)return!1;let c=hs(s);return!!c&&Wc(a,c,t)},joinTextblockForward:(a,t,r)=>{let s=Hc(a,r);if(!s)return!1;let c=ds(s);return!!c&&Wc(a,c,t)},joinUp:Di,lift:Ti,liftEmptyBlock:Xc,macBaseKeymap:gs,newlineInCode:Gc,pcBaseKeymap:xt,selectAll:Zc,selectNodeBackward:Jc,selectNodeForward:jc,selectParentNode:Ei,selectTextblockEnd:nh,selectTextblockStart:th,setBlockType:Pr,splitBlock:ps,splitBlockAs:_c,splitBlockKeepMarks:(a,t)=>ps(a,t&&(r=>{let s=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();s&&r.ensureMarks(s),t(r)})),toggleMark:Rt,wrapIn:Ai});const Vp=["p",0],Fp=["blockquote",0],Lp=["hr"],qp=["pre",["code",0]],$p=["br"],oh={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>Vp},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>Fp},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>Lp},heading:{attrs:{level:{default:1,validate:"number"}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:a=>["h"+a.attrs.level,0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>qp},text:{group:"inline"},image:{inline:!0,attrs:{src:{validate:"string"},alt:{default:null,validate:"string|null"},title:{default:null,validate:"string|null"}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:a=>({src:a.getAttribute("src"),title:a.getAttribute("title"),alt:a.getAttribute("alt")})}],toDOM(a){let{src:t,alt:r,title:s}=a.attrs;return["img",{src:t,alt:r,title:s}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>$p}},Wp=["em",0],Jp=["strong",0],Hp=["code",0],sh={link:{attrs:{href:{validate:"string"},title:{default:null,validate:"string|null"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:a=>({href:a.getAttribute("href"),title:a.getAttribute("title")})}],toDOM(a){let{href:t,title:r}=a.attrs;return["a",{href:t,title:r},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:a=>a.type.name=="em"}],toDOM:()=>Wp},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:a=>a.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:a=>a.type.name=="strong"},{style:"font-weight",getAttrs:a=>/^(bold(er)?|[5-9]\d{2,})$/.test(a)&&null}],toDOM:()=>Jp},code:{parseDOM:[{tag:"code"}],toDOM:()=>Hp}},Kp=new ql({nodes:oh,marks:sh});var jp=Object.freeze({__proto__:null,marks:sh,nodes:oh,schema:Kp});const Up=["ol",0],Gp=["ul",0],Yp=["li",0],lh={attrs:{order:{default:1,validate:"number"}},parseDOM:[{tag:"ol",getAttrs:a=>({order:a.hasAttribute("start")?+a.getAttribute("start"):1})}],toDOM:a=>a.attrs.order==1?Up:["ol",{start:a.attrs.order},0]},ah={parseDOM:[{tag:"ul"}],toDOM:()=>Gp},ch={parseDOM:[{tag:"li"}],toDOM:()=>Yp,defining:!0};function ys(a,t){let r={};for(let s in a)r[s]=a[s];for(let s in t)r[s]=t[s];return r}function Ii(a,t=null){return function(r,s){let{$from:c,$to:d}=r.selection,u=c.blockRange(d),m=!1,g=u;if(!u)return!1;if(u.depth>=2&&c.node(u.depth-1).type.compatibleContent(a)&&u.startIndex==0){if(c.index(u.depth-1)==0)return!1;let k=r.doc.resolve(u.start-2);g=new G(k,k,u.depth),u.endIndex<u.parent.childCount&&(u=new G(c,r.doc.resolve(d.end(u.depth)),u.depth)),m=!0}let w=ui(g,a,t,u);return!!w&&(s&&s(function(k,x,C,v,M){let D=i.empty;for(let q=C.length-1;q>=0;q--)D=i.from(C[q].type.create(C[q].attrs,D));k.step(new me(x.start-(v?2:0),x.end,x.start,x.end,new b(D,0,0),C.length,!0));let A=0;for(let q=0;q<C.length;q++)C[q].type==M&&(A=q+1);let I=C.length-A,R=x.start+C.length-(v?2:0),V=x.parent;for(let q=x.startIndex,Y=x.endIndex,ie=!0;q<Y;q++,ie=!1)!ie&&yn(k.doc,R,I)&&(k.split(R,I),R+=2*I),R+=V.child(q).nodeSize;return k}(r.tr,u,w,m,a).scrollIntoView()),!0)}}function ws(a,t){return function(r,s){let{$from:c,$to:d,node:u}=r.selection;if(u&&u.isBlock||c.depth<2||!c.sameParent(d))return!1;let m=c.node(-1);if(m.type!=a)return!1;if(c.parent.content.size==0&&c.node(-1).childCount==c.indexAfter(-1)){if(c.depth==3||c.node(-3).type!=a||c.index(-2)!=c.node(-2).childCount-1)return!1;if(s){let x=i.empty,C=c.index(-1)?1:c.index(-2)?2:3;for(let I=c.depth-C;I>=c.depth-3;I--)x=i.from(c.node(I).copy(x));let v=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3;x=x.append(i.from(a.createAndFill()));let M=c.before(c.depth-(C-1)),D=r.tr.replace(M,c.after(-v),new b(x,4-C,0)),A=-1;D.doc.nodesBetween(M,D.doc.content.size,(I,R)=>{if(A>-1)return!1;I.isTextblock&&I.content.size==0&&(A=R+1)}),A>-1&&D.setSelection(X.near(D.doc.resolve(A))),s(D.scrollIntoView())}return!0}let g=d.pos==c.end()?m.contentMatchAt(0).defaultType:null,w=r.tr.delete(c.pos,d.pos),k=g?[t?{type:a,attrs:t}:null,{type:g}]:void 0;return!!yn(w.doc,c.pos,2,k)&&(s&&s(w.split(c.pos,2,k).scrollIntoView()),!0)}}function hh(a){return function(t,r){let{$from:s,$to:c}=t.selection,d=s.blockRange(c,u=>u.childCount>0&&u.firstChild.type==a);return!!d&&(!r||(s.node(d.depth-1).type==a?function(u,m,g,w){let k=u.tr,x=w.end,C=w.$to.end(w.depth);x<C&&(k.step(new me(x-1,C,x,C,new b(i.from(g.create(null,w.parent.copy())),1,0),1,!0)),w=new G(k.doc.resolve(w.$from.pos),k.doc.resolve(C),w.depth));const v=$n(w);if(v==null)return!1;k.lift(w,v);let M=k.mapping.map(x,-1)-1;return Lt(k.doc,M)&&k.join(M),m(k.scrollIntoView()),!0}(t,r,a,d):function(u,m,g){let w=u.tr,k=g.parent;for(let V=g.end,q=g.endIndex-1,Y=g.startIndex;q>Y;q--)V-=k.child(q).nodeSize,w.delete(V-1,V+1);let x=w.doc.resolve(g.start),C=x.nodeAfter;if(w.mapping.map(g.end)!=g.start+x.nodeAfter.nodeSize)return!1;let v=g.startIndex==0,M=g.endIndex==k.childCount,D=x.node(-1),A=x.index(-1);if(!D.canReplace(A+(v?0:1),A+1,C.content.append(M?i.empty:i.from(k))))return!1;let I=x.pos,R=I+C.nodeSize;return w.step(new me(I-(v?1:0),R+(M?1:0),I+1,R-1,new b((v?i.empty:i.from(k.copy(i.empty))).append(M?i.empty:i.from(k.copy(i.empty))),v?0:1,M?0:1),v?0:1)),m(w.scrollIntoView()),!0}(t,r,d)))}}function dh(a){return function(t,r){let{$from:s,$to:c}=t.selection,d=s.blockRange(c,w=>w.childCount>0&&w.firstChild.type==a);if(!d)return!1;let u=d.startIndex;if(u==0)return!1;let m=d.parent,g=m.child(u-1);if(g.type!=a)return!1;if(r){let w=g.lastChild&&g.lastChild.type==m.type,k=i.from(w?a.create():null),x=new b(i.from(a.create(null,i.from(m.type.create(null,k)))),w?3:1,0),C=d.start,v=d.end;r(t.tr.step(new me(C-(w?3:1),v,C,v,x,1,!0)).scrollIntoView())}return!0}}var Xp=Object.freeze({__proto__:null,addListNodes:function(a,t,r){return a.append({ordered_list:ys(lh,{content:"list_item+",group:r}),bullet_list:ys(ah,{content:"list_item+",group:r}),list_item:ys(ch,{content:t})})},bulletList:ah,liftListItem:hh,listItem:ch,orderedList:lh,sinkListItem:dh,splitListItem:ws,splitListItemKeepMarks:function(a,t){let r=ws(a,t);return(s,c)=>r(s,c&&(d=>{let u=s.storedMarks||s.selection.$to.parentOffset&&s.selection.$from.marks();u&&d.ensureMarks(u),c(d)}))},wrapInList:Ii});function fh(a={}){return new qt({view:t=>new _p(t,a)})}class _p{constructor(t,r){var s;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=r.width)!==null&&s!==void 0?s:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(c=>{let d=u=>{this[c](u)};return t.dom.addEventListener(c,d),{name:c,handler:d}})}destroy(){this.handlers.forEach(({name:t,handler:r})=>this.editorView.dom.removeEventListener(t,r))}update(t,r){this.cursorPos!=null&&r.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,r=this.editorView.state.doc.resolve(this.cursorPos),s=!r.parent.inlineContent;if(s){let m=r.nodeBefore,g=r.nodeAfter;if(m||g){let w=this.editorView.nodeDOM(this.cursorPos-(m?m.nodeSize:0));if(w){let k=w.getBoundingClientRect(),x=m?k.bottom:k.top;m&&g&&(x=(x+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:k.left,right:k.right,top:x-this.width/2,bottom:x+this.width/2}}}}if(!t){let m=this.editorView.coordsAtPos(this.cursorPos);t={left:m.left-this.width/2,right:m.left+this.width/2,top:m.top,bottom:m.bottom}}let c,d,u=this.editorView.dom.offsetParent;if(this.element||(this.element=u.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",s),this.element.classList.toggle("prosemirror-dropcursor-inline",!s),!u||u==document.body&&getComputedStyle(u).position=="static")c=-pageXOffset,d=-pageYOffset;else{let m=u.getBoundingClientRect();c=m.left-u.scrollLeft,d=m.top-u.scrollTop}this.element.style.left=t.left-c+"px",this.element.style.top=t.top-d+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),s=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),c=s&&s.type.spec.disableDropCursor,d=typeof c=="function"?c(this.editorView,r,t):c;if(r&&!d){let u=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let m=So(this.editorView.state.doc,u,this.editorView.dragging.slice);m!=null&&(u=m)}this.setCursor(u),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}var Zp=Object.freeze({__proto__:null,dropCursor:fh});class re extends X{constructor(t){super(t,t)}map(t,r){let s=t.resolve(r.map(this.head));return re.valid(s)?new re(s):X.near(s)}content(){return b.empty}eq(t){return t instanceof re&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new re(t.resolve(r.pos))}getBookmark(){return new bs(this.anchor)}static valid(t){let r=t.parent;if(r.isTextblock||!function(d){for(let u=d.depth;u>=0;u--){let m=d.index(u),g=d.node(u);if(m!=0)for(let w=g.child(m-1);;w=w.lastChild){if(w.childCount==0&&!w.inlineContent||w.isAtom||w.type.spec.isolating)return!0;if(w.inlineContent)return!1}else if(g.type.spec.isolating)return!0}return!0}(t)||!function(d){for(let u=d.depth;u>=0;u--){let m=d.indexAfter(u),g=d.node(u);if(m!=g.childCount)for(let w=g.child(m);;w=w.firstChild){if(w.childCount==0&&!w.inlineContent||w.isAtom||w.type.spec.isolating)return!0;if(w.inlineContent)return!1}else if(g.type.spec.isolating)return!0}return!0}(t))return!1;let s=r.type.spec.allowGapCursor;if(s!=null)return s;let c=r.contentMatchAt(t.index()).defaultType;return c&&c.isTextblock}static findGapCursorFrom(t,r,s=!1){e:for(;;){if(!s&&re.valid(t))return t;let c=t.pos,d=null;for(let u=t.depth;;u--){let m=t.node(u);if(r>0?t.indexAfter(u)<m.childCount:t.index(u)>0){d=m.child(r>0?t.indexAfter(u):t.index(u)-1);break}if(u==0)return null;c+=r;let g=t.doc.resolve(c);if(re.valid(g))return g}for(;;){let u=r>0?d.firstChild:d.lastChild;if(!u){if(d.isAtom&&!d.isText&&!W.isSelectable(d)){t=t.doc.resolve(c+d.nodeSize*r),s=!1;continue e}break}d=u,c+=r;let m=t.doc.resolve(c);if(re.valid(m))return m}return null}}}re.prototype.visible=!1,re.findFrom=re.findGapCursorFrom,X.jsonID("gapcursor",re);class bs{constructor(t){this.pos=t}map(t){return new bs(t.map(this.pos))}resolve(t){let r=t.resolve(this.pos);return re.valid(r)?new re(r):X.near(r)}}function uh(){return new qt({props:{decorations:nm,createSelectionBetween:(a,t,r)=>t.pos==r.pos&&re.valid(r)?new re(r):null,handleClick:em,handleKeyDown:Qp,handleDOMEvents:{beforeinput:tm}}})}const Qp=is({ArrowLeft:Ri("horiz",-1),ArrowRight:Ri("horiz",1),ArrowUp:Ri("vert",-1),ArrowDown:Ri("vert",1)});function Ri(a,t){const r=a=="vert"?t>0?"down":"up":t>0?"right":"left";return function(s,c,d){let u=s.selection,m=t>0?u.$to:u.$from,g=u.empty;if(u instanceof Z){if(!d.endOfTextblock(r)||m.depth==0)return!1;g=!1,m=s.doc.resolve(t>0?m.after():m.before())}let w=re.findGapCursorFrom(m,t,g);return!!w&&(c&&c(s.tr.setSelection(new re(w))),!0)}}function em(a,t,r){if(!a||!a.editable)return!1;let s=a.state.doc.resolve(t);if(!re.valid(s))return!1;let c=a.posAtCoords({left:r.clientX,top:r.clientY});return!(c&&c.inside>-1&&W.isSelectable(a.state.doc.nodeAt(c.inside)))&&(a.dispatch(a.state.tr.setSelection(new re(s))),!0)}function tm(a,t){if(t.inputType!="insertCompositionText"||!(a.state.selection instanceof re))return!1;let{$from:r}=a.state.selection,s=r.parent.contentMatchAt(r.index()).findWrapping(a.state.schema.nodes.text);if(!s)return!1;let c=i.empty;for(let u=s.length-1;u>=0;u--)c=i.from(s[u].createAndFill(null,c));let d=a.state.tr.replace(r.pos,r.pos,new b(c,0,0));return d.setSelection(Z.near(d.doc.resolve(r.pos+1))),a.dispatch(d),!1}function nm(a){if(!(a.selection instanceof re))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",de.create(a.doc,[Ye.widget(a.selection.head,t,{key:"gapcursor"})])}var rm=Object.freeze({__proto__:null,GapCursor:re,gapCursor:uh});function Xe(){var a=arguments[0];typeof a=="string"&&(a=document.createElement(a));var t=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){var c=r[s];typeof c=="string"?a.setAttribute(s,c):c!=null&&(a[s]=c)}t++}for(;t<arguments.length;t++)ph(a,arguments[t]);return a}function ph(a,t){if(typeof t=="string")a.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)a.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var r=0;r<t.length;r++)ph(a,t[r])}}const Vr="http://www.w3.org/2000/svg",ks="ProseMirror-icon";function im(a,t){let r=(a.nodeType==9?a:a.ownerDocument)||document,s=r.createElement("div");if(s.className=ks,t.path){let{path:c,width:d,height:u}=t,m="pm-icon-"+function(w){let k=0;for(let x=0;x<w.length;x++)k=(k<<5)-k+w.charCodeAt(x)|0;return k}(c).toString(16);r.getElementById(m)||function(w,k,x){let[C,v]=w.nodeType==9?[w,w.body]:[w.ownerDocument||document,w],M=C.getElementById(ks+"-collection");M||(M=C.createElementNS(Vr,"svg"),M.id=ks+"-collection",M.style.display="none",v.insertBefore(M,v.firstChild));let D=C.createElementNS(Vr,"symbol");D.id=k,D.setAttribute("viewBox","0 0 "+x.width+" "+x.height),D.appendChild(C.createElementNS(Vr,"path")).setAttribute("d",x.path),M.appendChild(D)}(a,m,t);let g=s.appendChild(r.createElementNS(Vr,"svg"));g.style.width=d/u+"em",g.appendChild(r.createElementNS(Vr,"use")).setAttributeNS("http://www.w3.org/1999/xlink","href",/([^#]*)/.exec(r.location.toString())[1]+"#"+m)}else if(t.dom)s.appendChild(t.dom.cloneNode(!0));else{let{text:c,css:d}=t;s.appendChild(r.createElement("span")).textContent=c||"",d&&(s.firstChild.style.cssText=d)}return s}const He="ProseMirror-menu";class it{constructor(t){this.spec=t}render(t){let r=this.spec,s=r.render?r.render(t):r.icon?im(t.root,r.icon):r.label?Xe("div",null,Fr(t,r.label)):null;if(!s)throw new RangeError("MenuItem without icon or label property");if(r.title){const c=typeof r.title=="function"?r.title(t.state):r.title;s.setAttribute("title",Fr(t,c))}return r.class&&s.classList.add(r.class),r.css&&(s.style.cssText+=r.css),s.addEventListener("mousedown",c=>{c.preventDefault(),s.classList.contains(He+"-disabled")||r.run(t.state,t.dispatch,t,c)}),{dom:s,update:function(c){if(r.select){let u=r.select(c);if(s.style.display=u?"":"none",!u)return!1}let d=!0;if(r.enable&&(d=r.enable(c)||!1,Ss(s,He+"-disabled",!d)),r.active){let u=d&&r.active(c)||!1;Ss(s,He+"-active",u)}return!0}}}}function Fr(a,t){return a._props.translate?a._props.translate(t):t}let Lr={time:0,node:null};function mh(a){Lr.time=Date.now(),Lr.node=a.target}function gh(a){return Date.now()-100<Lr.time&&Lr.node&&a.contains(Lr.node)}class xs{constructor(t,r={}){this.options=r,this.options=r||{},this.content=Array.isArray(t)?t:[t]}render(t){let r=yh(this.content,t),s=t.dom.ownerDocument.defaultView||window,c=Xe("div",{class:He+"-dropdown "+(this.options.class||""),style:this.options.css},Fr(t,this.options.label||""));this.options.title&&c.setAttribute("title",Fr(t,this.options.title));let d=Xe("div",{class:He+"-dropdown-wrap"},c),u=null,m=null,g=()=>{u&&u.close()&&(u=null,s.removeEventListener("mousedown",m))};return c.addEventListener("mousedown",w=>{w.preventDefault(),mh(w),u?g():(u=this.expand(d,r.dom),s.addEventListener("mousedown",m=()=>{gh(d)||g()}))}),{dom:d,update:function(w){let k=r.update(w);return d.style.display=k?"":"none",k}}}expand(t,r){let s=Xe("div",{class:He+"-dropdown-menu "+(this.options.class||"")},r),c=!1;return t.appendChild(s),{close:function(){return!c&&(c=!0,t.removeChild(s),!0)},node:s}}}function yh(a,t){let r=[],s=[];for(let c=0;c<a.length;c++){let{dom:d,update:u}=a[c].render(t);r.push(Xe("div",{class:He+"-dropdown-item"},d)),s.push(u)}return{dom:r,update:wh(s,r)}}function wh(a,t){return r=>{let s=!1;for(let c=0;c<a.length;c++){let d=a[c](r);t[c].style.display=d?"":"none",d&&(s=!0)}return s}}class bh{constructor(t,r={}){this.options=r,this.content=Array.isArray(t)?t:[t]}render(t){let r=yh(this.content,t),s=t.dom.ownerDocument.defaultView||window,c=Xe("div",{class:He+"-submenu-label"},Fr(t,this.options.label||"")),d=Xe("div",{class:He+"-submenu-wrap"},c,Xe("div",{class:He+"-submenu"},r.dom)),u=null;return c.addEventListener("mousedown",m=>{m.preventDefault(),mh(m),Ss(d,He+"-submenu-wrap-active",!1),u||s.addEventListener("mousedown",u=()=>{gh(d)||(d.classList.remove(He+"-submenu-wrap-active"),s.removeEventListener("mousedown",u),u=null)})}),{dom:d,update:function(m){let g=r.update(m);return d.style.display=g?"":"none",g}}}}function kh(a,t){let r=document.createDocumentFragment(),s=[],c=[];for(let d=0;d<t.length;d++){let u=t[d],m=[],g=[];for(let w=0;w<u.length;w++){let{dom:k,update:x}=u[w].render(a),C=Xe("span",{class:He+"item"},k);r.appendChild(C),g.push(C),m.push(x)}m.length&&(s.push(wh(m,g)),d<t.length-1&&c.push(r.appendChild(Xe("span",{class:He+"separator"}))))}return{dom:r,update:function(d){let u=!1,m=!1;for(let g=0;g<s.length;g++){let w=s[g](d);g&&(c[g-1].style.display=m&&w?"":"none"),m=w,w&&(u=!0)}return u}}}const _e={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"⬚",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},xh=new it({title:"Join with above block",run:Di,select:a=>Di(a),icon:_e.join}),Sh=new it({title:"Lift out of enclosing block",run:Ti,select:a=>Ti(a),icon:_e.lift}),Ch=new it({title:"Select parent node",run:Ei,select:a=>Ei(a),icon:_e.selectParentNode});let Mh=new it({title:"Undo last change",run:zr,enable:a=>zr(a),icon:_e.undo}),vh=new it({title:"Redo last undone change",run:_n,enable:a=>_n(a),icon:_e.redo});function Oh(a,t){let r={run:(s,c)=>Ai(a,t.attrs)(s,c),select:s=>Ai(a,t.attrs)(s)};for(let s in t)r[s]=t[s];return new it(r)}function zi(a,t){let r=Pr(a,t.attrs),s={run:r,enable:c=>r(c),active(c){let{$from:d,to:u,node:m}=c.selection;return m?m.hasMarkup(a,t.attrs):u<=d.end()&&d.parent.hasMarkup(a,t.attrs)}};for(let c in t)s[c]=t[c];return new it(s)}function Ss(a,t,r){r?a.classList.add(t):a.classList.remove(t)}const Pi="ProseMirror-menubar";function Nh(a){return new qt({view:t=>new om(t,a)})}class om{constructor(t,r){this.editorView=t,this.options=r,this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1,this.scrollHandler=null,this.wrapper=Xe("div",{class:Pi+"-wrapper"}),this.menu=this.wrapper.appendChild(Xe("div",{class:Pi})),this.menu.className=Pi,t.dom.parentNode&&t.dom.parentNode.replaceChild(this.wrapper,t.dom),this.wrapper.appendChild(t.dom);let{dom:s,update:c}=kh(this.editorView,this.options.content);if(this.contentUpdate=c,this.menu.appendChild(s),this.update(),r.floating&&!function(){if(typeof navigator>"u")return!1;let d=navigator.userAgent;return!/Edge\/\d/.test(d)&&/AppleWebKit/.test(d)&&/Mobile\/\w+/.test(d)}()){this.updateFloat();let d=function(u){let m=[u.ownerDocument.defaultView||window];for(let g=u.parentNode;g;g=g.parentNode)m.push(g);return m}(this.wrapper);this.scrollHandler=u=>{let m=this.editorView.root;(m.body||m).contains(this.wrapper)?this.updateFloat(u.target.getBoundingClientRect?u.target:void 0):d.forEach(g=>g.removeEventListener("scroll",this.scrollHandler))},d.forEach(u=>u.addEventListener("scroll",this.scrollHandler))}}update(){this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))}updateScrollCursor(){let t=this.editorView.root.getSelection();if(!t.focusNode)return;let r=t.getRangeAt(0).getClientRects(),s=r[function(d){return d.anchorNode==d.focusNode?d.anchorOffset>d.focusOffset:d.anchorNode.compareDocumentPosition(d.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}(t)?0:r.length-1];if(!s)return;let c=this.menu.getBoundingClientRect();if(s.top<c.bottom&&s.bottom>c.top){let d=function(u){for(let m=u.parentNode;m;m=m.parentNode)if(m.scrollHeight>m.clientHeight)return m}(this.wrapper);d&&(d.scrollTop-=c.bottom-s.top)}}updateFloat(t){let r=this.wrapper,s=r.getBoundingClientRect(),c=t?Math.max(0,t.getBoundingClientRect().top):0;if(this.floating)if(s.top>=c||s.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{let d=(r.offsetWidth-r.clientWidth)/2;this.menu.style.left=s.left+d+"px",this.menu.style.display=s.top>(this.editorView.dom.ownerDocument.defaultView||window).innerHeight?"none":"",t&&(this.menu.style.top=c+"px")}else if(s.top<c&&s.bottom>=this.menu.offsetHeight+10){this.floating=!0;let d=this.menu.getBoundingClientRect();this.menu.style.left=d.left+"px",this.menu.style.width=d.width+"px",t&&(this.menu.style.top=c+"px"),this.menu.style.position="fixed",this.spacer=Xe("div",{class:Pi+"-spacer",style:`height: ${d.height}px`}),r.insertBefore(this.spacer,this.menu)}}destroy(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}}var sm=Object.freeze({__proto__:null,Dropdown:xs,DropdownSubmenu:bh,MenuItem:it,blockTypeItem:zi,icons:_e,joinUpItem:xh,liftItem:Sh,menuBar:Nh,redoItem:vh,renderGrouped:kh,selectParentNodeItem:Ch,undoItem:Mh,wrapItem:Oh});const Bi="ProseMirror-prompt";function Dh(a){let t=document.body.appendChild(document.createElement("div"));t.className=Bi;let r=C=>{t.contains(C.target)||s()};setTimeout(()=>window.addEventListener("mousedown",r),50);let s=()=>{window.removeEventListener("mousedown",r),t.parentNode&&t.parentNode.removeChild(t)},c=[];for(let C in a.fields)c.push(a.fields[C].render());let d=document.createElement("button");d.type="submit",d.className=Bi+"-submit",d.textContent="OK";let u=document.createElement("button");u.type="button",u.className=Bi+"-cancel",u.textContent="Cancel",u.addEventListener("click",s);let m=t.appendChild(document.createElement("form"));a.title&&(m.appendChild(document.createElement("h5")).textContent=a.title),c.forEach(C=>{m.appendChild(document.createElement("div")).appendChild(C)});let g=m.appendChild(document.createElement("div"));g.className=Bi+"-buttons",g.appendChild(d),g.appendChild(document.createTextNode(" ")),g.appendChild(u);let w=t.getBoundingClientRect();t.style.top=(window.innerHeight-w.height)/2+"px",t.style.left=(window.innerWidth-w.width)/2+"px";let k=()=>{let C=function(v,M){let D=Object.create(null),A=0;for(let I in v){let R=v[I],V=M[A++],q=R.read(V),Y=R.validate(q);if(Y)return lm(V,Y),null;D[I]=R.clean(q)}return D}(a.fields,c);C&&(s(),a.callback(C))};m.addEventListener("submit",C=>{C.preventDefault(),k()}),m.addEventListener("keydown",C=>{C.keyCode==27?(C.preventDefault(),s()):C.keyCode!=13||C.ctrlKey||C.metaKey||C.shiftKey?C.keyCode==9&&window.setTimeout(()=>{t.contains(document.activeElement)||s()},500):(C.preventDefault(),k())});let x=m.elements[0];x&&x.focus()}function lm(a,t){let r=a.parentNode,s=r.appendChild(document.createElement("div"));s.style.left=a.offsetLeft+a.offsetWidth+2+"px",s.style.top=a.offsetTop-5+"px",s.className="ProseMirror-invalid",s.textContent=t,setTimeout(()=>r.removeChild(s),1500)}class am{constructor(t){this.options=t}read(t){return t.value}validateType(t){return null}validate(t){return!t&&this.options.required?"Required field":this.validateType(t)||(this.options.validate?this.options.validate(t):null)}clean(t){return this.options.clean?this.options.clean(t):t}}class qr extends am{render(){let t=document.createElement("input");return t.type="text",t.placeholder=this.options.label,t.value=this.options.value||"",t.autocomplete="off",t}}function Th(a,t){let r=a.selection.$from;for(let s=r.depth;s>=0;s--){let c=r.index(s);if(r.node(s).canReplaceWith(c,c,t))return!0}return!1}function Eh(a,t){let r={label:t.title,run:a};for(let s in t)r[s]=t[s];return t.enable||t.select||(r[t.enable?"enable":"select"]=s=>a(s)),new it(r)}function Cs(a,t){let{from:r,$from:s,to:c,empty:d}=a.selection;return d?!!t.isInSet(a.storedMarks||s.marks()):a.doc.rangeHasMark(r,c,t)}function Ms(a,t){let r={active:s=>Cs(s,a)};for(let s in t)r[s]=t[s];return Eh(Rt(a),r)}function Ah(a,t){return Eh(Ii(a,t.attrs),t)}function Ih(a){let t,r={};var s;let c;var d;if((t=a.marks.strong)&&(r.toggleStrong=Ms(t,{title:"Toggle strong style",icon:_e.strong})),(t=a.marks.em)&&(r.toggleEm=Ms(t,{title:"Toggle emphasis",icon:_e.em})),(t=a.marks.code)&&(r.toggleCode=Ms(t,{title:"Toggle code font",icon:_e.code})),(t=a.marks.link)&&(r.toggleLink=(s=t,new it({title:"Add or remove link",icon:_e.link,active:m=>Cs(m,s),enable:m=>!m.selection.empty,run(m,g,w){if(Cs(m,s))return Rt(s)(m,g),!0;Dh({title:"Create a link",fields:{href:new qr({label:"Link target",required:!0}),title:new qr({label:"Title"})},callback(k){Rt(s,k)(w.state,w.dispatch),w.focus()}})}}))),(c=a.nodes.image)&&(r.insertImage=(d=c,new it({title:"Insert image",label:"Image",enable:m=>Th(m,d),run(m,g,w){let{from:k,to:x}=m.selection,C=null;m.selection instanceof W&&m.selection.node.type==d&&(C=m.selection.node.attrs),Dh({title:"Insert image",fields:{src:new qr({label:"Location",required:!0,value:C&&C.src}),title:new qr({label:"Title",value:C&&C.title}),alt:new qr({label:"Description",value:C?C.alt:m.doc.textBetween(k,x," ")})},callback(v){w.dispatch(w.state.tr.replaceSelectionWith(d.createAndFill(v))),w.focus()}})}}))),(c=a.nodes.bullet_list)&&(r.wrapBulletList=Ah(c,{title:"Wrap in bullet list",icon:_e.bulletList})),(c=a.nodes.ordered_list)&&(r.wrapOrderedList=Ah(c,{title:"Wrap in ordered list",icon:_e.orderedList})),(c=a.nodes.blockquote)&&(r.wrapBlockQuote=Oh(c,{title:"Wrap in block quote",icon:_e.blockquote})),(c=a.nodes.paragraph)&&(r.makeParagraph=zi(c,{title:"Change to paragraph",label:"Plain"})),(c=a.nodes.code_block)&&(r.makeCodeBlock=zi(c,{title:"Change to code block",label:"Code"})),c=a.nodes.heading)for(let m=1;m<=10;m++)r["makeHead"+m]=zi(c,{title:"Change to heading "+m,label:"Level "+m,attrs:{level:m}});if(c=a.nodes.horizontal_rule){let m=c;r.insertHorizontalRule=new it({title:"Insert horizontal rule",label:"Horizontal rule",enable:g=>Th(g,m),run(g,w){w(g.tr.replaceSelectionWith(m.create()))}})}let u=m=>m.filter(g=>g);return r.insertMenu=new xs(u([r.insertImage,r.insertHorizontalRule]),{label:"Insert"}),r.typeMenu=new xs(u([r.makeParagraph,r.makeCodeBlock,r.makeHead1&&new bh(u([r.makeHead1,r.makeHead2,r.makeHead3,r.makeHead4,r.makeHead5,r.makeHead6]),{label:"Heading"})]),{label:"Type..."}),r.inlineMenu=[u([r.toggleStrong,r.toggleEm,r.toggleCode,r.toggleLink])],r.blockMenu=[u([r.wrapBulletList,r.wrapOrderedList,r.wrapBlockQuote,xh,Sh,Ch])],r.fullMenu=r.inlineMenu.concat([[r.insertMenu,r.typeMenu]],[[Mh,vh]],r.blockMenu),r}const Rh=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function zh(a,t){let r,s={};function c(d,u){if(t){let m=t[d];if(m===!1)return;m&&(d=m)}s[d]=u}if(c("Mod-z",zr),c("Shift-Mod-z",_n),c("Backspace",Nc),Rh||c("Mod-y",_n),c("Alt-ArrowUp",Di),c("Alt-ArrowDown",Uc),c("Mod-BracketLeft",Ti),c("Escape",Ei),(r=a.marks.strong)&&(c("Mod-b",Rt(r)),c("Mod-B",Rt(r))),(r=a.marks.em)&&(c("Mod-i",Rt(r)),c("Mod-I",Rt(r))),(r=a.marks.code)&&c("Mod-`",Rt(r)),(r=a.nodes.bullet_list)&&c("Shift-Ctrl-8",Ii(r)),(r=a.nodes.ordered_list)&&c("Shift-Ctrl-9",Ii(r)),(r=a.nodes.blockquote)&&c("Ctrl->",Ai(r)),r=a.nodes.hard_break){let d=r,u=Br(us,(m,g)=>(g&&g(m.tr.replaceSelectionWith(d.create()).scrollIntoView()),!0));c("Mod-Enter",u),c("Shift-Enter",u),Rh&&c("Ctrl-Enter",u)}if((r=a.nodes.list_item)&&(c("Enter",ws(r)),c("Mod-[",hh(r)),c("Mod-]",dh(r))),(r=a.nodes.paragraph)&&c("Shift-Ctrl-0",Pr(r)),(r=a.nodes.code_block)&&c("Shift-Ctrl-\\",Pr(r)),r=a.nodes.heading)for(let d=1;d<=6;d++)c("Shift-Ctrl-"+d,Pr(r,{level:d}));if(r=a.nodes.horizontal_rule){let d=r;c("Mod-_",(u,m)=>(m&&m(u.tr.replaceSelectionWith(d.create()).scrollIntoView()),!0))}return s}function Ph(a){let t,r=zc.concat(Tc,Dc);return(t=a.nodes.blockquote)&&r.push(Mi(/^\s*>\s$/,t)),(t=a.nodes.ordered_list)&&r.push(function(s){return Mi(/^(\d+)\.\s$/,s,c=>({order:+c[1]}),(c,d)=>d.childCount+d.attrs.order==+c[1])}(t)),(t=a.nodes.bullet_list)&&r.push(function(s){return Mi(/^\s*([-+*])\s$/,s)}(t)),(t=a.nodes.code_block)&&r.push(function(s){return ss(/^```$/,s)}(t)),(t=a.nodes.heading)&&r.push(function(s,c){return ss(new RegExp("^(#{1,"+c+"})\\s$"),s,d=>({level:d[1].length}))}(t,6)),vc({rules:r})}var cm=Object.freeze({__proto__:null,buildInputRules:Ph,buildKeymap:zh,buildMenuItems:Ih,exampleSetup:function(a){let t=[Ph(a.schema),rs(zh(a.schema,a.mapKeys)),rs(ih),fh(),uh()];return a.menuBar!==!1&&t.push(Nh({floating:a.floatingMenu!==!1,content:a.menuContent||Ih(a.schema).fullMenu})),a.history!==!1&&t.push(Lc()),t.concat(new qt({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}});window.PM={model:zu,transform:Vu,state:qu,view:Cp,keymap:Dp,inputrules:Tp,history:zp,commands:Bp,schema_basic:jp,schema_list:Xp,dropcursor:Zp,menu:sm,example_setup:cm,gapcursor:rm}})();function Se(o){this.content=o}Se.prototype={constructor:Se,find:function(o){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===o)return e;return-1},get:function(o){var e=this.find(o);return e==-1?void 0:this.content[e+1]},update:function(o,e,n){var i=n&&n!=o?this.remove(n):this,l=i.find(o),h=i.content.slice();return l==-1?h.push(n||o,e):(h[l+1]=e,n&&(h[l]=n)),new Se(h)},remove:function(o){var e=this.find(o);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Se(n)},addToStart:function(o,e){return new Se([o,e].concat(this.remove(o).content))},addToEnd:function(o,e){var n=this.remove(o).content.slice();return n.push(o,e),new Se(n)},addBefore:function(o,e,n){var i=this.remove(e),l=i.content.slice(),h=i.find(o);return l.splice(h==-1?l.length:h,0,e,n),new Se(l)},forEach:function(o){for(var e=0;e<this.content.length;e+=2)o(this.content[e],this.content[e+1])},prepend:function(o){return o=Se.from(o),o.size?new Se(o.content.concat(this.subtract(o).content)):this},append:function(o){return o=Se.from(o),o.size?new Se(this.subtract(o).content.concat(o.content)):this},subtract:function(o){var e=this;o=Se.from(o);for(var n=0;n<o.content.length;n+=2)e=e.remove(o.content[n]);return e},toObject:function(){var o={};return this.forEach(function(e,n){o[e]=n}),o},get size(){return this.content.length>>1}};Se.from=function(o){if(o instanceof Se)return o;var e=[];if(o)for(var n in o)e.push(n,o[n]);return new Se(e)};function Kd(o,e,n){for(let i=0;;i++){if(i==o.childCount||i==e.childCount)return o.childCount==e.childCount?null:n;let l=o.child(i),h=e.child(i);if(l==h){n+=l.nodeSize;continue}if(!l.sameMarkup(h))return n;if(l.isText&&l.text!=h.text){for(let f=0;l.text[f]==h.text[f];f++)n++;return n}if(l.content.size||h.content.size){let f=Kd(l.content,h.content,n+1);if(f!=null)return f}n+=l.nodeSize}}function jd(o,e,n,i){for(let l=o.childCount,h=e.childCount;;){if(l==0||h==0)return l==h?null:{a:n,b:i};let f=o.child(--l),p=e.child(--h),y=f.nodeSize;if(f==p){n-=y,i-=y;continue}if(!f.sameMarkup(p))return{a:n,b:i};if(f.isText&&f.text!=p.text){let b=0,S=Math.min(f.text.length,p.text.length);for(;b<S&&f.text[f.text.length-b-1]==p.text[p.text.length-b-1];)b++,n--,i--;return{a:n,b:i}}if(f.content.size||p.content.size){let b=jd(f.content,p.content,n-1,i-1);if(b)return b}n-=y,i-=y}}class B{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let i=0;i<e.length;i++)this.size+=e[i].nodeSize}nodesBetween(e,n,i,l=0,h){for(let f=0,p=0;p<n;f++){let y=this.content[f],b=p+y.nodeSize;if(b>e&&i(y,l+p,h||null,f)!==!1&&y.content.size){let S=p+1;y.nodesBetween(Math.max(0,e-S),Math.min(y.content.size,n-S),i,l+S)}p=b}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,i,l){let h="",f=!0;return this.nodesBetween(e,n,(p,y)=>{let b=p.isText?p.text.slice(Math.max(e,y)-y,n-y):p.isLeaf?l?typeof l=="function"?l(p):l:p.type.spec.leafText?p.type.spec.leafText(p):"":"";p.isBlock&&(p.isLeaf&&b||p.isTextblock)&&i&&(f?f=!1:h+=i),h+=b},0),h}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,i=e.firstChild,l=this.content.slice(),h=0;for(n.isText&&n.sameMarkup(i)&&(l[l.length-1]=n.withText(n.text+i.text),h=1);h<e.content.length;h++)l.push(e.content[h]);return new B(l,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let i=[],l=0;if(n>e)for(let h=0,f=0;f<n;h++){let p=this.content[h],y=f+p.nodeSize;y>e&&((f<e||y>n)&&(p.isText?p=p.cut(Math.max(0,e-f),Math.min(p.text.length,n-f)):p=p.cut(Math.max(0,e-f-1),Math.min(p.content.size,n-f-1))),i.push(p),l+=p.nodeSize),f=y}return new B(i,l)}cutByIndex(e,n){return e==n?B.empty:e==0&&n==this.content.length?this:new B(this.content.slice(e,n))}replaceChild(e,n){let i=this.content[e];if(i==n)return this;let l=this.content.slice(),h=this.size+n.nodeSize-i.nodeSize;return l[e]=n,new B(l,h)}addToStart(e){return new B([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new B(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,i=0;n<this.content.length;n++){let l=this.content[n];e(l,i,n),i+=l.nodeSize}}findDiffStart(e,n=0){return Kd(this,e,n)}findDiffEnd(e,n=this.size,i=e.size){return jd(this,e,n,i)}findIndex(e,n=-1){if(e==0)return Vi(0,e);if(e==this.size)return Vi(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let i=0,l=0;;i++){let h=this.child(i),f=l+h.nodeSize;if(f>=e)return f==e||n>0?Vi(i+1,f):Vi(i,l);l=f}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return B.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new B(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return B.empty;let n,i=0;for(let l=0;l<e.length;l++){let h=e[l];i+=h.nodeSize,l&&h.isText&&e[l-1].sameMarkup(h)?(n||(n=e.slice(0,l)),n[n.length-1]=h.withText(n[n.length-1].text+h.text)):n&&n.push(h)}return new B(n||e,i)}static from(e){if(!e)return B.empty;if(e instanceof B)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new B([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}B.empty=new B([],0);const Os={index:0,offset:0};function Vi(o,e){return Os.index=o,Os.offset=e,Os}function Ui(o,e){if(o===e)return!0;if(!(o&&typeof o=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(o);if(Array.isArray(e)!=n)return!1;if(n){if(o.length!=e.length)return!1;for(let i=0;i<o.length;i++)if(!Ui(o[i],e[i]))return!1}else{for(let i in o)if(!(i in e)||!Ui(o[i],e[i]))return!1;for(let i in e)if(!(i in o))return!1}return!0}class ee{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,i=!1;for(let l=0;l<e.length;l++){let h=e[l];if(this.eq(h))return e;if(this.type.excludes(h.type))n||(n=e.slice(0,l));else{if(h.type.excludes(this.type))return e;!i&&h.type.rank>this.type.rank&&(n||(n=e.slice(0,l)),n.push(this),i=!0),n&&n.push(h)}}return n||(n=e.slice()),i||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Ui(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let i=e.marks[n.type];if(!i)throw new RangeError(`There is no mark type ${n.type} in this schema`);let l=i.create(n.attrs);return i.checkAttrs(l.attrs),l}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].eq(n[i]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return ee.none;if(e instanceof ee)return[e];let n=e.slice();return n.sort((i,l)=>i.type.rank-l.type.rank),n}}ee.none=[];class Gi extends Error{}class F{constructor(e,n,i){this.content=e,this.openStart=n,this.openEnd=i}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let i=Gd(this.content,e+this.openStart,n);return i&&new F(i,this.openStart,this.openEnd)}removeBetween(e,n){return new F(Ud(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return F.empty;let i=n.openStart||0,l=n.openEnd||0;if(typeof i!="number"||typeof l!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new F(B.fromJSON(e,n.content),i,l)}static maxOpen(e,n=!0){let i=0,l=0;for(let h=e.firstChild;h&&!h.isLeaf&&(n||!h.type.spec.isolating);h=h.firstChild)i++;for(let h=e.lastChild;h&&!h.isLeaf&&(n||!h.type.spec.isolating);h=h.lastChild)l++;return new F(e,i,l)}}F.empty=new F(B.empty,0,0);function Ud(o,e,n){let{index:i,offset:l}=o.findIndex(e),h=o.maybeChild(i),{index:f,offset:p}=o.findIndex(n);if(l==e||h.isText){if(p!=n&&!o.child(f).isText)throw new RangeError("Removing non-flat range");return o.cut(0,e).append(o.cut(n))}if(i!=f)throw new RangeError("Removing non-flat range");return o.replaceChild(i,h.copy(Ud(h.content,e-l-1,n-l-1)))}function Gd(o,e,n,i){let{index:l,offset:h}=o.findIndex(e),f=o.maybeChild(l);if(h==e||f.isText)return o.cut(0,e).append(n).append(o.cut(e));let p=Gd(f.content,e-h-1,n);return p&&o.replaceChild(l,f.copy(p))}function um(o,e,n){if(n.openStart>o.depth)throw new Gi("Inserted content deeper than insertion position");if(o.depth-n.openStart!=e.depth-n.openEnd)throw new Gi("Inconsistent open depths");return Yd(o,e,n,0)}function Yd(o,e,n,i){let l=o.index(i),h=o.node(i);if(l==e.index(i)&&i<o.depth-n.openStart){let f=Yd(o,e,n,i+1);return h.copy(h.content.replaceChild(l,f))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&o.depth==i&&e.depth==i){let f=o.parent,p=f.content;return En(f,p.cut(0,o.parentOffset).append(n.content).append(p.cut(e.parentOffset)))}else{let{start:f,end:p}=pm(n,o);return En(h,_d(o,f,p,e,i))}else return En(h,Yi(o,e,i))}function Xd(o,e){if(!e.type.compatibleContent(o.type))throw new Gi("Cannot join "+e.type.name+" onto "+o.type.name)}function Us(o,e,n){let i=o.node(n);return Xd(i,e.node(n)),i}function Tn(o,e){let n=e.length-1;n>=0&&o.isText&&o.sameMarkup(e[n])?e[n]=o.withText(e[n].text+o.text):e.push(o)}function jr(o,e,n,i){let l=(e||o).node(n),h=0,f=e?e.index(n):l.childCount;o&&(h=o.index(n),o.depth>n?h++:o.textOffset&&(Tn(o.nodeAfter,i),h++));for(let p=h;p<f;p++)Tn(l.child(p),i);e&&e.depth==n&&e.textOffset&&Tn(e.nodeBefore,i)}function En(o,e){return o.type.checkContent(e),o.copy(e)}function _d(o,e,n,i,l){let h=o.depth>l&&Us(o,e,l+1),f=i.depth>l&&Us(n,i,l+1),p=[];return jr(null,o,l,p),h&&f&&e.index(l)==n.index(l)?(Xd(h,f),Tn(En(h,_d(o,e,n,i,l+1)),p)):(h&&Tn(En(h,Yi(o,e,l+1)),p),jr(e,n,l,p),f&&Tn(En(f,Yi(n,i,l+1)),p)),jr(i,null,l,p),new B(p)}function Yi(o,e,n){let i=[];if(jr(null,o,n,i),o.depth>n){let l=Us(o,e,n+1);Tn(En(l,Yi(o,e,n+1)),i)}return jr(e,null,n,i),new B(i)}function pm(o,e){let n=e.depth-o.openStart,l=e.node(n).copy(o.content);for(let h=n-1;h>=0;h--)l=e.node(h).copy(B.from(l));return{start:l.resolveNoCache(o.openStart+n),end:l.resolveNoCache(l.content.size-o.openEnd-n)}}class Qr{constructor(e,n,i){this.pos=e,this.path=n,this.parentOffset=i,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let i=this.pos-this.path[this.path.length-1],l=e.child(n);return i?e.child(n).cut(i):l}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let i=this.path[n*3],l=n==0?0:this.path[n*3-1]+1;for(let h=0;h<e;h++)l+=i.child(h).nodeSize;return l}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return ee.none;if(this.textOffset)return e.child(n).marks;let i=e.maybeChild(n-1),l=e.maybeChild(n);if(!i){let p=i;i=l,l=p}let h=i.marks;for(var f=0;f<h.length;f++)h[f].type.spec.inclusive===!1&&(!l||!h[f].isInSet(l.marks))&&(h=h[f--].removeFromSet(h));return h}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let i=n.marks,l=e.parent.maybeChild(e.index());for(var h=0;h<i.length;h++)i[h].type.spec.inclusive===!1&&(!l||!i[h].isInSet(l.marks))&&(i=i[h--].removeFromSet(i));return i}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let i=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);i>=0;i--)if(e.pos<=this.end(i)&&(!n||n(this.node(i))))return new Xi(this,e,i);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let i=[],l=0,h=n;for(let f=e;;){let{index:p,offset:y}=f.content.findIndex(h),b=h-y;if(i.push(f,p,l+y),!b||(f=f.child(p),f.isText))break;h=b-1,l+=y+1}return new Qr(n,i,h)}static resolveCached(e,n){let i=Vh.get(e);if(i)for(let h=0;h<i.elts.length;h++){let f=i.elts[h];if(f.pos==n)return f}else Vh.set(e,i=new mm);let l=i.elts[i.i]=Qr.resolve(e,n);return i.i=(i.i+1)%gm,l}}class mm{constructor(){this.elts=[],this.i=0}}const gm=12,Vh=new WeakMap;class Xi{constructor(e,n,i){this.$from=e,this.$to=n,this.depth=i}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ym=Object.create(null);let An=class Gs{constructor(e,n,i,l=ee.none){this.type=e,this.attrs=n,this.marks=l,this.content=i||B.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,i,l=0){this.content.nodesBetween(e,n,i,l,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,i,l){return this.content.textBetween(e,n,i,l)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,i){return this.type==e&&Ui(this.attrs,n||e.defaultAttrs||ym)&&ee.sameSet(this.marks,i||ee.none)}copy(e=null){return e==this.content?this:new Gs(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Gs(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,i=!1){if(e==n)return F.empty;let l=this.resolve(e),h=this.resolve(n),f=i?0:l.sharedDepth(n),p=l.start(f),b=l.node(f).content.cut(l.pos-p,h.pos-p);return new F(b,l.depth-f,h.depth-f)}replace(e,n,i){return um(this.resolve(e),this.resolve(n),i)}nodeAt(e){for(let n=this;;){let{index:i,offset:l}=n.content.findIndex(e);if(n=n.maybeChild(i),!n)return null;if(l==e||n.isText)return n;e-=l+1}}childAfter(e){let{index:n,offset:i}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:i}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:i}=this.content.findIndex(e);if(i<e)return{node:this.content.child(n),index:n,offset:i};let l=this.content.child(n-1);return{node:l,index:n-1,offset:i-l.nodeSize}}resolve(e){return Qr.resolveCached(this,e)}resolveNoCache(e){return Qr.resolve(this,e)}rangeHasMark(e,n,i){let l=!1;return n>e&&this.nodesBetween(e,n,h=>(i.isInSet(h.marks)&&(l=!0),!l)),l}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Zd(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,i=B.empty,l=0,h=i.childCount){let f=this.contentMatchAt(e).matchFragment(i,l,h),p=f&&f.matchFragment(this.content,n);if(!p||!p.validEnd)return!1;for(let y=l;y<h;y++)if(!this.type.allowsMarks(i.child(y).marks))return!1;return!0}canReplaceWith(e,n,i,l){if(l&&!this.type.allowsMarks(l))return!1;let h=this.contentMatchAt(e).matchType(i),f=h&&h.matchFragment(this.content,n);return f?f.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=ee.none;for(let n=0;n<this.marks.length;n++){let i=this.marks[n];i.type.checkAttrs(i.attrs),e=i.addToSet(e)}if(!ee.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let i;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");i=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,i)}let l=B.fromJSON(e,n.content),h=e.nodeType(n.type).create(n.attrs,l,i);return h.type.checkAttrs(h.attrs),h}};An.prototype.text=void 0;class _i extends An{constructor(e,n,i,l){if(super(e,n,null,l),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Zd(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new _i(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new _i(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Zd(o,e){for(let n=o.length-1;n>=0;n--)e=o[n].type.name+"("+e+")";return e}class Pn{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let i=new wm(e,n);if(i.next==null)return Pn.empty;let l=Qd(i);i.next&&i.err("Unexpected trailing text");let h=vm(Mm(l));return Om(h,i),h}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,i=e.childCount){let l=this;for(let h=n;l&&h<i;h++)l=l.matchType(e.child(h).type);return l}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let i=0;i<e.next.length;i++)if(this.next[n].type==e.next[i].type)return!0;return!1}fillBefore(e,n=!1,i=0){let l=[this];function h(f,p){let y=f.matchFragment(e,i);if(y&&(!n||y.validEnd))return B.from(p.map(b=>b.createAndFill()));for(let b=0;b<f.next.length;b++){let{type:S,next:O}=f.next[b];if(!(S.isText||S.hasRequiredAttrs())&&l.indexOf(O)==-1){l.push(O);let N=h(O,p.concat(S));if(N)return N}}return null}return h(this,[])}findWrapping(e){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==e)return this.wrapCache[i+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),i=[{match:this,type:null,via:null}];for(;i.length;){let l=i.shift(),h=l.match;if(h.matchType(e)){let f=[];for(let p=l;p.type;p=p.via)f.push(p.type);return f.reverse()}for(let f=0;f<h.next.length;f++){let{type:p,next:y}=h.next[f];!p.isLeaf&&!p.hasRequiredAttrs()&&!(p.name in n)&&(!l.type||y.validEnd)&&(i.push({match:p.contentMatch,type:p,via:l}),n[p.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(i){e.push(i);for(let l=0;l<i.next.length;l++)e.indexOf(i.next[l].next)==-1&&n(i.next[l].next)}return n(this),e.map((i,l)=>{let h=l+(i.validEnd?"*":" ")+" ";for(let f=0;f<i.next.length;f++)h+=(f?", ":"")+i.next[f].type.name+"->"+e.indexOf(i.next[f].next);return h}).join(`
`)}}Pn.empty=new Pn(!0);class wm{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Qd(o){let e=[];do e.push(bm(o));while(o.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function bm(o){let e=[];do e.push(km(o));while(o.next&&o.next!=")"&&o.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function km(o){let e=Cm(o);for(;;)if(o.eat("+"))e={type:"plus",expr:e};else if(o.eat("*"))e={type:"star",expr:e};else if(o.eat("?"))e={type:"opt",expr:e};else if(o.eat("{"))e=xm(o,e);else break;return e}function Fh(o){/\D/.test(o.next)&&o.err("Expected number, got '"+o.next+"'");let e=Number(o.next);return o.pos++,e}function xm(o,e){let n=Fh(o),i=n;return o.eat(",")&&(o.next!="}"?i=Fh(o):i=-1),o.eat("}")||o.err("Unclosed braced range"),{type:"range",min:n,max:i,expr:e}}function Sm(o,e){let n=o.nodeTypes,i=n[e];if(i)return[i];let l=[];for(let h in n){let f=n[h];f.isInGroup(e)&&l.push(f)}return l.length==0&&o.err("No node type or group '"+e+"' found"),l}function Cm(o){if(o.eat("(")){let e=Qd(o);return o.eat(")")||o.err("Missing closing paren"),e}else if(/\W/.test(o.next))o.err("Unexpected token '"+o.next+"'");else{let e=Sm(o,o.next).map(n=>(o.inline==null?o.inline=n.isInline:o.inline!=n.isInline&&o.err("Mixing inline and block content"),{type:"name",value:n}));return o.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Mm(o){let e=[[]];return l(h(o,0),n()),e;function n(){return e.push([])-1}function i(f,p,y){let b={term:y,to:p};return e[f].push(b),b}function l(f,p){f.forEach(y=>y.to=p)}function h(f,p){if(f.type=="choice")return f.exprs.reduce((y,b)=>y.concat(h(b,p)),[]);if(f.type=="seq")for(let y=0;;y++){let b=h(f.exprs[y],p);if(y==f.exprs.length-1)return b;l(b,p=n())}else if(f.type=="star"){let y=n();return i(p,y),l(h(f.expr,y),y),[i(y)]}else if(f.type=="plus"){let y=n();return l(h(f.expr,p),y),l(h(f.expr,y),y),[i(y)]}else{if(f.type=="opt")return[i(p)].concat(h(f.expr,p));if(f.type=="range"){let y=p;for(let b=0;b<f.min;b++){let S=n();l(h(f.expr,y),S),y=S}if(f.max==-1)l(h(f.expr,y),y);else for(let b=f.min;b<f.max;b++){let S=n();i(y,S),l(h(f.expr,y),S),y=S}return[i(y)]}else{if(f.type=="name")return[i(p,void 0,f.value)];throw new Error("Unknown expr type")}}}}function ef(o,e){return e-o}function Lh(o,e){let n=[];return i(e),n.sort(ef);function i(l){let h=o[l];if(h.length==1&&!h[0].term)return i(h[0].to);n.push(l);for(let f=0;f<h.length;f++){let{term:p,to:y}=h[f];!p&&n.indexOf(y)==-1&&i(y)}}}function vm(o){let e=Object.create(null);return n(Lh(o,0));function n(i){let l=[];i.forEach(f=>{o[f].forEach(({term:p,to:y})=>{if(!p)return;let b;for(let S=0;S<l.length;S++)l[S][0]==p&&(b=l[S][1]);Lh(o,y).forEach(S=>{b||l.push([p,b=[]]),b.indexOf(S)==-1&&b.push(S)})})});let h=e[i.join(",")]=new Pn(i.indexOf(o.length-1)>-1);for(let f=0;f<l.length;f++){let p=l[f][1].sort(ef);h.next.push({type:l[f][0],next:e[p.join(",")]||n(p)})}return h}}function Om(o,e){for(let n=0,i=[o];n<i.length;n++){let l=i[n],h=!l.validEnd,f=[];for(let p=0;p<l.next.length;p++){let{type:y,next:b}=l.next[p];f.push(y.name),h&&!(y.isText||y.hasRequiredAttrs())&&(h=!1),i.indexOf(b)==-1&&i.push(b)}h&&e.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function tf(o){let e=Object.create(null);for(let n in o){let i=o[n];if(!i.hasDefault)return null;e[n]=i.default}return e}function nf(o,e){let n=Object.create(null);for(let i in o){let l=e&&e[i];if(l===void 0){let h=o[i];if(h.hasDefault)l=h.default;else throw new RangeError("No value supplied for attribute "+i)}n[i]=l}return n}function rf(o,e,n,i){for(let l in e)if(!(l in o))throw new RangeError(`Unsupported attribute ${l} for ${n} of type ${l}`);for(let l in o){let h=o[l];h.validate&&h.validate(e[l])}}function of(o,e){let n=Object.create(null);if(e)for(let i in e)n[i]=new Dm(o,i,e[i]);return n}let qh=class sf{constructor(e,n,i){this.name=e,this.schema=n,this.spec=i,this.markSet=null,this.groups=i.group?i.group.split(" "):[],this.attrs=of(e,i.attrs),this.defaultAttrs=tf(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(i.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Pn.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:nf(this.attrs,e)}create(e=null,n,i){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new An(this,this.computeAttrs(e),B.from(n),ee.setFrom(i))}createChecked(e=null,n,i){return n=B.from(n),this.checkContent(n),new An(this,this.computeAttrs(e),n,ee.setFrom(i))}createAndFill(e=null,n,i){if(e=this.computeAttrs(e),n=B.from(n),n.size){let f=this.contentMatch.fillBefore(n);if(!f)return null;n=f.append(n)}let l=this.contentMatch.matchFragment(n),h=l&&l.fillBefore(B.empty,!0);return h?new An(this,e,n.append(h),ee.setFrom(i)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let i=0;i<e.childCount;i++)if(!this.allowsMarks(e.child(i).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){rf(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let i=0;i<e.length;i++)this.allowsMarkType(e[i].type)?n&&n.push(e[i]):n||(n=e.slice(0,i));return n?n.length?n:ee.none:e}static compile(e,n){let i=Object.create(null);e.forEach((h,f)=>i[h]=new sf(h,n,f));let l=n.spec.topNode||"doc";if(!i[l])throw new RangeError("Schema is missing its top node type ('"+l+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let h in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};function Nm(o,e,n){let i=n.split("|");return l=>{let h=l===null?"null":typeof l;if(i.indexOf(h)<0)throw new RangeError(`Expected value of type ${i} for attribute ${e} on type ${o}, got ${h}`)}}class Dm{constructor(e,n,i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default,this.validate=typeof i.validate=="string"?Nm(e,n,i.validate):i.validate}get isRequired(){return!this.hasDefault}}class ao{constructor(e,n,i,l){this.name=e,this.rank=n,this.schema=i,this.spec=l,this.attrs=of(e,l.attrs),this.excluded=null;let h=tf(this.attrs);this.instance=h?new ee(this,h):null}create(e=null){return!e&&this.instance?this.instance:new ee(this,nf(this.attrs,e))}static compile(e,n){let i=Object.create(null),l=0;return e.forEach((h,f)=>i[h]=new ao(h,l++,n,f)),i}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){rf(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class lf{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let l in e)n[l]=e[l];n.nodes=Se.from(e.nodes),n.marks=Se.from(e.marks||{}),this.nodes=qh.compile(this.spec.nodes,this),this.marks=ao.compile(this.spec.marks,this);let i=Object.create(null);for(let l in this.nodes){if(l in this.marks)throw new RangeError(l+" can not be both a node and a mark");let h=this.nodes[l],f=h.spec.content||"",p=h.spec.marks;if(h.contentMatch=i[f]||(i[f]=Pn.parse(f,this.nodes)),h.inlineContent=h.contentMatch.inlineContent,h.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!h.isInline||!h.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=h}h.markSet=p=="_"?null:p?$h(this,p.split(" ")):p==""||!h.inlineContent?[]:null}for(let l in this.marks){let h=this.marks[l],f=h.spec.excludes;h.excluded=f==null?[h]:f==""?[]:$h(this,f.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,i,l){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof qh){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,i,l)}text(e,n){let i=this.nodes.text;return new _i(i,i.defaultAttrs,e,ee.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return An.fromJSON(this,e)}markFromJSON(e){return ee.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function $h(o,e){let n=[];for(let i=0;i<e.length;i++){let l=e[i],h=o.marks[l],f=h;if(h)n.push(h);else for(let p in o.marks){let y=o.marks[p];(l=="_"||y.spec.group&&y.spec.group.split(" ").indexOf(l)>-1)&&n.push(f=y)}if(!f)throw new SyntaxError("Unknown mark type: '"+e[i]+"'")}return n}function Tm(o){return o.tag!=null}function Em(o){return o.style!=null}class cr{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let i=this.matchedStyles=[];n.forEach(l=>{if(Tm(l))this.tags.push(l);else if(Em(l)){let h=/[^=]*/.exec(l.style)[0];i.indexOf(h)<0&&i.push(h),this.styles.push(l)}}),this.normalizeLists=!this.tags.some(l=>{if(!/^(ul|ol)\b/.test(l.tag)||!l.node)return!1;let h=e.nodes[l.node];return h.contentMatch.matchType(h)})}parse(e,n={}){let i=new Jh(this,n,!1);return i.addAll(e,ee.none,n.from,n.to),i.finish()}parseSlice(e,n={}){let i=new Jh(this,n,!0);return i.addAll(e,ee.none,n.from,n.to),F.maxOpen(i.finish())}matchTag(e,n,i){for(let l=i?this.tags.indexOf(i)+1:0;l<this.tags.length;l++){let h=this.tags[l];if(Rm(e,h.tag)&&(h.namespace===void 0||e.namespaceURI==h.namespace)&&(!h.context||n.matchesContext(h.context))){if(h.getAttrs){let f=h.getAttrs(e);if(f===!1)continue;h.attrs=f||void 0}return h}}}matchStyle(e,n,i,l){for(let h=l?this.styles.indexOf(l)+1:0;h<this.styles.length;h++){let f=this.styles[h],p=f.style;if(!(p.indexOf(e)!=0||f.context&&!i.matchesContext(f.context)||p.length>e.length&&(p.charCodeAt(e.length)!=61||p.slice(e.length+1)!=n))){if(f.getAttrs){let y=f.getAttrs(n);if(y===!1)continue;f.attrs=y||void 0}return f}}}static schemaRules(e){let n=[];function i(l){let h=l.priority==null?50:l.priority,f=0;for(;f<n.length;f++){let p=n[f];if((p.priority==null?50:p.priority)<h)break}n.splice(f,0,l)}for(let l in e.marks){let h=e.marks[l].spec.parseDOM;h&&h.forEach(f=>{i(f=Hh(f)),f.mark||f.ignore||f.clearMark||(f.mark=l)})}for(let l in e.nodes){let h=e.nodes[l].spec.parseDOM;h&&h.forEach(f=>{i(f=Hh(f)),f.node||f.ignore||f.mark||(f.node=l)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new cr(e,cr.schemaRules(e)))}}const af={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Am={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},cf={ol:!0,ul:!0},Zi=1,Qi=2,Ur=4;function Wh(o,e,n){return e!=null?(e?Zi:0)|(e==="full"?Qi:0):o&&o.whitespace=="pre"?Zi|Qi:n&~Ur}class Fi{constructor(e,n,i,l,h,f){this.type=e,this.attrs=n,this.marks=i,this.solid=l,this.options=f,this.content=[],this.activeMarks=ee.none,this.match=h||(f&Ur?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(B.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let i=this.type.contentMatch,l;return(l=i.findWrapping(e.type))?(this.match=i,l):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Zi)){let i=this.content[this.content.length-1],l;if(i&&i.isText&&(l=/[ \t\r\n\u000c]+$/.exec(i.text))){let h=i;i.text.length==l[0].length?this.content.pop():this.content[this.content.length-1]=h.withText(h.text.slice(0,h.text.length-l[0].length))}}let n=B.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(B.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!af.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Jh{constructor(e,n,i){this.parser=e,this.options=n,this.isOpen=i,this.open=0;let l=n.topNode,h,f=Wh(null,n.preserveWhitespace,0)|(i?Ur:0);l?h=new Fi(l.type,l.attrs,ee.none,!0,n.topMatch||l.type.contentMatch,f):i?h=new Fi(null,null,ee.none,!0,null,f):h=new Fi(e.schema.topNodeType,null,ee.none,!0,null,f),this.nodes=[h],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let i=e.nodeValue,l=this.top;if(l.options&Qi||l.inlineContext(e)||/[^ \t\r\n\u000c]/.test(i)){if(l.options&Zi)l.options&Qi?i=i.replace(/\r\n?/g,`
`):i=i.replace(/\r?\n|\r/g," ");else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){let h=l.content[l.content.length-1],f=e.previousSibling;(!h||f&&f.nodeName=="BR"||h.isText&&/[ \t\r\n\u000c]$/.test(h.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i),n),this.findInText(e)}else this.findInside(e)}addElement(e,n,i){let l=e.nodeName.toLowerCase(),h;cf.hasOwnProperty(l)&&this.parser.normalizeLists&&Im(e);let f=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(h=this.parser.matchTag(e,this,i));if(f?f.ignore:Am.hasOwnProperty(l))this.findInside(e),this.ignoreFallback(e,n);else if(!f||f.skip||f.closeParent){f&&f.closeParent?this.open=Math.max(0,this.open-1):f&&f.skip.nodeType&&(e=f.skip);let p,y=this.top,b=this.needsBlock;if(af.hasOwnProperty(l))y.content.length&&y.content[0].isInline&&this.open&&(this.open--,y=this.top),p=!0,y.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);return}let S=f&&f.skip?n:this.readStyles(e,n);S&&this.addAll(e,S),p&&this.sync(y),this.needsBlock=b}else{let p=this.readStyles(e,n);p&&this.addElementByRule(e,f,p,f.consuming===!1?h:void 0)}}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n)}readStyles(e,n){let i=e.style;if(i&&i.length)for(let l=0;l<this.parser.matchedStyles.length;l++){let h=this.parser.matchedStyles[l],f=i.getPropertyValue(h);if(f)for(let p=void 0;;){let y=this.parser.matchStyle(h,f,this,p);if(!y)break;if(y.ignore)return null;if(y.clearMark?n=n.filter(b=>!y.clearMark(b)):n=n.concat(this.parser.schema.marks[y.mark].create(y.attrs)),y.consuming===!1)p=y;else break}}return n}addElementByRule(e,n,i,l){let h,f;if(n.node)if(f=this.parser.schema.nodes[n.node],f.isLeaf)this.insertNode(f.create(n.attrs),i)||this.leafFallback(e,i);else{let y=this.enter(f,n.attrs||null,i,n.preserveWhitespace);y&&(h=!0,i=y)}else{let y=this.parser.schema.marks[n.mark];i=i.concat(y.create(n.attrs))}let p=this.top;if(f&&f.isLeaf)this.findInside(e);else if(l)this.addElement(e,i,l);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(y=>this.insertNode(y,i));else{let y=e;typeof n.contentElement=="string"?y=e.querySelector(n.contentElement):typeof n.contentElement=="function"?y=n.contentElement(e):n.contentElement&&(y=n.contentElement),this.findAround(e,y,!0),this.addAll(y,i),this.findAround(e,y,!1)}h&&this.sync(p)&&this.open--}addAll(e,n,i,l){let h=i||0;for(let f=i?e.childNodes[i]:e.firstChild,p=l==null?null:e.childNodes[l];f!=p;f=f.nextSibling,++h)this.findAtPoint(e,h),this.addDOM(f,n);this.findAtPoint(e,h)}findPlace(e,n){let i,l;for(let h=this.open;h>=0;h--){let f=this.nodes[h],p=f.findWrapping(e);if(p&&(!i||i.length>p.length)&&(i=p,l=f,!p.length)||f.solid)break}if(!i)return null;this.sync(l);for(let h=0;h<i.length;h++)n=this.enterInner(i[h],null,n,!1);return n}insertNode(e,n){if(e.isInline&&this.needsBlock&&!this.top.type){let l=this.textblockFromContext();l&&(n=this.enterInner(l,null,n))}let i=this.findPlace(e,n);if(i){this.closeExtra();let l=this.top;l.match&&(l.match=l.match.matchType(e.type));let h=ee.none;for(let f of i.concat(e.marks))(l.type?l.type.allowsMarkType(f.type):Kh(f.type,e.type))&&(h=f.addToSet(h));return l.content.push(e.mark(h)),!0}return!1}enter(e,n,i,l){let h=this.findPlace(e.create(n),i);return h&&(h=this.enterInner(e,n,i,!0,l)),h}enterInner(e,n,i,l=!1,h){this.closeExtra();let f=this.top;f.match=f.match&&f.match.matchType(e);let p=Wh(e,h,f.options);f.options&Ur&&f.content.length==0&&(p|=Ur);let y=ee.none;return i=i.filter(b=>(f.type?f.type.allowsMarkType(b.type):Kh(b.type,e))?(y=b.addToSet(y),!1):!0),this.nodes.push(new Fi(e,n,y,l,null,p)),this.open++,i}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let n=this.open;n>=0;n--)if(this.nodes[n]==e)return this.open=n,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let i=this.nodes[n].content;for(let l=i.length-1;l>=0;l--)e+=i[l].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==e&&this.find[i].offset==n&&(this.find[i].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,i){if(e!=n&&this.find)for(let l=0;l<this.find.length;l++)this.find[l].pos==null&&e.nodeType==1&&e.contains(this.find[l].node)&&n.compareDocumentPosition(this.find[l].node)&(i?2:4)&&(this.find[l].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),i=this.options.context,l=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),h=-(i?i.depth+1:0)+(l?0:1),f=(p,y)=>{for(;p>=0;p--){let b=n[p];if(b==""){if(p==n.length-1||p==0)continue;for(;y>=h;y--)if(f(p-1,y))return!0;return!1}else{let S=y>0||y==0&&l?this.nodes[y].type:i&&y>=h?i.node(y-h).type:null;if(!S||S.name!=b&&!S.isInGroup(b))return!1;y--}}return!0};return f(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(i&&i.isTextblock&&i.defaultAttrs)return i}for(let n in this.parser.schema.nodes){let i=this.parser.schema.nodes[n];if(i.isTextblock&&i.defaultAttrs)return i}}}function Im(o){for(let e=o.firstChild,n=null;e;e=e.nextSibling){let i=e.nodeType==1?e.nodeName.toLowerCase():null;i&&cf.hasOwnProperty(i)&&n?(n.appendChild(e),e=n):i=="li"?n=e:i&&(n=null)}}function Rm(o,e){return(o.matches||o.msMatchesSelector||o.webkitMatchesSelector||o.mozMatchesSelector).call(o,e)}function Hh(o){let e={};for(let n in o)e[n]=o[n];return e}function Kh(o,e){let n=e.schema.nodes;for(let i in n){let l=n[i];if(!l.allowsMarkType(o))continue;let h=[],f=p=>{h.push(p);for(let y=0;y<p.edgeCount;y++){let{type:b,next:S}=p.edge(y);if(b==e||h.indexOf(S)<0&&f(S))return!0}};if(f(l.contentMatch))return!0}}class pr{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},i){i||(i=Ns(n).createDocumentFragment());let l=i,h=[];return e.forEach(f=>{if(h.length||f.marks.length){let p=0,y=0;for(;p<h.length&&y<f.marks.length;){let b=f.marks[y];if(!this.marks[b.type.name]){y++;continue}if(!b.eq(h[p][0])||b.type.spec.spanning===!1)break;p++,y++}for(;p<h.length;)l=h.pop()[1];for(;y<f.marks.length;){let b=f.marks[y++],S=this.serializeMark(b,f.isInline,n);S&&(h.push([b,l]),l.appendChild(S.dom),l=S.contentDOM||S.dom)}}l.appendChild(this.serializeNodeInner(f,n))}),i}serializeNodeInner(e,n){let{dom:i,contentDOM:l}=Ji(Ns(n),this.nodes[e.type.name](e),null,e.attrs);if(l){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,l)}return i}serializeNode(e,n={}){let i=this.serializeNodeInner(e,n);for(let l=e.marks.length-1;l>=0;l--){let h=this.serializeMark(e.marks[l],e.isInline,n);h&&((h.contentDOM||h.dom).appendChild(i),i=h.dom)}return i}serializeMark(e,n,i={}){let l=this.marks[e.type.name];return l&&Ji(Ns(i),l(e,n),null,e.attrs)}static renderSpec(e,n,i=null,l){return Ji(e,n,i,l)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new pr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=jh(e.nodes);return n.text||(n.text=i=>i.text),n}static marksFromSchema(e){return jh(e.marks)}}function jh(o){let e={};for(let n in o){let i=o[n].spec.toDOM;i&&(e[n]=i)}return e}function Ns(o){return o.document||window.document}const Uh=new WeakMap;function zm(o){let e=Uh.get(o);return e===void 0&&Uh.set(o,e=Pm(o)),e}function Pm(o){let e=null;function n(i){if(i&&typeof i=="object")if(Array.isArray(i))if(typeof i[0]=="string")e||(e=[]),e.push(i);else for(let l=0;l<i.length;l++)n(i[l]);else for(let l in i)n(i[l])}return n(o),e}function Ji(o,e,n,i){if(typeof e=="string")return{dom:o.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let l=e[0],h;if(typeof l!="string")throw new RangeError("Invalid array passed to renderSpec");if(i&&(h=zm(i))&&h.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let f=l.indexOf(" ");f>0&&(n=l.slice(0,f),l=l.slice(f+1));let p,y=n?o.createElementNS(n,l):o.createElement(l),b=e[1],S=1;if(b&&typeof b=="object"&&b.nodeType==null&&!Array.isArray(b)){S=2;for(let O in b)if(b[O]!=null){let N=O.indexOf(" ");N>0?y.setAttributeNS(O.slice(0,N),O.slice(N+1),b[O]):y.setAttribute(O,b[O])}}for(let O=S;O<e.length;O++){let N=e[O];if(N===0){if(O<e.length-1||O>S)throw new RangeError("Content hole must be the only child of its parent node");return{dom:y,contentDOM:y}}else{let{dom:E,contentDOM:T}=Ji(o,N,n,i);if(y.appendChild(E),T){if(p)throw new RangeError("Multiple content holes");p=T}}}return{dom:y,contentDOM:p}}const hf=65535,df=Math.pow(2,16);function Bm(o,e){return o+e*df}function Gh(o){return o&hf}function Vm(o){return(o-(o&hf))/df}const ff=1,uf=2,Hi=4,pf=8;class Ys{constructor(e,n,i){this.pos=e,this.delInfo=n,this.recover=i}get deleted(){return(this.delInfo&pf)>0}get deletedBefore(){return(this.delInfo&(ff|Hi))>0}get deletedAfter(){return(this.delInfo&(uf|Hi))>0}get deletedAcross(){return(this.delInfo&Hi)>0}}class Qe{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Qe.empty)return Qe.empty}recover(e){let n=0,i=Gh(e);if(!this.inverted)for(let l=0;l<i;l++)n+=this.ranges[l*3+2]-this.ranges[l*3+1];return this.ranges[i*3]+n+Vm(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,i){let l=0,h=this.inverted?2:1,f=this.inverted?1:2;for(let p=0;p<this.ranges.length;p+=3){let y=this.ranges[p]-(this.inverted?l:0);if(y>e)break;let b=this.ranges[p+h],S=this.ranges[p+f],O=y+b;if(e<=O){let N=b?e==y?-1:e==O?1:n:n,E=y+l+(N<0?0:S);if(i)return E;let T=e==(n<0?y:O)?null:Bm(p/3,e-y),z=e==y?uf:e==O?ff:Hi;return(n<0?e!=y:e!=O)&&(z|=pf),new Ys(E,z,T)}l+=S-b}return i?e+l:new Ys(e+l,0,null)}touches(e,n){let i=0,l=Gh(n),h=this.inverted?2:1,f=this.inverted?1:2;for(let p=0;p<this.ranges.length;p+=3){let y=this.ranges[p]-(this.inverted?i:0);if(y>e)break;let b=this.ranges[p+h],S=y+b;if(e<=S&&p==l*3)return!0;i+=this.ranges[p+f]-b}return!1}forEach(e){let n=this.inverted?2:1,i=this.inverted?1:2;for(let l=0,h=0;l<this.ranges.length;l+=3){let f=this.ranges[l],p=f-(this.inverted?h:0),y=f+(this.inverted?0:h),b=this.ranges[l+n],S=this.ranges[l+i];e(p,p+b,y,y+S),h+=S-b}}invert(){return new Qe(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Qe.empty:new Qe(e<0?[0,-e,0]:[0,0,e])}}Qe.empty=new Qe([]);class or{constructor(e=[],n,i=0,l=e.length){this.maps=e,this.mirror=n,this.from=i,this.to=l}slice(e=0,n=this.maps.length){return new or(this.maps,this.mirror,e,n)}copy(){return new or(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,n){this.to=this.maps.push(e),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(e){for(let n=0,i=this.maps.length;n<e.maps.length;n++){let l=e.getMirror(n);this.appendMap(e.maps[n],l!=null&&l<n?i+l:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,i=this.maps.length+e.maps.length;n>=0;n--){let l=e.getMirror(n);this.appendMap(e.maps[n].invert(),l!=null&&l>n?i-l-1:void 0)}}invert(){let e=new or;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let i=this.from;i<this.to;i++)e=this.maps[i].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,i){let l=0;for(let h=this.from;h<this.to;h++){let f=this.maps[h],p=f.mapResult(e,n);if(p.recover!=null){let y=this.getMirror(h);if(y!=null&&y>h&&y<this.to){h=y,e=this.maps[y].recover(p.recover);continue}}l|=p.delInfo,e=p.pos}return i?e:new Ys(e,l,null)}}const Ds=Object.create(null);class Ie{getMap(){return Qe.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let i=Ds[n.stepType];if(!i)throw new RangeError(`No step type ${n.stepType} defined`);return i.fromJSON(e,n)}static jsonID(e,n){if(e in Ds)throw new RangeError("Duplicate use of step JSON ID "+e);return Ds[e]=n,n.prototype.jsonID=e,n}}class fe{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new fe(e,null)}static fail(e){return new fe(null,e)}static fromReplace(e,n,i,l){try{return fe.ok(e.replace(n,i,l))}catch(h){if(h instanceof Gi)return fe.fail(h.message);throw h}}}function ml(o,e,n){let i=[];for(let l=0;l<o.childCount;l++){let h=o.child(l);h.content.size&&(h=h.copy(ml(h.content,e,h))),h.isInline&&(h=e(h,n,l)),i.push(h)}return B.fromArray(i)}class rn extends Ie{constructor(e,n,i){super(),this.from=e,this.to=n,this.mark=i}apply(e){let n=e.slice(this.from,this.to),i=e.resolve(this.from),l=i.node(i.sharedDepth(this.to)),h=new F(ml(n.content,(f,p)=>!f.isAtom||!p.type.allowsMarkType(this.mark.type)?f:f.mark(this.mark.addToSet(f.marks)),l),n.openStart,n.openEnd);return fe.fromReplace(e,this.from,this.to,h)}invert(){return new Ct(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),i=e.mapResult(this.to,-1);return n.deleted&&i.deleted||n.pos>=i.pos?null:new rn(n.pos,i.pos,this.mark)}merge(e){return e instanceof rn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new rn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new rn(n.from,n.to,e.markFromJSON(n.mark))}}Ie.jsonID("addMark",rn);class Ct extends Ie{constructor(e,n,i){super(),this.from=e,this.to=n,this.mark=i}apply(e){let n=e.slice(this.from,this.to),i=new F(ml(n.content,l=>l.mark(this.mark.removeFromSet(l.marks)),e),n.openStart,n.openEnd);return fe.fromReplace(e,this.from,this.to,i)}invert(){return new rn(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),i=e.mapResult(this.to,-1);return n.deleted&&i.deleted||n.pos>=i.pos?null:new Ct(n.pos,i.pos,this.mark)}merge(e){return e instanceof Ct&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ct(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ct(n.from,n.to,e.markFromJSON(n.mark))}}Ie.jsonID("removeMark",Ct);class on extends Ie{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fe.fail("No node at mark step's position");let i=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return fe.fromReplace(e,this.pos,this.pos+1,new F(B.from(i),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let i=this.mark.addToSet(n.marks);if(i.length==n.marks.length){for(let l=0;l<n.marks.length;l++)if(!n.marks[l].isInSet(i))return new on(this.pos,n.marks[l]);return new on(this.pos,this.mark)}}return new hr(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new on(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new on(n.pos,e.markFromJSON(n.mark))}}Ie.jsonID("addNodeMark",on);class hr extends Ie{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fe.fail("No node at mark step's position");let i=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return fe.fromReplace(e,this.pos,this.pos+1,new F(B.from(i),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new on(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new hr(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new hr(n.pos,e.markFromJSON(n.mark))}}Ie.jsonID("removeNodeMark",hr);class Ee extends Ie{constructor(e,n,i,l=!1){super(),this.from=e,this.to=n,this.slice=i,this.structure=l}apply(e){return this.structure&&Xs(e,this.from,this.to)?fe.fail("Structure replace would overwrite content"):fe.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Qe([this.from,this.to-this.from,this.slice.size])}invert(e){return new Ee(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),i=e.mapResult(this.to,-1);return n.deletedAcross&&i.deletedAcross?null:new Ee(n.pos,Math.max(n.pos,i.pos),this.slice)}merge(e){if(!(e instanceof Ee)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?F.empty:new F(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Ee(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?F.empty:new F(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Ee(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Ee(n.from,n.to,F.fromJSON(e,n.slice),!!n.structure)}}Ie.jsonID("replace",Ee);class ve extends Ie{constructor(e,n,i,l,h,f,p=!1){super(),this.from=e,this.to=n,this.gapFrom=i,this.gapTo=l,this.slice=h,this.insert=f,this.structure=p}apply(e){if(this.structure&&(Xs(e,this.from,this.gapFrom)||Xs(e,this.gapTo,this.to)))return fe.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return fe.fail("Gap is not a flat range");let i=this.slice.insertAt(this.insert,n.content);return i?fe.fromReplace(e,this.from,this.to,i):fe.fail("Content does not fit in gap")}getMap(){return new Qe([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ve(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),i=e.mapResult(this.to,-1),l=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),h=this.to==this.gapTo?i.pos:e.map(this.gapTo,1);return n.deletedAcross&&i.deletedAcross||l<n.pos||h>i.pos?null:new ve(n.pos,i.pos,l,h,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ve(n.from,n.to,n.gapFrom,n.gapTo,F.fromJSON(e,n.slice),n.insert,!!n.structure)}}Ie.jsonID("replaceAround",ve);function Xs(o,e,n){let i=o.resolve(e),l=n-e,h=i.depth;for(;l>0&&h>0&&i.indexAfter(h)==i.node(h).childCount;)h--,l--;if(l>0){let f=i.node(h).maybeChild(i.indexAfter(h));for(;l>0;){if(!f||f.isLeaf)return!0;f=f.firstChild,l--}}return!1}function Fm(o,e,n,i){let l=[],h=[],f,p;o.doc.nodesBetween(e,n,(y,b,S)=>{if(!y.isInline)return;let O=y.marks;if(!i.isInSet(O)&&S.type.allowsMarkType(i.type)){let N=Math.max(b,e),E=Math.min(b+y.nodeSize,n),T=i.addToSet(O);for(let z=0;z<O.length;z++)O[z].isInSet(T)||(f&&f.to==N&&f.mark.eq(O[z])?f.to=E:l.push(f=new Ct(N,E,O[z])));p&&p.to==N?p.to=E:h.push(p=new rn(N,E,i))}}),l.forEach(y=>o.step(y)),h.forEach(y=>o.step(y))}function Lm(o,e,n,i){let l=[],h=0;o.doc.nodesBetween(e,n,(f,p)=>{if(!f.isInline)return;h++;let y=null;if(i instanceof ao){let b=f.marks,S;for(;S=i.isInSet(b);)(y||(y=[])).push(S),b=S.removeFromSet(b)}else i?i.isInSet(f.marks)&&(y=[i]):y=f.marks;if(y&&y.length){let b=Math.min(p+f.nodeSize,n);for(let S=0;S<y.length;S++){let O=y[S],N;for(let E=0;E<l.length;E++){let T=l[E];T.step==h-1&&O.eq(l[E].style)&&(N=T)}N?(N.to=b,N.step=h):l.push({style:O,from:Math.max(p,e),to:b,step:h})}}}),l.forEach(f=>o.step(new Ct(f.from,f.to,f.style)))}function gl(o,e,n,i=n.contentMatch,l=!0){let h=o.doc.nodeAt(e),f=[],p=e+1;for(let y=0;y<h.childCount;y++){let b=h.child(y),S=p+b.nodeSize,O=i.matchType(b.type);if(!O)f.push(new Ee(p,S,F.empty));else{i=O;for(let N=0;N<b.marks.length;N++)n.allowsMarkType(b.marks[N].type)||o.step(new Ct(p,S,b.marks[N]));if(l&&b.isText&&n.whitespace!="pre"){let N,E=/\r?\n|\r/g,T;for(;N=E.exec(b.text);)T||(T=new F(B.from(n.schema.text(" ",n.allowedMarks(b.marks))),0,0)),f.push(new Ee(p+N.index,p+N.index+N[0].length,T))}}p=S}if(!i.validEnd){let y=i.fillBefore(B.empty,!0);o.replace(p,p,new F(y,0,0))}for(let y=f.length-1;y>=0;y--)o.step(f[y])}function qm(o,e,n){return(e==0||o.canReplace(e,o.childCount))&&(n==o.childCount||o.canReplace(0,n))}function li(o){let n=o.parent.content.cutByIndex(o.startIndex,o.endIndex);for(let i=o.depth;;--i){let l=o.$from.node(i),h=o.$from.index(i),f=o.$to.indexAfter(i);if(i<o.depth&&l.canReplace(h,f,n))return i;if(i==0||l.type.spec.isolating||!qm(l,h,f))break}return null}function $m(o,e,n){let{$from:i,$to:l,depth:h}=e,f=i.before(h+1),p=l.after(h+1),y=f,b=p,S=B.empty,O=0;for(let T=h,z=!1;T>n;T--)z||i.index(T)>0?(z=!0,S=B.from(i.node(T).copy(S)),O++):y--;let N=B.empty,E=0;for(let T=h,z=!1;T>n;T--)z||l.after(T+1)<l.end(T)?(z=!0,N=B.from(l.node(T).copy(N)),E++):b++;o.step(new ve(y,b,f,p,new F(S.append(N),O,E),S.size-O,!0))}function yl(o,e,n=null,i=o){let l=Wm(o,e),h=l&&Jm(i,e);return h?l.map(Yh).concat({type:e,attrs:n}).concat(h.map(Yh)):null}function Yh(o){return{type:o,attrs:null}}function Wm(o,e){let{parent:n,startIndex:i,endIndex:l}=o,h=n.contentMatchAt(i).findWrapping(e);if(!h)return null;let f=h.length?h[0]:e;return n.canReplaceWith(i,l,f)?h:null}function Jm(o,e){let{parent:n,startIndex:i,endIndex:l}=o,h=n.child(i),f=e.contentMatch.findWrapping(h.type);if(!f)return null;let y=(f.length?f[f.length-1]:e).contentMatch;for(let b=i;y&&b<l;b++)y=y.matchType(n.child(b).type);return!y||!y.validEnd?null:f}function Hm(o,e,n){let i=B.empty;for(let f=n.length-1;f>=0;f--){if(i.size){let p=n[f].type.contentMatch.matchFragment(i);if(!p||!p.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=B.from(n[f].type.create(n[f].attrs,i))}let l=e.start,h=e.end;o.step(new ve(l,h,l,h,new F(i,0,0),n.length,!0))}function Km(o,e,n,i,l){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let h=o.steps.length;o.doc.nodesBetween(e,n,(f,p)=>{let y=typeof l=="function"?l(f):l;if(f.isTextblock&&!f.hasMarkup(i,y)&&jm(o.doc,o.mapping.slice(h).map(p),i)){let b=null;if(i.schema.linebreakReplacement){let E=i.whitespace=="pre",T=!!i.contentMatch.matchType(i.schema.linebreakReplacement);E&&!T?b=!1:!E&&T&&(b=!0)}b===!1&&gf(o,f,p,h),gl(o,o.mapping.slice(h).map(p,1),i,void 0,b===null);let S=o.mapping.slice(h),O=S.map(p,1),N=S.map(p+f.nodeSize,1);return o.step(new ve(O,N,O+1,N-1,new F(B.from(i.create(y,null,f.marks)),0,0),1,!0)),b===!0&&mf(o,f,p,h),!1}})}function mf(o,e,n,i){e.forEach((l,h)=>{if(l.isText){let f,p=/\r?\n|\r/g;for(;f=p.exec(l.text);){let y=o.mapping.slice(i).map(n+1+h+f.index);o.replaceWith(y,y+1,e.type.schema.linebreakReplacement.create())}}})}function gf(o,e,n,i){e.forEach((l,h)=>{if(l.type==l.type.schema.linebreakReplacement){let f=o.mapping.slice(i).map(n+1+h);o.replaceWith(f,f+1,e.type.schema.text(`
`))}})}function jm(o,e,n){let i=o.resolve(e),l=i.index();return i.parent.canReplaceWith(l,l+1,n)}function Um(o,e,n,i,l){let h=o.doc.nodeAt(e);if(!h)throw new RangeError("No node at given position");n||(n=h.type);let f=n.create(i,null,l||h.marks);if(h.isLeaf)return o.replaceWith(e,e+h.nodeSize,f);if(!n.validContent(h.content))throw new RangeError("Invalid content for node type "+n.name);o.step(new ve(e,e+h.nodeSize,e+1,e+h.nodeSize-1,new F(B.from(f),0,0),1,!0))}function sr(o,e,n=1,i){let l=o.resolve(e),h=l.depth-n,f=i&&i[i.length-1]||l.parent;if(h<0||l.parent.type.spec.isolating||!l.parent.canReplace(l.index(),l.parent.childCount)||!f.type.validContent(l.parent.content.cutByIndex(l.index(),l.parent.childCount)))return!1;for(let b=l.depth-1,S=n-2;b>h;b--,S--){let O=l.node(b),N=l.index(b);if(O.type.spec.isolating)return!1;let E=O.content.cutByIndex(N,O.childCount),T=i&&i[S+1];T&&(E=E.replaceChild(0,T.type.create(T.attrs)));let z=i&&i[S]||O;if(!O.canReplace(N+1,O.childCount)||!z.type.validContent(E))return!1}let p=l.indexAfter(h),y=i&&i[0];return l.node(h).canReplaceWith(p,p,y?y.type:l.node(h+1).type)}function Gm(o,e,n=1,i){let l=o.doc.resolve(e),h=B.empty,f=B.empty;for(let p=l.depth,y=l.depth-n,b=n-1;p>y;p--,b--){h=B.from(l.node(p).copy(h));let S=i&&i[b];f=B.from(S?S.type.create(S.attrs,f):l.node(p).copy(f))}o.step(new Ee(e,e,new F(h.append(f),n,n),!0))}function mr(o,e){let n=o.resolve(e),i=n.index();return yf(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(i,i+1)}function Ym(o,e){e.content.size||o.type.compatibleContent(e.type);let n=o.contentMatchAt(o.childCount),{linebreakReplacement:i}=o.type.schema;for(let l=0;l<e.childCount;l++){let h=e.child(l),f=h.type==i?o.type.schema.nodes.text:h.type;if(n=n.matchType(f),!n||!o.type.allowsMarks(h.marks))return!1}return n.validEnd}function yf(o,e){return!!(o&&e&&!o.isLeaf&&Ym(o,e))}function wf(o,e,n=-1){let i=o.resolve(e);for(let l=i.depth;;l--){let h,f,p=i.index(l);if(l==i.depth?(h=i.nodeBefore,f=i.nodeAfter):n>0?(h=i.node(l+1),p++,f=i.node(l).maybeChild(p)):(h=i.node(l).maybeChild(p-1),f=i.node(l+1)),h&&!h.isTextblock&&yf(h,f)&&i.node(l).canReplace(p,p+1))return e;if(l==0)break;e=n<0?i.before(l):i.after(l)}}function Xm(o,e,n){let i=null,{linebreakReplacement:l}=o.doc.type.schema,h=o.doc.resolve(e-n),f=h.node().type;if(l&&f.inlineContent){let S=f.whitespace=="pre",O=!!f.contentMatch.matchType(l);S&&!O?i=!1:!S&&O&&(i=!0)}let p=o.steps.length;if(i===!1){let S=o.doc.resolve(e+n);gf(o,S.node(),S.before(),p)}f.inlineContent&&gl(o,e+n-1,f,h.node().contentMatchAt(h.index()),i==null);let y=o.mapping.slice(p),b=y.map(e-n);if(o.step(new Ee(b,y.map(e+n,-1),F.empty,!0)),i===!0){let S=o.doc.resolve(b);mf(o,S.node(),S.before(),o.steps.length)}return o}function _m(o,e,n){let i=o.resolve(e);if(i.parent.canReplaceWith(i.index(),i.index(),n))return e;if(i.parentOffset==0)for(let l=i.depth-1;l>=0;l--){let h=i.index(l);if(i.node(l).canReplaceWith(h,h,n))return i.before(l+1);if(h>0)return null}if(i.parentOffset==i.parent.content.size)for(let l=i.depth-1;l>=0;l--){let h=i.indexAfter(l);if(i.node(l).canReplaceWith(h,h,n))return i.after(l+1);if(h<i.node(l).childCount)return null}return null}function bf(o,e,n){let i=o.resolve(e);if(!n.content.size)return e;let l=n.content;for(let h=0;h<n.openStart;h++)l=l.firstChild.content;for(let h=1;h<=(n.openStart==0&&n.size?2:1);h++)for(let f=i.depth;f>=0;f--){let p=f==i.depth?0:i.pos<=(i.start(f+1)+i.end(f+1))/2?-1:1,y=i.index(f)+(p>0?1:0),b=i.node(f),S=!1;if(h==1)S=b.canReplace(y,y,l);else{let O=b.contentMatchAt(y).findWrapping(l.firstChild.type);S=O&&b.canReplaceWith(y,y,O[0])}if(S)return p==0?i.pos:p<0?i.before(f+1):i.after(f+1)}return null}function wl(o,e,n=e,i=F.empty){if(e==n&&!i.size)return null;let l=o.resolve(e),h=o.resolve(n);return kf(l,h,i)?new Ee(e,n,i):new Zm(l,h,i).fit()}function kf(o,e,n){return!n.openStart&&!n.openEnd&&o.start()==e.start()&&o.parent.canReplace(o.index(),e.index(),n.content)}class Zm{constructor(e,n,i){this.$from=e,this.$to=n,this.unplaced=i,this.frontier=[],this.placed=B.empty;for(let l=0;l<=e.depth;l++){let h=e.node(l);this.frontier.push({type:h.type,match:h.contentMatchAt(e.indexAfter(l))})}for(let l=e.depth;l>0;l--)this.placed=B.from(e.node(l).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let b=this.findFittable();b?this.placeNodes(b):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,i=this.$from,l=this.close(e<0?this.$to:i.doc.resolve(e));if(!l)return null;let h=this.placed,f=i.depth,p=l.depth;for(;f&&p&&h.childCount==1;)h=h.firstChild.content,f--,p--;let y=new F(h,f,p);return e>-1?new ve(i.pos,e,this.$to.pos,this.$to.end(),y,n):y.size||i.pos!=this.$to.pos?new Ee(i.pos,l.pos,y):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,i=0,l=this.unplaced.openEnd;i<e;i++){let h=n.firstChild;if(n.childCount>1&&(l=0),h.type.spec.isolating&&l<=i){e=i;break}n=h.content}for(let n=1;n<=2;n++)for(let i=n==1?e:this.unplaced.openStart;i>=0;i--){let l,h=null;i?(h=Ts(this.unplaced.content,i-1).firstChild,l=h.content):l=this.unplaced.content;let f=l.firstChild;for(let p=this.depth;p>=0;p--){let{type:y,match:b}=this.frontier[p],S,O=null;if(n==1&&(f?b.matchType(f.type)||(O=b.fillBefore(B.from(f),!1)):h&&y.compatibleContent(h.type)))return{sliceDepth:i,frontierDepth:p,parent:h,inject:O};if(n==2&&f&&(S=b.findWrapping(f.type)))return{sliceDepth:i,frontierDepth:p,parent:h,wrap:S};if(h&&b.matchType(h.type))break}}}openMore(){let{content:e,openStart:n,openEnd:i}=this.unplaced,l=Ts(e,n);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new F(e,n+1,Math.max(i,l.size+n>=e.size-i?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:i}=this.unplaced,l=Ts(e,n);if(l.childCount<=1&&n>0){let h=e.size-n<=n+l.size;this.unplaced=new F(Jr(e,n-1,1),n-1,h?n-1:i)}else this.unplaced=new F(Jr(e,n,1),n,i)}placeNodes({sliceDepth:e,frontierDepth:n,parent:i,inject:l,wrap:h}){for(;this.depth>n;)this.closeFrontierNode();if(h)for(let z=0;z<h.length;z++)this.openFrontierNode(h[z]);let f=this.unplaced,p=i?i.content:f.content,y=f.openStart-e,b=0,S=[],{match:O,type:N}=this.frontier[n];if(l){for(let z=0;z<l.childCount;z++)S.push(l.child(z));O=O.matchFragment(l)}let E=p.size+e-(f.content.size-f.openEnd);for(;b<p.childCount;){let z=p.child(b),P=O.matchType(z.type);if(!P)break;b++,(b>1||y==0||z.content.size)&&(O=P,S.push(xf(z.mark(N.allowedMarks(z.marks)),b==1?y:0,b==p.childCount?E:-1)))}let T=b==p.childCount;T||(E=-1),this.placed=Hr(this.placed,n,B.from(S)),this.frontier[n].match=O,T&&E<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let z=0,P=p;z<E;z++){let L=P.lastChild;this.frontier.push({type:L.type,match:L.contentMatchAt(L.childCount)}),P=L.content}this.unplaced=T?e==0?F.empty:new F(Jr(f.content,e-1,1),e-1,E<0?f.openEnd:e-1):new F(Jr(f.content,e,b),f.openStart,f.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Es(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:i}=this.$to,l=this.$to.after(i);for(;i>1&&l==this.$to.end(--i);)++l;return l}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:i,type:l}=this.frontier[n],h=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),f=Es(e,n,l,i,h);if(f){for(let p=n-1;p>=0;p--){let{match:y,type:b}=this.frontier[p],S=Es(e,p,b,y,!0);if(!S||S.childCount)continue e}return{depth:n,fit:f,move:h?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Hr(this.placed,n.depth,n.fit)),e=n.move;for(let i=n.depth+1;i<=e.depth;i++){let l=e.node(i),h=l.type.contentMatch.fillBefore(l.content,!0,e.index(i));this.openFrontierNode(l.type,l.attrs,h)}return e}openFrontierNode(e,n=null,i){let l=this.frontier[this.depth];l.match=l.match.matchType(e),this.placed=Hr(this.placed,this.depth,B.from(e.create(n,i))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(B.empty,!0);n.childCount&&(this.placed=Hr(this.placed,this.frontier.length,n))}}function Jr(o,e,n){return e==0?o.cutByIndex(n,o.childCount):o.replaceChild(0,o.firstChild.copy(Jr(o.firstChild.content,e-1,n)))}function Hr(o,e,n){return e==0?o.append(n):o.replaceChild(o.childCount-1,o.lastChild.copy(Hr(o.lastChild.content,e-1,n)))}function Ts(o,e){for(let n=0;n<e;n++)o=o.firstChild.content;return o}function xf(o,e,n){if(e<=0)return o;let i=o.content;return e>1&&(i=i.replaceChild(0,xf(i.firstChild,e-1,i.childCount==1?n-1:0))),e>0&&(i=o.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(o.type.contentMatch.matchFragment(i).fillBefore(B.empty,!0)))),o.copy(i)}function Es(o,e,n,i,l){let h=o.node(e),f=l?o.indexAfter(e):o.index(e);if(f==h.childCount&&!n.compatibleContent(h.type))return null;let p=i.fillBefore(h.content,!0,f);return p&&!Qm(n,h.content,f)?p:null}function Qm(o,e,n){for(let i=n;i<e.childCount;i++)if(!o.allowsMarks(e.child(i).marks))return!0;return!1}function eg(o){return o.spec.defining||o.spec.definingForContent}function tg(o,e,n,i){if(!i.size)return o.deleteRange(e,n);let l=o.doc.resolve(e),h=o.doc.resolve(n);if(kf(l,h,i))return o.step(new Ee(e,n,i));let f=Cf(l,o.doc.resolve(n));f[f.length-1]==0&&f.pop();let p=-(l.depth+1);f.unshift(p);for(let N=l.depth,E=l.pos-1;N>0;N--,E--){let T=l.node(N).type.spec;if(T.defining||T.definingAsContext||T.isolating)break;f.indexOf(N)>-1?p=N:l.before(N)==E&&f.splice(1,0,-N)}let y=f.indexOf(p),b=[],S=i.openStart;for(let N=i.content,E=0;;E++){let T=N.firstChild;if(b.push(T),E==i.openStart)break;N=T.content}for(let N=S-1;N>=0;N--){let E=b[N],T=eg(E.type);if(T&&!E.sameMarkup(l.node(Math.abs(p)-1)))S=N;else if(T||!E.type.isTextblock)break}for(let N=i.openStart;N>=0;N--){let E=(N+S+1)%(i.openStart+1),T=b[E];if(T)for(let z=0;z<f.length;z++){let P=f[(z+y)%f.length],L=!0;P<0&&(L=!1,P=-P);let Q=l.node(P-1),we=l.index(P-1);if(Q.canReplaceWith(we,we,T.type,T.marks))return o.replace(l.before(P),L?h.after(P):n,new F(Sf(i.content,0,i.openStart,E),E,i.openEnd))}}let O=o.steps.length;for(let N=f.length-1;N>=0&&(o.replace(e,n,i),!(o.steps.length>O));N--){let E=f[N];E<0||(e=l.before(E),n=h.after(E))}}function Sf(o,e,n,i,l){if(e<n){let h=o.firstChild;o=o.replaceChild(0,h.copy(Sf(h.content,e+1,n,i,h)))}if(e>i){let h=l.contentMatchAt(0),f=h.fillBefore(o).append(o);o=f.append(h.matchFragment(f).fillBefore(B.empty,!0))}return o}function ng(o,e,n,i){if(!i.isInline&&e==n&&o.doc.resolve(e).parent.content.size){let l=_m(o.doc,e,i.type);l!=null&&(e=n=l)}o.replaceRange(e,n,new F(B.from(i),0,0))}function rg(o,e,n){let i=o.doc.resolve(e),l=o.doc.resolve(n),h=Cf(i,l);for(let f=0;f<h.length;f++){let p=h[f],y=f==h.length-1;if(y&&p==0||i.node(p).type.contentMatch.validEnd)return o.delete(i.start(p),l.end(p));if(p>0&&(y||i.node(p-1).canReplace(i.index(p-1),l.indexAfter(p-1))))return o.delete(i.before(p),l.after(p))}for(let f=1;f<=i.depth&&f<=l.depth;f++)if(e-i.start(f)==i.depth-f&&n>i.end(f)&&l.end(f)-n!=l.depth-f&&i.start(f-1)==l.start(f-1)&&i.node(f-1).canReplace(i.index(f-1),l.index(f-1)))return o.delete(i.before(f),n);o.delete(e,n)}function Cf(o,e){let n=[],i=Math.min(o.depth,e.depth);for(let l=i;l>=0;l--){let h=o.start(l);if(h<o.pos-(o.depth-l)||e.end(l)>e.pos+(e.depth-l)||o.node(l).type.spec.isolating||e.node(l).type.spec.isolating)break;(h==e.start(l)||l==o.depth&&l==e.depth&&o.parent.inlineContent&&e.parent.inlineContent&&l&&e.start(l-1)==h-1)&&n.push(l)}return n}class lr extends Ie{constructor(e,n,i){super(),this.pos=e,this.attr=n,this.value=i}apply(e){let n=e.nodeAt(this.pos);if(!n)return fe.fail("No node at attribute step's position");let i=Object.create(null);for(let h in n.attrs)i[h]=n.attrs[h];i[this.attr]=this.value;let l=n.type.create(i,null,n.marks);return fe.fromReplace(e,this.pos,this.pos+1,new F(B.from(l),0,n.isLeaf?0:1))}getMap(){return Qe.empty}invert(e){return new lr(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new lr(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new lr(n.pos,n.attr,n.value)}}Ie.jsonID("attr",lr);class ei extends Ie{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let l in e.attrs)n[l]=e.attrs[l];n[this.attr]=this.value;let i=e.type.create(n,e.content,e.marks);return fe.ok(i)}getMap(){return Qe.empty}invert(e){return new ei(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new ei(n.attr,n.value)}}Ie.jsonID("docAttr",ei);let dr=class extends Error{};dr=function o(e){let n=Error.call(this,e);return n.__proto__=o.prototype,n};dr.prototype=Object.create(Error.prototype);dr.prototype.constructor=dr;dr.prototype.name="TransformError";class ig{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new or}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new dr(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,i=F.empty){let l=wl(this.doc,e,n,i);return l&&this.step(l),this}replaceWith(e,n,i){return this.replace(e,n,new F(B.from(i),0,0))}delete(e,n){return this.replace(e,n,F.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,i){return tg(this,e,n,i),this}replaceRangeWith(e,n,i){return ng(this,e,n,i),this}deleteRange(e,n){return rg(this,e,n),this}lift(e,n){return $m(this,e,n),this}join(e,n=1){return Xm(this,e,n),this}wrap(e,n){return Hm(this,e,n),this}setBlockType(e,n=e,i,l=null){return Km(this,e,n,i,l),this}setNodeMarkup(e,n,i=null,l){return Um(this,e,n,i,l),this}setNodeAttribute(e,n,i){return this.step(new lr(e,n,i)),this}setDocAttribute(e,n){return this.step(new ei(e,n)),this}addNodeMark(e,n){return this.step(new on(e,n)),this}removeNodeMark(e,n){if(!(n instanceof ee)){let i=this.doc.nodeAt(e);if(!i)throw new RangeError("No node at position "+e);if(n=n.isInSet(i.marks),!n)return this}return this.step(new hr(e,n)),this}split(e,n=1,i){return Gm(this,e,n,i),this}addMark(e,n,i){return Fm(this,e,n,i),this}removeMark(e,n,i){return Lm(this,e,n,i),this}clearIncompatible(e,n,i){return gl(this,e,n,i),this}}const As=Object.create(null);class _{constructor(e,n,i){this.$anchor=e,this.$head=n,this.ranges=i||[new og(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=F.empty){let i=n.content.lastChild,l=null;for(let p=0;p<n.openEnd;p++)l=i,i=i.lastChild;let h=e.steps.length,f=this.ranges;for(let p=0;p<f.length;p++){let{$from:y,$to:b}=f[p],S=e.mapping.slice(h);e.replaceRange(S.map(y.pos),S.map(b.pos),p?F.empty:n),p==0&&Zh(e,h,(i?i.isInline:l&&l.isTextblock)?-1:1)}}replaceWith(e,n){let i=e.steps.length,l=this.ranges;for(let h=0;h<l.length;h++){let{$from:f,$to:p}=l[h],y=e.mapping.slice(i),b=y.map(f.pos),S=y.map(p.pos);h?e.deleteRange(b,S):(e.replaceRangeWith(b,S,n),Zh(e,i,n.isInline?-1:1))}}static findFrom(e,n,i=!1){let l=e.parent.inlineContent?new te(e):nr(e.node(0),e.parent,e.pos,e.index(),n,i);if(l)return l;for(let h=e.depth-1;h>=0;h--){let f=n<0?nr(e.node(0),e.node(h),e.before(h+1),e.index(h),n,i):nr(e.node(0),e.node(h),e.after(h+1),e.index(h)+1,n,i);if(f)return f}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new et(e.node(0))}static atStart(e){return nr(e,e,0,0,1)||new et(e)}static atEnd(e){return nr(e,e,e.content.size,e.childCount,-1)||new et(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let i=As[n.type];if(!i)throw new RangeError(`No selection type ${n.type} defined`);return i.fromJSON(e,n)}static jsonID(e,n){if(e in As)throw new RangeError("Duplicate use of selection JSON ID "+e);return As[e]=n,n.prototype.jsonID=e,n}getBookmark(){return te.between(this.$anchor,this.$head).getBookmark()}}_.prototype.visible=!0;class og{constructor(e,n){this.$from=e,this.$to=n}}let Xh=!1;function _h(o){!Xh&&!o.parent.inlineContent&&(Xh=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+o.parent.type.name+")"))}class te extends _{constructor(e,n=e){_h(e),_h(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let i=e.resolve(n.map(this.head));if(!i.parent.inlineContent)return _.near(i);let l=e.resolve(n.map(this.anchor));return new te(l.parent.inlineContent?l:i,i)}replace(e,n=F.empty){if(super.replace(e,n),n==F.empty){let i=this.$from.marksAcross(this.$to);i&&e.ensureMarks(i)}}eq(e){return e instanceof te&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new co(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new te(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,i=n){let l=e.resolve(n);return new this(l,i==n?l:e.resolve(i))}static between(e,n,i){let l=e.pos-n.pos;if((!i||l)&&(i=l>=0?1:-1),!n.parent.inlineContent){let h=_.findFrom(n,i,!0)||_.findFrom(n,-i,!0);if(h)n=h.$head;else return _.near(n,i)}return e.parent.inlineContent||(l==0?e=n:(e=(_.findFrom(e,-i,!0)||_.findFrom(e,i,!0)).$anchor,e.pos<n.pos!=l<0&&(e=n))),new te(e,n)}}_.jsonID("text",te);class co{constructor(e,n){this.anchor=e,this.head=n}map(e){return new co(e.map(this.anchor),e.map(this.head))}resolve(e){return te.between(e.resolve(this.anchor),e.resolve(this.head))}}class J extends _{constructor(e){let n=e.nodeAfter,i=e.node(0).resolve(e.pos+n.nodeSize);super(e,i),this.node=n}map(e,n){let{deleted:i,pos:l}=n.mapResult(this.anchor),h=e.resolve(l);return i?_.near(h):new J(h)}content(){return new F(B.from(this.node),0,0)}eq(e){return e instanceof J&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new bl(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new J(e.resolve(n.anchor))}static create(e,n){return new J(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}J.prototype.visible=!1;_.jsonID("node",J);class bl{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:i}=e.mapResult(this.anchor);return n?new co(i,i):new bl(i)}resolve(e){let n=e.resolve(this.anchor),i=n.nodeAfter;return i&&J.isSelectable(i)?new J(n):_.near(n)}}class et extends _{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=F.empty){if(n==F.empty){e.delete(0,e.doc.content.size);let i=_.atStart(e.doc);i.eq(e.selection)||e.setSelection(i)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new et(e)}map(e){return new et(e)}eq(e){return e instanceof et}getBookmark(){return sg}}_.jsonID("all",et);const sg={map(){return this},resolve(o){return new et(o)}};function nr(o,e,n,i,l,h=!1){if(e.inlineContent)return te.create(o,n);for(let f=i-(l>0?0:1);l>0?f<e.childCount:f>=0;f+=l){let p=e.child(f);if(p.isAtom){if(!h&&J.isSelectable(p))return J.create(o,n-(l<0?p.nodeSize:0))}else{let y=nr(o,p,n+l,l<0?p.childCount:0,l,h);if(y)return y}n+=p.nodeSize*l}return null}function Zh(o,e,n){let i=o.steps.length-1;if(i<e)return;let l=o.steps[i];if(!(l instanceof Ee||l instanceof ve))return;let h=o.mapping.maps[i],f;h.forEach((p,y,b,S)=>{f==null&&(f=S)}),o.setSelection(_.near(o.doc.resolve(f),n))}const Qh=1,Li=2,ed=4;class lg extends ig{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Qh)&~Li,this.storedMarks=null,this}get selectionSet(){return(this.updated&Qh)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Li,this}ensureMarks(e){return ee.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Li)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Li,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let i=this.selection;return n&&(e=e.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||ee.none))),i.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,i){let l=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(l.text(e),!0):this.deleteSelection();{if(i==null&&(i=n),i=i??n,!e)return this.deleteRange(n,i);let h=this.storedMarks;if(!h){let f=this.doc.resolve(n);h=i==n?f.marks():f.marksAcross(this.doc.resolve(i))}return this.replaceRangeWith(n,i,l.text(e,h)),this.selection.empty||this.setSelection(_.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=ed,this}get scrolledIntoView(){return(this.updated&ed)>0}}function td(o,e){return!e||!o?o:o.bind(e)}class Kr{constructor(e,n,i){this.name=e,this.init=td(n.init,i),this.apply=td(n.apply,i)}}const ag=[new Kr("doc",{init(o){return o.doc||o.schema.topNodeType.createAndFill()},apply(o){return o.doc}}),new Kr("selection",{init(o,e){return o.selection||_.atStart(e.doc)},apply(o){return o.selection}}),new Kr("storedMarks",{init(o){return o.storedMarks||null},apply(o,e,n,i){return i.selection.$cursor?o.storedMarks:null}}),new Kr("scrollToSelection",{init(){return 0},apply(o,e){return o.scrolledIntoView?e+1:e}})];class Is{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=ag.slice(),n&&n.forEach(i=>{if(this.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");this.plugins.push(i),this.pluginsByKey[i.key]=i,i.spec.state&&this.fields.push(new Kr(i.key,i.spec.state,i))})}}class ir{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=n){let l=this.config.plugins[i];if(l.spec.filterTransaction&&!l.spec.filterTransaction.call(l,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],i=this.applyInner(e),l=null;for(;;){let h=!1;for(let f=0;f<this.config.plugins.length;f++){let p=this.config.plugins[f];if(p.spec.appendTransaction){let y=l?l[f].n:0,b=l?l[f].state:this,S=y<n.length&&p.spec.appendTransaction.call(p,y?n.slice(y):n,b,i);if(S&&i.filterTransaction(S,f)){if(S.setMeta("appendedTransaction",e),!l){l=[];for(let O=0;O<this.config.plugins.length;O++)l.push(O<f?{state:i,n:n.length}:{state:this,n:0})}n.push(S),i=i.applyInner(S),h=!0}l&&(l[f]={state:i,n:n.length})}}if(!h)return{state:i,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new ir(this.config),i=this.config.fields;for(let l=0;l<i.length;l++){let h=i[l];n[h.name]=h.apply(e,this[h.name],this,n)}return n}get tr(){return new lg(this)}static create(e){let n=new Is(e.doc?e.doc.type.schema:e.schema,e.plugins),i=new ir(n);for(let l=0;l<n.fields.length;l++)i[n.fields[l].name]=n.fields[l].init(e,i);return i}reconfigure(e){let n=new Is(this.schema,e.plugins),i=n.fields,l=new ir(n);for(let h=0;h<i.length;h++){let f=i[h].name;l[f]=this.hasOwnProperty(f)?this[f]:i[h].init(e,l)}return l}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(i=>i.toJSON())),e&&typeof e=="object")for(let i in e){if(i=="doc"||i=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let l=e[i],h=l.spec.state;h&&h.toJSON&&(n[i]=h.toJSON.call(l,this[l.key]))}return n}static fromJSON(e,n,i){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let l=new Is(e.schema,e.plugins),h=new ir(l);return l.fields.forEach(f=>{if(f.name=="doc")h.doc=An.fromJSON(e.schema,n.doc);else if(f.name=="selection")h.selection=_.fromJSON(h.doc,n.selection);else if(f.name=="storedMarks")n.storedMarks&&(h.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(i)for(let p in i){let y=i[p],b=y.spec.state;if(y.key==f.name&&b&&b.fromJSON&&Object.prototype.hasOwnProperty.call(n,p)){h[f.name]=b.fromJSON.call(y,e,n[p],h);return}}h[f.name]=f.init(e,h)}}),h}}function Mf(o,e,n){for(let i in o){let l=o[i];l instanceof Function?l=l.bind(e):i=="handleDOMEvents"&&(l=Mf(l,e,{})),n[i]=l}return n}class Fn{constructor(e){this.spec=e,this.props={},e.props&&Mf(e.props,this,this.props),this.key=e.key?e.key.key:vf("plugin")}getState(e){return e[this.key]}}const Rs=Object.create(null);function vf(o){return o in Rs?o+"$"+ ++Rs[o]:(Rs[o]=0,o+"$")}class Of{constructor(e="key"){this.key=vf(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Ce=function(o){for(var e=0;;e++)if(o=o.previousSibling,!o)return e},ti=function(o){let e=o.assignedSlot||o.parentNode;return e&&e.nodeType==11?e.host:e};let _s=null;const Pt=function(o,e,n){let i=_s||(_s=document.createRange());return i.setEnd(o,n??o.nodeValue.length),i.setStart(o,e||0),i},cg=function(){_s=null},Bn=function(o,e,n,i){return n&&(nd(o,e,n,i,-1)||nd(o,e,n,i,1))},hg=/^(img|br|input|textarea|hr)$/i;function nd(o,e,n,i,l){for(;;){if(o==n&&e==i)return!0;if(e==(l<0?0:lt(o))){let h=o.parentNode;if(!h||h.nodeType!=1||ai(o)||hg.test(o.nodeName)||o.contentEditable=="false")return!1;e=Ce(o)+(l<0?0:1),o=h}else if(o.nodeType==1){if(o=o.childNodes[e+(l<0?-1:0)],o.contentEditable=="false")return!1;e=l<0?lt(o):0}else return!1}}function lt(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function dg(o,e){for(;;){if(o.nodeType==3&&e)return o;if(o.nodeType==1&&e>0){if(o.contentEditable=="false")return null;o=o.childNodes[e-1],e=lt(o)}else if(o.parentNode&&!ai(o))e=Ce(o),o=o.parentNode;else return null}}function fg(o,e){for(;;){if(o.nodeType==3&&e<o.nodeValue.length)return o;if(o.nodeType==1&&e<o.childNodes.length){if(o.contentEditable=="false")return null;o=o.childNodes[e],e=0}else if(o.parentNode&&!ai(o))e=Ce(o)+1,o=o.parentNode;else return null}}function ug(o,e,n){for(let i=e==0,l=e==lt(o);i||l;){if(o==n)return!0;let h=Ce(o);if(o=o.parentNode,!o)return!1;i=i&&h==0,l=l&&h==lt(o)}}function ai(o){let e;for(let n=o;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==o||e.contentDOM==o)}const ho=function(o){return o.focusNode&&Bn(o.focusNode,o.focusOffset,o.anchorNode,o.anchorOffset)};function On(o,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=o,n.key=n.code=e,n}function pg(o){let e=o.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function mg(o,e,n){if(o.caretPositionFromPoint)try{let i=o.caretPositionFromPoint(e,n);if(i)return{node:i.offsetNode,offset:Math.min(lt(i.offsetNode),i.offset)}}catch{}if(o.caretRangeFromPoint){let i=o.caretRangeFromPoint(e,n);if(i)return{node:i.startContainer,offset:Math.min(lt(i.startContainer),i.startOffset)}}}const Mt=typeof navigator<"u"?navigator:null,rd=typeof document<"u"?document:null,dn=Mt&&Mt.userAgent||"",Zs=/Edge\/(\d+)/.exec(dn),Nf=/MSIE \d/.exec(dn),Qs=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(dn),Ue=!!(Nf||Qs||Zs),ln=Nf?document.documentMode:Qs?+Qs[1]:Zs?+Zs[1]:0,gt=!Ue&&/gecko\/(\d+)/i.test(dn);gt&&+(/Firefox\/(\d+)/.exec(dn)||[0,0])[1];const el=!Ue&&/Chrome\/(\d+)/.exec(dn),Ae=!!el,Df=el?+el[1]:0,Ve=!Ue&&!!Mt&&/Apple Computer/.test(Mt.vendor),fr=Ve&&(/Mobile\/\w+/.test(dn)||!!Mt&&Mt.maxTouchPoints>2),ot=fr||(Mt?/Mac/.test(Mt.platform):!1),gg=Mt?/Win/.test(Mt.platform):!1,pt=/Android \d/.test(dn),ci=!!rd&&"webkitFontSmoothing"in rd.documentElement.style,yg=ci?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function wg(o){let e=o.defaultView&&o.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:o.documentElement.clientWidth,top:0,bottom:o.documentElement.clientHeight}}function zt(o,e){return typeof o=="number"?o:o[e]}function bg(o){let e=o.getBoundingClientRect(),n=e.width/o.offsetWidth||1,i=e.height/o.offsetHeight||1;return{left:e.left,right:e.left+o.clientWidth*n,top:e.top,bottom:e.top+o.clientHeight*i}}function id(o,e,n){let i=o.someProp("scrollThreshold")||0,l=o.someProp("scrollMargin")||5,h=o.dom.ownerDocument;for(let f=n||o.dom;f;f=ti(f)){if(f.nodeType!=1)continue;let p=f,y=p==h.body,b=y?wg(h):bg(p),S=0,O=0;if(e.top<b.top+zt(i,"top")?O=-(b.top-e.top+zt(l,"top")):e.bottom>b.bottom-zt(i,"bottom")&&(O=e.bottom-e.top>b.bottom-b.top?e.top+zt(l,"top")-b.top:e.bottom-b.bottom+zt(l,"bottom")),e.left<b.left+zt(i,"left")?S=-(b.left-e.left+zt(l,"left")):e.right>b.right-zt(i,"right")&&(S=e.right-b.right+zt(l,"right")),S||O)if(y)h.defaultView.scrollBy(S,O);else{let N=p.scrollLeft,E=p.scrollTop;O&&(p.scrollTop+=O),S&&(p.scrollLeft+=S);let T=p.scrollLeft-N,z=p.scrollTop-E;e={left:e.left-T,top:e.top-z,right:e.right-T,bottom:e.bottom-z}}if(y||/^(fixed|sticky)$/.test(getComputedStyle(f).position))break}}function kg(o){let e=o.dom.getBoundingClientRect(),n=Math.max(0,e.top),i,l;for(let h=(e.left+e.right)/2,f=n+1;f<Math.min(innerHeight,e.bottom);f+=5){let p=o.root.elementFromPoint(h,f);if(!p||p==o.dom||!o.dom.contains(p))continue;let y=p.getBoundingClientRect();if(y.top>=n-20){i=p,l=y.top;break}}return{refDOM:i,refTop:l,stack:Tf(o.dom)}}function Tf(o){let e=[],n=o.ownerDocument;for(let i=o;i&&(e.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),o!=n);i=ti(i));return e}function xg({refDOM:o,refTop:e,stack:n}){let i=o?o.getBoundingClientRect().top:0;Ef(n,i==0?0:i-e)}function Ef(o,e){for(let n=0;n<o.length;n++){let{dom:i,top:l,left:h}=o[n];i.scrollTop!=l+e&&(i.scrollTop=l+e),i.scrollLeft!=h&&(i.scrollLeft=h)}}let er=null;function Sg(o){if(o.setActive)return o.setActive();if(er)return o.focus(er);let e=Tf(o);o.focus(er==null?{get preventScroll(){return er={preventScroll:!0},!0}}:void 0),er||(er=!1,Ef(e,0))}function Af(o,e){let n,i=2e8,l,h=0,f=e.top,p=e.top,y,b;for(let S=o.firstChild,O=0;S;S=S.nextSibling,O++){let N;if(S.nodeType==1)N=S.getClientRects();else if(S.nodeType==3)N=Pt(S).getClientRects();else continue;for(let E=0;E<N.length;E++){let T=N[E];if(T.top<=f&&T.bottom>=p){f=Math.max(T.bottom,f),p=Math.min(T.top,p);let z=T.left>e.left?T.left-e.left:T.right<e.left?e.left-T.right:0;if(z<i){n=S,i=z,l=z&&n.nodeType==3?{left:T.right<e.left?T.right:T.left,top:e.top}:e,S.nodeType==1&&z&&(h=O+(e.left>=(T.left+T.right)/2?1:0));continue}}else T.top>e.top&&!y&&T.left<=e.left&&T.right>=e.left&&(y=S,b={left:Math.max(T.left,Math.min(T.right,e.left)),top:T.top});!n&&(e.left>=T.right&&e.top>=T.top||e.left>=T.left&&e.top>=T.bottom)&&(h=O+1)}}return!n&&y&&(n=y,l=b,i=0),n&&n.nodeType==3?Cg(n,l):!n||i&&n.nodeType==1?{node:o,offset:h}:Af(n,l)}function Cg(o,e){let n=o.nodeValue.length,i=document.createRange();for(let l=0;l<n;l++){i.setEnd(o,l+1),i.setStart(o,l);let h=Zt(i,1);if(h.top!=h.bottom&&kl(e,h))return{node:o,offset:l+(e.left>=(h.left+h.right)/2?1:0)}}return{node:o,offset:0}}function kl(o,e){return o.left>=e.left-1&&o.left<=e.right+1&&o.top>=e.top-1&&o.top<=e.bottom+1}function Mg(o,e){let n=o.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<o.getBoundingClientRect().left?n:o}function vg(o,e,n){let{node:i,offset:l}=Af(e,n),h=-1;if(i.nodeType==1&&!i.firstChild){let f=i.getBoundingClientRect();h=f.left!=f.right&&n.left>(f.left+f.right)/2?1:-1}return o.docView.posFromDOM(i,l,h)}function Og(o,e,n,i){let l=-1;for(let h=e,f=!1;h!=o.dom;){let p=o.docView.nearestDesc(h,!0);if(!p)return null;if(p.dom.nodeType==1&&(p.node.isBlock&&p.parent||!p.contentDOM)){let y=p.dom.getBoundingClientRect();if(p.node.isBlock&&p.parent&&(!f&&y.left>i.left||y.top>i.top?l=p.posBefore:(!f&&y.right<i.left||y.bottom<i.top)&&(l=p.posAfter),f=!0),!p.contentDOM&&l<0&&!p.node.isText)return(p.node.isBlock?i.top<(y.top+y.bottom)/2:i.left<(y.left+y.right)/2)?p.posBefore:p.posAfter}h=p.dom.parentNode}return l>-1?l:o.docView.posFromDOM(e,n,-1)}function If(o,e,n){let i=o.childNodes.length;if(i&&n.top<n.bottom)for(let l=Math.max(0,Math.min(i-1,Math.floor(i*(e.top-n.top)/(n.bottom-n.top))-2)),h=l;;){let f=o.childNodes[h];if(f.nodeType==1){let p=f.getClientRects();for(let y=0;y<p.length;y++){let b=p[y];if(kl(e,b))return If(f,e,b)}}if((h=(h+1)%i)==l)break}return o}function Ng(o,e){let n=o.dom.ownerDocument,i,l=0,h=mg(n,e.left,e.top);h&&({node:i,offset:l}=h);let f=(o.root.elementFromPoint?o.root:n).elementFromPoint(e.left,e.top),p;if(!f||!o.dom.contains(f.nodeType!=1?f.parentNode:f)){let b=o.dom.getBoundingClientRect();if(!kl(e,b)||(f=If(o.dom,e,b),!f))return null}if(Ve)for(let b=f;i&&b;b=ti(b))b.draggable&&(i=void 0);if(f=Mg(f,e),i){if(gt&&i.nodeType==1&&(l=Math.min(l,i.childNodes.length),l<i.childNodes.length)){let S=i.childNodes[l],O;S.nodeName=="IMG"&&(O=S.getBoundingClientRect()).right<=e.left&&O.bottom>e.top&&l++}let b;ci&&l&&i.nodeType==1&&(b=i.childNodes[l-1]).nodeType==1&&b.contentEditable=="false"&&b.getBoundingClientRect().top>=e.top&&l--,i==o.dom&&l==i.childNodes.length-1&&i.lastChild.nodeType==1&&e.top>i.lastChild.getBoundingClientRect().bottom?p=o.state.doc.content.size:(l==0||i.nodeType!=1||i.childNodes[l-1].nodeName!="BR")&&(p=Og(o,i,l,e))}p==null&&(p=vg(o,f,e));let y=o.docView.nearestDesc(f,!0);return{pos:p,inside:y?y.posAtStart-y.border:-1}}function od(o){return o.top<o.bottom||o.left<o.right}function Zt(o,e){let n=o.getClientRects();if(n.length){let i=n[e<0?0:n.length-1];if(od(i))return i}return Array.prototype.find.call(n,od)||o.getBoundingClientRect()}const Dg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Rf(o,e,n){let{node:i,offset:l,atom:h}=o.docView.domFromPos(e,n<0?-1:1),f=ci||gt;if(i.nodeType==3)if(f&&(Dg.test(i.nodeValue)||(n<0?!l:l==i.nodeValue.length))){let y=Zt(Pt(i,l,l),n);if(gt&&l&&/\s/.test(i.nodeValue[l-1])&&l<i.nodeValue.length){let b=Zt(Pt(i,l-1,l-1),-1);if(b.top==y.top){let S=Zt(Pt(i,l,l+1),-1);if(S.top!=y.top)return Wr(S,S.left<b.left)}}return y}else{let y=l,b=l,S=n<0?1:-1;return n<0&&!l?(b++,S=-1):n>=0&&l==i.nodeValue.length?(y--,S=1):n<0?y--:b++,Wr(Zt(Pt(i,y,b),S),S<0)}if(!o.state.doc.resolve(e-(h||0)).parent.inlineContent){if(h==null&&l&&(n<0||l==lt(i))){let y=i.childNodes[l-1];if(y.nodeType==1)return zs(y.getBoundingClientRect(),!1)}if(h==null&&l<lt(i)){let y=i.childNodes[l];if(y.nodeType==1)return zs(y.getBoundingClientRect(),!0)}return zs(i.getBoundingClientRect(),n>=0)}if(h==null&&l&&(n<0||l==lt(i))){let y=i.childNodes[l-1],b=y.nodeType==3?Pt(y,lt(y)-(f?0:1)):y.nodeType==1&&(y.nodeName!="BR"||!y.nextSibling)?y:null;if(b)return Wr(Zt(b,1),!1)}if(h==null&&l<lt(i)){let y=i.childNodes[l];for(;y.pmViewDesc&&y.pmViewDesc.ignoreForCoords;)y=y.nextSibling;let b=y?y.nodeType==3?Pt(y,0,f?0:1):y.nodeType==1?y:null:null;if(b)return Wr(Zt(b,-1),!0)}return Wr(Zt(i.nodeType==3?Pt(i):i,-n),n>=0)}function Wr(o,e){if(o.width==0)return o;let n=e?o.left:o.right;return{top:o.top,bottom:o.bottom,left:n,right:n}}function zs(o,e){if(o.height==0)return o;let n=e?o.top:o.bottom;return{top:n,bottom:n,left:o.left,right:o.right}}function zf(o,e,n){let i=o.state,l=o.root.activeElement;i!=e&&o.updateState(e),l!=o.dom&&o.focus();try{return n()}finally{i!=e&&o.updateState(i),l!=o.dom&&l&&l.focus()}}function Tg(o,e,n){let i=e.selection,l=n=="up"?i.$from:i.$to;return zf(o,e,()=>{let{node:h}=o.docView.domFromPos(l.pos,n=="up"?-1:1);for(;;){let p=o.docView.nearestDesc(h,!0);if(!p)break;if(p.node.isBlock){h=p.contentDOM||p.dom;break}h=p.dom.parentNode}let f=Rf(o,l.pos,1);for(let p=h.firstChild;p;p=p.nextSibling){let y;if(p.nodeType==1)y=p.getClientRects();else if(p.nodeType==3)y=Pt(p,0,p.nodeValue.length).getClientRects();else continue;for(let b=0;b<y.length;b++){let S=y[b];if(S.bottom>S.top+1&&(n=="up"?f.top-S.top>(S.bottom-f.top)*2:S.bottom-f.bottom>(f.bottom-S.top)*2))return!1}}return!0})}const Eg=/[\u0590-\u08ac]/;function Ag(o,e,n){let{$head:i}=e.selection;if(!i.parent.isTextblock)return!1;let l=i.parentOffset,h=!l,f=l==i.parent.content.size,p=o.domSelection();return p?!Eg.test(i.parent.textContent)||!p.modify?n=="left"||n=="backward"?h:f:zf(o,e,()=>{let{focusNode:y,focusOffset:b,anchorNode:S,anchorOffset:O}=o.domSelectionRange(),N=p.caretBidiLevel;p.modify("move",n,"character");let E=i.depth?o.docView.domAfterPos(i.before()):o.dom,{focusNode:T,focusOffset:z}=o.domSelectionRange(),P=T&&!E.contains(T.nodeType==1?T:T.parentNode)||y==T&&b==z;try{p.collapse(S,O),y&&(y!=S||b!=O)&&p.extend&&p.extend(y,b)}catch{}return N!=null&&(p.caretBidiLevel=N),P}):i.pos==i.start()||i.pos==i.end()}let sd=null,ld=null,ad=!1;function Ig(o,e,n){return sd==e&&ld==n?ad:(sd=e,ld=n,ad=n=="up"||n=="down"?Tg(o,e,n):Ag(o,e,n))}const ct=0,cd=1,Nn=2,vt=3;class hi{constructor(e,n,i,l){this.parent=e,this.children=n,this.dom=i,this.contentDOM=l,this.dirty=ct,i.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,i){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,i=this.posAtStart;;n++){let l=this.children[n];if(l==e)return i;i+=l.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,i){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(i<0){let h,f;if(e==this.contentDOM)h=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;h=e.previousSibling}for(;h&&!((f=h.pmViewDesc)&&f.parent==this);)h=h.previousSibling;return h?this.posBeforeChild(f)+f.size:this.posAtStart}else{let h,f;if(e==this.contentDOM)h=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;h=e.nextSibling}for(;h&&!((f=h.pmViewDesc)&&f.parent==this);)h=h.nextSibling;return h?this.posBeforeChild(f):this.posAtEnd}let l;if(e==this.dom&&this.contentDOM)l=n>Ce(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))l=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let h=e;;h=h.parentNode){if(h==this.dom){l=!1;break}if(h.previousSibling)break}if(l==null&&n==e.childNodes.length)for(let h=e;;h=h.parentNode){if(h==this.dom){l=!0;break}if(h.nextSibling)break}}return l??i>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let i=!0,l=e;l;l=l.parentNode){let h=this.getDesc(l),f;if(h&&(!n||h.node))if(i&&(f=h.nodeDOM)&&!(f.nodeType==1?f.contains(e.nodeType==1?e:e.parentNode):f==e))i=!1;else return h}}getDesc(e){let n=e.pmViewDesc;for(let i=n;i;i=i.parent)if(i==this)return n}posFromDOM(e,n,i){for(let l=e;l;l=l.parentNode){let h=this.getDesc(l);if(h)return h.localPosFromDOM(e,n,i)}return-1}descAt(e){for(let n=0,i=0;n<this.children.length;n++){let l=this.children[n],h=i+l.size;if(i==e&&h!=i){for(;!l.border&&l.children.length;)l=l.children[0];return l}if(e<h)return l.descAt(e-i-l.border);i=h}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let i=0,l=0;for(let h=0;i<this.children.length;i++){let f=this.children[i],p=h+f.size;if(p>e||f instanceof Bf){l=e-h;break}h=p}if(l)return this.children[i].domFromPos(l-this.children[i].border,n);for(let h;i&&!(h=this.children[i-1]).size&&h instanceof Pf&&h.side>=0;i--);if(n<=0){let h,f=!0;for(;h=i?this.children[i-1]:null,!(!h||h.dom.parentNode==this.contentDOM);i--,f=!1);return h&&n&&f&&!h.border&&!h.domAtom?h.domFromPos(h.size,n):{node:this.contentDOM,offset:h?Ce(h.dom)+1:0}}else{let h,f=!0;for(;h=i<this.children.length?this.children[i]:null,!(!h||h.dom.parentNode==this.contentDOM);i++,f=!1);return h&&f&&!h.border&&!h.domAtom?h.domFromPos(0,n):{node:this.contentDOM,offset:h?Ce(h.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,i=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let l=-1,h=-1;for(let f=i,p=0;;p++){let y=this.children[p],b=f+y.size;if(l==-1&&e<=b){let S=f+y.border;if(e>=S&&n<=b-y.border&&y.node&&y.contentDOM&&this.contentDOM.contains(y.contentDOM))return y.parseRange(e,n,S);e=f;for(let O=p;O>0;O--){let N=this.children[O-1];if(N.size&&N.dom.parentNode==this.contentDOM&&!N.emptyChildAt(1)){l=Ce(N.dom)+1;break}e-=N.size}l==-1&&(l=0)}if(l>-1&&(b>n||p==this.children.length-1)){n=b;for(let S=p+1;S<this.children.length;S++){let O=this.children[S];if(O.size&&O.dom.parentNode==this.contentDOM&&!O.emptyChildAt(-1)){h=Ce(O.dom);break}n+=O.size}h==-1&&(h=this.contentDOM.childNodes.length);break}f=b}return{node:this.contentDOM,from:e,to:n,fromOffset:l,toOffset:h}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:i}=this.domFromPos(e,0);if(n.nodeType!=1||i==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[i]}setSelection(e,n,i,l=!1){let h=Math.min(e,n),f=Math.max(e,n);for(let E=0,T=0;E<this.children.length;E++){let z=this.children[E],P=T+z.size;if(h>T&&f<P)return z.setSelection(e-T-z.border,n-T-z.border,i,l);T=P}let p=this.domFromPos(e,e?-1:1),y=n==e?p:this.domFromPos(n,n?-1:1),b=i.root.getSelection(),S=i.domSelectionRange(),O=!1;if((gt||Ve)&&e==n){let{node:E,offset:T}=p;if(E.nodeType==3){if(O=!!(T&&E.nodeValue[T-1]==`
`),O&&T==E.nodeValue.length)for(let z=E,P;z;z=z.parentNode){if(P=z.nextSibling){P.nodeName=="BR"&&(p=y={node:P.parentNode,offset:Ce(P)+1});break}let L=z.pmViewDesc;if(L&&L.node&&L.node.isBlock)break}}else{let z=E.childNodes[T-1];O=z&&(z.nodeName=="BR"||z.contentEditable=="false")}}if(gt&&S.focusNode&&S.focusNode!=y.node&&S.focusNode.nodeType==1){let E=S.focusNode.childNodes[S.focusOffset];E&&E.contentEditable=="false"&&(l=!0)}if(!(l||O&&Ve)&&Bn(p.node,p.offset,S.anchorNode,S.anchorOffset)&&Bn(y.node,y.offset,S.focusNode,S.focusOffset))return;let N=!1;if((b.extend||e==n)&&!O){b.collapse(p.node,p.offset);try{e!=n&&b.extend(y.node,y.offset),N=!0}catch{}}if(!N){if(e>n){let T=p;p=y,y=T}let E=document.createRange();E.setEnd(y.node,y.offset),E.setStart(p.node,p.offset),b.removeAllRanges(),b.addRange(E)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let i=0,l=0;l<this.children.length;l++){let h=this.children[l],f=i+h.size;if(i==f?e<=f&&n>=i:e<f&&n>i){let p=i+h.border,y=f-h.border;if(e>=p&&n<=y){this.dirty=e==i||n==f?Nn:cd,e==p&&n==y&&(h.contentLost||h.dom.parentNode!=this.contentDOM)?h.dirty=vt:h.markDirty(e-p,n-p);return}else h.dirty=h.dom==h.contentDOM&&h.dom.parentNode==this.contentDOM&&!h.children.length?Nn:vt}i=f}this.dirty=Nn}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let i=e==1?Nn:cd;n.dirty<i&&(n.dirty=i)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class Pf extends hi{constructor(e,n,i,l){let h,f=n.type.toDOM;if(typeof f=="function"&&(f=f(i,()=>{if(!h)return l;if(h.parent)return h.parent.posBeforeChild(h)})),!n.type.spec.raw){if(f.nodeType!=1){let p=document.createElement("span");p.appendChild(f),f=p}f.contentEditable="false",f.classList.add("ProseMirror-widget")}super(e,[],f,null),this.widget=n,this.widget=n,h=this}matchesWidget(e){return this.dirty==ct&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Rg extends hi{constructor(e,n,i,l){super(e,[],n,null),this.textDOM=i,this.text=l}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Vn extends hi{constructor(e,n,i,l,h){super(e,[],i,l),this.mark=n,this.spec=h}static create(e,n,i,l){let h=l.nodeViews[n.type.name],f=h&&h(n,l,i);return(!f||!f.dom)&&(f=pr.renderSpec(document,n.type.spec.toDOM(n,i),null,n.attrs)),new Vn(e,n,f.dom,f.contentDOM||f.dom,f)}parseRule(){return this.dirty&vt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=vt&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=ct){let i=this.parent;for(;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=ct}}slice(e,n,i){let l=Vn.create(this.parent,this.mark,!0,i),h=this.children,f=this.size;n<f&&(h=nl(h,n,f,i)),e>0&&(h=nl(h,0,e,i));for(let p=0;p<h.length;p++)h[p].parent=l;return l.children=h,l}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class an extends hi{constructor(e,n,i,l,h,f,p,y,b){super(e,[],h,f),this.node=n,this.outerDeco=i,this.innerDeco=l,this.nodeDOM=p}static create(e,n,i,l,h,f){let p=h.nodeViews[n.type.name],y,b=p&&p(n,h,()=>{if(!y)return f;if(y.parent)return y.parent.posBeforeChild(y)},i,l),S=b&&b.dom,O=b&&b.contentDOM;if(n.isText){if(!S)S=document.createTextNode(n.text);else if(S.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else S||({dom:S,contentDOM:O}=pr.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!O&&!n.isText&&S.nodeName!="BR"&&(S.hasAttribute("contenteditable")||(S.contentEditable="false"),n.type.spec.draggable&&(S.draggable=!0));let N=S;return S=Lf(S,i,n),b?y=new zg(e,n,i,l,S,O||null,N,b,h,f+1):n.isText?new fo(e,n,i,l,S,N,h):new an(e,n,i,l,S,O||null,N,h,f+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let i=this.children[n];if(this.dom.contains(i.dom.parentNode)){e.contentElement=i.dom.parentNode;break}}e.contentElement||(e.getContent=()=>B.empty)}return e}matchesNode(e,n,i){return this.dirty==ct&&e.eq(this.node)&&eo(n,this.outerDeco)&&i.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let i=this.node.inlineContent,l=n,h=e.composing?this.localCompositionInfo(e,n):null,f=h&&h.pos>-1?h:null,p=h&&h.pos<0,y=new Bg(this,f&&f.node,e);Lg(this.node,this.innerDeco,(b,S,O)=>{b.spec.marks?y.syncToMarks(b.spec.marks,i,e):b.type.side>=0&&!O&&y.syncToMarks(S==this.node.childCount?ee.none:this.node.child(S).marks,i,e),y.placeWidget(b,e,l)},(b,S,O,N)=>{y.syncToMarks(b.marks,i,e);let E;y.findNodeMatch(b,S,O,N)||p&&e.state.selection.from>l&&e.state.selection.to<l+b.nodeSize&&(E=y.findIndexWithChild(h.node))>-1&&y.updateNodeAt(b,S,O,E,e)||y.updateNextNode(b,S,O,e,N,l)||y.addNode(b,S,O,e,l),l+=b.nodeSize}),y.syncToMarks([],i,e),this.node.isTextblock&&y.addTextblockHacks(),y.destroyRest(),(y.changed||this.dirty==Nn)&&(f&&this.protectLocalComposition(e,f),Vf(this.contentDOM,this.children,e),fr&&qg(this.dom))}localCompositionInfo(e,n){let{from:i,to:l}=e.state.selection;if(!(e.state.selection instanceof te)||i<n||l>n+this.node.content.size)return null;let h=e.input.compositionNode;if(!h||!this.dom.contains(h.parentNode))return null;if(this.node.inlineContent){let f=h.nodeValue,p=$g(this.node.content,f,i-n,l-n);return p<0?null:{node:h,pos:p,text:f}}else return{node:h,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:i,text:l}){if(this.getDesc(n))return;let h=n;for(;h.parentNode!=this.contentDOM;h=h.parentNode){for(;h.previousSibling;)h.parentNode.removeChild(h.previousSibling);for(;h.nextSibling;)h.parentNode.removeChild(h.nextSibling);h.pmViewDesc&&(h.pmViewDesc=void 0)}let f=new Rg(this,h,n,l);e.input.compositionNodes.push(f),this.children=nl(this.children,i,i+l.length,e,f)}update(e,n,i,l){return this.dirty==vt||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,i,l),!0)}updateInner(e,n,i,l){this.updateOuterDeco(n),this.node=e,this.innerDeco=i,this.contentDOM&&this.updateChildren(l,this.posAtStart),this.dirty=ct}updateOuterDeco(e){if(eo(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,i=this.dom;this.dom=Ff(this.dom,this.nodeDOM,tl(this.outerDeco,this.node,n),tl(e,this.node,n)),this.dom!=i&&(i.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function hd(o,e,n,i,l){Lf(i,e,o);let h=new an(void 0,o,e,n,i,i,i,l,0);return h.contentDOM&&h.updateChildren(l,0),h}class fo extends an{constructor(e,n,i,l,h,f,p){super(e,n,i,l,h,null,f,p,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,i,l){return this.dirty==vt||this.dirty!=ct&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=ct||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,l.trackWrites==this.nodeDOM&&(l.trackWrites=null)),this.node=e,this.dirty=ct,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,i){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,i)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,i){let l=this.node.cut(e,n),h=document.createTextNode(l.text);return new fo(this.parent,l,this.outerDeco,this.innerDeco,h,h,i)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=vt)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Bf extends hi{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ct&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class zg extends an{constructor(e,n,i,l,h,f,p,y,b,S){super(e,n,i,l,h,f,p,b,S),this.spec=y}update(e,n,i,l){if(this.dirty==vt)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let h=this.spec.update(e,n,i);return h&&this.updateInner(e,n,i,l),h}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,i,l)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,i,l){this.spec.setSelection?this.spec.setSelection(e,n,i.root):super.setSelection(e,n,i,l)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Vf(o,e,n){let i=o.firstChild,l=!1;for(let h=0;h<e.length;h++){let f=e[h],p=f.dom;if(p.parentNode==o){for(;p!=i;)i=dd(i),l=!0;i=i.nextSibling}else l=!0,o.insertBefore(p,i);if(f instanceof Vn){let y=i?i.previousSibling:o.lastChild;Vf(f.contentDOM,f.children,n),i=y?y.nextSibling:o.firstChild}}for(;i;)i=dd(i),l=!0;l&&n.trackWrites==o&&(n.trackWrites=null)}const Gr=function(o){o&&(this.nodeName=o)};Gr.prototype=Object.create(null);const Dn=[new Gr];function tl(o,e,n){if(o.length==0)return Dn;let i=n?Dn[0]:new Gr,l=[i];for(let h=0;h<o.length;h++){let f=o[h].type.attrs;if(f){f.nodeName&&l.push(i=new Gr(f.nodeName));for(let p in f){let y=f[p];y!=null&&(n&&l.length==1&&l.push(i=new Gr(e.isInline?"span":"div")),p=="class"?i.class=(i.class?i.class+" ":"")+y:p=="style"?i.style=(i.style?i.style+";":"")+y:p!="nodeName"&&(i[p]=y))}}}return l}function Ff(o,e,n,i){if(n==Dn&&i==Dn)return e;let l=e;for(let h=0;h<i.length;h++){let f=i[h],p=n[h];if(h){let y;p&&p.nodeName==f.nodeName&&l!=o&&(y=l.parentNode)&&y.nodeName.toLowerCase()==f.nodeName||(y=document.createElement(f.nodeName),y.pmIsDeco=!0,y.appendChild(l),p=Dn[0]),l=y}Pg(l,p||Dn[0],f)}return l}function Pg(o,e,n){for(let i in e)i!="class"&&i!="style"&&i!="nodeName"&&!(i in n)&&o.removeAttribute(i);for(let i in n)i!="class"&&i!="style"&&i!="nodeName"&&n[i]!=e[i]&&o.setAttribute(i,n[i]);if(e.class!=n.class){let i=e.class?e.class.split(" ").filter(Boolean):[],l=n.class?n.class.split(" ").filter(Boolean):[];for(let h=0;h<i.length;h++)l.indexOf(i[h])==-1&&o.classList.remove(i[h]);for(let h=0;h<l.length;h++)i.indexOf(l[h])==-1&&o.classList.add(l[h]);o.classList.length==0&&o.removeAttribute("class")}if(e.style!=n.style){if(e.style){let i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,l;for(;l=i.exec(e.style);)o.style.removeProperty(l[1])}n.style&&(o.style.cssText+=n.style)}}function Lf(o,e,n){return Ff(o,o,Dn,tl(e,n,o.nodeType!=1))}function eo(o,e){if(o.length!=e.length)return!1;for(let n=0;n<o.length;n++)if(!o[n].type.eq(e[n].type))return!1;return!0}function dd(o){let e=o.nextSibling;return o.parentNode.removeChild(o),e}class Bg{constructor(e,n,i){this.lock=n,this.view=i,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Vg(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let i=e;i<n;i++)this.top.children[i].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,i){let l=0,h=this.stack.length>>1,f=Math.min(h,e.length);for(;l<f&&(l==h-1?this.top:this.stack[l+1<<1]).matchesMark(e[l])&&e[l].type.spec.spanning!==!1;)l++;for(;l<h;)this.destroyRest(),this.top.dirty=ct,this.index=this.stack.pop(),this.top=this.stack.pop(),h--;for(;h<e.length;){this.stack.push(this.top,this.index+1);let p=-1;for(let y=this.index;y<Math.min(this.index+3,this.top.children.length);y++){let b=this.top.children[y];if(b.matchesMark(e[h])&&!this.isLocked(b.dom)){p=y;break}}if(p>-1)p>this.index&&(this.changed=!0,this.destroyBetween(this.index,p)),this.top=this.top.children[this.index];else{let y=Vn.create(this.top,e[h],n,i);this.top.children.splice(this.index,0,y),this.top=y,this.changed=!0}this.index=0,h++}}findNodeMatch(e,n,i,l){let h=-1,f;if(l>=this.preMatch.index&&(f=this.preMatch.matches[l-this.preMatch.index]).parent==this.top&&f.matchesNode(e,n,i))h=this.top.children.indexOf(f,this.index);else for(let p=this.index,y=Math.min(this.top.children.length,p+5);p<y;p++){let b=this.top.children[p];if(b.matchesNode(e,n,i)&&!this.preMatch.matched.has(b)){h=p;break}}return h<0?!1:(this.destroyBetween(this.index,h),this.index++,!0)}updateNodeAt(e,n,i,l,h){let f=this.top.children[l];return f.dirty==vt&&f.dom==f.contentDOM&&(f.dirty=Nn),f.update(e,n,i,h)?(this.destroyBetween(this.index,l),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let i=e.pmViewDesc;if(i){for(let l=this.index;l<this.top.children.length;l++)if(this.top.children[l]==i)return l}return-1}e=n}}updateNextNode(e,n,i,l,h,f){for(let p=this.index;p<this.top.children.length;p++){let y=this.top.children[p];if(y instanceof an){let b=this.preMatch.matched.get(y);if(b!=null&&b!=h)return!1;let S=y.dom,O,N=this.isLocked(S)&&!(e.isText&&y.node&&y.node.isText&&y.nodeDOM.nodeValue==e.text&&y.dirty!=vt&&eo(n,y.outerDeco));if(!N&&y.update(e,n,i,l))return this.destroyBetween(this.index,p),y.dom!=S&&(this.changed=!0),this.index++,!0;if(!N&&(O=this.recreateWrapper(y,e,n,i,l,f)))return this.destroyBetween(this.index,p),this.top.children[this.index]=O,O.contentDOM&&(O.dirty=Nn,O.updateChildren(l,f+1),O.dirty=ct),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,i,l,h,f){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!eo(i,e.outerDeco)||!l.eq(e.innerDeco))return null;let p=an.create(this.top,n,i,l,h,f);if(p.contentDOM){p.children=e.children,e.children=[];for(let y of p.children)y.parent=p}return e.destroy(),p}addNode(e,n,i,l,h){let f=an.create(this.top,e,n,i,l,h);f.contentDOM&&f.updateChildren(l,h+1),this.top.children.splice(this.index++,0,f),this.changed=!0}placeWidget(e,n,i){let l=this.index<this.top.children.length?this.top.children[this.index]:null;if(l&&l.matchesWidget(e)&&(e==l.widget||!l.widget.type.toDOM.parentNode))this.index++;else{let h=new Pf(this.top,e,n,i);this.top.children.splice(this.index++,0,h),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Vn;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof fo)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ve||Ae)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let i=document.createElement(e);e=="IMG"&&(i.className="ProseMirror-separator",i.alt=""),e=="BR"&&(i.className="ProseMirror-trailingBreak");let l=new Bf(this.top,[],i,null);n!=this.top?n.children.push(l):n.children.splice(this.index++,0,l),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Vg(o,e){let n=e,i=n.children.length,l=o.childCount,h=new Map,f=[];e:for(;l>0;){let p;for(;;)if(i){let b=n.children[i-1];if(b instanceof Vn)n=b,i=b.children.length;else{p=b,i--;break}}else{if(n==e)break e;i=n.parent.children.indexOf(n),n=n.parent}let y=p.node;if(y){if(y!=o.child(l-1))break;--l,h.set(p,l),f.push(p)}}return{index:l,matched:h,matches:f.reverse()}}function Fg(o,e){return o.type.side-e.type.side}function Lg(o,e,n,i){let l=e.locals(o),h=0;if(l.length==0){for(let b=0;b<o.childCount;b++){let S=o.child(b);i(S,l,e.forChild(h,S),b),h+=S.nodeSize}return}let f=0,p=[],y=null;for(let b=0;;){let S,O;for(;f<l.length&&l[f].to==h;){let P=l[f++];P.widget&&(S?(O||(O=[S])).push(P):S=P)}if(S)if(O){O.sort(Fg);for(let P=0;P<O.length;P++)n(O[P],b,!!y)}else n(S,b,!!y);let N,E;if(y)E=-1,N=y,y=null;else if(b<o.childCount)E=b,N=o.child(b++);else break;for(let P=0;P<p.length;P++)p[P].to<=h&&p.splice(P--,1);for(;f<l.length&&l[f].from<=h&&l[f].to>h;)p.push(l[f++]);let T=h+N.nodeSize;if(N.isText){let P=T;f<l.length&&l[f].from<P&&(P=l[f].from);for(let L=0;L<p.length;L++)p[L].to<P&&(P=p[L].to);P<T&&(y=N.cut(P-h),N=N.cut(0,P-h),T=P,E=-1)}else for(;f<l.length&&l[f].to<T;)f++;let z=N.isInline&&!N.isLeaf?p.filter(P=>!P.inline):p.slice();i(N,z,e.forChild(h,N),E),h=T}}function qg(o){if(o.nodeName=="UL"||o.nodeName=="OL"){let e=o.style.cssText;o.style.cssText=e+"; list-style: square !important",window.getComputedStyle(o).listStyle,o.style.cssText=e}}function $g(o,e,n,i){for(let l=0,h=0;l<o.childCount&&h<=i;){let f=o.child(l++),p=h;if(h+=f.nodeSize,!f.isText)continue;let y=f.text;for(;l<o.childCount;){let b=o.child(l++);if(h+=b.nodeSize,!b.isText)break;y+=b.text}if(h>=n){if(h>=i&&y.slice(i-e.length-p,i-p)==e)return i-e.length;let b=p<i?y.lastIndexOf(e,i-p-1):-1;if(b>=0&&b+e.length+p>=n)return p+b;if(n==i&&y.length>=i+e.length-p&&y.slice(i-p,i-p+e.length)==e)return i}}return-1}function nl(o,e,n,i,l){let h=[];for(let f=0,p=0;f<o.length;f++){let y=o[f],b=p,S=p+=y.size;b>=n||S<=e?h.push(y):(b<e&&h.push(y.slice(0,e-b,i)),l&&(h.push(l),l=void 0),S>n&&h.push(y.slice(n-b,y.size,i)))}return h}function xl(o,e=null){let n=o.domSelectionRange(),i=o.state.doc;if(!n.focusNode)return null;let l=o.docView.nearestDesc(n.focusNode),h=l&&l.size==0,f=o.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(f<0)return null;let p=i.resolve(f),y,b;if(ho(n)){for(y=f;l&&!l.node;)l=l.parent;let O=l.node;if(l&&O.isAtom&&J.isSelectable(O)&&l.parent&&!(O.isInline&&ug(n.focusNode,n.focusOffset,l.dom))){let N=l.posBefore;b=new J(f==N?p:i.resolve(N))}}else{if(n instanceof o.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let O=f,N=f;for(let E=0;E<n.rangeCount;E++){let T=n.getRangeAt(E);O=Math.min(O,o.docView.posFromDOM(T.startContainer,T.startOffset,1)),N=Math.max(N,o.docView.posFromDOM(T.endContainer,T.endOffset,-1))}if(O<0)return null;[y,f]=N==o.state.selection.anchor?[N,O]:[O,N],p=i.resolve(f)}else y=o.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(y<0)return null}let S=i.resolve(y);if(!b){let O=e=="pointer"||o.state.selection.head<p.pos&&!h?1:-1;b=Sl(o,S,p,O)}return b}function qf(o){return o.editable?o.hasFocus():Wf(o)&&document.activeElement&&document.activeElement.contains(o.dom)}function Vt(o,e=!1){let n=o.state.selection;if($f(o,n),!!qf(o)){if(!e&&o.input.mouseDown&&o.input.mouseDown.allowDefault&&Ae){let i=o.domSelectionRange(),l=o.domObserver.currentSelection;if(i.anchorNode&&l.anchorNode&&Bn(i.anchorNode,i.anchorOffset,l.anchorNode,l.anchorOffset)){o.input.mouseDown.delayedSelectionSync=!0,o.domObserver.setCurSelection();return}}if(o.domObserver.disconnectSelection(),o.cursorWrapper)Jg(o);else{let{anchor:i,head:l}=n,h,f;fd&&!(n instanceof te)&&(n.$from.parent.inlineContent||(h=ud(o,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(f=ud(o,n.to))),o.docView.setSelection(i,l,o,e),fd&&(h&&pd(h),f&&pd(f)),n.visible?o.dom.classList.remove("ProseMirror-hideselection"):(o.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Wg(o))}o.domObserver.setCurSelection(),o.domObserver.connectSelection()}}const fd=Ve||Ae&&Df<63;function ud(o,e){let{node:n,offset:i}=o.docView.domFromPos(e,0),l=i<n.childNodes.length?n.childNodes[i]:null,h=i?n.childNodes[i-1]:null;if(Ve&&l&&l.contentEditable=="false")return Ps(l);if((!l||l.contentEditable=="false")&&(!h||h.contentEditable=="false")){if(l)return Ps(l);if(h)return Ps(h)}}function Ps(o){return o.contentEditable="true",Ve&&o.draggable&&(o.draggable=!1,o.wasDraggable=!0),o}function pd(o){o.contentEditable="false",o.wasDraggable&&(o.draggable=!0,o.wasDraggable=null)}function Wg(o){let e=o.dom.ownerDocument;e.removeEventListener("selectionchange",o.input.hideSelectionGuard);let n=o.domSelectionRange(),i=n.anchorNode,l=n.anchorOffset;e.addEventListener("selectionchange",o.input.hideSelectionGuard=()=>{(n.anchorNode!=i||n.anchorOffset!=l)&&(e.removeEventListener("selectionchange",o.input.hideSelectionGuard),setTimeout(()=>{(!qf(o)||o.state.selection.visible)&&o.dom.classList.remove("ProseMirror-hideselection")},20))})}function Jg(o){let e=o.domSelection(),n=document.createRange();if(!e)return;let i=o.cursorWrapper.dom,l=i.nodeName=="IMG";l?n.setStart(i.parentNode,Ce(i)+1):n.setStart(i,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!l&&!o.state.selection.visible&&Ue&&ln<=11&&(i.disabled=!0,i.disabled=!1)}function $f(o,e){if(e instanceof J){let n=o.docView.descAt(e.from);n!=o.lastSelectedViewDesc&&(md(o),n&&n.selectNode(),o.lastSelectedViewDesc=n)}else md(o)}function md(o){o.lastSelectedViewDesc&&(o.lastSelectedViewDesc.parent&&o.lastSelectedViewDesc.deselectNode(),o.lastSelectedViewDesc=void 0)}function Sl(o,e,n,i){return o.someProp("createSelectionBetween",l=>l(o,e,n))||te.between(e,n,i)}function gd(o){return o.editable&&!o.hasFocus()?!1:Wf(o)}function Wf(o){let e=o.domSelectionRange();if(!e.anchorNode)return!1;try{return o.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(o.editable||o.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Hg(o){let e=o.docView.domFromPos(o.state.selection.anchor,0),n=o.domSelectionRange();return Bn(e.node,e.offset,n.anchorNode,n.anchorOffset)}function rl(o,e){let{$anchor:n,$head:i}=o.selection,l=e>0?n.max(i):n.min(i),h=l.parent.inlineContent?l.depth?o.doc.resolve(e>0?l.after():l.before()):null:l;return h&&_.findFrom(h,e)}function Qt(o,e){return o.dispatch(o.state.tr.setSelection(e).scrollIntoView()),!0}function yd(o,e,n){let i=o.state.selection;if(i instanceof te)if(n.indexOf("s")>-1){let{$head:l}=i,h=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter;if(!h||h.isText||!h.isLeaf)return!1;let f=o.state.doc.resolve(l.pos+h.nodeSize*(e<0?-1:1));return Qt(o,new te(i.$anchor,f))}else if(i.empty){if(o.endOfTextblock(e>0?"forward":"backward")){let l=rl(o.state,e);return l&&l instanceof J?Qt(o,l):!1}else if(!(ot&&n.indexOf("m")>-1)){let l=i.$head,h=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter,f;if(!h||h.isText)return!1;let p=e<0?l.pos-h.nodeSize:l.pos;return h.isAtom||(f=o.docView.descAt(p))&&!f.contentDOM?J.isSelectable(h)?Qt(o,new J(e<0?o.state.doc.resolve(l.pos-h.nodeSize):l)):ci?Qt(o,new te(o.state.doc.resolve(e<0?p:p+h.nodeSize))):!1:!1}}else return!1;else{if(i instanceof J&&i.node.isInline)return Qt(o,new te(e>0?i.$to:i.$from));{let l=rl(o.state,e);return l?Qt(o,l):!1}}}function to(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function Yr(o,e){let n=o.pmViewDesc;return n&&n.size==0&&(e<0||o.nextSibling||o.nodeName!="BR")}function tr(o,e){return e<0?Kg(o):jg(o)}function Kg(o){let e=o.domSelectionRange(),n=e.focusNode,i=e.focusOffset;if(!n)return;let l,h,f=!1;for(gt&&n.nodeType==1&&i<to(n)&&Yr(n.childNodes[i],-1)&&(f=!0);;)if(i>0){if(n.nodeType!=1)break;{let p=n.childNodes[i-1];if(Yr(p,-1))l=n,h=--i;else if(p.nodeType==3)n=p,i=n.nodeValue.length;else break}}else{if(Jf(n))break;{let p=n.previousSibling;for(;p&&Yr(p,-1);)l=n.parentNode,h=Ce(p),p=p.previousSibling;if(p)n=p,i=to(n);else{if(n=n.parentNode,n==o.dom)break;i=0}}}f?il(o,n,i):l&&il(o,l,h)}function jg(o){let e=o.domSelectionRange(),n=e.focusNode,i=e.focusOffset;if(!n)return;let l=to(n),h,f;for(;;)if(i<l){if(n.nodeType!=1)break;let p=n.childNodes[i];if(Yr(p,1))h=n,f=++i;else break}else{if(Jf(n))break;{let p=n.nextSibling;for(;p&&Yr(p,1);)h=p.parentNode,f=Ce(p)+1,p=p.nextSibling;if(p)n=p,i=0,l=to(n);else{if(n=n.parentNode,n==o.dom)break;i=l=0}}}h&&il(o,h,f)}function Jf(o){let e=o.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ug(o,e){for(;o&&e==o.childNodes.length&&!ai(o);)e=Ce(o)+1,o=o.parentNode;for(;o&&e<o.childNodes.length;){let n=o.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;o=n,e=0}}function Gg(o,e){for(;o&&!e&&!ai(o);)e=Ce(o),o=o.parentNode;for(;o&&e;){let n=o.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;o=n,e=o.childNodes.length}}function il(o,e,n){if(e.nodeType!=3){let h,f;(f=Ug(e,n))?(e=f,n=0):(h=Gg(e,n))&&(e=h,n=h.nodeValue.length)}let i=o.domSelection();if(!i)return;if(ho(i)){let h=document.createRange();h.setEnd(e,n),h.setStart(e,n),i.removeAllRanges(),i.addRange(h)}else i.extend&&i.extend(e,n);o.domObserver.setCurSelection();let{state:l}=o;setTimeout(()=>{o.state==l&&Vt(o)},50)}function wd(o,e){let n=o.state.doc.resolve(e);if(!(Ae||gg)&&n.parent.inlineContent){let l=o.coordsAtPos(e);if(e>n.start()){let h=o.coordsAtPos(e-1),f=(h.top+h.bottom)/2;if(f>l.top&&f<l.bottom&&Math.abs(h.left-l.left)>1)return h.left<l.left?"ltr":"rtl"}if(e<n.end()){let h=o.coordsAtPos(e+1),f=(h.top+h.bottom)/2;if(f>l.top&&f<l.bottom&&Math.abs(h.left-l.left)>1)return h.left>l.left?"ltr":"rtl"}}return getComputedStyle(o.dom).direction=="rtl"?"rtl":"ltr"}function bd(o,e,n){let i=o.state.selection;if(i instanceof te&&!i.empty||n.indexOf("s")>-1||ot&&n.indexOf("m")>-1)return!1;let{$from:l,$to:h}=i;if(!l.parent.inlineContent||o.endOfTextblock(e<0?"up":"down")){let f=rl(o.state,e);if(f&&f instanceof J)return Qt(o,f)}if(!l.parent.inlineContent){let f=e<0?l:h,p=i instanceof et?_.near(f,e):_.findFrom(f,e);return p?Qt(o,p):!1}return!1}function kd(o,e){if(!(o.state.selection instanceof te))return!0;let{$head:n,$anchor:i,empty:l}=o.state.selection;if(!n.sameParent(i))return!0;if(!l)return!1;if(o.endOfTextblock(e>0?"forward":"backward"))return!0;let h=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(h&&!h.isText){let f=o.state.tr;return e<0?f.delete(n.pos-h.nodeSize,n.pos):f.delete(n.pos,n.pos+h.nodeSize),o.dispatch(f),!0}return!1}function xd(o,e,n){o.domObserver.stop(),e.contentEditable=n,o.domObserver.start()}function Yg(o){if(!Ve||o.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=o.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let i=e.firstChild;xd(o,i,"true"),setTimeout(()=>xd(o,i,"false"),20)}return!1}function Xg(o){let e="";return o.ctrlKey&&(e+="c"),o.metaKey&&(e+="m"),o.altKey&&(e+="a"),o.shiftKey&&(e+="s"),e}function _g(o,e){let n=e.keyCode,i=Xg(e);if(n==8||ot&&n==72&&i=="c")return kd(o,-1)||tr(o,-1);if(n==46&&!e.shiftKey||ot&&n==68&&i=="c")return kd(o,1)||tr(o,1);if(n==13||n==27)return!0;if(n==37||ot&&n==66&&i=="c"){let l=n==37?wd(o,o.state.selection.from)=="ltr"?-1:1:-1;return yd(o,l,i)||tr(o,l)}else if(n==39||ot&&n==70&&i=="c"){let l=n==39?wd(o,o.state.selection.from)=="ltr"?1:-1:1;return yd(o,l,i)||tr(o,l)}else{if(n==38||ot&&n==80&&i=="c")return bd(o,-1,i)||tr(o,-1);if(n==40||ot&&n==78&&i=="c")return Yg(o)||bd(o,1,i)||tr(o,1);if(i==(ot?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Hf(o,e){o.someProp("transformCopied",E=>{e=E(e,o)});let n=[],{content:i,openStart:l,openEnd:h}=e;for(;l>1&&h>1&&i.childCount==1&&i.firstChild.childCount==1;){l--,h--;let E=i.firstChild;n.push(E.type.name,E.attrs!=E.type.defaultAttrs?E.attrs:null),i=E.content}let f=o.someProp("clipboardSerializer")||pr.fromSchema(o.state.schema),p=Xf(),y=p.createElement("div");y.appendChild(f.serializeFragment(i,{document:p}));let b=y.firstChild,S,O=0;for(;b&&b.nodeType==1&&(S=Yf[b.nodeName.toLowerCase()]);){for(let E=S.length-1;E>=0;E--){let T=p.createElement(S[E]);for(;y.firstChild;)T.appendChild(y.firstChild);y.appendChild(T),O++}b=y.firstChild}b&&b.nodeType==1&&b.setAttribute("data-pm-slice",`${l} ${h}${O?` -${O}`:""} ${JSON.stringify(n)}`);let N=o.someProp("clipboardTextSerializer",E=>E(e,o))||e.content.textBetween(0,e.content.size,`

`);return{dom:y,text:N,slice:e}}function Kf(o,e,n,i,l){let h=l.parent.type.spec.code,f,p;if(!n&&!e)return null;let y=e&&(i||h||!n);if(y){if(o.someProp("transformPastedText",N=>{e=N(e,h||i,o)}),h)return e?new F(B.from(o.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):F.empty;let O=o.someProp("clipboardTextParser",N=>N(e,l,i,o));if(O)p=O;else{let N=l.marks(),{schema:E}=o.state,T=pr.fromSchema(E);f=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(z=>{let P=f.appendChild(document.createElement("p"));z&&P.appendChild(T.serializeNode(E.text(z,N)))})}}else o.someProp("transformPastedHTML",O=>{n=O(n,o)}),f=t0(n),ci&&n0(f);let b=f&&f.querySelector("[data-pm-slice]"),S=b&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(b.getAttribute("data-pm-slice")||"");if(S&&S[3])for(let O=+S[3];O>0;O--){let N=f.firstChild;for(;N&&N.nodeType!=1;)N=N.nextSibling;if(!N)break;f=N}if(p||(p=(o.someProp("clipboardParser")||o.someProp("domParser")||cr.fromSchema(o.state.schema)).parseSlice(f,{preserveWhitespace:!!(y||S),context:l,ruleFromNode(N){return N.nodeName=="BR"&&!N.nextSibling&&N.parentNode&&!Zg.test(N.parentNode.nodeName)?{ignore:!0}:null}})),S)p=r0(Sd(p,+S[1],+S[2]),S[4]);else if(p=F.maxOpen(Qg(p.content,l),!0),p.openStart||p.openEnd){let O=0,N=0;for(let E=p.content.firstChild;O<p.openStart&&!E.type.spec.isolating;O++,E=E.firstChild);for(let E=p.content.lastChild;N<p.openEnd&&!E.type.spec.isolating;N++,E=E.lastChild);p=Sd(p,O,N)}return o.someProp("transformPasted",O=>{p=O(p,o)}),p}const Zg=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Qg(o,e){if(o.childCount<2)return o;for(let n=e.depth;n>=0;n--){let l=e.node(n).contentMatchAt(e.index(n)),h,f=[];if(o.forEach(p=>{if(!f)return;let y=l.findWrapping(p.type),b;if(!y)return f=null;if(b=f.length&&h.length&&Uf(y,h,p,f[f.length-1],0))f[f.length-1]=b;else{f.length&&(f[f.length-1]=Gf(f[f.length-1],h.length));let S=jf(p,y);f.push(S),l=l.matchType(S.type),h=y}}),f)return B.from(f)}return o}function jf(o,e,n=0){for(let i=e.length-1;i>=n;i--)o=e[i].create(null,B.from(o));return o}function Uf(o,e,n,i,l){if(l<o.length&&l<e.length&&o[l]==e[l]){let h=Uf(o,e,n,i.lastChild,l+1);if(h)return i.copy(i.content.replaceChild(i.childCount-1,h));if(i.contentMatchAt(i.childCount).matchType(l==o.length-1?n.type:o[l+1]))return i.copy(i.content.append(B.from(jf(n,o,l+1))))}}function Gf(o,e){if(e==0)return o;let n=o.content.replaceChild(o.childCount-1,Gf(o.lastChild,e-1)),i=o.contentMatchAt(o.childCount).fillBefore(B.empty,!0);return o.copy(n.append(i))}function ol(o,e,n,i,l,h){let f=e<0?o.firstChild:o.lastChild,p=f.content;return o.childCount>1&&(h=0),l<i-1&&(p=ol(p,e,n,i,l+1,h)),l>=n&&(p=e<0?f.contentMatchAt(0).fillBefore(p,h<=l).append(p):p.append(f.contentMatchAt(f.childCount).fillBefore(B.empty,!0))),o.replaceChild(e<0?0:o.childCount-1,f.copy(p))}function Sd(o,e,n){return e<o.openStart&&(o=new F(ol(o.content,-1,e,o.openStart,0,o.openEnd),e,o.openEnd)),n<o.openEnd&&(o=new F(ol(o.content,1,n,o.openEnd,0,0),o.openStart,n)),o}const Yf={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Cd=null;function Xf(){return Cd||(Cd=document.implementation.createHTMLDocument("title"))}let Bs=null;function e0(o){let e=window.trustedTypes;return e?(Bs||(Bs=e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),Bs.createHTML(o)):o}function t0(o){let e=/^(\s*<meta [^>]*>)*/.exec(o);e&&(o=o.slice(e[0].length));let n=Xf().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(o),l;if((l=i&&Yf[i[1].toLowerCase()])&&(o=l.map(h=>"<"+h+">").join("")+o+l.map(h=>"</"+h+">").reverse().join("")),n.innerHTML=e0(o),l)for(let h=0;h<l.length;h++)n=n.querySelector(l[h])||n;return n}function n0(o){let e=o.querySelectorAll(Ae?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let i=e[n];i.childNodes.length==1&&i.textContent==" "&&i.parentNode&&i.parentNode.replaceChild(o.ownerDocument.createTextNode(" "),i)}}function r0(o,e){if(!o.size)return o;let n=o.content.firstChild.type.schema,i;try{i=JSON.parse(e)}catch{return o}let{content:l,openStart:h,openEnd:f}=o;for(let p=i.length-2;p>=0;p-=2){let y=n.nodes[i[p]];if(!y||y.hasRequiredAttrs())break;l=B.from(y.create(i[p+1],l)),h++,f++}return new F(l,h,f)}const Fe={},Le={},i0={touchstart:!0,touchmove:!0};class o0{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function s0(o){for(let e in Fe){let n=Fe[e];o.dom.addEventListener(e,o.input.eventHandlers[e]=i=>{a0(o,i)&&!Cl(o,i)&&(o.editable||!(i.type in Le))&&n(o,i)},i0[e]?{passive:!0}:void 0)}Ve&&o.dom.addEventListener("input",()=>null),sl(o)}function sn(o,e){o.input.lastSelectionOrigin=e,o.input.lastSelectionTime=Date.now()}function l0(o){o.domObserver.stop();for(let e in o.input.eventHandlers)o.dom.removeEventListener(e,o.input.eventHandlers[e]);clearTimeout(o.input.composingTimeout),clearTimeout(o.input.lastIOSEnterFallbackTimeout)}function sl(o){o.someProp("handleDOMEvents",e=>{for(let n in e)o.input.eventHandlers[n]||o.dom.addEventListener(n,o.input.eventHandlers[n]=i=>Cl(o,i))})}function Cl(o,e){return o.someProp("handleDOMEvents",n=>{let i=n[e.type];return i?i(o,e)||e.defaultPrevented:!1})}function a0(o,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=o.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function c0(o,e){!Cl(o,e)&&Fe[e.type]&&(o.editable||!(e.type in Le))&&Fe[e.type](o,e)}Le.keydown=(o,e)=>{let n=e;if(o.input.shiftKey=n.keyCode==16||n.shiftKey,!Zf(o,n)&&(o.input.lastKeyCode=n.keyCode,o.input.lastKeyCodeTime=Date.now(),!(pt&&Ae&&n.keyCode==13)))if(n.keyCode!=229&&o.domObserver.forceFlush(),fr&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let i=Date.now();o.input.lastIOSEnter=i,o.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{o.input.lastIOSEnter==i&&(o.someProp("handleKeyDown",l=>l(o,On(13,"Enter"))),o.input.lastIOSEnter=0)},200)}else o.someProp("handleKeyDown",i=>i(o,n))||_g(o,n)?n.preventDefault():sn(o,"key")};Le.keyup=(o,e)=>{e.keyCode==16&&(o.input.shiftKey=!1)};Le.keypress=(o,e)=>{let n=e;if(Zf(o,n)||!n.charCode||n.ctrlKey&&!n.altKey||ot&&n.metaKey)return;if(o.someProp("handleKeyPress",l=>l(o,n))){n.preventDefault();return}let i=o.state.selection;if(!(i instanceof te)||!i.$from.sameParent(i.$to)){let l=String.fromCharCode(n.charCode);!/[\r\n]/.test(l)&&!o.someProp("handleTextInput",h=>h(o,i.$from.pos,i.$to.pos,l))&&o.dispatch(o.state.tr.insertText(l).scrollIntoView()),n.preventDefault()}};function uo(o){return{left:o.clientX,top:o.clientY}}function h0(o,e){let n=e.x-o.clientX,i=e.y-o.clientY;return n*n+i*i<100}function Ml(o,e,n,i,l){if(i==-1)return!1;let h=o.state.doc.resolve(i);for(let f=h.depth+1;f>0;f--)if(o.someProp(e,p=>f>h.depth?p(o,n,h.nodeAfter,h.before(f),l,!0):p(o,n,h.node(f),h.before(f),l,!1)))return!0;return!1}function ar(o,e,n){if(o.focused||o.focus(),o.state.selection.eq(e))return;let i=o.state.tr.setSelection(e);i.setMeta("pointer",!0),o.dispatch(i)}function d0(o,e){if(e==-1)return!1;let n=o.state.doc.resolve(e),i=n.nodeAfter;return i&&i.isAtom&&J.isSelectable(i)?(ar(o,new J(n)),!0):!1}function f0(o,e){if(e==-1)return!1;let n=o.state.selection,i,l;n instanceof J&&(i=n.node);let h=o.state.doc.resolve(e);for(let f=h.depth+1;f>0;f--){let p=f>h.depth?h.nodeAfter:h.node(f);if(J.isSelectable(p)){i&&n.$from.depth>0&&f>=n.$from.depth&&h.before(n.$from.depth+1)==n.$from.pos?l=h.before(n.$from.depth):l=h.before(f);break}}return l!=null?(ar(o,J.create(o.state.doc,l)),!0):!1}function u0(o,e,n,i,l){return Ml(o,"handleClickOn",e,n,i)||o.someProp("handleClick",h=>h(o,e,i))||(l?f0(o,n):d0(o,n))}function p0(o,e,n,i){return Ml(o,"handleDoubleClickOn",e,n,i)||o.someProp("handleDoubleClick",l=>l(o,e,i))}function m0(o,e,n,i){return Ml(o,"handleTripleClickOn",e,n,i)||o.someProp("handleTripleClick",l=>l(o,e,i))||g0(o,n,i)}function g0(o,e,n){if(n.button!=0)return!1;let i=o.state.doc;if(e==-1)return i.inlineContent?(ar(o,te.create(i,0,i.content.size)),!0):!1;let l=i.resolve(e);for(let h=l.depth+1;h>0;h--){let f=h>l.depth?l.nodeAfter:l.node(h),p=l.before(h);if(f.inlineContent)ar(o,te.create(i,p+1,p+1+f.content.size));else if(J.isSelectable(f))ar(o,J.create(i,p));else continue;return!0}}function vl(o){return no(o)}const _f=ot?"metaKey":"ctrlKey";Fe.mousedown=(o,e)=>{let n=e;o.input.shiftKey=n.shiftKey;let i=vl(o),l=Date.now(),h="singleClick";l-o.input.lastClick.time<500&&h0(n,o.input.lastClick)&&!n[_f]&&(o.input.lastClick.type=="singleClick"?h="doubleClick":o.input.lastClick.type=="doubleClick"&&(h="tripleClick")),o.input.lastClick={time:l,x:n.clientX,y:n.clientY,type:h};let f=o.posAtCoords(uo(n));f&&(h=="singleClick"?(o.input.mouseDown&&o.input.mouseDown.done(),o.input.mouseDown=new y0(o,f,n,!!i)):(h=="doubleClick"?p0:m0)(o,f.pos,f.inside,n)?n.preventDefault():sn(o,"pointer"))};class y0{constructor(e,n,i,l){this.view=e,this.pos=n,this.event=i,this.flushed=l,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!i[_f],this.allowDefault=i.shiftKey;let h,f;if(n.inside>-1)h=e.state.doc.nodeAt(n.inside),f=n.inside;else{let S=e.state.doc.resolve(n.pos);h=S.parent,f=S.depth?S.before():0}const p=l?null:i.target,y=p?e.docView.nearestDesc(p,!0):null;this.target=y&&y.dom.nodeType==1?y.dom:null;let{selection:b}=e.state;(i.button==0&&h.type.spec.draggable&&h.type.spec.selectable!==!1||b instanceof J&&b.from<=f&&b.to>f)&&(this.mightDrag={node:h,pos:f,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),sn(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Vt(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(uo(e))),this.updateAllowDefault(e),this.allowDefault||!n?sn(this.view,"pointer"):u0(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ve&&this.mightDrag&&!this.mightDrag.node.isAtom||Ae&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ar(this.view,_.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):sn(this.view,"pointer")}move(e){this.updateAllowDefault(e),sn(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Fe.touchstart=o=>{o.input.lastTouch=Date.now(),vl(o),sn(o,"pointer")};Fe.touchmove=o=>{o.input.lastTouch=Date.now(),sn(o,"pointer")};Fe.contextmenu=o=>vl(o);function Zf(o,e){return o.composing?!0:Ve&&Math.abs(e.timeStamp-o.input.compositionEndedAt)<500?(o.input.compositionEndedAt=-2e8,!0):!1}const w0=pt?5e3:-1;Le.compositionstart=Le.compositionupdate=o=>{if(!o.composing){o.domObserver.flush();let{state:e}=o,n=e.selection.$to;if(e.selection instanceof te&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(i=>i.type.spec.inclusive===!1)))o.markCursor=o.state.storedMarks||n.marks(),no(o,!0),o.markCursor=null;else if(no(o,!e.selection.empty),gt&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let i=o.domSelectionRange();for(let l=i.focusNode,h=i.focusOffset;l&&l.nodeType==1&&h!=0;){let f=h<0?l.lastChild:l.childNodes[h-1];if(!f)break;if(f.nodeType==3){let p=o.domSelection();p&&p.collapse(f,f.nodeValue.length);break}else l=f,h=-1}}o.input.composing=!0}Qf(o,w0)};Le.compositionend=(o,e)=>{o.composing&&(o.input.composing=!1,o.input.compositionEndedAt=e.timeStamp,o.input.compositionPendingChanges=o.domObserver.pendingRecords().length?o.input.compositionID:0,o.input.compositionNode=null,o.input.compositionPendingChanges&&Promise.resolve().then(()=>o.domObserver.flush()),o.input.compositionID++,Qf(o,20))};function Qf(o,e){clearTimeout(o.input.composingTimeout),e>-1&&(o.input.composingTimeout=setTimeout(()=>no(o),e))}function eu(o){for(o.composing&&(o.input.composing=!1,o.input.compositionEndedAt=k0());o.input.compositionNodes.length>0;)o.input.compositionNodes.pop().markParentsDirty()}function b0(o){let e=o.domSelectionRange();if(!e.focusNode)return null;let n=dg(e.focusNode,e.focusOffset),i=fg(e.focusNode,e.focusOffset);if(n&&i&&n!=i){let l=i.pmViewDesc,h=o.domObserver.lastChangedTextNode;if(n==h||i==h)return h;if(!l||!l.isText(i.nodeValue))return i;if(o.input.compositionNode==i){let f=n.pmViewDesc;if(!(!f||!f.isText(n.nodeValue)))return i}}return n||i}function k0(){let o=document.createEvent("Event");return o.initEvent("event",!0,!0),o.timeStamp}function no(o,e=!1){if(!(pt&&o.domObserver.flushingSoon>=0)){if(o.domObserver.forceFlush(),eu(o),e||o.docView&&o.docView.dirty){let n=xl(o);return n&&!n.eq(o.state.selection)?o.dispatch(o.state.tr.setSelection(n)):(o.markCursor||e)&&!o.state.selection.empty?o.dispatch(o.state.tr.deleteSelection()):o.updateState(o.state),!0}return!1}}function x0(o,e){if(!o.dom.parentNode)return;let n=o.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),l=document.createRange();l.selectNodeContents(e),o.dom.blur(),i.removeAllRanges(),i.addRange(l),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),o.focus()},50)}const ni=Ue&&ln<15||fr&&yg<604;Fe.copy=Le.cut=(o,e)=>{let n=e,i=o.state.selection,l=n.type=="cut";if(i.empty)return;let h=ni?null:n.clipboardData,f=i.content(),{dom:p,text:y}=Hf(o,f);h?(n.preventDefault(),h.clearData(),h.setData("text/html",p.innerHTML),h.setData("text/plain",y)):x0(o,p),l&&o.dispatch(o.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function S0(o){return o.openStart==0&&o.openEnd==0&&o.content.childCount==1?o.content.firstChild:null}function C0(o,e){if(!o.dom.parentNode)return;let n=o.input.shiftKey||o.state.selection.$from.parent.type.spec.code,i=o.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus();let l=o.input.shiftKey&&o.input.lastKeyCode!=45;setTimeout(()=>{o.focus(),i.parentNode&&i.parentNode.removeChild(i),n?ri(o,i.value,null,l,e):ri(o,i.textContent,i.innerHTML,l,e)},50)}function ri(o,e,n,i,l){let h=Kf(o,e,n,i,o.state.selection.$from);if(o.someProp("handlePaste",y=>y(o,l,h||F.empty)))return!0;if(!h)return!1;let f=S0(h),p=f?o.state.tr.replaceSelectionWith(f,i):o.state.tr.replaceSelection(h);return o.dispatch(p.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function tu(o){let e=o.getData("text/plain")||o.getData("Text");if(e)return e;let n=o.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Le.paste=(o,e)=>{let n=e;if(o.composing&&!pt)return;let i=ni?null:n.clipboardData,l=o.input.shiftKey&&o.input.lastKeyCode!=45;i&&ri(o,tu(i),i.getData("text/html"),l,n)?n.preventDefault():C0(o,n)};class nu{constructor(e,n,i){this.slice=e,this.move=n,this.node=i}}const ru=ot?"altKey":"ctrlKey";Fe.dragstart=(o,e)=>{let n=e,i=o.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let l=o.state.selection,h=l.empty?null:o.posAtCoords(uo(n)),f;if(!(h&&h.pos>=l.from&&h.pos<=(l instanceof J?l.to-1:l.to))){if(i&&i.mightDrag)f=J.create(o.state.doc,i.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let O=o.docView.nearestDesc(n.target,!0);O&&O.node.type.spec.draggable&&O!=o.docView&&(f=J.create(o.state.doc,O.posBefore))}}let p=(f||o.state.selection).content(),{dom:y,text:b,slice:S}=Hf(o,p);(!n.dataTransfer.files.length||!Ae||Df>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(ni?"Text":"text/html",y.innerHTML),n.dataTransfer.effectAllowed="copyMove",ni||n.dataTransfer.setData("text/plain",b),o.dragging=new nu(S,!n[ru],f)};Fe.dragend=o=>{let e=o.dragging;window.setTimeout(()=>{o.dragging==e&&(o.dragging=null)},50)};Le.dragover=Le.dragenter=(o,e)=>e.preventDefault();Le.drop=(o,e)=>{let n=e,i=o.dragging;if(o.dragging=null,!n.dataTransfer)return;let l=o.posAtCoords(uo(n));if(!l)return;let h=o.state.doc.resolve(l.pos),f=i&&i.slice;f?o.someProp("transformPasted",T=>{f=T(f,o)}):f=Kf(o,tu(n.dataTransfer),ni?null:n.dataTransfer.getData("text/html"),!1,h);let p=!!(i&&!n[ru]);if(o.someProp("handleDrop",T=>T(o,n,f||F.empty,p))){n.preventDefault();return}if(!f)return;n.preventDefault();let y=f?bf(o.state.doc,h.pos,f):h.pos;y==null&&(y=h.pos);let b=o.state.tr;if(p){let{node:T}=i;T?T.replace(b):b.deleteSelection()}let S=b.mapping.map(y),O=f.openStart==0&&f.openEnd==0&&f.content.childCount==1,N=b.doc;if(O?b.replaceRangeWith(S,S,f.content.firstChild):b.replaceRange(S,S,f),b.doc.eq(N))return;let E=b.doc.resolve(S);if(O&&J.isSelectable(f.content.firstChild)&&E.nodeAfter&&E.nodeAfter.sameMarkup(f.content.firstChild))b.setSelection(new J(E));else{let T=b.mapping.map(y);b.mapping.maps[b.mapping.maps.length-1].forEach((z,P,L,Q)=>T=Q),b.setSelection(Sl(o,E,b.doc.resolve(T)))}o.focus(),o.dispatch(b.setMeta("uiEvent","drop"))};Fe.focus=o=>{o.input.lastFocus=Date.now(),o.focused||(o.domObserver.stop(),o.dom.classList.add("ProseMirror-focused"),o.domObserver.start(),o.focused=!0,setTimeout(()=>{o.docView&&o.hasFocus()&&!o.domObserver.currentSelection.eq(o.domSelectionRange())&&Vt(o)},20))};Fe.blur=(o,e)=>{let n=e;o.focused&&(o.domObserver.stop(),o.dom.classList.remove("ProseMirror-focused"),o.domObserver.start(),n.relatedTarget&&o.dom.contains(n.relatedTarget)&&o.domObserver.currentSelection.clear(),o.focused=!1)};Fe.beforeinput=(o,e)=>{if(Ae&&pt&&e.inputType=="deleteContentBackward"){o.domObserver.flushSoon();let{domChangeCount:i}=o.input;setTimeout(()=>{if(o.input.domChangeCount!=i||(o.dom.blur(),o.focus(),o.someProp("handleKeyDown",h=>h(o,On(8,"Backspace")))))return;let{$cursor:l}=o.state.selection;l&&l.pos>0&&o.dispatch(o.state.tr.delete(l.pos-1,l.pos).scrollIntoView())},50)}};for(let o in Le)Fe[o]=Le[o];function ii(o,e){if(o==e)return!0;for(let n in o)if(o[n]!==e[n])return!1;for(let n in e)if(!(n in o))return!1;return!0}class ro{constructor(e,n){this.toDOM=e,this.spec=n||In,this.side=this.spec.side||0}map(e,n,i,l){let{pos:h,deleted:f}=e.mapResult(n.from+l,this.side<0?-1:1);return f?null:new at(h-i,h-i,this)}valid(){return!0}eq(e){return this==e||e instanceof ro&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&ii(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class cn{constructor(e,n){this.attrs=e,this.spec=n||In}map(e,n,i,l){let h=e.map(n.from+l,this.spec.inclusiveStart?-1:1)-i,f=e.map(n.to+l,this.spec.inclusiveEnd?1:-1)-i;return h>=f?null:new at(h,f,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof cn&&ii(this.attrs,e.attrs)&&ii(this.spec,e.spec)}static is(e){return e.type instanceof cn}destroy(){}}class Ol{constructor(e,n){this.attrs=e,this.spec=n||In}map(e,n,i,l){let h=e.mapResult(n.from+l,1);if(h.deleted)return null;let f=e.mapResult(n.to+l,-1);return f.deleted||f.pos<=h.pos?null:new at(h.pos-i,f.pos-i,this)}valid(e,n){let{index:i,offset:l}=e.content.findIndex(n.from),h;return l==n.from&&!(h=e.child(i)).isText&&l+h.nodeSize==n.to}eq(e){return this==e||e instanceof Ol&&ii(this.attrs,e.attrs)&&ii(this.spec,e.spec)}destroy(){}}class at{constructor(e,n,i){this.from=e,this.to=n,this.type=i}copy(e,n){return new at(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,i){return this.type.map(e,this,n,i)}static widget(e,n,i){return new at(e,e,new ro(n,i))}static inline(e,n,i,l){return new at(e,n,new cn(i,l))}static node(e,n,i,l){return new at(e,n,new Ol(i,l))}get spec(){return this.type.spec}get inline(){return this.type instanceof cn}get widget(){return this.type instanceof ro}}const rr=[],In={};class ue{constructor(e,n){this.local=e.length?e:rr,this.children=n.length?n:rr}static create(e,n){return n.length?io(n,e,0,In):Te}find(e,n,i){let l=[];return this.findInner(e??0,n??1e9,l,0,i),l}findInner(e,n,i,l,h){for(let f=0;f<this.local.length;f++){let p=this.local[f];p.from<=n&&p.to>=e&&(!h||h(p.spec))&&i.push(p.copy(p.from+l,p.to+l))}for(let f=0;f<this.children.length;f+=3)if(this.children[f]<n&&this.children[f+1]>e){let p=this.children[f]+1;this.children[f+2].findInner(e-p,n-p,i,l+p,h)}}map(e,n,i){return this==Te||e.maps.length==0?this:this.mapInner(e,n,0,0,i||In)}mapInner(e,n,i,l,h){let f;for(let p=0;p<this.local.length;p++){let y=this.local[p].map(e,i,l);y&&y.type.valid(n,y)?(f||(f=[])).push(y):h.onRemove&&h.onRemove(this.local[p].spec)}return this.children.length?M0(this.children,f||[],e,n,i,l,h):f?new ue(f.sort(Rn),rr):Te}add(e,n){return n.length?this==Te?ue.create(e,n):this.addInner(e,n,0):this}addInner(e,n,i){let l,h=0;e.forEach((p,y)=>{let b=y+i,S;if(S=ou(n,p,b)){for(l||(l=this.children.slice());h<l.length&&l[h]<y;)h+=3;l[h]==y?l[h+2]=l[h+2].addInner(p,S,b+1):l.splice(h,0,y,y+p.nodeSize,io(S,p,b+1,In)),h+=3}});let f=iu(h?su(n):n,-i);for(let p=0;p<f.length;p++)f[p].type.valid(e,f[p])||f.splice(p--,1);return new ue(f.length?this.local.concat(f).sort(Rn):this.local,l||this.children)}remove(e){return e.length==0||this==Te?this:this.removeInner(e,0)}removeInner(e,n){let i=this.children,l=this.local;for(let h=0;h<i.length;h+=3){let f,p=i[h]+n,y=i[h+1]+n;for(let S=0,O;S<e.length;S++)(O=e[S])&&O.from>p&&O.to<y&&(e[S]=null,(f||(f=[])).push(O));if(!f)continue;i==this.children&&(i=this.children.slice());let b=i[h+2].removeInner(f,p+1);b!=Te?i[h+2]=b:(i.splice(h,3),h-=3)}if(l.length){for(let h=0,f;h<e.length;h++)if(f=e[h])for(let p=0;p<l.length;p++)l[p].eq(f,n)&&(l==this.local&&(l=this.local.slice()),l.splice(p--,1))}return i==this.children&&l==this.local?this:l.length||i.length?new ue(l,i):Te}forChild(e,n){if(this==Te)return this;if(n.isLeaf)return ue.empty;let i,l;for(let p=0;p<this.children.length;p+=3)if(this.children[p]>=e){this.children[p]==e&&(i=this.children[p+2]);break}let h=e+1,f=h+n.content.size;for(let p=0;p<this.local.length;p++){let y=this.local[p];if(y.from<f&&y.to>h&&y.type instanceof cn){let b=Math.max(h,y.from)-h,S=Math.min(f,y.to)-h;b<S&&(l||(l=[])).push(y.copy(b,S))}}if(l){let p=new ue(l.sort(Rn),rr);return i?new tn([p,i]):p}return i||Te}eq(e){if(this==e)return!0;if(!(e instanceof ue)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Nl(this.localsInner(e))}localsInner(e){if(this==Te)return rr;if(e.inlineContent||!this.local.some(cn.is))return this.local;let n=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof cn||n.push(this.local[i]);return n}forEachSet(e){e(this)}}ue.empty=new ue([],[]);ue.removeOverlap=Nl;const Te=ue.empty;class tn{constructor(e){this.members=e}map(e,n){const i=this.members.map(l=>l.map(e,n,In));return tn.from(i)}forChild(e,n){if(n.isLeaf)return ue.empty;let i=[];for(let l=0;l<this.members.length;l++){let h=this.members[l].forChild(e,n);h!=Te&&(h instanceof tn?i=i.concat(h.members):i.push(h))}return tn.from(i)}eq(e){if(!(e instanceof tn)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,i=!0;for(let l=0;l<this.members.length;l++){let h=this.members[l].localsInner(e);if(h.length)if(!n)n=h;else{i&&(n=n.slice(),i=!1);for(let f=0;f<h.length;f++)n.push(h[f])}}return n?Nl(i?n:n.sort(Rn)):rr}static from(e){switch(e.length){case 0:return Te;case 1:return e[0];default:return new tn(e.every(n=>n instanceof ue)?e:e.reduce((n,i)=>n.concat(i instanceof ue?i:i.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function M0(o,e,n,i,l,h,f){let p=o.slice();for(let b=0,S=h;b<n.maps.length;b++){let O=0;n.maps[b].forEach((N,E,T,z)=>{let P=z-T-(E-N);for(let L=0;L<p.length;L+=3){let Q=p[L+1];if(Q<0||N>Q+S-O)continue;let we=p[L]+S-O;E>=we?p[L+1]=N<=we?-2:-1:N>=S&&P&&(p[L]+=P,p[L+1]+=P)}O+=P}),S=n.maps[b].map(S,-1)}let y=!1;for(let b=0;b<p.length;b+=3)if(p[b+1]<0){if(p[b+1]==-2){y=!0,p[b+1]=-1;continue}let S=n.map(o[b]+h),O=S-l;if(O<0||O>=i.content.size){y=!0;continue}let N=n.map(o[b+1]+h,-1),E=N-l,{index:T,offset:z}=i.content.findIndex(O),P=i.maybeChild(T);if(P&&z==O&&z+P.nodeSize==E){let L=p[b+2].mapInner(n,P,S+1,o[b]+h+1,f);L!=Te?(p[b]=O,p[b+1]=E,p[b+2]=L):(p[b+1]=-2,y=!0)}else y=!0}if(y){let b=v0(p,o,e,n,l,h,f),S=io(b,i,0,f);e=S.local;for(let O=0;O<p.length;O+=3)p[O+1]<0&&(p.splice(O,3),O-=3);for(let O=0,N=0;O<S.children.length;O+=3){let E=S.children[O];for(;N<p.length&&p[N]<E;)N+=3;p.splice(N,0,S.children[O],S.children[O+1],S.children[O+2])}}return new ue(e.sort(Rn),p)}function iu(o,e){if(!e||!o.length)return o;let n=[];for(let i=0;i<o.length;i++){let l=o[i];n.push(new at(l.from+e,l.to+e,l.type))}return n}function v0(o,e,n,i,l,h,f){function p(y,b){for(let S=0;S<y.local.length;S++){let O=y.local[S].map(i,l,b);O?n.push(O):f.onRemove&&f.onRemove(y.local[S].spec)}for(let S=0;S<y.children.length;S+=3)p(y.children[S+2],y.children[S]+b+1)}for(let y=0;y<o.length;y+=3)o[y+1]==-1&&p(o[y+2],e[y]+h+1);return n}function ou(o,e,n){if(e.isLeaf)return null;let i=n+e.nodeSize,l=null;for(let h=0,f;h<o.length;h++)(f=o[h])&&f.from>n&&f.to<i&&((l||(l=[])).push(f),o[h]=null);return l}function su(o){let e=[];for(let n=0;n<o.length;n++)o[n]!=null&&e.push(o[n]);return e}function io(o,e,n,i){let l=[],h=!1;e.forEach((p,y)=>{let b=ou(o,p,y+n);if(b){h=!0;let S=io(b,p,n+y+1,i);S!=Te&&l.push(y,y+p.nodeSize,S)}});let f=iu(h?su(o):o,-n).sort(Rn);for(let p=0;p<f.length;p++)f[p].type.valid(e,f[p])||(i.onRemove&&i.onRemove(f[p].spec),f.splice(p--,1));return f.length||l.length?new ue(f,l):Te}function Rn(o,e){return o.from-e.from||o.to-e.to}function Nl(o){let e=o;for(let n=0;n<e.length-1;n++){let i=e[n];if(i.from!=i.to)for(let l=n+1;l<e.length;l++){let h=e[l];if(h.from==i.from){h.to!=i.to&&(e==o&&(e=o.slice()),e[l]=h.copy(h.from,i.to),Md(e,l+1,h.copy(i.to,h.to)));continue}else{h.from<i.to&&(e==o&&(e=o.slice()),e[n]=i.copy(i.from,h.from),Md(e,l,i.copy(h.from,i.to)));break}}}return e}function Md(o,e,n){for(;e<o.length&&Rn(n,o[e])>0;)e++;o.splice(e,0,n)}function Vs(o){let e=[];return o.someProp("decorations",n=>{let i=n(o.state);i&&i!=Te&&e.push(i)}),o.cursorWrapper&&e.push(ue.create(o.state.doc,[o.cursorWrapper.deco])),tn.from(e)}const O0={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},N0=Ue&&ln<=11;class D0{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class T0{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new D0,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(i=>{for(let l=0;l<i.length;l++)this.queue.push(i[l]);Ue&&ln<=11&&i.some(l=>l.type=="childList"&&l.removedNodes.length||l.type=="characterData"&&l.oldValue.length>l.target.nodeValue.length)?this.flushSoon():this.flush()}),N0&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,O0)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(gd(this.view)){if(this.suppressingSelectionUpdates)return Vt(this.view);if(Ue&&ln<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Bn(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,i;for(let h=e.focusNode;h;h=ti(h))n.add(h);for(let h=e.anchorNode;h;h=ti(h))if(n.has(h)){i=h;break}let l=i&&this.view.docView.nearestDesc(i);if(l&&l.ignoreMutation({type:"selection",target:i.nodeType==3?i.parentNode:i}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let i=e.domSelectionRange(),l=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(i)&&gd(e)&&!this.ignoreSelectionChange(i),h=-1,f=-1,p=!1,y=[];if(e.editable)for(let S=0;S<n.length;S++){let O=this.registerMutation(n[S],y);O&&(h=h<0?O.from:Math.min(O.from,h),f=f<0?O.to:Math.max(O.to,f),O.typeOver&&(p=!0))}if(gt&&y.length){let S=y.filter(O=>O.nodeName=="BR");if(S.length==2){let[O,N]=S;O.parentNode&&O.parentNode.parentNode==N.parentNode?N.remove():O.remove()}else{let{focusNode:O}=this.currentSelection;for(let N of S){let E=N.parentNode;E&&E.nodeName=="LI"&&(!O||I0(e,O)!=E)&&N.remove()}}}let b=null;h<0&&l&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&ho(i)&&(b=xl(e))&&b.eq(_.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Vt(e),this.currentSelection.set(i),e.scrollToSelection()):(h>-1||l)&&(h>-1&&(e.docView.markDirty(h,f),E0(e)),this.handleDOMChange(h,f,p,y),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(i)||Vt(e),this.currentSelection.set(i))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let i=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(i==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!i||i.ignoreMutation(e))return null;if(e.type=="childList"){for(let S=0;S<e.addedNodes.length;S++){let O=e.addedNodes[S];n.push(O),O.nodeType==3&&(this.lastChangedTextNode=O)}if(i.contentDOM&&i.contentDOM!=i.dom&&!i.contentDOM.contains(e.target))return{from:i.posBefore,to:i.posAfter};let l=e.previousSibling,h=e.nextSibling;if(Ue&&ln<=11&&e.addedNodes.length)for(let S=0;S<e.addedNodes.length;S++){let{previousSibling:O,nextSibling:N}=e.addedNodes[S];(!O||Array.prototype.indexOf.call(e.addedNodes,O)<0)&&(l=O),(!N||Array.prototype.indexOf.call(e.addedNodes,N)<0)&&(h=N)}let f=l&&l.parentNode==e.target?Ce(l)+1:0,p=i.localPosFromDOM(e.target,f,-1),y=h&&h.parentNode==e.target?Ce(h):e.target.childNodes.length,b=i.localPosFromDOM(e.target,y,1);return{from:p,to:b}}else return e.type=="attributes"?{from:i.posAtStart-i.border,to:i.posAtEnd+i.border}:(this.lastChangedTextNode=e.target,{from:i.posAtStart,to:i.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let vd=new WeakMap,Od=!1;function E0(o){if(!vd.has(o)&&(vd.set(o,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(o.dom).whiteSpace)!==-1)){if(o.requiresGeckoHackNode=gt,Od)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Od=!0}}function Nd(o,e){let n=e.startContainer,i=e.startOffset,l=e.endContainer,h=e.endOffset,f=o.domAtPos(o.state.selection.anchor);return Bn(f.node,f.offset,l,h)&&([n,i,l,h]=[l,h,n,i]),{anchorNode:n,anchorOffset:i,focusNode:l,focusOffset:h}}function A0(o,e){if(e.getComposedRanges){let l=e.getComposedRanges(o.root)[0];if(l)return Nd(o,l)}let n;function i(l){l.preventDefault(),l.stopImmediatePropagation(),n=l.getTargetRanges()[0]}return o.dom.addEventListener("beforeinput",i,!0),document.execCommand("indent"),o.dom.removeEventListener("beforeinput",i,!0),n?Nd(o,n):null}function I0(o,e){for(let n=e.parentNode;n&&n!=o.dom;n=n.parentNode){let i=o.docView.nearestDesc(n,!0);if(i&&i.node.isBlock)return n}return null}function R0(o,e,n){let{node:i,fromOffset:l,toOffset:h,from:f,to:p}=o.docView.parseRange(e,n),y=o.domSelectionRange(),b,S=y.anchorNode;if(S&&o.dom.contains(S.nodeType==1?S:S.parentNode)&&(b=[{node:S,offset:y.anchorOffset}],ho(y)||b.push({node:y.focusNode,offset:y.focusOffset})),Ae&&o.input.lastKeyCode===8)for(let P=h;P>l;P--){let L=i.childNodes[P-1],Q=L.pmViewDesc;if(L.nodeName=="BR"&&!Q){h=P;break}if(!Q||Q.size)break}let O=o.state.doc,N=o.someProp("domParser")||cr.fromSchema(o.state.schema),E=O.resolve(f),T=null,z=N.parse(i,{topNode:E.parent,topMatch:E.parent.contentMatchAt(E.index()),topOpen:!0,from:l,to:h,preserveWhitespace:E.parent.type.whitespace=="pre"?"full":!0,findPositions:b,ruleFromNode:z0,context:E});if(b&&b[0].pos!=null){let P=b[0].pos,L=b[1]&&b[1].pos;L==null&&(L=P),T={anchor:P+f,head:L+f}}return{doc:z,sel:T,from:f,to:p}}function z0(o){let e=o.pmViewDesc;if(e)return e.parseRule();if(o.nodeName=="BR"&&o.parentNode){if(Ve&&/^(ul|ol)$/i.test(o.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(o.parentNode.lastChild==o||Ve&&/^(tr|table)$/i.test(o.parentNode.nodeName))return{ignore:!0}}else if(o.nodeName=="IMG"&&o.getAttribute("mark-placeholder"))return{ignore:!0};return null}const P0=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function B0(o,e,n,i,l){let h=o.input.compositionPendingChanges||(o.composing?o.input.compositionID:0);if(o.input.compositionPendingChanges=0,e<0){let G=o.input.lastSelectionTime>Date.now()-50?o.input.lastSelectionOrigin:null,wt=xl(o,G);if(wt&&!o.state.selection.eq(wt)){if(Ae&&pt&&o.input.lastKeyCode===13&&Date.now()-100<o.input.lastKeyCodeTime&&o.someProp("handleKeyDown",Ln=>Ln(o,On(13,"Enter"))))return;let Oe=o.state.tr.setSelection(wt);G=="pointer"?Oe.setMeta("pointer",!0):G=="key"&&Oe.scrollIntoView(),h&&Oe.setMeta("composition",h),o.dispatch(Oe)}return}let f=o.state.doc.resolve(e),p=f.sharedDepth(n);e=f.before(p+1),n=o.state.doc.resolve(n).after(p+1);let y=o.state.selection,b=R0(o,e,n),S=o.state.doc,O=S.slice(b.from,b.to),N,E;o.input.lastKeyCode===8&&Date.now()-100<o.input.lastKeyCodeTime?(N=o.state.selection.to,E="end"):(N=o.state.selection.from,E="start"),o.input.lastKeyCode=null;let T=L0(O.content,b.doc.content,b.from,N,E);if(T&&o.input.domChangeCount++,(fr&&o.input.lastIOSEnter>Date.now()-225||pt)&&l.some(G=>G.nodeType==1&&!P0.test(G.nodeName))&&(!T||T.endA>=T.endB)&&o.someProp("handleKeyDown",G=>G(o,On(13,"Enter")))){o.input.lastIOSEnter=0;return}if(!T)if(i&&y instanceof te&&!y.empty&&y.$head.sameParent(y.$anchor)&&!o.composing&&!(b.sel&&b.sel.anchor!=b.sel.head))T={start:y.from,endA:y.to,endB:y.to};else{if(b.sel){let G=Dd(o,o.state.doc,b.sel);if(G&&!G.eq(o.state.selection)){let wt=o.state.tr.setSelection(G);h&&wt.setMeta("composition",h),o.dispatch(wt)}}return}o.state.selection.from<o.state.selection.to&&T.start==T.endB&&o.state.selection instanceof te&&(T.start>o.state.selection.from&&T.start<=o.state.selection.from+2&&o.state.selection.from>=b.from?T.start=o.state.selection.from:T.endA<o.state.selection.to&&T.endA>=o.state.selection.to-2&&o.state.selection.to<=b.to&&(T.endB+=o.state.selection.to-T.endA,T.endA=o.state.selection.to)),Ue&&ln<=11&&T.endB==T.start+1&&T.endA==T.start&&T.start>b.from&&b.doc.textBetween(T.start-b.from-1,T.start-b.from+1)=="  "&&(T.start--,T.endA--,T.endB--);let z=b.doc.resolveNoCache(T.start-b.from),P=b.doc.resolveNoCache(T.endB-b.from),L=S.resolve(T.start),Q=z.sameParent(P)&&z.parent.inlineContent&&L.end()>=T.endA,we;if((fr&&o.input.lastIOSEnter>Date.now()-225&&(!Q||l.some(G=>G.nodeName=="DIV"||G.nodeName=="P"))||!Q&&z.pos<b.doc.content.size&&!z.sameParent(P)&&(we=_.findFrom(b.doc.resolve(z.pos+1),1,!0))&&we.head==P.pos)&&o.someProp("handleKeyDown",G=>G(o,On(13,"Enter")))){o.input.lastIOSEnter=0;return}if(o.state.selection.anchor>T.start&&F0(S,T.start,T.endA,z,P)&&o.someProp("handleKeyDown",G=>G(o,On(8,"Backspace")))){pt&&Ae&&o.domObserver.suppressSelectionUpdates();return}Ae&&pt&&T.endB==T.start&&(o.input.lastAndroidDelete=Date.now()),pt&&!Q&&z.start()!=P.start()&&P.parentOffset==0&&z.depth==P.depth&&b.sel&&b.sel.anchor==b.sel.head&&b.sel.head==T.endA&&(T.endB-=2,P=b.doc.resolveNoCache(T.endB-b.from),setTimeout(()=>{o.someProp("handleKeyDown",function(G){return G(o,On(13,"Enter"))})},20));let Ge=T.start,qe=T.endA,Re,gr,un;if(Q){if(z.pos==P.pos)Ue&&ln<=11&&z.parentOffset==0&&(o.domObserver.suppressSelectionUpdates(),setTimeout(()=>Vt(o),20)),Re=o.state.tr.delete(Ge,qe),gr=S.resolve(T.start).marksAcross(S.resolve(T.endA));else if(T.endA==T.endB&&(un=V0(z.parent.content.cut(z.parentOffset,P.parentOffset),L.parent.content.cut(L.parentOffset,T.endA-L.start()))))Re=o.state.tr,un.type=="add"?Re.addMark(Ge,qe,un.mark):Re.removeMark(Ge,qe,un.mark);else if(z.parent.child(z.index()).isText&&z.index()==P.index()-(P.textOffset?0:1)){let G=z.parent.textBetween(z.parentOffset,P.parentOffset);if(o.someProp("handleTextInput",wt=>wt(o,Ge,qe,G)))return;Re=o.state.tr.insertText(G,Ge,qe)}}if(Re||(Re=o.state.tr.replace(Ge,qe,b.doc.slice(T.start-b.from,T.endB-b.from))),b.sel){let G=Dd(o,Re.doc,b.sel);G&&!(Ae&&pt&&o.composing&&G.empty&&(T.start!=T.endB||o.input.lastAndroidDelete<Date.now()-100)&&(G.head==Ge||G.head==Re.mapping.map(qe)-1)||Ue&&G.empty&&G.head==Ge)&&Re.setSelection(G)}gr&&Re.ensureMarks(gr),h&&Re.setMeta("composition",h),o.dispatch(Re.scrollIntoView())}function Dd(o,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Sl(o,e.resolve(n.anchor),e.resolve(n.head))}function V0(o,e){let n=o.firstChild.marks,i=e.firstChild.marks,l=n,h=i,f,p,y;for(let S=0;S<i.length;S++)l=i[S].removeFromSet(l);for(let S=0;S<n.length;S++)h=n[S].removeFromSet(h);if(l.length==1&&h.length==0)p=l[0],f="add",y=S=>S.mark(p.addToSet(S.marks));else if(l.length==0&&h.length==1)p=h[0],f="remove",y=S=>S.mark(p.removeFromSet(S.marks));else return null;let b=[];for(let S=0;S<e.childCount;S++)b.push(y(e.child(S)));if(B.from(b).eq(o))return{mark:p,type:f}}function F0(o,e,n,i,l){if(n-e<=l.pos-i.pos||Fs(i,!0,!1)<l.pos)return!1;let h=o.resolve(e);if(!i.parent.isTextblock){let p=h.nodeAfter;return p!=null&&n==e+p.nodeSize}if(h.parentOffset<h.parent.content.size||!h.parent.isTextblock)return!1;let f=o.resolve(Fs(h,!0,!0));return!f.parent.isTextblock||f.pos>n||Fs(f,!0,!1)<n?!1:i.parent.content.cut(i.parentOffset).eq(f.parent.content)}function Fs(o,e,n){let i=o.depth,l=e?o.end():o.pos;for(;i>0&&(e||o.indexAfter(i)==o.node(i).childCount);)i--,l++,e=!1;if(n){let h=o.node(i).maybeChild(o.indexAfter(i));for(;h&&!h.isLeaf;)h=h.firstChild,l++}return l}function L0(o,e,n,i,l){let h=o.findDiffStart(e,n);if(h==null)return null;let{a:f,b:p}=o.findDiffEnd(e,n+o.size,n+e.size);if(l=="end"){let y=Math.max(0,h-Math.min(f,p));i-=f+y-h}if(f<h&&o.size<e.size){let y=i<=h&&i>=f?h-i:0;h-=y,h&&h<e.size&&Td(e.textBetween(h-1,h+1))&&(h+=y?1:-1),p=h+(p-f),f=h}else if(p<h){let y=i<=h&&i>=p?h-i:0;h-=y,h&&h<o.size&&Td(o.textBetween(h-1,h+1))&&(h+=y?1:-1),f=h+(f-p),p=h}return{start:h,endA:f,endB:p}}function Td(o){if(o.length!=2)return!1;let e=o.charCodeAt(0),n=o.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class q0{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new o0,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(zd),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Id(this),Ad(this),this.nodeViews=Rd(this),this.docView=hd(this.state.doc,Ed(this),Vs(this),this.dom,this),this.domObserver=new T0(this,(i,l,h,f)=>B0(this,i,l,h,f)),this.domObserver.start(),s0(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&sl(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(zd),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let i in this._props)n[i]=this._props[i];n.state=this.state;for(let i in e)n[i]=e[i];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var i;let l=this.state,h=!1,f=!1;e.storedMarks&&this.composing&&(eu(this),f=!0),this.state=e;let p=l.plugins!=e.plugins||this._props.plugins!=n.plugins;if(p||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let E=Rd(this);W0(E,this.nodeViews)&&(this.nodeViews=E,h=!0)}(p||n.handleDOMEvents!=this._props.handleDOMEvents)&&sl(this),this.editable=Id(this),Ad(this);let y=Vs(this),b=Ed(this),S=l.plugins!=e.plugins&&!l.doc.eq(e.doc)?"reset":e.scrollToSelection>l.scrollToSelection?"to selection":"preserve",O=h||!this.docView.matchesNode(e.doc,b,y);(O||!e.selection.eq(l.selection))&&(f=!0);let N=S=="preserve"&&f&&this.dom.style.overflowAnchor==null&&kg(this);if(f){this.domObserver.stop();let E=O&&(Ue||Ae)&&!this.composing&&!l.selection.empty&&!e.selection.empty&&$0(l.selection,e.selection);if(O){let T=Ae?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=b0(this)),(h||!this.docView.update(e.doc,b,y,this))&&(this.docView.updateOuterDeco(b),this.docView.destroy(),this.docView=hd(e.doc,b,y,this.dom,this)),T&&!this.trackWrites&&(E=!0)}E||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Hg(this))?Vt(this,E):($f(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(l),!((i=this.dragging)===null||i===void 0)&&i.node&&!l.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,l),S=="reset"?this.dom.scrollTop=0:S=="to selection"?this.scrollToSelection():N&&xg(N)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof J){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&id(this,n.getBoundingClientRect(),e)}else id(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let i=this.directPlugins[n];i.spec.view&&this.pluginViews.push(i.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let i=this.state.plugins[n];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let i=this.pluginViews[n];i.update&&i.update(this,e)}}updateDraggedNode(e,n){let i=e.node,l=-1;if(this.state.doc.nodeAt(i.from)==i.node)l=i.from;else{let h=i.from+(this.state.doc.content.size-n.doc.content.size);(h>0&&this.state.doc.nodeAt(h))==i.node&&(l=h)}this.dragging=new nu(e.slice,e.move,l<0?void 0:J.create(this.state.doc,l))}someProp(e,n){let i=this._props&&this._props[e],l;if(i!=null&&(l=n?n(i):i))return l;for(let f=0;f<this.directPlugins.length;f++){let p=this.directPlugins[f].props[e];if(p!=null&&(l=n?n(p):p))return l}let h=this.state.plugins;if(h)for(let f=0;f<h.length;f++){let p=h[f].props[e];if(p!=null&&(l=n?n(p):p))return l}}hasFocus(){if(Ue){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Sg(this.dom),Vt(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Ng(this,e)}coordsAtPos(e,n=1){return Rf(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,i=-1){let l=this.docView.posFromDOM(e,n,i);if(l==null)throw new RangeError("DOM position not inside the editor");return l}endOfTextblock(e,n){return Ig(this,n||this.state,e)}pasteHTML(e,n){return ri(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return ri(this,e,null,!0,n||new ClipboardEvent("paste"))}destroy(){this.docView&&(l0(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Vs(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,cg())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return c0(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?Ve&&this.root.nodeType===11&&pg(this.dom.ownerDocument)==this.dom&&A0(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Ed(o){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(o.editable),o.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(o.state)),n)for(let i in n)i=="class"?e.class+=" "+n[i]:i=="style"?e.style=(e.style?e.style+";":"")+n[i]:!e[i]&&i!="contenteditable"&&i!="nodeName"&&(e[i]=String(n[i]))}),e.translate||(e.translate="no"),[at.node(0,o.state.doc.content.size,e)]}function Ad(o){if(o.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),o.cursorWrapper={dom:e,deco:at.widget(o.state.selection.from,e,{raw:!0,marks:o.markCursor})}}else o.cursorWrapper=null}function Id(o){return!o.someProp("editable",e=>e(o.state)===!1)}function $0(o,e){let n=Math.min(o.$anchor.sharedDepth(o.head),e.$anchor.sharedDepth(e.head));return o.$anchor.start(n)!=e.$anchor.start(n)}function Rd(o){let e=Object.create(null);function n(i){for(let l in i)Object.prototype.hasOwnProperty.call(e,l)||(e[l]=i[l])}return o.someProp("nodeViews",n),o.someProp("markViews",n),e}function W0(o,e){let n=0,i=0;for(let l in o){if(o[l]!=e[l])return!0;n++}for(let l in e)i++;return n!=i}function zd(o){if(o.spec.state||o.spec.filterTransaction||o.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const J0=["p",0],H0=["blockquote",0],K0=["hr"],j0=["pre",["code",0]],U0=["br"],G0={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return J0}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM(){return H0}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return K0}},heading:{attrs:{level:{default:1,validate:"number"}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return j0}},text:{group:"inline"},image:{inline:!0,attrs:{src:{validate:"string"},alt:{default:null,validate:"string|null"},title:{default:null,validate:"string|null"}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(o){return{src:o.getAttribute("src"),title:o.getAttribute("title"),alt:o.getAttribute("alt")}}}],toDOM(o){let{src:e,alt:n,title:i}=o.attrs;return["img",{src:e,alt:n,title:i}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return U0}}},Y0=["em",0],X0=["strong",0],_0=["code",0],Z0={link:{attrs:{href:{validate:"string"},title:{default:null,validate:"string|null"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(o){return{href:o.getAttribute("href"),title:o.getAttribute("title")}}}],toDOM(o){let{href:e,title:n}=o.attrs;return["a",{href:e,title:n},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:o=>o.type.name=="em"}],toDOM(){return Y0}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:o=>o.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:o=>o.type.name=="strong"},{style:"font-weight",getAttrs:o=>/^(bold(er)?|[5-9]\d{2,})$/.test(o)&&null}],toDOM(){return X0}},code:{parseDOM:[{tag:"code"}],toDOM(){return _0}}},Pd=new lf({nodes:G0,marks:Z0}),Q0=["ol",0],e1=["ul",0],t1=["li",0],n1={attrs:{order:{default:1,validate:"number"}},parseDOM:[{tag:"ol",getAttrs(o){return{order:o.hasAttribute("start")?+o.getAttribute("start"):1}}}],toDOM(o){return o.attrs.order==1?Q0:["ol",{start:o.attrs.order},0]}},r1={parseDOM:[{tag:"ul"}],toDOM(){return e1}},i1={parseDOM:[{tag:"li"}],toDOM(){return t1},defining:!0};function Ls(o,e){let n={};for(let i in o)n[i]=o[i];for(let i in e)n[i]=e[i];return n}function o1(o,e,n){return o.append({ordered_list:Ls(n1,{content:"list_item+",group:n}),bullet_list:Ls(r1,{content:"list_item+",group:n}),list_item:Ls(i1,{content:e})})}function ll(o,e=null){return function(n,i){let{$from:l,$to:h}=n.selection,f=l.blockRange(h),p=!1,y=f;if(!f)return!1;if(f.depth>=2&&l.node(f.depth-1).type.compatibleContent(o)&&f.startIndex==0){if(l.index(f.depth-1)==0)return!1;let S=n.doc.resolve(f.start-2);y=new Xi(S,S,f.depth),f.endIndex<f.parent.childCount&&(f=new Xi(l,n.doc.resolve(h.end(f.depth)),f.depth)),p=!0}let b=yl(y,o,e,f);return b?(i&&i(s1(n.tr,f,b,p,o).scrollIntoView()),!0):!1}}function s1(o,e,n,i,l){let h=B.empty;for(let S=n.length-1;S>=0;S--)h=B.from(n[S].type.create(n[S].attrs,h));o.step(new ve(e.start-(i?2:0),e.end,e.start,e.end,new F(h,0,0),n.length,!0));let f=0;for(let S=0;S<n.length;S++)n[S].type==l&&(f=S+1);let p=n.length-f,y=e.start+n.length-(i?2:0),b=e.parent;for(let S=e.startIndex,O=e.endIndex,N=!0;S<O;S++,N=!1)!N&&sr(o.doc,y,p)&&(o.split(y,p),y+=2*p),y+=b.child(S).nodeSize;return o}function l1(o,e){return function(n,i){let{$from:l,$to:h,node:f}=n.selection;if(f&&f.isBlock||l.depth<2||!l.sameParent(h))return!1;let p=l.node(-1);if(p.type!=o)return!1;if(l.parent.content.size==0&&l.node(-1).childCount==l.indexAfter(-1)){if(l.depth==3||l.node(-3).type!=o||l.index(-2)!=l.node(-2).childCount-1)return!1;if(i){let O=B.empty,N=l.index(-1)?1:l.index(-2)?2:3;for(let L=l.depth-N;L>=l.depth-3;L--)O=B.from(l.node(L).copy(O));let E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3;O=O.append(B.from(o.createAndFill()));let T=l.before(l.depth-(N-1)),z=n.tr.replace(T,l.after(-E),new F(O,4-N,0)),P=-1;z.doc.nodesBetween(T,z.doc.content.size,(L,Q)=>{if(P>-1)return!1;L.isTextblock&&L.content.size==0&&(P=Q+1)}),P>-1&&z.setSelection(_.near(z.doc.resolve(P))),i(z.scrollIntoView())}return!0}let y=h.pos==l.end()?p.contentMatchAt(0).defaultType:null,b=n.tr.delete(l.pos,h.pos),S=y?[null,{type:y}]:void 0;return sr(b.doc,l.pos,2,S)?(i&&i(b.split(l.pos,2,S).scrollIntoView()),!0):!1}}function a1(o){return function(e,n){let{$from:i,$to:l}=e.selection,h=i.blockRange(l,f=>f.childCount>0&&f.firstChild.type==o);return h?n?i.node(h.depth-1).type==o?c1(e,n,o,h):h1(e,n,h):!0:!1}}function c1(o,e,n,i){let l=o.tr,h=i.end,f=i.$to.end(i.depth);h<f&&(l.step(new ve(h-1,f,h,f,new F(B.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new Xi(l.doc.resolve(i.$from.pos),l.doc.resolve(f),i.depth));const p=li(i);if(p==null)return!1;l.lift(i,p);let y=l.mapping.map(h,-1)-1;return mr(l.doc,y)&&l.join(y),e(l.scrollIntoView()),!0}function h1(o,e,n){let i=o.tr,l=n.parent;for(let E=n.end,T=n.endIndex-1,z=n.startIndex;T>z;T--)E-=l.child(T).nodeSize,i.delete(E-1,E+1);let h=i.doc.resolve(n.start),f=h.nodeAfter;if(i.mapping.map(n.end)!=n.start+h.nodeAfter.nodeSize)return!1;let p=n.startIndex==0,y=n.endIndex==l.childCount,b=h.node(-1),S=h.index(-1);if(!b.canReplace(S+(p?0:1),S+1,f.content.append(y?B.empty:B.from(l))))return!1;let O=h.pos,N=O+f.nodeSize;return i.step(new ve(O-(p?1:0),N+(y?1:0),O+1,N-1,new F((p?B.empty:B.from(l.copy(B.empty))).append(y?B.empty:B.from(l.copy(B.empty))),p?0:1,y?0:1),p?0:1)),e(i.scrollIntoView()),!0}function d1(o){return function(e,n){let{$from:i,$to:l}=e.selection,h=i.blockRange(l,b=>b.childCount>0&&b.firstChild.type==o);if(!h)return!1;let f=h.startIndex;if(f==0)return!1;let p=h.parent,y=p.child(f-1);if(y.type!=o)return!1;if(n){let b=y.lastChild&&y.lastChild.type==p.type,S=B.from(b?o.create():null),O=new F(B.from(o.create(null,B.from(p.type.create(null,S)))),b?3:1,0),N=h.start,E=h.end;n(e.tr.step(new ve(N-(b?3:1),E,N,E,O,1,!0)).scrollIntoView())}return!0}}var hn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},oo={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},f1=typeof navigator<"u"&&/Mac/.test(navigator.platform),u1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Me=0;Me<10;Me++)hn[48+Me]=hn[96+Me]=String(Me);for(var Me=1;Me<=24;Me++)hn[Me+111]="F"+Me;for(var Me=65;Me<=90;Me++)hn[Me]=String.fromCharCode(Me+32),oo[Me]=String.fromCharCode(Me);for(var qs in hn)oo.hasOwnProperty(qs)||(oo[qs]=hn[qs]);function p1(o){var e=f1&&o.metaKey&&o.shiftKey&&!o.ctrlKey&&!o.altKey||u1&&o.shiftKey&&o.key&&o.key.length==1||o.key=="Unidentified",n=!e&&o.key||(o.shiftKey?oo:hn)[o.keyCode]||o.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const m1=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function g1(o){let e=o.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let i,l,h,f;for(let p=0;p<e.length-1;p++){let y=e[p];if(/^(cmd|meta|m)$/i.test(y))f=!0;else if(/^a(lt)?$/i.test(y))i=!0;else if(/^(c|ctrl|control)$/i.test(y))l=!0;else if(/^s(hift)?$/i.test(y))h=!0;else if(/^mod$/i.test(y))m1?f=!0:l=!0;else throw new Error("Unrecognized modifier name: "+y)}return i&&(n="Alt-"+n),l&&(n="Ctrl-"+n),f&&(n="Meta-"+n),h&&(n="Shift-"+n),n}function y1(o){let e=Object.create(null);for(let n in o)e[g1(n)]=o[n];return e}function $s(o,e,n=!0){return e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o),e.metaKey&&(o="Meta-"+o),n&&e.shiftKey&&(o="Shift-"+o),o}function Bd(o){return new Fn({props:{handleKeyDown:lu(o)}})}function lu(o){let e=y1(o);return function(n,i){let l=p1(i),h,f=e[$s(l,i)];if(f&&f(n.state,n.dispatch,n))return!0;if(l.length==1&&l!=" "){if(i.shiftKey){let p=e[$s(l,i,!1)];if(p&&p(n.state,n.dispatch,n))return!0}if((i.shiftKey||i.altKey||i.metaKey||l.charCodeAt(0)>127)&&(h=hn[i.keyCode])&&h!=l){let p=e[$s(h,i)];if(p&&p(n.state,n.dispatch,n))return!0}}return!1}}var so=200,ye=function(){};ye.prototype.append=function(e){return e.length?(e=ye.from(e),!this.length&&e||e.length<so&&this.leafAppend(e)||this.length<so&&e.leafPrepend(this)||this.appendInner(e)):this};ye.prototype.prepend=function(e){return e.length?ye.from(e).append(this):this};ye.prototype.appendInner=function(e){return new w1(this,e)};ye.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?ye.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};ye.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ye.prototype.forEach=function(e,n,i){n===void 0&&(n=0),i===void 0&&(i=this.length),n<=i?this.forEachInner(e,n,i,0):this.forEachInvertedInner(e,n,i,0)};ye.prototype.map=function(e,n,i){n===void 0&&(n=0),i===void 0&&(i=this.length);var l=[];return this.forEach(function(h,f){return l.push(e(h,f))},n,i),l};ye.from=function(e){return e instanceof ye?e:e&&e.length?new au(e):ye.empty};var au=function(o){function e(i){o.call(this),this.values=i}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(l,h){return l==0&&h==this.length?this:new e(this.values.slice(l,h))},e.prototype.getInner=function(l){return this.values[l]},e.prototype.forEachInner=function(l,h,f,p){for(var y=h;y<f;y++)if(l(this.values[y],p+y)===!1)return!1},e.prototype.forEachInvertedInner=function(l,h,f,p){for(var y=h-1;y>=f;y--)if(l(this.values[y],p+y)===!1)return!1},e.prototype.leafAppend=function(l){if(this.length+l.length<=so)return new e(this.values.concat(l.flatten()))},e.prototype.leafPrepend=function(l){if(this.length+l.length<=so)return new e(l.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(ye);ye.empty=new au([]);var w1=function(o){function e(n,i){o.call(this),this.left=n,this.right=i,this.length=n.length+i.length,this.depth=Math.max(n.depth,i.depth)+1}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},e.prototype.forEachInner=function(i,l,h,f){var p=this.left.length;if(l<p&&this.left.forEachInner(i,l,Math.min(h,p),f)===!1||h>p&&this.right.forEachInner(i,Math.max(l-p,0),Math.min(this.length,h)-p,f+p)===!1)return!1},e.prototype.forEachInvertedInner=function(i,l,h,f){var p=this.left.length;if(l>p&&this.right.forEachInvertedInner(i,l-p,Math.max(h,p)-p,f+p)===!1||h<p&&this.left.forEachInvertedInner(i,Math.min(l,p),h,f)===!1)return!1},e.prototype.sliceInner=function(i,l){if(i==0&&l==this.length)return this;var h=this.left.length;return l<=h?this.left.slice(i,l):i>=h?this.right.slice(i-h,l-h):this.left.slice(i,h).append(this.right.slice(0,l-h))},e.prototype.leafAppend=function(i){var l=this.right.leafAppend(i);if(l)return new e(this.left,l)},e.prototype.leafPrepend=function(i){var l=this.left.leafPrepend(i);if(l)return new e(l,this.right)},e.prototype.appendInner=function(i){return this.left.depth>=Math.max(this.right.depth,i.depth)+1?new e(this.left,new e(this.right,i)):new e(this,i)},e}(ye);const b1=500;class mt{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let i=this.items.length;for(;;i--)if(this.items.get(i-1).selection){--i;break}let l,h;n&&(l=this.remapping(i,this.items.length),h=l.maps.length);let f=e.tr,p,y,b=[],S=[];return this.items.forEach((O,N)=>{if(!O.step){l||(l=this.remapping(i,N+1),h=l.maps.length),h--,S.push(O);return}if(l){S.push(new St(O.map));let E=O.step.map(l.slice(h)),T;E&&f.maybeStep(E).doc&&(T=f.mapping.maps[f.mapping.maps.length-1],b.push(new St(T,void 0,void 0,b.length+S.length))),h--,T&&l.appendMap(T,h)}else f.maybeStep(O.step);if(O.selection)return p=l?O.selection.map(l.slice(h)):O.selection,y=new mt(this.items.slice(0,i).append(S.reverse().concat(b)),this.eventCount-1),!1},this.items.length,0),{remaining:y,transform:f,selection:p}}addTransform(e,n,i,l){let h=[],f=this.eventCount,p=this.items,y=!l&&p.length?p.get(p.length-1):null;for(let S=0;S<e.steps.length;S++){let O=e.steps[S].invert(e.docs[S]),N=new St(e.mapping.maps[S],O,n),E;(E=y&&y.merge(N))&&(N=E,S?h.pop():p=p.slice(0,p.length-1)),h.push(N),n&&(f++,n=void 0),l||(y=N)}let b=f-i.depth;return b>x1&&(p=k1(p,b),f-=b),new mt(p.append(h),f)}remapping(e,n){let i=new or;return this.items.forEach((l,h)=>{let f=l.mirrorOffset!=null&&h-l.mirrorOffset>=e?i.maps.length-l.mirrorOffset:void 0;i.appendMap(l.map,f)},e,n),i}addMaps(e){return this.eventCount==0?this:new mt(this.items.append(e.map(n=>new St(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let i=[],l=Math.max(0,this.items.length-n),h=e.mapping,f=e.steps.length,p=this.eventCount;this.items.forEach(N=>{N.selection&&p--},l);let y=n;this.items.forEach(N=>{let E=h.getMirror(--y);if(E==null)return;f=Math.min(f,E);let T=h.maps[E];if(N.step){let z=e.steps[E].invert(e.docs[E]),P=N.selection&&N.selection.map(h.slice(y+1,E));P&&p++,i.push(new St(T,z,P))}else i.push(new St(T))},l);let b=[];for(let N=n;N<f;N++)b.push(new St(h.maps[N]));let S=this.items.slice(0,l).append(b).append(i),O=new mt(S,p);return O.emptyItemCount()>b1&&(O=O.compress(this.items.length-i.length)),O}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),i=n.maps.length,l=[],h=0;return this.items.forEach((f,p)=>{if(p>=e)l.push(f),f.selection&&h++;else if(f.step){let y=f.step.map(n.slice(i)),b=y&&y.getMap();if(i--,b&&n.appendMap(b,i),y){let S=f.selection&&f.selection.map(n.slice(i));S&&h++;let O=new St(b.invert(),y,S),N,E=l.length-1;(N=l.length&&l[E].merge(O))?l[E]=N:l.push(O)}}else f.map&&i--},this.items.length,0),new mt(ye.from(l.reverse()),h)}}mt.empty=new mt(ye.empty,0);function k1(o,e){let n;return o.forEach((i,l)=>{if(i.selection&&e--==0)return n=l,!1}),o.slice(n)}class St{constructor(e,n,i,l){this.map=e,this.step=n,this.selection=i,this.mirrorOffset=l}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new St(n.getMap().invert(),n,this.selection)}}}class en{constructor(e,n,i,l,h){this.done=e,this.undone=n,this.prevRanges=i,this.prevTime=l,this.prevComposition=h}}const x1=20;function S1(o,e,n,i){let l=n.getMeta(zn),h;if(l)return l.historyState;n.getMeta(v1)&&(o=new en(o.done,o.undone,null,0,-1));let f=n.getMeta("appendedTransaction");if(n.steps.length==0)return o;if(f&&f.getMeta(zn))return f.getMeta(zn).redo?new en(o.done.addTransform(n,void 0,i,Ki(e)),o.undone,Vd(n.mapping.maps),o.prevTime,o.prevComposition):new en(o.done,o.undone.addTransform(n,void 0,i,Ki(e)),null,o.prevTime,o.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(f&&f.getMeta("addToHistory")===!1)){let p=n.getMeta("composition"),y=o.prevTime==0||!f&&o.prevComposition!=p&&(o.prevTime<(n.time||0)-i.newGroupDelay||!C1(n,o.prevRanges)),b=f?Ws(o.prevRanges,n.mapping):Vd(n.mapping.maps);return new en(o.done.addTransform(n,y?e.selection.getBookmark():void 0,i,Ki(e)),mt.empty,b,n.time,p??o.prevComposition)}else return(h=n.getMeta("rebased"))?new en(o.done.rebased(n,h),o.undone.rebased(n,h),Ws(o.prevRanges,n.mapping),o.prevTime,o.prevComposition):new en(o.done.addMaps(n.mapping.maps),o.undone.addMaps(n.mapping.maps),Ws(o.prevRanges,n.mapping),o.prevTime,o.prevComposition)}function C1(o,e){if(!e)return!1;if(!o.docChanged)return!0;let n=!1;return o.mapping.maps[0].forEach((i,l)=>{for(let h=0;h<e.length;h+=2)i<=e[h+1]&&l>=e[h]&&(n=!0)}),n}function Vd(o){let e=[];for(let n=o.length-1;n>=0&&e.length==0;n--)o[n].forEach((i,l,h,f)=>e.push(h,f));return e}function Ws(o,e){if(!o)return null;let n=[];for(let i=0;i<o.length;i+=2){let l=e.map(o[i],1),h=e.map(o[i+1],-1);l<=h&&n.push(l,h)}return n}function M1(o,e,n){let i=Ki(e),l=zn.get(e).spec.config,h=(n?o.undone:o.done).popEvent(e,i);if(!h)return null;let f=h.selection.resolve(h.transform.doc),p=(n?o.done:o.undone).addTransform(h.transform,e.selection.getBookmark(),l,i),y=new en(n?p:h.remaining,n?h.remaining:p,null,0,-1);return h.transform.setSelection(f).setMeta(zn,{redo:n,historyState:y})}let Js=!1,Fd=null;function Ki(o){let e=o.plugins;if(Fd!=e){Js=!1,Fd=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Js=!0;break}}return Js}const zn=new Of("history"),v1=new Of("closeHistory");function O1(o={}){return o={depth:o.depth||100,newGroupDelay:o.newGroupDelay||500},new Fn({key:zn,state:{init(){return new en(mt.empty,mt.empty,null,0,-1)},apply(e,n,i){return S1(n,i,e,o)}},config:o,props:{handleDOMEvents:{beforeinput(e,n){let i=n.inputType,l=i=="historyUndo"?lo:i=="historyRedo"?oi:null;return l?(n.preventDefault(),l(e.state,e.dispatch)):!1}}}})}function cu(o,e){return(n,i)=>{let l=zn.getState(n);if(!l||(o?l.undone:l.done).eventCount==0)return!1;if(i){let h=M1(l,n,o);h&&i(e?h.scrollIntoView():h)}return!0}}const lo=cu(!1,!0),oi=cu(!0,!0),hu=(o,e)=>o.selection.empty?!1:(e&&e(o.tr.deleteSelection().scrollIntoView()),!0);function N1(o,e){let{$cursor:n}=o.selection;return!n||(e?!e.endOfTextblock("backward",o):n.parentOffset>0)?null:n}const D1=(o,e,n)=>{let i=N1(o,n);if(!i)return!1;let l=du(i);if(!l){let f=i.blockRange(),p=f&&li(f);return p==null?!1:(e&&e(o.tr.lift(f,p).scrollIntoView()),!0)}let h=l.nodeBefore;if(pu(o,l,e,-1))return!0;if(i.parent.content.size==0&&(ur(h,"end")||J.isSelectable(h)))for(let f=i.depth;;f--){let p=wl(o.doc,i.before(f),i.after(f),F.empty);if(p&&p.slice.size<p.to-p.from){if(e){let y=o.tr.step(p);y.setSelection(ur(h,"end")?_.findFrom(y.doc.resolve(y.mapping.map(l.pos,-1)),-1):J.create(y.doc,l.pos-h.nodeSize)),e(y.scrollIntoView())}return!0}if(f==1||i.node(f-1).childCount>1)break}return h.isAtom&&l.depth==i.depth-1?(e&&e(o.tr.delete(l.pos-h.nodeSize,l.pos).scrollIntoView()),!0):!1};function ur(o,e,n=!1){for(let i=o;i;i=e=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(n&&i.childCount!=1)return!1}return!1}const T1=(o,e,n)=>{let{$head:i,empty:l}=o.selection,h=i;if(!l)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",o):i.parentOffset>0)return!1;h=du(i)}let f=h&&h.nodeBefore;return!f||!J.isSelectable(f)?!1:(e&&e(o.tr.setSelection(J.create(o.doc,h.pos-f.nodeSize)).scrollIntoView()),!0)};function du(o){if(!o.parent.type.spec.isolating)for(let e=o.depth-1;e>=0;e--){if(o.index(e)>0)return o.doc.resolve(o.before(e+1));if(o.node(e).type.spec.isolating)break}return null}function E1(o,e){let{$cursor:n}=o.selection;return!n||(e?!e.endOfTextblock("forward",o):n.parentOffset<n.parent.content.size)?null:n}const A1=(o,e,n)=>{let i=E1(o,n);if(!i)return!1;let l=fu(i);if(!l)return!1;let h=l.nodeAfter;if(pu(o,l,e,1))return!0;if(i.parent.content.size==0&&(ur(h,"start")||J.isSelectable(h))){let f=wl(o.doc,i.before(),i.after(),F.empty);if(f&&f.slice.size<f.to-f.from){if(e){let p=o.tr.step(f);p.setSelection(ur(h,"start")?_.findFrom(p.doc.resolve(p.mapping.map(l.pos)),1):J.create(p.doc,p.mapping.map(l.pos))),e(p.scrollIntoView())}return!0}}return h.isAtom&&l.depth==i.depth-1?(e&&e(o.tr.delete(l.pos,l.pos+h.nodeSize).scrollIntoView()),!0):!1},I1=(o,e,n)=>{let{$head:i,empty:l}=o.selection,h=i;if(!l)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",o):i.parentOffset<i.parent.content.size)return!1;h=fu(i)}let f=h&&h.nodeAfter;return!f||!J.isSelectable(f)?!1:(e&&e(o.tr.setSelection(J.create(o.doc,h.pos)).scrollIntoView()),!0)};function fu(o){if(!o.parent.type.spec.isolating)for(let e=o.depth-1;e>=0;e--){let n=o.node(e);if(o.index(e)+1<n.childCount)return o.doc.resolve(o.after(e+1));if(n.type.spec.isolating)break}return null}const al=(o,e)=>{let n=o.selection,i=n instanceof J,l;if(i){if(n.node.isTextblock||!mr(o.doc,n.from))return!1;l=n.from}else if(l=wf(o.doc,n.from,-1),l==null)return!1;if(e){let h=o.tr.join(l);i&&h.setSelection(J.create(h.doc,l-o.doc.resolve(l).nodeBefore.nodeSize)),e(h.scrollIntoView())}return!0},R1=(o,e)=>{let n=o.selection,i;if(n instanceof J){if(n.node.isTextblock||!mr(o.doc,n.to))return!1;i=n.to}else if(i=wf(o.doc,n.to,1),i==null)return!1;return e&&e(o.tr.join(i).scrollIntoView()),!0},cl=(o,e)=>{let{$from:n,$to:i}=o.selection,l=n.blockRange(i),h=l&&li(l);return h==null?!1:(e&&e(o.tr.lift(l,h).scrollIntoView()),!0)},z1=(o,e)=>{let{$head:n,$anchor:i}=o.selection;return!n.parent.type.spec.code||!n.sameParent(i)?!1:(e&&e(o.tr.insertText(`
`).scrollIntoView()),!0)};function Dl(o){for(let e=0;e<o.edgeCount;e++){let{type:n}=o.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const uu=(o,e)=>{let{$head:n,$anchor:i}=o.selection;if(!n.parent.type.spec.code||!n.sameParent(i))return!1;let l=n.node(-1),h=n.indexAfter(-1),f=Dl(l.contentMatchAt(h));if(!f||!l.canReplaceWith(h,h,f))return!1;if(e){let p=n.after(),y=o.tr.replaceWith(p,p,f.createAndFill());y.setSelection(_.near(y.doc.resolve(p),1)),e(y.scrollIntoView())}return!0},P1=(o,e)=>{let n=o.selection,{$from:i,$to:l}=n;if(n instanceof et||i.parent.inlineContent||l.parent.inlineContent)return!1;let h=Dl(l.parent.contentMatchAt(l.indexAfter()));if(!h||!h.isTextblock)return!1;if(e){let f=(!i.parentOffset&&l.index()<l.parent.childCount?i:l).pos,p=o.tr.insert(f,h.createAndFill());p.setSelection(te.create(p.doc,f+1)),e(p.scrollIntoView())}return!0},B1=(o,e)=>{let{$cursor:n}=o.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let h=n.before();if(sr(o.doc,h))return e&&e(o.tr.split(h).scrollIntoView()),!0}let i=n.blockRange(),l=i&&li(i);return l==null?!1:(e&&e(o.tr.lift(i,l).scrollIntoView()),!0)};function V1(o){return(e,n)=>{let{$from:i,$to:l}=e.selection;if(e.selection instanceof J&&e.selection.node.isBlock)return!i.parentOffset||!sr(e.doc,i.pos)?!1:(n&&n(e.tr.split(i.pos).scrollIntoView()),!0);if(!i.depth)return!1;let h=[],f,p,y=!1,b=!1;for(let E=i.depth;;E--)if(i.node(E).isBlock){y=i.end(E)==i.pos+(i.depth-E),b=i.start(E)==i.pos-(i.depth-E),p=Dl(i.node(E-1).contentMatchAt(i.indexAfter(E-1))),h.unshift(y&&p?{type:p}:null),f=E;break}else{if(E==1)return!1;h.unshift(null)}let S=e.tr;(e.selection instanceof te||e.selection instanceof et)&&S.deleteSelection();let O=S.mapping.map(i.pos),N=sr(S.doc,O,h.length,h);if(N||(h[0]=p?{type:p}:null,N=sr(S.doc,O,h.length,h)),S.split(O,h.length,h),!y&&b&&i.node(f).type!=p){let E=S.mapping.map(i.before(f)),T=S.doc.resolve(E);p&&i.node(f-1).canReplaceWith(T.index(),T.index()+1,p)&&S.setNodeMarkup(S.mapping.map(i.before(f)),p)}return n&&n(S.scrollIntoView()),!0}}const F1=V1(),hl=(o,e)=>{let{$from:n,to:i}=o.selection,l,h=n.sharedDepth(i);return h==0?!1:(l=n.before(h),e&&e(o.tr.setSelection(J.create(o.doc,l))),!0)},L1=(o,e)=>(e&&e(o.tr.setSelection(new et(o.doc))),!0);function q1(o,e,n){let i=e.nodeBefore,l=e.nodeAfter,h=e.index();return!i||!l||!i.type.compatibleContent(l.type)?!1:!i.content.size&&e.parent.canReplace(h-1,h)?(n&&n(o.tr.delete(e.pos-i.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(h,h+1)||!(l.isTextblock||mr(o.doc,e.pos))?!1:(n&&n(o.tr.join(e.pos).scrollIntoView()),!0)}function pu(o,e,n,i){let l=e.nodeBefore,h=e.nodeAfter,f,p,y=l.type.spec.isolating||h.type.spec.isolating;if(!y&&q1(o,e,n))return!0;let b=!y&&e.parent.canReplace(e.index(),e.index()+1);if(b&&(f=(p=l.contentMatchAt(l.childCount)).findWrapping(h.type))&&p.matchType(f[0]||h.type).validEnd){if(n){let E=e.pos+h.nodeSize,T=B.empty;for(let L=f.length-1;L>=0;L--)T=B.from(f[L].create(null,T));T=B.from(l.copy(T));let z=o.tr.step(new ve(e.pos-1,E,e.pos,E,new F(T,1,0),f.length,!0)),P=z.doc.resolve(E+2*f.length);P.nodeAfter&&P.nodeAfter.type==l.type&&mr(z.doc,P.pos)&&z.join(P.pos),n(z.scrollIntoView())}return!0}let S=h.type.spec.isolating||i>0&&y?null:_.findFrom(e,1),O=S&&S.$from.blockRange(S.$to),N=O&&li(O);if(N!=null&&N>=e.depth)return n&&n(o.tr.lift(O,N).scrollIntoView()),!0;if(b&&ur(h,"start",!0)&&ur(l,"end")){let E=l,T=[];for(;T.push(E),!E.isTextblock;)E=E.lastChild;let z=h,P=1;for(;!z.isTextblock;z=z.firstChild)P++;if(E.canReplace(E.childCount,E.childCount,z.content)){if(n){let L=B.empty;for(let we=T.length-1;we>=0;we--)L=B.from(T[we].copy(L));let Q=o.tr.step(new ve(e.pos-T.length,e.pos+h.nodeSize,e.pos+P,e.pos+h.nodeSize-P,new F(L,T.length,0),0,!0));n(Q.scrollIntoView())}return!0}}return!1}function mu(o){return function(e,n){let i=e.selection,l=o<0?i.$from:i.$to,h=l.depth;for(;l.node(h).isInline;){if(!h)return!1;h--}return l.node(h).isTextblock?(n&&n(e.tr.setSelection(te.create(e.doc,o<0?l.start(h):l.end(h)))),!0):!1}}const $1=mu(-1),W1=mu(1);function dl(o,e=null){return function(n,i){let{$from:l,$to:h}=n.selection,f=l.blockRange(h),p=f&&yl(f,o,e);return p?(i&&i(n.tr.wrap(f,p).scrollIntoView()),!0):!1}}function ji(o,e=null){return function(n,i){let l=!1;for(let h=0;h<n.selection.ranges.length&&!l;h++){let{$from:{pos:f},$to:{pos:p}}=n.selection.ranges[h];n.doc.nodesBetween(f,p,(y,b)=>{if(l)return!1;if(!(!y.isTextblock||y.hasMarkup(o,e)))if(y.type==o)l=!0;else{let S=n.doc.resolve(b),O=S.index();l=S.parent.canReplaceWith(O,O+1,o)}})}if(!l)return!1;if(i){let h=n.tr;for(let f=0;f<n.selection.ranges.length;f++){let{$from:{pos:p},$to:{pos:y}}=n.selection.ranges[f];h.setBlockType(p,y,o,e)}i(h.scrollIntoView())}return!0}}function J1(o,e,n,i){for(let l=0;l<e.length;l++){let{$from:h,$to:f}=e[l],p=h.depth==0?o.inlineContent&&o.type.allowsMarkType(n):!1;if(o.nodesBetween(h.pos,f.pos,(y,b)=>{if(p||!i)return!1;p=y.inlineContent&&y.type.allowsMarkType(n)}),p)return!0}return!1}function nn(o,e=null,n){let i=n!==!1;return function(l,h){let{empty:f,$cursor:p,ranges:y}=l.selection;if(f&&!p||!J1(l.doc,y,o,i))return!1;if(h)if(p)o.isInSet(l.storedMarks||p.marks())?h(l.tr.removeStoredMark(o)):h(l.tr.addStoredMark(o.create(e)));else{let b,S=l.tr;b=!y.some(O=>l.doc.rangeHasMark(O.$from.pos,O.$to.pos,o));for(let O=0;O<y.length;O++){let{$from:N,$to:E}=y[O];if(!b)S.removeMark(N.pos,E.pos,o);else{let T=N.pos,z=E.pos,P=N.nodeAfter,L=E.nodeBefore,Q=P&&P.isText?/^\s*/.exec(P.text)[0].length:0,we=L&&L.isText?/\s*$/.exec(L.text)[0].length:0;T+Q<z&&(T+=Q,z-=we),S.addMark(T,z,o.create(e))}}h(S.scrollIntoView())}return!0}}function po(...o){return function(e,n,i){for(let l=0;l<o.length;l++)if(o[l](e,n,i))return!0;return!1}}let Hs=po(hu,D1,T1),Ld=po(hu,A1,I1);const Bt={Enter:po(z1,P1,B1,F1),"Mod-Enter":uu,Backspace:Hs,"Mod-Backspace":Hs,"Shift-Backspace":Hs,Delete:Ld,"Mod-Delete":Ld,"Mod-a":L1},gu={"Ctrl-h":Bt.Backspace,"Alt-Backspace":Bt["Mod-Backspace"],"Ctrl-d":Bt.Delete,"Ctrl-Alt-Backspace":Bt["Mod-Delete"],"Alt-Delete":Bt["Mod-Delete"],"Alt-d":Bt["Mod-Delete"],"Ctrl-a":$1,"Ctrl-e":W1};for(let o in Bt)gu[o]=Bt[o];const H1=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,K1=H1?gu:Bt;function j1(o={}){return new Fn({view(e){return new U1(e,o)}})}class U1{constructor(e,n){var i;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(i=n.width)!==null&&i!==void 0?i:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(l=>{let h=f=>{this[l](f)};return e.dom.addEventListener(l,h),{name:l,handler:h}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,i;if(n){let p=e.nodeBefore,y=e.nodeAfter;if(p||y){let b=this.editorView.nodeDOM(this.cursorPos-(p?p.nodeSize:0));if(b){let S=b.getBoundingClientRect(),O=p?S.bottom:S.top;p&&y&&(O=(O+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),i={left:S.left,right:S.right,top:O-this.width/2,bottom:O+this.width/2}}}}if(!i){let p=this.editorView.coordsAtPos(this.cursorPos);i={left:p.left-this.width/2,right:p.left+this.width/2,top:p.top,bottom:p.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let h,f;if(!l||l==document.body&&getComputedStyle(l).position=="static")h=-pageXOffset,f=-pageYOffset;else{let p=l.getBoundingClientRect();h=p.left-l.scrollLeft,f=p.top-l.scrollTop}this.element.style.left=i.left-h+"px",this.element.style.top=i.top-f+"px",this.element.style.width=i.right-i.left+"px",this.element.style.height=i.bottom-i.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),i=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),l=i&&i.type.spec.disableDropCursor,h=typeof l=="function"?l(this.editorView,n,e):l;if(n&&!h){let f=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let p=bf(this.editorView.state.doc,f,this.editorView.dragging.slice);p!=null&&(f=p)}this.setCursor(f),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}class ce extends _{constructor(e){super(e,e)}map(e,n){let i=e.resolve(n.map(this.head));return ce.valid(i)?new ce(i):_.near(i)}content(){return F.empty}eq(e){return e instanceof ce&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ce(e.resolve(n.pos))}getBookmark(){return new Tl(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!G1(e)||!Y1(e))return!1;let i=n.type.spec.allowGapCursor;if(i!=null)return i;let l=n.contentMatchAt(e.index()).defaultType;return l&&l.isTextblock}static findGapCursorFrom(e,n,i=!1){e:for(;;){if(!i&&ce.valid(e))return e;let l=e.pos,h=null;for(let f=e.depth;;f--){let p=e.node(f);if(n>0?e.indexAfter(f)<p.childCount:e.index(f)>0){h=p.child(n>0?e.indexAfter(f):e.index(f)-1);break}else if(f==0)return null;l+=n;let y=e.doc.resolve(l);if(ce.valid(y))return y}for(;;){let f=n>0?h.firstChild:h.lastChild;if(!f){if(h.isAtom&&!h.isText&&!J.isSelectable(h)){e=e.doc.resolve(l+h.nodeSize*n),i=!1;continue e}break}h=f,l+=n;let p=e.doc.resolve(l);if(ce.valid(p))return p}return null}}}ce.prototype.visible=!1;ce.findFrom=ce.findGapCursorFrom;_.jsonID("gapcursor",ce);class Tl{constructor(e){this.pos=e}map(e){return new Tl(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return ce.valid(n)?new ce(n):_.near(n)}}function G1(o){for(let e=o.depth;e>=0;e--){let n=o.index(e),i=o.node(e);if(n==0){if(i.type.spec.isolating)return!0;continue}for(let l=i.child(n-1);;l=l.lastChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function Y1(o){for(let e=o.depth;e>=0;e--){let n=o.indexAfter(e),i=o.node(e);if(n==i.childCount){if(i.type.spec.isolating)return!0;continue}for(let l=i.child(n);;l=l.firstChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function X1(){return new Fn({props:{decorations:ey,createSelectionBetween(o,e,n){return e.pos==n.pos&&ce.valid(n)?new ce(n):null},handleClick:Z1,handleKeyDown:_1,handleDOMEvents:{beforeinput:Q1}}})}const _1=lu({ArrowLeft:qi("horiz",-1),ArrowRight:qi("horiz",1),ArrowUp:qi("vert",-1),ArrowDown:qi("vert",1)});function qi(o,e){const n=o=="vert"?e>0?"down":"up":e>0?"right":"left";return function(i,l,h){let f=i.selection,p=e>0?f.$to:f.$from,y=f.empty;if(f instanceof te){if(!h.endOfTextblock(n)||p.depth==0)return!1;y=!1,p=i.doc.resolve(e>0?p.after():p.before())}let b=ce.findGapCursorFrom(p,e,y);return b?(l&&l(i.tr.setSelection(new ce(b))),!0):!1}}function Z1(o,e,n){if(!o||!o.editable)return!1;let i=o.state.doc.resolve(e);if(!ce.valid(i))return!1;let l=o.posAtCoords({left:n.clientX,top:n.clientY});return l&&l.inside>-1&&J.isSelectable(o.state.doc.nodeAt(l.inside))?!1:(o.dispatch(o.state.tr.setSelection(new ce(i))),!0)}function Q1(o,e){if(e.inputType!="insertCompositionText"||!(o.state.selection instanceof ce))return!1;let{$from:n}=o.state.selection,i=n.parent.contentMatchAt(n.index()).findWrapping(o.state.schema.nodes.text);if(!i)return!1;let l=B.empty;for(let f=i.length-1;f>=0;f--)l=B.from(i[f].createAndFill(null,l));let h=o.state.tr.replace(n.pos,n.pos,new F(l,0,0));return h.setSelection(te.near(h.doc.resolve(n.pos+1))),o.dispatch(h),!1}function ey(o){if(!(o.selection instanceof ce))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ue.create(o.doc,[at.widget(o.selection.head,e,{key:"gapcursor"})])}function tt(){var o=arguments[0];typeof o=="string"&&(o=document.createElement(o));var e=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var l=n[i];typeof l=="string"?o.setAttribute(i,l):l!=null&&(o[i]=l)}e++}for(;e<arguments.length;e++)yu(o,arguments[e]);return o}function yu(o,e){if(typeof e=="string")o.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)o.appendChild(e);else if(Array.isArray(e))for(var n=0;n<e.length;n++)yu(o,e[n]);else throw new RangeError("Unsupported child node: "+e)}const Xr="http://www.w3.org/2000/svg",ty="http://www.w3.org/1999/xlink",fl="ProseMirror-icon";function ny(o){let e=0;for(let n=0;n<o.length;n++)e=(e<<5)-e+o.charCodeAt(n)|0;return e}function ry(o,e){let n=(o.nodeType==9?o:o.ownerDocument)||document,i=n.createElement("div");if(i.className=fl,e.path){let{path:l,width:h,height:f}=e,p="pm-icon-"+ny(l).toString(16);n.getElementById(p)||iy(o,p,e);let y=i.appendChild(n.createElementNS(Xr,"svg"));y.style.width=h/f+"em",y.appendChild(n.createElementNS(Xr,"use")).setAttributeNS(ty,"href",/([^#]*)/.exec(n.location.toString())[1]+"#"+p)}else if(e.dom)i.appendChild(e.dom.cloneNode(!0));else{let{text:l,css:h}=e;i.appendChild(n.createElement("span")).textContent=l||"",h&&(i.firstChild.style.cssText=h)}return i}function iy(o,e,n){let[i,l]=o.nodeType==9?[o,o.body]:[o.ownerDocument||document,o],h=i.getElementById(fl+"-collection");h||(h=i.createElementNS(Xr,"svg"),h.id=fl+"-collection",h.style.display="none",l.insertBefore(h,l.firstChild));let f=i.createElementNS(Xr,"symbol");f.id=e,f.setAttribute("viewBox","0 0 "+n.width+" "+n.height),f.appendChild(i.createElementNS(Xr,"path")).setAttribute("d",n.path),h.appendChild(f)}const je="ProseMirror-menu";class yt{constructor(e){this.spec=e}render(e){let n=this.spec,i=n.render?n.render(e):n.icon?ry(e.root,n.icon):n.label?tt("div",null,si(e,n.label)):null;if(!i)throw new RangeError("MenuItem without icon or label property");if(n.title){const h=typeof n.title=="function"?n.title(e.state):n.title;i.setAttribute("title",si(e,h))}n.class&&i.classList.add(n.class),n.css&&(i.style.cssText+=n.css),i.addEventListener("mousedown",h=>{h.preventDefault(),i.classList.contains(je+"-disabled")||n.run(e.state,e.dispatch,e,h)});function l(h){if(n.select){let p=n.select(h);if(i.style.display=p?"":"none",!p)return!1}let f=!0;if(n.enable&&(f=n.enable(h)||!1,ul(i,je+"-disabled",!f)),n.active){let p=f&&n.active(h)||!1;ul(i,je+"-active",p)}return!0}return{dom:i,update:l}}}function si(o,e){return o._props.translate?o._props.translate(e):e}let _r={time:0,node:null};function wu(o){_r.time=Date.now(),_r.node=o.target}function bu(o){return Date.now()-100<_r.time&&_r.node&&o.contains(_r.node)}class qd{constructor(e,n={}){this.options=n,this.options=n||{},this.content=Array.isArray(e)?e:[e]}render(e){let n=ku(this.content,e),i=e.dom.ownerDocument.defaultView||window,l=tt("div",{class:je+"-dropdown "+(this.options.class||""),style:this.options.css},si(e,this.options.label||""));this.options.title&&l.setAttribute("title",si(e,this.options.title));let h=tt("div",{class:je+"-dropdown-wrap"},l),f=null,p=null,y=()=>{f&&f.close()&&(f=null,i.removeEventListener("mousedown",p))};l.addEventListener("mousedown",S=>{S.preventDefault(),wu(S),f?y():(f=this.expand(h,n.dom),i.addEventListener("mousedown",p=()=>{bu(h)||y()}))});function b(S){let O=n.update(S);return h.style.display=O?"":"none",O}return{dom:h,update:b}}expand(e,n){let i=tt("div",{class:je+"-dropdown-menu "+(this.options.class||"")},n),l=!1;function h(){return l?!1:(l=!0,e.removeChild(i),!0)}return e.appendChild(i),{close:h,node:i}}}function ku(o,e){let n=[],i=[];for(let l=0;l<o.length;l++){let{dom:h,update:f}=o[l].render(e);n.push(tt("div",{class:je+"-dropdown-item"},h)),i.push(f)}return{dom:n,update:xu(i,n)}}function xu(o,e){return n=>{let i=!1;for(let l=0;l<o.length;l++){let h=o[l](n);e[l].style.display=h?"":"none",h&&(i=!0)}return i}}class oy{constructor(e,n={}){this.options=n,this.content=Array.isArray(e)?e:[e]}render(e){let n=ku(this.content,e),i=e.dom.ownerDocument.defaultView||window,l=tt("div",{class:je+"-submenu-label"},si(e,this.options.label||"")),h=tt("div",{class:je+"-submenu-wrap"},l,tt("div",{class:je+"-submenu"},n.dom)),f=null;l.addEventListener("mousedown",y=>{y.preventDefault(),wu(y),ul(h,je+"-submenu-wrap-active",!1),f||i.addEventListener("mousedown",f=()=>{bu(h)||(h.classList.remove(je+"-submenu-wrap-active"),i.removeEventListener("mousedown",f),f=null)})});function p(y){let b=n.update(y);return h.style.display=b?"":"none",b}return{dom:h,update:p}}}function sy(o,e){let n=document.createDocumentFragment(),i=[],l=[];for(let f=0;f<e.length;f++){let p=e[f],y=[],b=[];for(let S=0;S<p.length;S++){let{dom:O,update:N}=p[S].render(o),E=tt("span",{class:je+"item"},O);n.appendChild(E),b.push(E),y.push(N)}y.length&&(i.push(xu(y,b)),f<e.length-1&&l.push(n.appendChild(ly())))}function h(f){let p=!1,y=!1;for(let b=0;b<i.length;b++){let S=i[b](f);b&&(l[b-1].style.display=y&&S?"":"none"),y=S,S&&(p=!0)}return p}return{dom:n,update:h}}function ly(){return tt("span",{class:je+"separator"})}const st={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"⬚",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},ay=new yt({title:"Join with above block",run:al,select:o=>al(o),icon:st.join}),cy=new yt({title:"Lift out of enclosing block",run:cl,select:o=>cl(o),icon:st.lift}),hy=new yt({title:"Select parent node",run:hl,select:o=>hl(o),icon:st.selectParentNode});let dy=new yt({title:"Undo last change",run:lo,enable:o=>lo(o),icon:st.undo}),fy=new yt({title:"Redo last undone change",run:oi,enable:o=>oi(o),icon:st.redo});function uy(o,e){let n={run(i,l){return dl(o,e.attrs)(i,l)},select(i){return dl(o,e.attrs)(i)}};for(let i in e)n[i]=e[i];return new yt(n)}function Ks(o,e){let n=ji(o,e.attrs),i={run:n,enable(l){return n(l)},active(l){let{$from:h,to:f,node:p}=l.selection;return p?p.hasMarkup(o,e.attrs):f<=h.end()&&h.parent.hasMarkup(o,e.attrs)}};for(let l in e)i[l]=e[l];return new yt(i)}function ul(o,e,n){n?o.classList.add(e):o.classList.remove(e)}const $i="ProseMirror-menubar";function py(){if(typeof navigator>"u")return!1;let o=navigator.userAgent;return!/Edge\/\d/.test(o)&&/AppleWebKit/.test(o)&&/Mobile\/\w+/.test(o)}function my(o){return new Fn({view(e){return new gy(e,o)}})}class gy{constructor(e,n){this.editorView=e,this.options=n,this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1,this.scrollHandler=null,this.wrapper=tt("div",{class:$i+"-wrapper"}),this.menu=this.wrapper.appendChild(tt("div",{class:$i})),this.menu.className=$i,e.dom.parentNode&&e.dom.parentNode.replaceChild(this.wrapper,e.dom),this.wrapper.appendChild(e.dom);let{dom:i,update:l}=sy(this.editorView,this.options.content);if(this.contentUpdate=l,this.menu.appendChild(i),this.update(),n.floating&&!py()){this.updateFloat();let h=by(this.wrapper);this.scrollHandler=f=>{let p=this.editorView.root;(p.body||p).contains(this.wrapper)?this.updateFloat(f.target.getBoundingClientRect?f.target:void 0):h.forEach(y=>y.removeEventListener("scroll",this.scrollHandler))},h.forEach(f=>f.addEventListener("scroll",this.scrollHandler))}}update(){this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))}updateScrollCursor(){let e=this.editorView.root.getSelection();if(!e.focusNode)return;let n=e.getRangeAt(0).getClientRects(),i=n[yy(e)?0:n.length-1];if(!i)return;let l=this.menu.getBoundingClientRect();if(i.top<l.bottom&&i.bottom>l.top){let h=wy(this.wrapper);h&&(h.scrollTop-=l.bottom-i.top)}}updateFloat(e){let n=this.wrapper,i=n.getBoundingClientRect(),l=e?Math.max(0,e.getBoundingClientRect().top):0;if(this.floating)if(i.top>=l||i.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{let h=(n.offsetWidth-n.clientWidth)/2;this.menu.style.left=i.left+h+"px",this.menu.style.display=i.top>(this.editorView.dom.ownerDocument.defaultView||window).innerHeight?"none":"",e&&(this.menu.style.top=l+"px")}else if(i.top<l&&i.bottom>=this.menu.offsetHeight+10){this.floating=!0;let h=this.menu.getBoundingClientRect();this.menu.style.left=h.left+"px",this.menu.style.width=h.width+"px",e&&(this.menu.style.top=l+"px"),this.menu.style.position="fixed",this.spacer=tt("div",{class:$i+"-spacer",style:`height: ${h.height}px`}),n.insertBefore(this.spacer,this.menu)}}destroy(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}}function yy(o){return o.anchorNode==o.focusNode?o.anchorOffset>o.focusOffset:o.anchorNode.compareDocumentPosition(o.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function wy(o){for(let e=o.parentNode;e;e=e.parentNode)if(e.scrollHeight>e.clientHeight)return e}function by(o){let e=[o.ownerDocument.defaultView||window];for(let n=o.parentNode;n;n=n.parentNode)e.push(n);return e}class fn{constructor(e,n,i={}){this.match=e,this.match=e,this.handler=typeof n=="string"?ky(n):n,this.undoable=i.undoable!==!1,this.inCode=i.inCode||!1}}function ky(o){return function(e,n,i,l){let h=o;if(n[1]){let f=n[0].lastIndexOf(n[1]);h+=n[0].slice(f+n[1].length),i+=f;let p=i-l;p>0&&(h=n[0].slice(f-p,f)+h,i=l)}return e.tr.insertText(h,i,l)}}const xy=500;function Sy({rules:o}){let e=new Fn({state:{init(){return null},apply(n,i){let l=n.getMeta(this);return l||(n.selectionSet||n.docChanged?null:i)}},props:{handleTextInput(n,i,l,h){return $d(n,i,l,h,o,e)},handleDOMEvents:{compositionend:n=>{setTimeout(()=>{let{$cursor:i}=n.state.selection;i&&$d(n,i.pos,i.pos,"",o,e)})}}},isInputRules:!0});return e}function $d(o,e,n,i,l,h){if(o.composing)return!1;let f=o.state,p=f.doc.resolve(e),y=p.parent.textBetween(Math.max(0,p.parentOffset-xy),p.parentOffset,null,"￼")+i;for(let b=0;b<l.length;b++){let S=l[b];if(p.parent.type.spec.code){if(!S.inCode)continue}else if(S.inCode==="only")continue;let O=S.match.exec(y),N=O&&S.handler(f,O,e-(O[0].length-i.length),n);if(N)return S.undoable&&N.setMeta(h,{transform:N,from:e,to:n,text:i}),o.dispatch(N),!0}return!1}const Cy=(o,e)=>{let n=o.plugins;for(let i=0;i<n.length;i++){let l=n[i],h;if(l.spec.isInputRules&&(h=l.getState(o))){if(e){let f=o.tr,p=h.transform;for(let y=p.steps.length-1;y>=0;y--)f.step(p.steps[y].invert(p.docs[y]));if(h.text){let y=f.doc.resolve(h.from).marks();f.replaceWith(h.from,h.to,o.schema.text(h.text,y))}else f.delete(h.from,h.to);e(f)}return!0}}return!1},My=new fn(/--$/,"—"),vy=new fn(/\.\.\.$/,"…"),Oy=new fn(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“"),Ny=new fn(/"$/,"”"),Dy=new fn(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘"),Ty=new fn(/'$/,"’"),Ey=[Oy,Ny,Dy,Ty];function El(o,e,n=null,i){return new fn(o,(l,h,f,p)=>{let y=n instanceof Function?n(h):n,b=l.tr.delete(f,p),S=b.doc.resolve(f),O=S.blockRange(),N=O&&yl(O,e,y);if(!N)return null;b.wrap(O,N);let E=b.doc.resolve(f-1).nodeBefore;return E&&E.type==e&&mr(b.doc,f-1)&&(!i||i(h,E))&&b.join(f-1),b})}function Su(o,e,n=null){return new fn(o,(i,l,h,f)=>{let p=i.doc.resolve(h),y=n instanceof Function?n(l):n;return p.node(-1).canReplaceWith(p.index(-1),p.indexAfter(-1),e)?i.tr.delete(h,f).setBlockType(h,h,e,y):null})}const Wi="ProseMirror-prompt";function Cu(o){let e=document.body.appendChild(document.createElement("div"));e.className=Wi;let n=N=>{e.contains(N.target)||i()};setTimeout(()=>window.addEventListener("mousedown",n),50);let i=()=>{window.removeEventListener("mousedown",n),e.parentNode&&e.parentNode.removeChild(e)},l=[];for(let N in o.fields)l.push(o.fields[N].render());let h=document.createElement("button");h.type="submit",h.className=Wi+"-submit",h.textContent="OK";let f=document.createElement("button");f.type="button",f.className=Wi+"-cancel",f.textContent="Cancel",f.addEventListener("click",i);let p=e.appendChild(document.createElement("form"));o.title&&(p.appendChild(document.createElement("h5")).textContent=o.title),l.forEach(N=>{p.appendChild(document.createElement("div")).appendChild(N)});let y=p.appendChild(document.createElement("div"));y.className=Wi+"-buttons",y.appendChild(h),y.appendChild(document.createTextNode(" ")),y.appendChild(f);let b=e.getBoundingClientRect();e.style.top=(window.innerHeight-b.height)/2+"px",e.style.left=(window.innerWidth-b.width)/2+"px";let S=()=>{let N=Ay(o.fields,l);N&&(i(),o.callback(N))};p.addEventListener("submit",N=>{N.preventDefault(),S()}),p.addEventListener("keydown",N=>{N.keyCode==27?(N.preventDefault(),i()):N.keyCode==13&&!(N.ctrlKey||N.metaKey||N.shiftKey)?(N.preventDefault(),S()):N.keyCode==9&&window.setTimeout(()=>{e.contains(document.activeElement)||i()},500)});let O=p.elements[0];O&&O.focus()}function Ay(o,e){let n=Object.create(null),i=0;for(let l in o){let h=o[l],f=e[i++],p=h.read(f),y=h.validate(p);if(y)return Iy(f,y),null;n[l]=h.clean(p)}return n}function Iy(o,e){let n=o.parentNode,i=n.appendChild(document.createElement("div"));i.style.left=o.offsetLeft+o.offsetWidth+2+"px",i.style.top=o.offsetTop-5+"px",i.className="ProseMirror-invalid",i.textContent=e,setTimeout(()=>n.removeChild(i),1500)}class Ry{constructor(e){this.options=e}read(e){return e.value}validateType(e){return null}validate(e){return!e&&this.options.required?"Required field":this.validateType(e)||(this.options.validate?this.options.validate(e):null)}clean(e){return this.options.clean?this.options.clean(e):e}}class Zr extends Ry{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.autocomplete="off",e}}function Mu(o,e){let n=o.selection.$from;for(let i=n.depth;i>=0;i--){let l=n.index(i);if(n.node(i).canReplaceWith(l,l,e))return!0}return!1}function zy(o){return new yt({title:"Insert image",label:"Image",enable(e){return Mu(e,o)},run(e,n,i){let{from:l,to:h}=e.selection,f=null;e.selection instanceof J&&e.selection.node.type==o&&(f=e.selection.node.attrs),Cu({title:"Insert image",fields:{src:new Zr({label:"Location",required:!0,value:f&&f.src}),title:new Zr({label:"Title",value:f&&f.title}),alt:new Zr({label:"Description",value:f?f.alt:e.doc.textBetween(l,h," ")})},callback(p){i.dispatch(i.state.tr.replaceSelectionWith(o.createAndFill(p))),i.focus()}})}})}function vu(o,e){let n={label:e.title,run:o};for(let i in e)n[i]=e[i];return!e.enable&&!e.select&&(n[e.enable?"enable":"select"]=i=>o(i)),new yt(n)}function pl(o,e){let{from:n,$from:i,to:l,empty:h}=o.selection;return h?!!e.isInSet(o.storedMarks||i.marks()):o.doc.rangeHasMark(n,l,e)}function js(o,e){let n={active(i){return pl(i,o)}};for(let i in e)n[i]=e[i];return vu(nn(o),n)}function Py(o){return new yt({title:"Add or remove link",icon:st.link,active(e){return pl(e,o)},enable(e){return!e.selection.empty},run(e,n,i){if(pl(e,o))return nn(o)(e,n),!0;Cu({title:"Create a link",fields:{href:new Zr({label:"Link target",required:!0}),title:new Zr({label:"Title"})},callback(l){nn(o,l)(i.state,i.dispatch),i.focus()}})}})}function Wd(o,e){return vu(ll(o,e.attrs),e)}function By(o){let e={},n;(n=o.marks.strong)&&(e.toggleStrong=js(n,{title:"Toggle strong style",icon:st.strong})),(n=o.marks.em)&&(e.toggleEm=js(n,{title:"Toggle emphasis",icon:st.em})),(n=o.marks.code)&&(e.toggleCode=js(n,{title:"Toggle code font",icon:st.code})),(n=o.marks.link)&&(e.toggleLink=Py(n));let i;if((i=o.nodes.image)&&(e.insertImage=zy(i)),(i=o.nodes.bullet_list)&&(e.wrapBulletList=Wd(i,{title:"Wrap in bullet list",icon:st.bulletList})),(i=o.nodes.ordered_list)&&(e.wrapOrderedList=Wd(i,{title:"Wrap in ordered list",icon:st.orderedList})),(i=o.nodes.blockquote)&&(e.wrapBlockQuote=uy(i,{title:"Wrap in block quote",icon:st.blockquote})),(i=o.nodes.paragraph)&&(e.makeParagraph=Ks(i,{title:"Change to paragraph",label:"Plain"})),(i=o.nodes.code_block)&&(e.makeCodeBlock=Ks(i,{title:"Change to code block",label:"Code"})),i=o.nodes.heading)for(let h=1;h<=10;h++)e["makeHead"+h]=Ks(i,{title:"Change to heading "+h,label:"Level "+h,attrs:{level:h}});if(i=o.nodes.horizontal_rule){let h=i;e.insertHorizontalRule=new yt({title:"Insert horizontal rule",label:"Horizontal rule",enable(f){return Mu(f,h)},run(f,p){p(f.tr.replaceSelectionWith(h.create()))}})}let l=h=>h.filter(f=>f);return e.insertMenu=new qd(l([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new qd(l([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new oy(l([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[l([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[l([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,ay,cy,hy])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[dy,fy]],e.blockMenu),e}const Jd=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Vy(o,e){let n={},i;function l(h,f){if(e){let p=e[h];if(p===!1)return;p&&(h=p)}n[h]=f}if(l("Mod-z",lo),l("Shift-Mod-z",oi),l("Backspace",Cy),Jd||l("Mod-y",oi),l("Alt-ArrowUp",al),l("Alt-ArrowDown",R1),l("Mod-BracketLeft",cl),l("Escape",hl),(i=o.marks.strong)&&(l("Mod-b",nn(i)),l("Mod-B",nn(i))),(i=o.marks.em)&&(l("Mod-i",nn(i)),l("Mod-I",nn(i))),(i=o.marks.code)&&l("Mod-`",nn(i)),(i=o.nodes.bullet_list)&&l("Shift-Ctrl-8",ll(i)),(i=o.nodes.ordered_list)&&l("Shift-Ctrl-9",ll(i)),(i=o.nodes.blockquote)&&l("Ctrl->",dl(i)),i=o.nodes.hard_break){let h=i,f=po(uu,(p,y)=>(y&&y(p.tr.replaceSelectionWith(h.create()).scrollIntoView()),!0));l("Mod-Enter",f),l("Shift-Enter",f),Jd&&l("Ctrl-Enter",f)}if((i=o.nodes.list_item)&&(l("Enter",l1(i)),l("Mod-[",a1(i)),l("Mod-]",d1(i))),(i=o.nodes.paragraph)&&l("Shift-Ctrl-0",ji(i)),(i=o.nodes.code_block)&&l("Shift-Ctrl-\\",ji(i)),i=o.nodes.heading)for(let h=1;h<=6;h++)l("Shift-Ctrl-"+h,ji(i,{level:h}));if(i=o.nodes.horizontal_rule){let h=i;l("Mod-_",(f,p)=>(p&&p(f.tr.replaceSelectionWith(h.create()).scrollIntoView()),!0))}return n}function Fy(o){return El(/^\s*>\s$/,o)}function Ly(o){return El(/^(\d+)\.\s$/,o,e=>({order:+e[1]}),(e,n)=>n.childCount+n.attrs.order==+e[1])}function qy(o){return El(/^\s*([-+*])\s$/,o)}function $y(o){return Su(/^```$/,o)}function Wy(o,e){return Su(new RegExp("^(#{1,"+e+"})\\s$"),o,n=>({level:n[1].length}))}function Jy(o){let e=Ey.concat(vy,My),n;return(n=o.nodes.blockquote)&&e.push(Fy(n)),(n=o.nodes.ordered_list)&&e.push(Ly(n)),(n=o.nodes.bullet_list)&&e.push(qy(n)),(n=o.nodes.code_block)&&e.push($y(n)),(n=o.nodes.heading)&&e.push(Wy(n,6)),Sy({rules:e})}function Hy(o){let e=[Jy(o.schema),Bd(Vy(o.schema,o.mapKeys)),Bd(K1),j1(),X1()];return o.menuBar!==!1&&e.push(my({floating:o.floatingMenu!==!1,content:o.menuContent||By(o.schema).fullMenu})),o.history!==!1&&e.push(O1()),e.concat(new Fn({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}const Hd=new lf({nodes:o1(Pd.spec.nodes,"paragraph block*","block"),marks:Pd.spec.marks});window.view=new q0(document.querySelector("#editor"),{state:ir.create({doc:cr.fromSchema(Hd).parse(document.querySelector("#content")),plugins:Hy({schema:Hd})})});
