import{c as q,B as H,y as G,z as K,P as W,A as Q,j as n,p as y,n as g,C as Z}from"./@udecode/plate-BPvte4DK.js";import{aK as J,aL as ee,aM as S,aN as te,aO as E,aP as N,aC as D,aQ as ae,a4 as B,aR as ne,a5 as b,aS as v,aT as se,aU as R,aV as re,aW as oe,aX as w,aY as A,aZ as j,a_ as ie,a$ as le,b0 as ce,b1 as ue,b2 as me,W as de,b3 as fe,b4 as xe,b5 as he,b6 as _,b7 as ve,b8 as ge,b9 as Ce,ba as je,bb as pe,bc as be,bd as O,be as T,bf as Me,bg as ye,bh as L,bi as Se,bj as Ne,bk as De,bl as Ie}from"./en-US-X456fi_3.js";import{r as x}from"./react-uubelm5h.js";var P=Object.getOwnPropertySymbols,we=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,_e=(e,a)=>{var t={};for(var s in e)we.call(e,s)&&a.indexOf(s)<0&&(t[s]=e[s]);if(e!=null&&P)for(var s of P(e))a.indexOf(s)<0&&Ae.call(e,s)&&(t[s]=e[s]);return t},Oe=({editor:e,getOptions:a})=>{const{normalizeNode:t}=e;return e.normalizeNode=([s,r])=>{const i=a(),{level:l,type:o}=i,m=_e(i,["level","type"]);if(r.length===0){const c=G(e,l),d=c==null?void 0:c[0];if(!d||d.type!==o&&K(c,m)){const C=c?W.next(c[1]):[0];Q(e,e.api.create.block({type:o},C),{at:C});return}}return t([s,r])},e},rt=q({key:"trailingBlock",extendEditor:Oe,options:{level:0}}).extend(({editor:e})=>({options:{type:e.getType(H)}}));/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=J("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var I="Avatar",[Ee,ot]=ee(I),[Be,k]=Ee(I),z=x.forwardRef((e,a)=>{const{__scopeAvatar:t,...s}=e,[r,i]=x.useState("idle");return n.jsx(Be,{scope:t,imageLoadingStatus:r,onImageLoadingStatusChange:i,children:n.jsx(S.span,{...s,ref:a})})});z.displayName=I;var F="AvatarImage",X=x.forwardRef((e,a)=>{const{__scopeAvatar:t,src:s,onLoadingStatusChange:r=()=>{},...i}=e,l=k(F,t),o=Re(s,i.referrerPolicy),m=te(c=>{r(c),l.onImageLoadingStatusChange(c)});return E(()=>{o!=="idle"&&m(o)},[o,m]),o==="loaded"?n.jsx(S.img,{...i,ref:a,src:s}):null});X.displayName=F;var V="AvatarFallback",U=x.forwardRef((e,a)=>{const{__scopeAvatar:t,delayMs:s,...r}=e,i=k(V,t),[l,o]=x.useState(s===void 0);return x.useEffect(()=>{if(s!==void 0){const m=window.setTimeout(()=>o(!0),s);return()=>window.clearTimeout(m)}},[s]),l&&i.imageLoadingStatus!=="loaded"?n.jsx(S.span,{...r,ref:a}):null});U.displayName=V;function Re(e,a){const[t,s]=x.useState("idle");return E(()=>{if(!e){s("error");return}let r=!0;const i=new window.Image,l=o=>()=>{r&&s(o)};return s("loading"),i.onload=l("loaded"),i.onerror=l("error"),i.src=e,a&&(i.referrerPolicy=a),()=>{r=!1}},[e,a]),t}var Te=z,Le=X,ke=U;const ze=y(Te,"relative flex size-10 shrink-0 overflow-hidden rounded-full"),Fe=y(Le,"aspect-square size-full"),Xe=y(ke,"flex size-full items-center justify-center rounded-full bg-muted");function Y({userId:e}){var s;const{useOption:a}=N(D),t=a("userById",e);return t?n.jsxs(ze,{className:"size-5",children:[n.jsx(Fe,{alt:t.name,src:t.avatarUrl}),n.jsx(Xe,{children:(s=t.name)==null?void 0:s[0]})]}):null}function Ve(){const{useOption:e}=N(D),a=e("myUserId");return n.jsxs("div",{className:"flex w-full space-x-2",children:[n.jsx(Y,{userId:a}),n.jsxs("div",{className:"flex grow flex-col items-end gap-2",children:[n.jsx(ae,{className:B()}),n.jsx(ne,{className:g(b({size:"sm"}),"w-[90px]"),children:"Comment"})]})]})}function p(e,a){const t=+v(e)-+v(a);return t<0?-1:t>0?1:t}function Ue(e){return a=>{const s=(e?Math[e]:Math.trunc)(a);return s===0?0:s}}function Ye(e,a){return+v(e)-+v(a)}function $e(e,a){const t=v(e,a==null?void 0:a.in);return t.setHours(23,59,59,999),t}function qe(e,a){const t=v(e,a==null?void 0:a.in);return+$e(t,a)==+se(t,a)}function He(e,a,t){const[s,r,i]=R(t==null?void 0:t.in,e,e,a),l=p(r,i),o=Math.abs(re(r,i));if(o<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-l*o);let m=p(r,i)===-l;qe(s)&&o===1&&p(s,i)===1&&(m=!1);const c=l*(o-+m);return c===0?0:c}function Ge(e,a,t){const s=Ye(e,a)/1e3;return Ue(t==null?void 0:t.roundingMethod)(s)}function Ke(e,a,t){const s=ie(),r=(t==null?void 0:t.locale)??s.locale??oe,i=2520,l=p(e,a);if(isNaN(l))throw new RangeError("Invalid time value");const o=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:l}),[m,c]=R(t==null?void 0:t.in,...l>0?[a,e]:[e,a]),d=Ge(c,m),C=(w(c)-w(m))/1e3,u=Math.round((d-C)/60);let h;if(u<2)return t!=null&&t.includeSeconds?d<5?r.formatDistance("lessThanXSeconds",5,o):d<10?r.formatDistance("lessThanXSeconds",10,o):d<20?r.formatDistance("lessThanXSeconds",20,o):d<40?r.formatDistance("halfAMinute",0,o):d<60?r.formatDistance("lessThanXMinutes",1,o):r.formatDistance("xMinutes",1,o):u===0?r.formatDistance("lessThanXMinutes",1,o):r.formatDistance("xMinutes",u,o);if(u<45)return r.formatDistance("xMinutes",u,o);if(u<90)return r.formatDistance("aboutXHours",1,o);if(u<A){const f=Math.round(u/60);return r.formatDistance("aboutXHours",f,o)}else{if(u<i)return r.formatDistance("xDays",1,o);if(u<j){const f=Math.round(u/A);return r.formatDistance("xDays",f,o)}else if(u<j*2)return h=Math.round(u/j),r.formatDistance("aboutXMonths",h,o)}if(h=He(c,m),h<12){const f=Math.round(u/j);return r.formatDistance("xMonths",f,o)}else{const f=h%12,M=Math.trunc(h/12);return f<3?r.formatDistance("aboutXYears",M,o):f<9?r.formatDistance("overXYears",M,o):r.formatDistance("almostXYears",M+1,o)}}function We(){const e=le(),{props:a}=ve(e),t=ce(),{props:s}=ge(t);return n.jsxs(ue,{modal:!1,children:[n.jsx(me,{asChild:!0,children:n.jsx(de,{variant:"ghost",className:g("h-6 p-1 text-muted-foreground"),children:n.jsx(fe,{className:"size-4"})})}),n.jsx(xe,{children:n.jsxs(he,{children:[n.jsx(_,{...a,children:"Edit comment"}),n.jsx(_,{...s,children:"Delete comment"})]})})]})}function Qe(){const e=Ce();return n.jsx(je,{className:g(b({variant:"ghost"}),"h-6 p-1 text-muted-foreground"),children:e.isResolved?n.jsx(Pe,{className:"size-4"}):n.jsx(pe,{className:"size-4"})})}function Ze(){return n.jsxs("div",{className:"my-2 flex flex-col items-end gap-2",children:[n.jsx(be,{className:g(B(),"min-h-[60px]")}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(O.CancelButton,{className:b({size:"xs",variant:"outline"}),children:"Cancel"}),n.jsx(O.SaveButton,{className:b({size:"xs",variant:"default"}),children:"Save"})]})]})}function Je(){const{comment:e,commentText:a,editingValue:t,isMyComment:s,isReplyComment:r,user:i}=Me();return n.jsxs("div",{children:[n.jsxs("div",{className:"relative flex items-center gap-2",children:[n.jsx(Y,{userId:e.userId}),n.jsx("h4",{className:"text-sm font-semibold leading-none",children:i==null?void 0:i.name}),n.jsxs("div",{className:"text-xs leading-none text-muted-foreground",children:[Ke(e.createdAt,Date.now())," ago"]}),s&&n.jsxs("div",{className:"absolute -right-0.5 -top-0.5 flex space-x-1",children:[r?null:n.jsx(Qe,{}),n.jsx(We,{})]})]}),n.jsx("div",{className:"mb-4 pl-7 pt-0.5",children:t?n.jsx(Ze,{}):n.jsx("div",{className:"whitespace-pre-wrap text-sm",children:a})})]})}function $({commentId:e}){const{useOption:a}=N(D);return a("commentById",e)?n.jsx(T,{id:e,children:n.jsx(Je,{})},e):null}function et(){const e=ye(L);return n.jsx(n.Fragment,{children:Object.keys(e).map(a=>n.jsx($,{commentId:a},a))})}function tt(e){const{disableForm:a}=e,{activeCommentId:t,hasNoComment:s,myUserId:r,ref:i}=De();return n.jsx(T,{id:t,scope:L,children:n.jsxs("div",{ref:i,className:g(Ie(),"relative w-[310px]"),children:[!s&&n.jsxs(n.Fragment,{children:[n.jsx($,{commentId:t},t),n.jsx(et,{})]}),!!r&&!a&&n.jsx(Ve,{})]})},t)}function it(){const{activeCommentId:e,loaded:a}=Se();return!a||!e?null:n.jsx(Z,{children:n.jsx(Ne,{className:"absolute z-50 w-[418px] pb-4","data-popover":!0,children:n.jsx(tt,{})})})}export{it as C,rt as T};
